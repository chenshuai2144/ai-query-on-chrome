# 🧐[问题 | question] antd pro v5中，从服务器获取菜单之后，也在routes.ts中申明了路由和组件关系，components代码也有，但是Layout会失效，是什么问题？

`🤔 Need Reproduce`,`AI Reply`

### 🧐 问题描述 | antd pro v5中，从服务器获取菜单之后，也在routes.ts中申明了路由和组件关系，components代码也有，但是Layout会失效，是什么问题？怎么解决呀？

**前置条件**：当我从后台服务器获取到菜单，并且在routes.ts中申明了路由和组件关系后，菜单正确渲染出来了

**问题**：但当我点击菜单上的子菜单，左边的菜单栏以及顶栏会消失，Layout失效了，而是重新展示一个页面

### 💻 示例代码 | Sample code

```tsx
/** app.tsx */
export const layout: RunTimeLayoutConfig = ({ initialState, setInitialState }) => {
  return {
    menu: {
      // 每当 initialState?.currentUser?.userid 发生修改时重新执行 request
      params: initialState,
      request: async (params, defaultMenuData) => {
          //获取 initialState 中的路由树
        return initialState?.currentUser?.routeTree || defaultMenuData;
      },
    },
    menuDataRender: (menuData: MenuDataItem[]) => {
      console.log(menuData)
        //渲染一级菜单的图标
      return fixMenuItemIcon(menuData)
    },
    rightContentRender: () => <RightContent />,
    disableContentMargin: false,
    waterMarkProps: {
      content: initialState?.currentUser?.realname,
    },
    footerRender: () => <Footer />,
    onPageChange: () => {
      const { location } = history;
      // 如果没有登录，重定向到 login
      if (location.pathname !== loginPath && location.pathname !== loginResultPath) {
        const token = localStorage.getItem('token');
        if (!token){
          history.push(loginPath);
        }
      }
    },
    links: isDev
      ? [
          <Link key="openapi" to="/umi/plugin/openapi" target="_blank">
            <LinkOutlined />
            <span>OpenAPI 文档</span>
          </Link>,
          <Link to="/~docs" key="docs">
            <BookOutlined />
            <span>业务组件文档</span>
          </Link>,
        ]
      : [],
    menuHeaderRender: undefined,
    // 自定义 403 页面
    // unAccessible: <div>unAccessible</div>,
    // 增加一个 loading 的状态
    childrenRender: (children, props) => {
      // if (initialState?.loading) return <PageLoading />;
      return (
        <>
          {children}
          {!props.location?.pathname?.includes('/login') && (
            <SettingDrawer
              disableUrlParams
              enableDarkTheme
              settings={initialState?.settings}
              onSettingChange={(settings) => {
                setInitialState((preInitialState) => ({
                  ...preInitialState,
                  settings,
                }));
              }}
            />
          )}
        </>
      );
    },
    ...initialState?.settings,
  };
```

```tsx
/** fixMenuItemIcon.tsx */
import type { MenuDataItem } from "@ant-design/pro-components";
import React from "react";
import * as allIcons from "@ant-design/icons";

const fixMenuItemIcon = (
  menus: MenuDataItem[],
  iconType = "Outlined",
): MenuDataItem[] => {
  menus.forEach((item) => {
    const { icon, children } = item;
    if (typeof icon === "string") {
      const fixIconName =
        icon.slice(0, 1).toLocaleUpperCase() + icon.slice(1) + iconType;
      item.icon = React.createElement(allIcons[fixIconName] || allIcons[icon]);
    }
    // eslint-disable-next-line @typescript-eslint/no-unused-expressions
    children && children.length > 0
      ? (item.children = fixMenuItemIcon(children))
      : null;
  });
  return menus;
};

export default fixMenuItemIcon;
```

```tsx
/** routes.ts */
export default [
  {
    path: "/user",
    layout: false,
    routes: [
      { name: "登录", path: "/user/login", component: "./user/Login" },
      {
        name: "登录中间页",
        path: "/user/login-result",
        component: "./user/LoginResult",
      },
      { component: "./404" },
    ],
  },
  {
    path: "/home",
    name: "翼存云数平台首页",
    icon: "HomeOutlined",
    component: "./Home",
  },
  {
    path: "/oos",
    name: "oos",
    routes: [
      { path: "/oos/amount", name: "amount", component: "./Oos/Amount" },
      { path: "/oos/rate", name: "rate", component: "./Oos/Rate" },
      { path: "/oos/oos-apm-speed", name: "apm", component: "./Oos/Apm" },
      {
        path: "/oos/oos-bucket-list",
        name: "bucket-manage",
        component: "./Oos/Manage/BucketManage",
      },
      {
        path: "/oos/oos-list",
        name: "oos-manage",
        component: "./Oos/Manage/OosManage",
      },
      {
        path: "/oos/user-type-manage",
        name: "user-type-manage",
        component: "./Oos/Manage/UserTypeManage",
      },
      { component: "./404" },
    ],
  },
  { path: "/", redirect: "/home" },
  { component: "./404" },
];
```

```json
//后台获取到的路由树详情
[
  {
    "path": "/oos",
    "icon": "CloudServerOutlined",
    "name": "oos",
    "hideChildrenInMenu": false,
    "hideInMenu": false,
    "hideInBreadcrumb": false,
    "headerRender": false,
    "footerRender": false,
    "menuRender": false,
    "menuHeaderRender": false,
    "routes": [
      {
        "component": "./Oos/Amount",
        "path": "/oos/amount",
        "name": "amount",
        "hideChildrenInMenu": false,
        "hideInMenu": false,
        "hideInBreadcrumb": false,
        "headerRender": false,
        "footerRender": false,
        "menuRender": false,
        "menuHeaderRender": false,
        "routes": []
      },
      {
        "component": "./Oos/Apm",
        "path": "/oos/oos-apm-speed",
        "name": "apm",
        "hideChildrenInMenu": false,
        "hideInMenu": false,
        "hideInBreadcrumb": false,
        "headerRender": false,
        "footerRender": false,
        "menuRender": false,
        "menuHeaderRender": false,
        "routes": []
      },
      {
        "component": "./Oos/Manage/BucketManage",
        "path": "/oos/oos-bucket-list",
        "name": "bucket-manage",
        "hideChildrenInMenu": false,
        "hideInMenu": false,
        "hideInBreadcrumb": false,
        "headerRender": false,
        "footerRender": false,
        "menuRender": false,
        "menuHeaderRender": false,
        "routes": []
      },
      {
        "component": "./Oos/Manage/OosManage",
        "path": "/oos/oos-list",
        "name": "oos-manage",
        "hideChildrenInMenu": false,
        "hideInMenu": false,
        "hideInBreadcrumb": false,
        "headerRender": false,
        "footerRender": false,
        "menuRender": false,
        "menuHeaderRender": false,
        "routes": []
      }
    ]
  }
]
```

### 🚑 其他信息 | Other information

OS: Windows10

Node：v14.19.1

浏览器 | browser：Chrome

## chenshuai2144

搞个重现出来看看

## chenshuai2144

> TAutomatically replying with ChatGPT can be attempted, but it cannot be guaranteed to be completely accurate and may not fully address all issues. Please feel free to reply if you have any further questions or concerns.
> 此回复基于 ChatGPT 自动生成，可以尝试下方案，官方人员会在一定时间后继续继续处理。

## xiaofeisss

"menuRender": false,这个属性在菜单中 会让菜单不显示，为false时，不显示。为true时 白屏

## xiaofeisss

"menuRender": false,这个属性在菜单中 会让菜单不显示，为false时，不显示。为true时 白屏

## chenshuai2144

menuRender 设置成 undfined，不能设置成true的
