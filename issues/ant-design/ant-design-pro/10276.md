# ğŸ› [BUG]Login successful but can't redirect to â€˜/welcomeâ€™ and logout error

### ğŸ› bug æè¿°

1ã€ç™»å½•æˆåŠŸï¼Œä½†æ˜¯æ— æ³•è½¬è·³åˆ°â€˜/welcomeâ€™é¡µé¢ï¼Œå°¤å…¶åœ¨ç‚¹å‡»é€€å‡ºç™»å½•ä¹‹åå†ç™»å½•ï¼Œ100%å¤ç°ã€‚
2ã€é€€å‡ºç™»å½•å‡ºé”™ï¼Œé”™è¯¯ä¿¡æ¯
Unhandled Rejection (TypeError): URL constructor: is not a valid URL.

### ğŸ“· å¤ç°æ­¥éª¤ | Recurrence steps

1ã€æŒ‰ç…§å®˜æ–¹æ•™ç¨‹ä½¿ç”¨umi@4åˆ›å»ºä¸€ä¸ªæ–°çš„proé¡¹ç›®
2ã€ä½¿ç”¨npm run start è¿è¡Œé¡¹ç›®
3ã€æ‰“å¼€ http://localhost:8000 ç™»å½•é¡¹ç›®ï¼Œç¨³å®šå¤ç°ï¼ŒåŒæ—¶consoleè¿˜ä¼šæœ‰å¦å¤–ä¸€ä¸ªé”™è¯¯ï¼ˆè§ä¸‹å›¾1ï¼‰
4ã€å†æ¬¡è®¿é—® http://localhost:8000 ï¼Œå‘ç°å·²ç»è‡ªåŠ¨è½¬è·³åˆ°welcomeé¡µé¢
5ã€ç‚¹å‡»é€€å‡ºç™»å½•ï¼Œå‡ºç°é”™è¯¯ï¼ˆè§ä¸‹å›¾2ï¼‰

### ğŸ æœŸæœ›ç»“æœ | Expected results

æˆ‘ä½¿ç”¨è¿‡æ—§ç‰ˆçš„ant design pro 6.0.0.beta.1 é…åˆçš„å¤§æ¦‚æ˜¯umi < 4.0.20ï¼Œå½“æ—¶æ—¶æ­£å¸¸çš„ï¼Œåæ¥å› ä¸ºä¸€ä¸ªå…¶ä»–çš„bugæˆ‘å‡çº§äº†umiçš„ç‰ˆæœ¬ï¼Œå°±å¼€å§‹å‡ºé—®é¢˜äº†ï¼Œåç»­æˆ‘å‘ç°é‡æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„é¡¹ç›®ï¼Œä¹Ÿä¼šç¨³å®šå¤ç°ï¼Œæ‰€ä»¥å¤§æ¦‚åˆ¤æ–­æ˜¯ä¸€ä¸ªBUGã€‚

### ğŸ’» å¤ç°ä»£ç  | Recurrence code

ç›´æ¥æŒ‰ç…§å®˜æ–¹æ•™ç¨‹åˆå§‹åŒ–ä¸€ä¸ªé¡¹ç›®å³å¯

### Â© ç‰ˆæœ¬ä¿¡æ¯

- Ant Design Pro ç‰ˆæœ¬: 6.0.0-beta.1
- umi ç‰ˆæœ¬ 4.0.24
- æµè§ˆå™¨ç¯å¢ƒ chrome 106.0.5249.103 (64ä½)
- å¼€å‘ç¯å¢ƒ [e.g. mac OS] windows 11

### ğŸš‘ å…¶ä»–ä¿¡æ¯

![å›¾ç‰‡](https://user-images.githubusercontent.com/13165391/194705570-97485f57-5d78-4b06-82a0-76c55cf4b633.png)

![å›¾ç‰‡](https://user-images.githubusercontent.com/13165391/194705547-ba8e816b-6249-4f10-8e7e-2ac33e4e5f20.png)

## PandaYip

ä¸ºäº†æ–¹ä¾¿å¤§ä½¬ä»¬debugï¼Œæˆ‘æŠŠæˆ‘çš„package.jsonè´´åœ¨è¿™é‡Œ

> {
> "name": "ant-design-pro",
> "version": "6.0.0-beta.1",
> "private": true,
> "description": "An out-of-box UI solution for enterprise applications",
> "scripts": {
> "analyze": "cross-env ANALYZE=1 max build",
> "build": "max build",
> "deploy": "npm run build && npm run gh-pages",
> "dev": "npm run start:dev",
> "gh-pages": "gh-pages -d dist",
> "i18n-remove": "pro i18n-remove --locale=zh-CN --write",
> "postinstall": "max setup",
> "lint": "npm run lint:js && npm run lint:prettier && npm run tsc",
> "lint-staged": "lint-staged",
> "lint-staged:js": "eslint --ext .js,.jsx,.ts,.tsx ",
> "lint:fix": "eslint --fix --cache --ext .js,.jsx,.ts,.tsx --format=pretty ./src ",
> "lint:js": "eslint --cache --ext .js,.jsx,.ts,.tsx --format=pretty ./src",
> "lint:prettier": "prettier -c --write \"src/**/\*\" --end-of-line auto",
> "openapi": "max openapi",
> "playwright": "playwright install && playwright test",
> "prepare": "husky install",
> "prettier": "prettier -c --write \"src/**/_\"",
> "serve": "umi-serve",
> "start": "cross-env UMI_ENV=dev max dev",
> "start:dev": "cross-env REACT_APP_ENV=dev MOCK=none UMI_ENV=dev max dev",
> "start:no-mock": "cross-env MOCK=none UMI_ENV=dev max dev",
> "start:pre": "cross-env REACT_APP_ENV=pre UMI_ENV=dev max dev",
> "start:test": "cross-env REACT_APP_ENV=test MOCK=none UMI_ENV=dev max dev",
> "test:e2e": "node ./tests/run-tests.js",
> "tsc": "tsc --noEmit"
> },
> "lint-staged": {
> "\*\*/_.{js,jsx,ts,tsx}": "npm run lint-staged:js",
> "\*_/_.{js,jsx,tsx,ts,less,md,json}": [
> > "prettier --write"
> > ]
> },
> "browserslist": [
> > "> 1%",
> > "last 2 versions",
> > "not ie <= 10"
> > ],
> "dependencies": {
> "@ant-design/icons": "^4.7.0",
> "@ant-design/pro-components": "^2.3.13",
> "@umijs/route-utils": "^2.2.0",
> "antd": "^4.23.4",
> "classnames": "^2.3.2",
> "lodash": "^4.17.21",
> "moment": "^2.29.4",
> "omit.js": "^2.0.2",
> "rc-menu": "^9.6.4",
> "rc-util": "^5.24.4",
> "react": "^17.0.0",
> "react-dev-inspector": "^1.8.1",
> "react-dom": "^17.0.2",
> "react-helmet-async": "^1.3.0"
> },
> "devDependencies": {
> "@ant-design/pro-cli": "^2.1.5",
> "@playwright/test": "^1.27.0",
> "@types/classnames": "^2.3.1",
> "@types/express": "^4.17.14",
> "@types/history": "^4.7.11",
> "@types/lodash": "^4.14.186",
> "@types/react": "^17.0.50",
> "@types/react-dom": "^17.0.17",
> "@types/react-helmet": "^6.1.5",
> "@umijs/fabric": "^2.14.0",
> "@umijs/max": "^4.0.24",
> "@umijs/openapi": "^1.7.0",
> "cross-env": "^7.0.3",
> "cross-port-killer": "^1.4.0",
> "detect-installer": "^1.0.2",
> "eslint": "^7.32.0",
> "gh-pages": "^3.2.3",
> "husky": "^7.0.4",
> "lint-staged": "^10.5.4",
> "mockjs": "^1.1.0",
> "prettier": "^2.7.1",
> "swagger-ui-dist": "^4.14.2",
> "typescript": "^4.8.4",
> "umi-presets-pro": "^1.0.5",
> "umi-serve": "^1.9.11"
> },
> "engines": {
> "node": ">=12.0.0"
> }
> }

## aibps

+1

## PandaYip

æœ€æ—©åœ¨é¡¹ç›®ä¸­åº”ç”¨çš„æ—¶å€™ï¼Œant design pro ä¹Ÿæ˜¯6.0.0-beta.1ï¼Œumi< 4.0.20ï¼Œeverything works
ç„¶åå› ä¸ºå…¶ä»–çš„bugï¼Œæˆ‘æŠŠä¾èµ–å‡çº§äº† umi å‡çº§åˆ°äº† 4.0.20 ï¼Œç„¶åå°±å‘ç°è¿™ä¸ªbugï¼Œæˆ‘æœ€æ—©ä»¥ä¸ºæ˜¯æˆ‘ä¿®æ”¹äº†ç™»å½•è·ŸcurrentUserç›¸å…³çš„ä»£ç å¯¼è‡´çš„ã€‚
ç„¶åæˆ‘åˆæ›´æ–°äº†æ‰€æœ‰ä¾èµ–ï¼Œå‘ç°é—®é¢˜ä¾æ—§ï¼Œè¿˜å¼•å…¥äº†ä¸€ä¸ªant.design Tabsç›¸å…³çš„åºŸå¼ƒå‘Šè­¦ï¼Œæˆ‘éƒ½æ‰‹å·¥fixäº†ï¼Œå‘ç°è¿™ä¸ªé—®é¢˜ä¾ç„¶æ²¡æœ‰æ”¹å–„ã€‚
æœ€åæˆ‘æ–°å»ºäº†ä¸€ä¸ªæµ‹è¯•é¡¹ç›®ï¼Œå‘ç°åŸæ¥æ˜¯ç¨³å®šå¤ç°çš„ã€‚
æˆ‘çš„ä¸‹ä¸€æ­¥è®¡åˆ’æ˜¯é™çº§umiçš„ç‰ˆæœ¬çœ‹çœ‹

## ghost

+1

## xiaohuoni

https://github.com/ant-design/ant-design-pro/pull/10257/files
è¿™ä¸ªæ”¹ä¸€ä¸‹ï¼Œconst urlParams = new URL(window.location.href).searchParams;

## guwan

> https://github.com/ant-design/ant-design-pro/pull/10257/files è¿™ä¸ªæ”¹ä¸€ä¸‹ï¼Œconst urlParams = new URL(window.location.href).searchParams;

æˆ‘ä¹Ÿç¢°åˆ°äº†è¿™ä¸ªé—®é¢˜ï¼Œè¿™ä¸ªä¿®æ”¹å¹¶ä¸ç”Ÿæ•ˆï¼Œæˆ‘çš„æƒé™æ˜¯ä»åå°è·å–çš„ã€‚
è¿™ä¸ªä¿®æ”¹é‡Œé¢æœ€å…³é”®çš„ä¸€ç‚¹æ˜¯await refresh();è€Œè¿™ä¼šå°†æˆ‘åå°è·å–åˆ°çš„ç›®å½•æƒé™åˆ·æ–°æ‰ã€‚
