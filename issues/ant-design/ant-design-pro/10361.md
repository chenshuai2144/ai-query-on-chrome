# 🐛 [BUG] Upload组件，按照官方案例写的代码，文件一直loading

`AI Reply`

### 🐛 bug 描述

<!--
详细地描述 bug，让大家都能理解
Describe the bug in detail so that everyone can understand it
-->

上传文件通常有后续处理，用到customRequest, 我按照官方案例写的上传，文件一直loading状态。从日志看progress已经100%， onSuccess也调用。
官方案例：
https://github.com/react-component/upload/blob/master/docs/examples/customRequest.tsx

<!--
清晰描述复现步骤，让别人也能看到问题
Clearly describe the recurrence steps so that others can see the problem
-->

1.点击上传按钮选择文件上传2.后台处理完成，上传完成。

### 🏞 期望结果 | Expected results

<!--
描述你原本期望看到的结果
Describe what you expected to see
-->

上传完成loading状态结束。

### 💻 复现代码 | Recurrence code

<!--
提供可复现的代码，仓库，或线上示例
Provide reproducible code, warehouse, or online examples
-->

代码如下：

```
const props = {
    name: 'file',
    action: '/api/upload-data?code=' + dm_code,
    accept: 'file',
    data: {},
    exts: 'xlsx|xls',
    onStart(file) {
      console.log('onStart', file, file.name);
    },
    onSuccess(res, file) {
      console.log('onSuccess', res, file.name);
      message.success(`${file.name} file uploaded successfully`);
    },
    onError(err) {
      console.log('onError', err);
    },
    onProgress({percent}, file) {
      console.log('onProgress', `${percent}`, file.name);
    },
    customRequest({
                    action,
                    data,
                    file,
                    filename,
                    headers,
                    onSuccess,
                    onError,
                    onProgress
                  }) {
      const formData = new FormData();
      formData.append(filename, file);

      axios.post(
        action,
        formData,
        {
          headers,
          onUploadProgress: ({total, loaded}) => {
            onProgress({percent: Math.round((loaded / total) * 100).toFixed(2)}, file);
          },
        })
        .then(({data: response}) => {
          onSuccess(response, file);
        })
        .catch(onError);

      return {
        abort() {
          console.log('upload progress is aborted.');
        },
      };
    }
  };

<ModalForm
        title={dm.name + '数据上传'}
        open={modalVisit}
        onFinish={async () => {
          message.success('提交成功');
          return true;
        }}
        onOpenChange={setModalVisit}
      >
        <Upload {...props}>
          <Button icon={<UploadOutlined/>}>点击上传</Button>
        </Upload>
 </ModalForm>
```

### © 版本信息

- Ant Design Pro 版本: ant-design-pro@6.0.0-beta.1
- umi 版本 Umi v4.0.260.0-beta.1
- 浏览器环境 Edge 107.0.1418.35
- 开发环境 [e.g. mac OS] win11

### 🚑 其他信息

<!--
如截图等其他信息可以贴在这里
-->

![lenovo20221112111309](https://user-images.githubusercontent.com/73603335/201453921-d8fabd2f-d690-4005-bc0f-c46c2680cb4e.png)

## yqz945

如果我import {Upload} from "antd";
这会出现这个问题。

如果我改成 import Upload from 'rc-upload';
上传之后就没有文件列表了。
![lenovo20221112115352](https://user-images.githubusercontent.com/73603335/201455621-11b29285-a46d-4b91-aec1-6d05fc5bde58.png)

## chenshuai2144

你需要受控的处理下fileList的状态。

```
{
      uid: '1',
      name: 'xxx.png',
      status: 'uploading',
      url: 'http://www.baidu.com/xxx.png',
      percent: 33,
    },
```

status: 'uploading', 是上传中， status: 'done', 就是上传完成了
