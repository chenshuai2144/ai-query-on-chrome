# ğŸ› [BUG] Uploadç»„ä»¶ï¼ŒæŒ‰ç…§å®˜æ–¹æ¡ˆä¾‹å†™çš„ä»£ç ï¼Œæ–‡ä»¶ä¸€ç›´loading

`AI Reply`

### ğŸ› bug æè¿°

<!--
è¯¦ç»†åœ°æè¿° bugï¼Œè®©å¤§å®¶éƒ½èƒ½ç†è§£
Describe the bug in detail so that everyone can understand it
-->

ä¸Šä¼ æ–‡ä»¶é€šå¸¸æœ‰åç»­å¤„ç†ï¼Œç”¨åˆ°customRequest, æˆ‘æŒ‰ç…§å®˜æ–¹æ¡ˆä¾‹å†™çš„ä¸Šä¼ ï¼Œæ–‡ä»¶ä¸€ç›´loadingçŠ¶æ€ã€‚ä»æ—¥å¿—çœ‹progresså·²ç»100%ï¼Œ onSuccessä¹Ÿè°ƒç”¨ã€‚
å®˜æ–¹æ¡ˆä¾‹ï¼š
https://github.com/react-component/upload/blob/master/docs/examples/customRequest.tsx

<!--
æ¸…æ™°æè¿°å¤ç°æ­¥éª¤ï¼Œè®©åˆ«äººä¹Ÿèƒ½çœ‹åˆ°é—®é¢˜
Clearly describe the recurrence steps so that others can see the problem
-->

1.ç‚¹å‡»ä¸Šä¼ æŒ‰é’®é€‰æ‹©æ–‡ä»¶ä¸Šä¼ 2.åå°å¤„ç†å®Œæˆï¼Œä¸Šä¼ å®Œæˆã€‚

### ğŸ æœŸæœ›ç»“æœ | Expected results

<!--
æè¿°ä½ åŸæœ¬æœŸæœ›çœ‹åˆ°çš„ç»“æœ
Describe what you expected to see
-->

ä¸Šä¼ å®ŒæˆloadingçŠ¶æ€ç»“æŸã€‚

### ğŸ’» å¤ç°ä»£ç  | Recurrence code

<!--
æä¾›å¯å¤ç°çš„ä»£ç ï¼Œä»“åº“ï¼Œæˆ–çº¿ä¸Šç¤ºä¾‹
Provide reproducible code, warehouse, or online examples
-->

ä»£ç å¦‚ä¸‹ï¼š

```
const props = {
    name: 'file',
    action: '/api/upload-data?code=' + dm_code,
    accept: 'file',
    data: {},
    exts: 'xlsx|xls',
    onStart(file) {
      console.log('onStart', file, file.name);
    },
    onSuccess(res, file) {
      console.log('onSuccess', res, file.name);
      message.success(`${file.name} file uploaded successfully`);
    },
    onError(err) {
      console.log('onError', err);
    },
    onProgress({percent}, file) {
      console.log('onProgress', `${percent}`, file.name);
    },
    customRequest({
                    action,
                    data,
                    file,
                    filename,
                    headers,
                    onSuccess,
                    onError,
                    onProgress
                  }) {
      const formData = new FormData();
      formData.append(filename, file);

      axios.post(
        action,
        formData,
        {
          headers,
          onUploadProgress: ({total, loaded}) => {
            onProgress({percent: Math.round((loaded / total) * 100).toFixed(2)}, file);
          },
        })
        .then(({data: response}) => {
          onSuccess(response, file);
        })
        .catch(onError);

      return {
        abort() {
          console.log('upload progress is aborted.');
        },
      };
    }
  };

<ModalForm
        title={dm.name + 'æ•°æ®ä¸Šä¼ '}
        open={modalVisit}
        onFinish={async () => {
          message.success('æäº¤æˆåŠŸ');
          return true;
        }}
        onOpenChange={setModalVisit}
      >
        <Upload {...props}>
          <Button icon={<UploadOutlined/>}>ç‚¹å‡»ä¸Šä¼ </Button>
        </Upload>
 </ModalForm>
```

### Â© ç‰ˆæœ¬ä¿¡æ¯

- Ant Design Pro ç‰ˆæœ¬: ant-design-pro@6.0.0-beta.1
- umi ç‰ˆæœ¬ Umi v4.0.260.0-beta.1
- æµè§ˆå™¨ç¯å¢ƒ Edge 107.0.1418.35
- å¼€å‘ç¯å¢ƒ [e.g. mac OS] win11

### ğŸš‘ å…¶ä»–ä¿¡æ¯

<!--
å¦‚æˆªå›¾ç­‰å…¶ä»–ä¿¡æ¯å¯ä»¥è´´åœ¨è¿™é‡Œ
-->

![lenovo20221112111309](https://user-images.githubusercontent.com/73603335/201453921-d8fabd2f-d690-4005-bc0f-c46c2680cb4e.png)

## yqz945

å¦‚æœæˆ‘import {Upload} from "antd";
è¿™ä¼šå‡ºç°è¿™ä¸ªé—®é¢˜ã€‚

å¦‚æœæˆ‘æ”¹æˆ import Upload from 'rc-upload';
ä¸Šä¼ ä¹‹åå°±æ²¡æœ‰æ–‡ä»¶åˆ—è¡¨äº†ã€‚
![lenovo20221112115352](https://user-images.githubusercontent.com/73603335/201455621-11b29285-a46d-4b91-aec1-6d05fc5bde58.png)

## chenshuai2144

ä½ éœ€è¦å—æ§çš„å¤„ç†ä¸‹fileListçš„çŠ¶æ€ã€‚

```
{
      uid: '1',
      name: 'xxx.png',
      status: 'uploading',
      url: 'http://www.baidu.com/xxx.png',
      percent: 33,
    },
```

status: 'uploading', æ˜¯ä¸Šä¼ ä¸­ï¼Œ status: 'done', å°±æ˜¯ä¸Šä¼ å®Œæˆäº†
