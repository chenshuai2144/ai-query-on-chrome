# ğŸ› [BUG] overlay is deprecated. Please use menu instead.

`AI Reply`

### ç”¨proè„šæ‰‹æ¶æ–°åˆ›å»ºé¡¹ç›®ä¼šæŠ¥è­¦å‘Š

<!--
è¯¦ç»†åœ°æè¿° bugï¼Œè®©å¤§å®¶éƒ½èƒ½ç†è§£
Describe the bug in detail so that everyone can understand it
-->

### ğŸ“· å¤ç°æ­¥éª¤ | Recurrence steps

<!--
æ¸…æ™°æè¿°å¤ç°æ­¥éª¤ï¼Œè®©åˆ«äººä¹Ÿèƒ½çœ‹åˆ°é—®é¢˜
Clearly describe the recurrence steps so that others can see the problem
-->

### ğŸ æœŸæœ›ç»“æœ | Expected results

<!--
æè¿°ä½ åŸæœ¬æœŸæœ›çœ‹åˆ°çš„ç»“æœ
Describe what you expected to see
-->

### ğŸ’» å¤ç°ä»£ç  | Recurrence code

<!--
æä¾›å¯å¤ç°çš„ä»£ç ï¼Œä»“åº“ï¼Œæˆ–çº¿ä¸Šç¤ºä¾‹
Provide reproducible code, warehouse, or online examples
-->

### Â© ç‰ˆæœ¬ä¿¡æ¯

- Ant Design Pro ç‰ˆæœ¬: [e.g. 4.0.0]
- umi ç‰ˆæœ¬
- æµè§ˆå™¨ç¯å¢ƒ
- å¼€å‘ç¯å¢ƒ [e.g. mac OS]

### ğŸš‘ å…¶ä»–ä¿¡æ¯

<!--
å¦‚æˆªå›¾ç­‰å…¶ä»–ä¿¡æ¯å¯ä»¥è´´åœ¨è¿™é‡Œ
-->
<img width="579" alt="image" src="https://user-images.githubusercontent.com/24800947/201569669-c2cc542f-18f8-495b-b777-d73d073b26ad.png">

## zhou0322-lab

> ### ç”¨proè„šæ‰‹æ¶æ–°åˆ›å»ºé¡¹ç›®ä¼šæŠ¥è­¦å‘Š
>
> ### ğŸ“· å¤ç°æ­¥éª¤ | Recurrence steps
>
> ### ğŸ æœŸæœ›ç»“æœ | Expected results
>
> ### ğŸ’» å¤ç°ä»£ç  | Recurrence code
>
> ### Â© ç‰ˆæœ¬ä¿¡æ¯
>
> - Ant Design Pro ç‰ˆæœ¬: [e.g. 4.0.0]
> - umi ç‰ˆæœ¬
> - æµè§ˆå™¨ç¯å¢ƒ
> - å¼€å‘ç¯å¢ƒ [e.g. mac OS]
>
> ### ğŸš‘ å…¶ä»–ä¿¡æ¯
>
> <img alt="image" width="579" src="https://user-images.githubusercontent.com/24800947/201569669-c2cc542f-18f8-495b-b777-d73d073b26ad.png">

## gaspire

åŒæ ·é—®é¢˜

## jianhao2010303

ç›¸åŒé—®é¢˜

## ming2020

https://ant.design/components/menu/#API

## ming2020

è‡ªå·±æŠŠoverlayæ”¹æˆmenuå°±å¯ä»¥äº†

## jianhao2010303

NoticeIcon è¿™ä¸ªç»„ä»¶å¦‚æœä½¿ç”¨menuä¼šæŠ¥é”™ï¼Œæ¸²æŸ“æ–¹å¼æœæ”¹å˜äº†ã€‚

## EchoNoReturn

Dropdownä¹Ÿä¹Ÿæœ‰è¿™æ ·çš„æŠ¥é”™ï¼Œè€Œä¸”æ”¹æˆmenuä¹Ÿä¼šæŠ¥é”™

## AceLing

é—®é¢˜åŸå› ï¼š
ä½¿ç”¨ Dropdown ç»„ä»¶æ—¶äº§ç”Ÿå…¼å®¹é—®é¢˜

è§£å†³æ–¹æ¡ˆï¼š
å¯¹ç…§ **src/.umi/plugin-locale/SelectLang.tsx**
ä¿®æ”¹ **src/components/RightContent/AvatarDropdown.tsx**

ä¿®æ”¹åçš„ **src/components/RightContent/AvatarDropdown.tsx** ä»£ç 

```
import { outLogin } from '@/services/ant-design-pro/api';
import { LogoutOutlined, SettingOutlined, UserOutlined } from '@ant-design/icons';
import { history, useModel } from '@umijs/max';
import { Avatar, Menu, version, Dropdown, Spin } from 'antd';
import type { ItemType } from 'antd/es/menu/hooks/useItems';
import { stringify } from 'querystring';
import type { MenuInfo } from 'rc-menu/lib/interface';
import React, { useCallback } from 'react';
import { flushSync } from 'react-dom';
// import HeaderDropdown from '../HeaderDropdown';
import type { DropDownProps } from 'antd/es/dropdown';
import styles from './index.less';

export type GlobalHeaderRightProps = {
  menu?: boolean;
};

export interface HeaderDropdownProps extends DropDownProps {
  overlayClassName?: string;
  placement?:
    | 'bottomLeft'
    | 'bottomRight'
    | 'topLeft'
    | 'topCenter'
    | 'topRight'
    | 'bottomCenter';
}

const HeaderDropdown: React.FC<HeaderDropdownProps> = ({
  overlayClassName: cls,
  ...restProps
}) => (
  <Dropdown
    overlayClassName={cls}
    {...restProps}
  />
);

const AvatarDropdown: React.FC<GlobalHeaderRightProps> = (props) => {
  const {
    menu,
    ...restProps
  } = props;
  /**
   * é€€å‡ºç™»å½•ï¼Œå¹¶ä¸”å°†å½“å‰çš„ url ä¿å­˜
   */
  const loginOut = async () => {
    await outLogin();
    const { search, pathname } = window.location;
    const urlParams = new URL(window.location.href).searchParams;
    /** æ­¤æ–¹æ³•ä¼šè·³è½¬åˆ° redirect å‚æ•°æ‰€åœ¨çš„ä½ç½® */
    const redirect = urlParams.get('redirect');
    // Note: There may be security issues, please note
    if (window.location.pathname !== '/user/login' && !redirect) {
      history.replace({
        pathname: '/user/login',
        search: stringify({
          redirect: pathname + search,
        }),
      });
    }
  };
  const { initialState, setInitialState } = useModel('@@initialState');

  const onMenuClick = useCallback(
    (event: MenuInfo) => {
      const { key } = event;
      if (key === 'logout') {
        flushSync(() => {
          setInitialState((s) => ({ ...s, currentUser: undefined }));
        });
        loginOut();
        return;
      }
      history.push(`/account/${key}`);
    },
    [setInitialState],
  );

  const loading = (
    <span className={`${styles.action} ${styles.account}`}>
      <Spin
        size="small"
        style={{
          marginLeft: 8,
          marginRight: 8,
        }}
      />
    </span>
  );

  if (!initialState) {
    return loading;
  }

  const { currentUser } = initialState;

  if (!currentUser || !currentUser.name) {
    return loading;
  }

  const menuItems: ItemType[] = [
    ...(menu
      ? [
          {
            key: 'center',
            icon: <UserOutlined />,
            label: 'ä¸ªäººä¸­å¿ƒ',
          },
          {
            key: 'settings',
            icon: <SettingOutlined />,
            label: 'ä¸ªäººè®¾ç½®',
          },
          {
            type: 'divider' as const,
          },
        ]
      : []),
    {
      key: 'logout',
      icon: <LogoutOutlined />,
      label: 'é€€å‡ºç™»å½•',
    },
  ];

  const avatarMenu = {
    selectedKeys: [],
    className: styles.menu,
    onClick: onMenuClick,
    items: menuItems,
  };

  // antd@5 å’Œ  4.24 ä¹‹åæ¨èä½¿ç”¨ menuï¼Œæ€§èƒ½æ›´å¥½
  const dropdownProps =
    version.startsWith('5.') || version.startsWith('4.24.')
      ? { menu: avatarMenu }
      : { overlay: <Menu {...avatarMenu} /> };

  return (
    <HeaderDropdown {...dropdownProps} placement="bottomRight" {...restProps}>
      <span className={`${styles.action} ${styles.account}`}>
        <Avatar size="small" className={styles.avatar} src={currentUser.avatar} alt="avatar" />
        <span className={`${styles.name} anticon`}>{currentUser.name}</span>
      </span>
    </HeaderDropdown>
  );
};

export default AvatarDropdown;


## hfpp2012copy

ä½ å…¨å±€æœç´¢ overlay å°±å¯ä»¥å…¨éƒ¨æ¸…æ‰ï¼Œå®˜æ–¹ä¹Ÿæœ‰ä»‹ç»æ–¹æ³• https://www.qiuzhi99.com/playlists/antdpro-prisma.html


## chenshuai2144

 > TAutomatically replying with ChatGPT can be attempted, but it cannot be guaranteed to be completely accurate and may not fully address all issues. Please feel free to reply if you have any further questions or concerns.
 > æ­¤å›å¤åŸºäº ChatGPT è‡ªåŠ¨ç”Ÿæˆï¼Œå¯ä»¥å°è¯•ä¸‹æ–¹æ¡ˆï¼Œå®˜æ–¹äººå‘˜ä¼šåœ¨ä¸€å®šæ—¶é—´åç»§ç»­ç»§ç»­å¤„ç†ã€‚

æ˜¯çš„ï¼Œå…¨å±€æœç´¢ overlay å¯ä»¥æ‰¾åˆ°æ‰€æœ‰ä¸æ­¤ç›¸å…³çš„ä»£ç ï¼Œå¹¶è¿›è¡Œä¿®æ”¹ã€‚åœ¨æ»¡è¶³ Ant Design Pro çš„éœ€æ±‚çš„å‰æä¸‹ï¼Œå¯ä»¥å°† overlay æ”¹ä¸º menuï¼Œæˆ–é‡‡ç”¨å®˜æ–¹å»ºè®®çš„ dropdown ä½¿ç”¨æ–¹å¼ã€‚

å¦å¤–ï¼Œåœ¨ Ant Design å®˜æ–¹çš„æ›´æ–°æ—¥å¿—ä¸­ï¼Œä¹Ÿæåˆ°é‡åˆ°ç±»ä¼¼çš„é—®é¢˜æ—¶éœ€è¦æŸ¥çœ‹ç»„ä»¶çš„ API æ–‡æ¡£ï¼Œæ¥å¯»æ‰¾æ–°çš„ API æˆ–å·²ç»åºŸå¼ƒçš„ APIï¼Œç‰¹åˆ«æ˜¯åœ¨è¿›è¡Œé‡å¤§ç‰ˆæœ¬æ›´æ–°æ—¶ã€‚

å…·ä½“å‚è€ƒé“¾æ¥ï¼š
- https://www.qiuzhi99.com/playlists/antdpro-prisma.html
- https://ant.design/changelog-cn#%E9%A1%B9%E7%9B%AE%E6%9B%B4%E6%96%B0-4-0-0-2020-10-10


## ycshill

æˆ‘ä¹Ÿæœ‰è¿™ä¸ªé—®é¢˜ï¼Œå…¨å±€æ²¡æœ‰overlayï¼›æŠ¥é”™äº‹portable

 "antd": "^4.24.7",
 "antd-pro": "^0.7.0",
 "@ant-design/pro-components": "^1.1.10",
  â€@ant-design/pro-layout": "^6.38.2",


## chenshuai2144

@ant-design/pro-components å‡çº§åˆ°2.0 å°±å¥½äº†

```
