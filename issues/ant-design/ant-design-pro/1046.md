# 发布上线后如何配置服务端API域名

你好，参考[和服务端进行交互](https://pro.ant.design/docs/server-cn)，本地环境既可以从mock走，也可以与服务器交互。但是构建发布后，不知道如何制定服务端域名？(查阅了[构建和发布文档](https://pro.ant.design/docs/deploy-cn)，并没有这一块内容)

比如，构建后ant-pro前端页面的地址为：

```
http://f2e.xxx.com/index.html
默认内部api调用地址为http://f2e.xxx.com/api/login
```

服务端部署好后，接口地址为：

```
http://server.xxx.com/api/login
```

所以如何配置服务端域名server.xxx.com？使默认请求地址指向服务端？需要在前端服务器nginx上配置代理才行吗？

期待回复。

## afc163

服务端不需要单独起域名，静态文件和接口统一用一个域名。你的服务端应该有托管静态资源的能力。

## Sayi

好吧，我只是不希望前端和服务端部署在同一个地方。谢谢了。

## kunhour

使用Nginx

## slamgundam

@afc163
我的也是！
想要前端跟服务端部署在不同的網域下

我目前也是沒解...

## chenshuai2144

反向代理了解一下。可以问问你们的运维

## guoyangyang666

这个问题解决了吗？我也有相同的问题

## slamgundam

在 Nginx 的 網站.conf 檔案多加入 proxy_pass 就可以了

我是在本地端測試，若正式發布，網址要改成正式網址

`location /api {
        proxy_pass http://XXXX.localhost;
    }`

## guoyangyang666

好使了，太谢谢你了

## haywaa

静态资源走CDN，API请求不走CDN，如何配置API调用的域名

## jiangzm

+1 有同样的问题。
人家的需求就是要配置不同环境API域名，然后被要求静态资源和后台部署到一起，或者使用代理。
咱能不能有点解决问题的精神，别碰到问路的就让绕着走。前端部署到CDN和后台分开很正常啊，不同环境使用不同的域名也很正常啊，为啥一定要反向代理呢。

@Sayi 我目前做法是根据环境来设置`umi-request` 配置参数 `prefix`, 在config配置项找了一圈没有相关联的配置项。

## jiangzm

> 反向代理了解一下。可以问问你们的运维

@chenshuai2144 装啥呢

## gaspire

> @chenshuai2144 反向代理了解一下。可以问问你们的运维
> 静态资源和后台API分开部署，现在是很正常的。装啥呢

## DestinyXie

同样遇到，改本地的umi-request模块那个dist/index.es.js
fetch(this.url, this.options);
=>
fetch(this.options.api ? this.options.api + this.url : this.url, this.options);
给umi-request配全局options的时候配上你自己的接口地址api就行了

## h1nson

请问有人解决了吗？

## h1nson

目前的办法是不是 const request = extend({ prefix: 'http://xxxx'}) 然后把这个request导出使用？ 但使用过程中发现一个问题，就是prefix配置为https后不起作用，最终还是把前端跟后端部署到一起，用子站点的方式解决（prefix配置为: /api/xxxxx）

## chenshuai2144

建议用容器 比如 nginx 之类的解决，前端不要硬编码

## Kennytian

这个问题解决了吗？我也有相同的问题

## steeeeps

专职开发前端的同学理解不到楼主的痛点啊。

网上找一圈都是在proxy下配置dev的代理转发，也不看注释写的清清楚楚的只是在开发模式下使用，哈哈...

下面说说我得方法吧：

**环境ant design pro v6.0.0**

1. 利用[环境变量](https://pro.ant.design/zh-cn/docs/environment-manage/)配置开发模式和产品模式的api 地址(其他模式类似)，以`dev`和`prod`为例，**仅支持typescript**：
   config.dev.ts

```
import { defineConfig } from '@umijs/max';
export default defineConfig({
  define: {
    BASE_URL: 'https://api.dev.com', // API地址
  },
});

```

config.prod.ts

```
import { defineConfig } from '@umijs/max';
export default defineConfig({
  define: {
    BASE_URL: 'https://api.prod.com', // API地址
  },
});

```

2. 在`typings.d.ts`中修改和添加以下内容：

```
declare const REACT_APP_ENV: 'test' | 'dev' | 'pre' | 'prod' | false;
declare const BASE_URL: string
```

3. 利用[拦截器](https://pro.ant.design/zh-cn/docs/request/)功能自定义拦截器，修改服务器地址或者其他需要传到服务器的数据，自定义一个`requestConfig.ts`文件。

```
import type { RequestConfig } from '@umijs/max';
/**
 * 自定义请求前拦截,根据环境变量修改baseUrl和token等信息
 * @param url
 * @param options
 * @returns
 */
export const beforeRequestInterceptor = (url: string, options: RequestConfig) => {

  const authHeader = { token: 'token' };
  return {
    url: `${BASE_URL}${url}`,
    options: { ...options, interceptors: true, headers: authHeader },
  };
};

```

4. 在`app.tsx `中引入上一文件，并修改`request`的配置：

```
export const request = {
  ...errorConfig,
  requestInterceptors: [
    beforeRequestInterceptor
  ]
};
```

5. 在`package.json script` 节点中添加产品模式编译脚本：

```
"build:prod": "cross-env UMI_ENV=prod max build",
```

6. 本地开发时使用`npm run start:no-mock`命令。

7. 产品上线编译时使用`npm run build:prod`命令。
