# ğŸ§[é—®é¢˜ | question]antd pro 6 è¯·æ±‚æ¥å£æ—¶æ·»åŠ å…¨å±€loading

`AI Reply`

è¯·æ±‚æ¥å£æ—¶æ·»åŠ å…¨å±€loading
ç›¸åº”åè¿›è¡Œå…³é—­
å¤šä¸ªæ¥å£ä¼šç­‰å¾…å…¨éƒ¨åŠ è½½å®Œæˆ–å‡ºç°é”™è¯¯ å…³é—­loading

## chenshuai2144

> TAutomatically replying with ChatGPT can be attempted, but it cannot be guaranteed to be completely accurate and may not fully address all issues. Please feel free to reply if you have any further questions or concerns.
> æ­¤å›å¤åŸºäº ChatGPT è‡ªåŠ¨ç”Ÿæˆï¼Œå¯ä»¥å°è¯•ä¸‹æ–¹æ¡ˆï¼Œå®˜æ–¹äººå‘˜ä¼šåœ¨ä¸€å®šæ—¶é—´åç»§ç»­ç»§ç»­å¤„ç†ã€‚

æ‚¨å¯ä»¥ä½¿ç”¨ `axios` çš„ `interceptors` é…åˆ `loading` ç»„ä»¶æ¥å®ç°è¯¥éœ€æ±‚ã€‚å…·ä½“å®ç°æ­¥éª¤å¦‚ä¸‹ï¼š

1. åœ¨å…¨å±€ä¸­å¼•å…¥ `axios` å’Œ `loading` ç»„ä»¶

```javascript
import axios from "axios";
import { message, Spin } from "antd";
```

2. åˆ›å»ºå…¨å±€è¯·æ±‚ `loading`

```javascript
const loading = document.createElement("div");
loading.className = "my-loading-classname"; // éœ€è¦è‡ªå®šä¹‰ loading æ ·å¼åç§°

const loadingSpin = (
  <div className="my-loading-spin-classname">
    <Spin size="large" />
  </div>
);
ReactDOM.render(loadingSpin, loading);
document.body.appendChild(loading);
```

3. é…ç½® `axios` çš„ `interceptors.request`

```javascript
let requestsCount = 0;
const shouldShowLoading = () => requestsCount === 0;

axios.interceptors.request.use(
  (config) => {
    if (shouldShowLoading()) {
      loading.style.display = "block";
    }
    requestsCount += 1;
    return config;
  },
  (error) => {
    return Promise.reject(error);
  },
);
```

4. é…ç½® `axios` çš„ `interceptors.response`

```javascript
axios.interceptors.response.use(
  (response) => {
    requestsCount -= 1;
    if (shouldShowLoading()) {
      loading.style.display = "none";
    }
    return response;
  },
  (error) => {
    requestsCount -= 1;
    if (shouldShowLoading()) {
      loading.style.display = "none";
    }
    message.error("è¯·æ±‚å‡ºé”™ï¼Œè¯·ç¨åé‡è¯•ï¼");
    return Promise.reject(error);
  },
);
```

5. å¯¹äºå¤šä¸ªè¯·æ±‚çš„æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨ `Promise.all` æ¥å¹¶è¡Œè¯·æ±‚ï¼Œå¹¶åœ¨æ‰€æœ‰è¯·æ±‚å®Œæˆæˆ–å‡ºé”™åå…³é—­ `loading`

```javascript
Promise.all([request1, request2, request3])
  .then(() => {
    loading.style.display = "none";
  })
  .catch(() => {
    loading.style.display = "none";
    message.error("è¯·æ±‚å‡ºé”™ï¼Œè¯·ç¨åé‡è¯•ï¼");
  });
```

6. æœ€åï¼Œåˆ«å¿˜äº†åœ¨é¡µé¢é”€æ¯æ—¶ç§»é™¤ `loading`ï¼š

```javascript
componentWillUnmount() {
  document.body.removeChild(loading);
}
```

å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š

```javascript
import axios from "axios";
import { message, Spin } from "antd";

const loading = document.createElement("div");
loading.className = "my-loading-classname";

const loadingSpin = (
  <div className="my-loading-spin-classname">
    <Spin size="large" />
  </div>
);
ReactDOM.render(loadingSpin, loading);
document.body.appendChild(loading);

let requestsCount = 0;
const shouldShowLoading = () => requestsCount === 0;

axios.interceptors.request.use(
  (config) => {
    if (shouldShowLoading()) {
      loading.style.display = "block";
    }
    requestsCount += 1;
    return config;
  },
  (error) => {
    return Promise.reject(error);
  }
);

axios.interceptors.response.use(
  (response) => {
    requestsCount -= 1;
    if (shouldShowLoading()) {
      loading.style.display = "none";
    }
    return response;
  },
  (error) => {
    requestsCount -= 1;
    if (shouldShowLoading()) {
      loading.style.display = "none";
    }
    message.error("è¯·æ±‚å‡ºé”™ï¼Œè¯·ç¨åé‡è¯•ï¼");
    return Promise.reject(error);
  }
);

Promise.all([request1, request2, request3])
  .then(() => {
    loading.style.display = "none";
  })
  .catch(() => {
    loading.style.display = "none";
    message.error("è¯·æ±‚å‡ºé”™ï¼Œè¯·ç¨åé‡è¯•ï¼");
  });

componentWillUnmount() {
  document.body.removeChild(loading);
}
```

å¸Œæœ›ä»¥ä¸Šå†…å®¹èƒ½å¤Ÿå¸®åŠ©æ‚¨è§£å†³é—®é¢˜ã€‚
