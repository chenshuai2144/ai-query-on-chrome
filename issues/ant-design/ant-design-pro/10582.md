# å‡çº§åˆ°v5ç‰ˆæœ¬åå‘é€è¯·æ±‚400æˆ–è€…500åï¼Œå†æ¬¡è¯·æ±‚å‘ä¸å‡ºå»ï¼Œåªèƒ½åˆ·æ–°æµè§ˆå™¨é‡æ–°è¯·æ±‚

`AI Reply`

### ğŸ› bug æè¿°

å‡çº§åˆ°v5ç‰ˆæœ¬åå‘é€è¯·æ±‚400æˆ–è€…500åï¼Œå†æ¬¡è¯·æ±‚å‘ä¸å‡ºå»ï¼Œåªèƒ½åˆ·æ–°æµè§ˆå™¨é‡æ–°è¯·æ±‚ï¼Œ v4ç‰ˆæœ¬æ˜¯åœ¨errorhandleré‡Œé¢ return responseå°±å¯ä»¥ï¼Œ v5ä¸èµ·ä½œç”¨ã€‚

```js
export const errorConfig: RequestConfig = {
  // é”™è¯¯å¤„ç†ï¼š umi@3 çš„é”™è¯¯å¤„ç†æ–¹æ¡ˆã€‚
  errorConfig: {
    // é”™è¯¯æŠ›å‡º
    errorThrower: (res) => {
      const { success, data, errorCode, errorMessage, showType } =
        res as unknown as ResponseStructure;
      if (!success) {
        const error: any = new Error(errorMessage);
        error.name = 'BizError';
        error.info = { errorCode, errorMessage, showType, data };
        throw error; // æŠ›å‡ºè‡ªåˆ¶çš„é”™è¯¯
      }
    },
    // é”™è¯¯æ¥æ”¶åŠå¤„ç†
    errorHandler: (error: any, opts: any) => {
      const { response }: any = error;
      if (opts?.skipErrorHandler) throw error;
      // æˆ‘ä»¬çš„ errorThrower æŠ›å‡ºçš„é”™è¯¯ã€‚
      if (error.name === 'BizError') {
        const errorInfo: ResponseStructure | undefined = error.info;
        if (errorInfo) {
          const { errorMessage, errorCode } = errorInfo;
          switch (errorInfo.showType) {
            case ErrorShowType.SILENT:
              // do nothing
              break;
            case ErrorShowType.WARN_MESSAGE:
              message.warning(errorMessage);
              break;
            case ErrorShowType.ERROR_MESSAGE:
              message.error(errorMessage);
              break;
            case ErrorShowType.NOTIFICATION:
              notification.open({
                description: errorMessage,
                message: errorCode,
              });
              break;
            case ErrorShowType.REDIRECT:
              // TODO: redirect
              break;
            default:
              message.error(errorMessage);
          }
        }
      } else if (error.response) {
        // Axios çš„é”™è¯¯
        // è¯·æ±‚æˆåŠŸå‘å‡ºä¸”æœåŠ¡å™¨ä¹Ÿå“åº”äº†çŠ¶æ€ç ï¼Œä½†çŠ¶æ€ä»£ç è¶…å‡ºäº† 2xx çš„èŒƒå›´
        message.error(error.response.data?.message || `Response status:${error.response.status}`);
      } else if (error.request) {
        // è¯·æ±‚å·²ç»æˆåŠŸå‘èµ·ï¼Œä½†æ²¡æœ‰æ”¶åˆ°å“åº”
        // \`error.request\` åœ¨æµè§ˆå™¨ä¸­æ˜¯ XMLHttpRequest çš„å®ä¾‹ï¼Œ
        // è€Œåœ¨node.jsä¸­æ˜¯ http.ClientRequest çš„å®ä¾‹
        message.error('None response! Please retry.');
      } else {
        // å‘é€è¯·æ±‚æ—¶å‡ºäº†ç‚¹é—®é¢˜
        message.error('Request error, please retry.');
      }
      return response;
    },
  },

  // è¯·æ±‚æ‹¦æˆªå™¨
  requestInterceptors: [requestInterceptor],

  // å“åº”æ‹¦æˆªå™¨
  responseInterceptors: [success],

};
```

### ğŸ“· å¤ç°æ­¥éª¤ | Recurrence steps

ç›´æ¥ä½¿ç”¨å®˜æ–¹è„šæ‰‹æ¶æä¾›çš„ requestErrorConfig.tsæ–‡ä»¶

### ğŸ æœŸæœ›ç»“æœ | Expected results

æœŸæœ›è¯·æ±‚åç«¯è¿”å›é200çŠ¶æ€åï¼Œå¯ä»¥å†æ¬¡æ­£å¸¸å‘é€è¯·æ±‚

### Â© ç‰ˆæœ¬ä¿¡æ¯

- Ant Design Pro ç‰ˆæœ¬: ^5.2.1
- umi ç‰ˆæœ¬ï¼š "@umijs/max": "^4.0.33",
- æµè§ˆå™¨ç¯å¢ƒ chrome
- å¼€å‘ç¯å¢ƒ : mac OS

## chenshuai2144

> TAutomatically replying with ChatGPT can be attempted, but it cannot be guaranteed to be completely accurate and may not fully address all issues. Please feel free to reply if you have any further questions or concerns.
> æ­¤å›å¤åŸºäº ChatGPT è‡ªåŠ¨ç”Ÿæˆï¼Œå¯ä»¥å°è¯•ä¸‹æ–¹æ¡ˆï¼Œå®˜æ–¹äººå‘˜ä¼šåœ¨ä¸€å®šæ—¶é—´åç»§ç»­ç»§ç»­å¤„ç†ã€‚

æ‚¨å¯ä»¥å°è¯•æ›´æ–°æ‚¨çš„é”™è¯¯å¤„ç†ç¨‹åºä»£ç ï¼Œç‰¹åˆ«å…³æ³¨ä»axiosé”™è¯¯å’Œä¸šåŠ¡é”™è¯¯ä¸­è¿›è¡Œæ­£ç¡®å¤„ç†ã€‚å¦‚ä¸‹æ‰€ç¤ºçš„ä»£ç å¯ä»¥æ˜¯ä¸€ä¸ªå‚è€ƒã€‚

```js
// error handler
const errorHandler = (error: any): any => {
  const { request, response } = error;
  if (response) {
    const { status, data } = response;
    // ä¸šåŠ¡é”™è¯¯å¤„ç†
    if (status === 400 || status === 500) {
      // è¿™é‡Œå¯ä»¥æ ¹æ®ä¸šåŠ¡é”™è¯¯codeæˆ–è€…å…¶ä»–æ¡ä»¶æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦åœ¨æ­¤å¤„throwé”™è¯¯ï¼Œ
      // æ‚¨ä¹Ÿå¯ä»¥åŠ å…¥ç›¸å…³çš„æ¶ˆæ¯æç¤ºæˆ–è€…å…¶ä»–çš„è¡¨ç°å½¢å¼æ¥æé†’ç”¨æˆ·é”™è¯¯ä¿¡æ¯
      throw new Error(data.message);
    }
    return response;
  } else if (request) {
    // è¯·æ±‚å·²ç»å‘å‡ºï¼Œä½†æ˜¯æ²¡æœ‰æ”¶åˆ°å“åº”
    message.error('The request was made, but no response was received.');
    return Promise.reject(error);
  } else {
    // åœ¨è¯·æ±‚è®¾ç½®æ—¶å‘ç”Ÿäº†ä¸€äº›é”™è¯¯, è¯·æ±‚æ²¡æœ‰å‘é€æˆåŠŸ
    message.error('Error when setting up the request.');
    return Promise.reject(error);
  }
};

// request Config
const requestConfig: IRequestConfig = {
  errorHandler, // å…¨å±€é”™è¯¯å¤„ç†
};

```

å¯¹äºgetRequestå’ŒpostRequestè¿™æ ·çš„è‡ªå®šä¹‰è¯·æ±‚æ–¹æ³•ï¼Œæ‚¨å¯ä»¥åœ¨é”™è¯¯å¤„ç†ç¨‹åºä¸­è¿›è¡Œç›¸åº”å¤„ç†ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚

```js

/**
 * @param {string} url url
 * @param {Object} params request params
 */
const postRequest = async <T = any>(url: string, params?: any) => {
  const { data: response }: AxiosResponse = await request.post(url, params);
  const { success, data, errorCode, errorMessage, showType } = response as any;
  console.log("POST Request Status", response.status);
  if (success) {
    return data as T;
  }
  // ä¸šåŠ¡é”™è¯¯å¤„ç†
  if (response.status === 400 || response.status === 500) {
    throw new Error(errorMessage);
  }
};

/**
 *
 * @param {string} url url
 * @param {Object} params request params
 */
const getRequest = async <T = any>(url: string, params?: any) => {
  try {
    const { data: response }: AxiosResponse = await request.get(url, {
      params,
    });
    const { success, data, errorCode, errorMessage, showType } = response as any;
    console.log("GET Request Status: ", response.status);
    if (success) {
      return data as T;
    }
    // ä¸šåŠ¡é”™è¯¯å¤„ç†
    if (response.status === 400 || response.status === 500) {
      throw new Error(errorMessage);
    }
  } catch (error) {
    errorHandler(error);
  }
};

```

å¦‚æœè¿™æ ·çš„å¤„ç†ä»æ—§æ— æ³•è§£å†³é—®é¢˜ï¼Œå»ºè®®æ‚¨è¿›ä¸€æ­¥è°ƒæŸ¥ï¼Œä»¥æ’é™¤å…¶ä»–å½±å“è¯·æ±‚çš„å¯èƒ½åŸå› ï¼Œä¾‹å¦‚ç½‘ç»œé—®é¢˜ã€‚

## chenshuai2144

https://axios-http.com/

æˆ‘ä»¬ç”¨äº†è¿™ä¸ªåº“ï¼Œä½ å¯ä»¥çœ‹è¿™ä¸ªåº“çš„æ–‡æ¡£æ¥å¤„ç†
