# 🧐[问题 | question] 如何新建自定义的主题及修改内置的主题

`AI Reply`

### 🧐 问题描述 | Problem description

你好，我主要有两个问题：

1. 我想全新创建一个主题，比如名字叫做`myCustomLight`，我应该怎么去创建这个主题？我看了官网上的[定制主题](https://ant.design/docs/react/customize-theme-cn)只看到修改指定组件内部的样式，没看到创建自己的主题要怎么弄。还有我想往主题里面添加自定义的变量要怎么加？比如自带了一个`colorPrimary`，现在我想加一个变量`colorMyBg`。自己的主题创建好之后要可以通过设置`{navTheme: 'myCustomLight'}`来进行动态切换。
2. 我想修改内置的`light`主题的主题色为绿色，但是当我动态切换主题为`realDark`时主题色要仍然是默认的蓝色，这个应该怎么做？我尝试在`config.ts`文件中按如下设置，不管我选择什么主题，他的主题色都固定成红色了

```ts
    antd: {
        theme: {
            token: {
                colorPrimary: '#00b96b',
            },
            components: {
                Button: {
                    colorPrimary: 'red',
                },
            },
        },
    },
```

Ant Design Pro版本：6.0.0
umi版本：4
刚使用命令`pro create myapp`创建的项目

## chenshuai2144

> TAutomatically replying with ChatGPT can be attempted, but it cannot be guaranteed to be completely accurate and may not fully address all issues. Please feel free to reply if you have any further questions or concerns.
> 此回复基于 ChatGPT 自动生成，可以尝试下方案，官方人员会在一定时间后继续继续处理。

### 🤔 解决方案 | Solution

#### 1. 新建自定义主题

首先要实现新建自定义主题的功能，需要做以下三步：

##### 第一步：新建文件

在`styles`文件夹中新建`myTheme.less`文件，编写自定义样式

```less
@import "~antd/dist/antd.less"; // 引入 antd 样式
@import "~antd/lib/style/themes/default.less"; // 引入 antd 主题默认样式

// 自定义主题变量
@colorPrimary: #1890ff;
@colorMyBg: #f0f0f0;

// 覆盖主题变量
@primary-color: @colorPrimary;
@link-color: @colorPrimary;

// 扩展 antd 主题
@import "~antd/lib/style/color/colors.less";
@import "~antd/lib/style/core/typography.less";
@import "~antd/lib/style/layout/layout.less";

// 在此处添加自定义样式
```

##### 第二步：使用`less-loader`处理自定义文件

找到项目根目录下的`.umirc.ts`文件，在其中加上一些配置

```ts
// .umirc.ts
export default {
  // ...
  // 修改 less-loader 配置
  lessLoader: {
    lessOptions: {
      javascriptEnabled: true,
      modifyVars: {
        hack: `true; @import '${path.join(
          __dirname,
          "src/styles/myTheme.less",
        )}';`, // css hack
      },
    },
  },
};
```

##### 第三步：引用自定义主题

找到`config.ts`文件，修改`theme`中传入的主题配置，将自定义主题的名字和路径加入：

```ts
// config.ts
import { defineConfig } from "umi";

export default defineConfig({
  // ...
  theme: {
    // 新加入自定义主题
    myCustomLight: {
      // 自定义主题名
      "primary-color": "#1890ff", // 自定义主题变量
    },
    // ... 其它主题配置
  },
});
```

这样配置完成后就可以在应用中动态切换自定义的主题，比如在组件中设置：

```tsx
import React from "react";
import { Button } from "antd";
import "antd/dist/antd.css"; // 引入 antd 样式

export default () => {
  const [theme, setTheme] = React.useState("myCustomLight"); // 指定自定义主题名

  return (
    <div>
      <Button
        onClick={() =>
          theme === "myCustomLight"
            ? setTheme("dark")
            : setTheme("myCustomLight")
        }
      >
        切换主题
      </Button>
    </div>
  );
};
```

#### 2. 修改内置主题

要修改内置的`light`主题的主题色为绿色，可以按照如下步骤进行操作：

##### 第一步：自定义主题

按照上述方法自定义一个`myCustomLight`的主题。

##### 第二步：修改内置主题

在`config.ts`中进行如下配置：

```ts
// config.ts
import { defineConfig } from "umi";

export default defineConfig({
  // ...
  theme: {
    myCustomLight: {
      // 自定义主题名
      "primary-color": "#00b96b", // 自定义主题颜色
      "@btn-primary-bg": "@primary-color",
      "@btn-default-next-color": "@primary-color",
    },
    realDark: {
      "primary-color": "#4c87d4",
    },
    light: {
      "primary-color": "#00b96b", // 修改主题色为绿色
    },
  },
  // ...
});
```

这里针对`light`主题将`primary-color`修改为绿色。

##### 第三步：处理组件样式

因为这里会将`light`主题的主题色修改，所以可能会影响到一些组件样式，需要在组件中进行相应的处理，比如：

```tsx
import React from "react";
import { Layout, Menu } from "antd";
import "antd/dist/antd.css"; // 引入 antd 样式

const { Header, Content, Sider } = Layout;

export default () => {
  const [theme, setTheme] = React.useState("light"); // 初始选择 light 主题

  const handleClick = React.useCallback((payload) => {
    setTheme(payload.key); // 切换主题
  }, []);

  return (
    <Layout>
      <Header className="header">Header</Header>
      <Content>
        <Layout>
          <Sider width={200} className="site-layout-background">
            <Menu
              mode="inline"
              defaultSelectedKeys={["1"]}
              onClick={handleClick}
            >
              {/* 需要手动设置 antd 组件的样式 */}
              <Menu.Item
                key="light"
                style={theme === "light" ? { background: "#fff" } : {}}
              >
                light
              </Menu.Item>
              <Menu.Item
                key="myCustomLight"
                style={theme === "myCustomLight" ? { background: "#fff" } : {}}
              >
                myCustomLight
              </Menu.Item>
              <Menu.Item
                key="realDark"
                style={theme === "realDark" ? { background: "#fff" } : {}}
              >
                realDark
              </Menu.Item>
            </Menu>
          </Sider>
          <Content style={{ padding: "0 24px", minHeight: 280 }}>
            Content
          </Content>
        </Layout>
      </Content>
    </Layout>
  );
};
```

这里手动设置了`Menu.Item`组件的背景颜色，因为在选择`light`主题时，它们的背景将与主体默认颜色相同，这可能导致它们在布局中看起来不协调。

#### 参考文献

- [Ant Design 自定义主题](https://ant.design/docs/react/customize-theme-cn)
- [umi 配置](https://umijs.org/config/)

## chenshuai2144

https://umijs.org/docs/max/antd#theme

看这里，在这边配置就可以

## DreamParadise

> https://umijs.org/docs/max/antd#theme
>
> 看这里，在这边配置就可以

我想新建多个自定义的主题，然后可以在新建的主题里面随意切换，不是在内置的realDark和light之间切换

## DreamParadise

还有一点问题：

1. 使用design token的话是不是就不需要用到`less`了，样式全都写在`tsx`文件中了？
2. 是的话那我想要给一个元素配置伪类的样式或者给他的子元素配置样式的话要怎么写呢？像下面的官方示例都是直接在`style`里面设置的，那设置不到伪类或者子元素上？
3. 我能不能往`const { token } = useToken();`这个`token`里添加自定义的变量？

```ts
import { Button, theme } from 'antd';
import React from 'react';

const { useToken } = theme;

const App: React.FC = () => {
  const { token } = useToken();

  return <Button style={{ backgroundColor: token.colorPrimary }}>Button</Button>;
};

export default App;
```
