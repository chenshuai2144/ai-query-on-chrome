# ğŸ› [BUG]onGetCaptchaä¸­ä½¿ç”¨message.erroræç¤ºTypeError: message.error is not a function

### ğŸ› bug æè¿°

onGetCaptchaè·å–éªŒè¯ç å®ç°ä¸­è°ƒç”¨message.erroræˆ–è€…message.sucessï¼Œå¦‚æœä½¿ç”¨äº†const {message} = App.useApp() ä¸­çš„message ä¼šæŠ¥é”™ã€‚å¦‚æœä½¿ç”¨import {message} from "antd"ä¸­çš„messageåˆ™æ²¡æœ‰é—®é¢˜ï¼Œä½†ä¼šäº§ç”Ÿè­¦å‘Š Warning: [antd: message] Static function can not consume context like dynamic theme. Please use 'App' component instead.ã€‚

### ğŸ“· å¤ç°æ­¥éª¤ | Recurrence steps

ModalFormä¸­å¼•ç”¨const {message} = App.useApp() ï¼Œåœ¨ProFormCaptchaç»„ä»¶onGetCaptchaæ–¹æ³•ä¸­è°ƒç”¨message.erroræˆ–è€…message.sucess

### ğŸ æœŸæœ›ç»“æœ | Expected results

å¼¹å‡ºmessageä¿¡æ¯æ¡†

### ğŸ’» å¤ç°ä»£ç  | Recurrence code

`
import React, {useRef} from "react"
import {useIntl} from "@umijs/max"
import {App, Button, message} from "antd"
import {LockOutlined, UserOutlined, KeyOutlined} from "@ant-design/icons"
import {ModalForm, ProFormCaptcha, ProFormInstance, ProFormText} from "@ant-design/pro-components"
import ServerSideValidator from "@/utils/ServerSideValidator"
import {UserRegister, VerificationCodeSend} from "@/services/react-backend/User"
import FormHeader from "./FormHeader"

const Register: React.FC = () => {
const intl = useIntl()
const formRef = useRef<ProFormInstance>()
const intlRegisterNow = intl.formatMessage({
id: 'app.register.now',
})
// const {message} = App.useApp()

    return (
        <ModalForm<{
            email: string;
            pwd: string;
            verificationCode: string;
        }>
            formRef={formRef}
            width={400}
            layout='horizontal'
            title={<FormHeader/>}
            modalProps={{
                destroyOnClose: true,
                onCancel: () => console.log('cancel'),
            }}
            submitter={{
                render: () => {
                    return [<Button onClick={() => formRef.current?.submit()} block size="large" type="primary">
                        {intlRegisterNow}
                    </Button>]
                },
            }}
            trigger={
                <a type="link">
                    {intlRegisterNow}
                </a>
            }
            onFinish={
                (values: { verificationCode?: string } & API.User) => {
                    return UserRegister(values).then(() => {
                        message.success(intl.formatMessage({
                            id: 'app.register.succeed',
                        }))
                    }).catch((e: Error) => {
                        formRef.current?.validateFields().then(() => {
                            console.log(e)
                            message.error(e.message)
                        })
                    })
                }
            }
        >
            <ProFormText
                name="email"
                fieldProps={{
                    size: 'large',
                    prefix: <UserOutlined className={'prefixIcon'}/>,
                }}
                placeholder={'é‚®ç®±'}
                rules={[
                    {
                        required: true,
                        message: 'è¯·è¾“å…¥ç”¨æˆ·å!',
                    },
                    ServerSideValidator.check()
                ]}
            />
            <ProFormText.Password
                name="pwd"
                fieldProps={{
                    size: 'large',
                    prefix: <LockOutlined className={'prefixIcon'}/>,
                }}
                placeholder={'å¯†ç '}
                rules={[
                    {
                        required: true,
                        message: 'è¯·è¾“å…¥å¯†ç ï¼',
                    },
                    ServerSideValidator.check()
                ]}
            />
            <ProFormCaptcha
                fieldProps={{
                    size: 'large',
                    prefix: <KeyOutlined/>,
                }}
                captchaProps={{
                    size: 'large',
                }}
                phoneName="email"
                placeholder={'è¯·è¾“å…¥éªŒè¯ç '}
                captchaTextRender={(timing, count) => {
                    if (timing) {
                        return `${count} ${'è·å–éªŒè¯ç '}`;
                    }
                    return 'è·å–éªŒè¯ç ';
                }}
                name="code"
                countDown={55}
                rules={[
                    {
                        required: true,
                        message: 'è¯·è¾“å…¥éªŒè¯ç ï¼',
                    },
                    ServerSideValidator.check()
                ]}
                onGetCaptcha={
                    async (phone) => {
                        return formRef?.current?.validateFields(['email']).then(
                            async () => {
                                await VerificationCodeSend({
                                    email: formRef?.current?.getFieldValue('email'),
                                    mode: "register"
                                }).then(() => {
                                    console.log(intl.formatMessage({
                                        id: 'app.verificationCode.sent',
                                    }))
                                    message.success(intl.formatMessage({
                                        id: 'app.verificationCode.sent',
                                    }))
                                }).catch((e: Error) => {
                                    return formRef?.current?.validateFields(['email']).then(() => {
                                        message.error(e.message)
                                        return new Promise((resolve, reject) => {
                                            reject()
                                        })
                                    })
                                })
                            }
                        )

                    }
                }
            />

        </ModalForm>
    )

}

export default Register
`

### Â© ç‰ˆæœ¬ä¿¡æ¯

- Ant Design Pro ç‰ˆæœ¬: [@ant-design/pro-components ^2.3.57]
- umi ç‰ˆæœ¬["@umijs/route-utils": "^2.2.2"]
- æµè§ˆå™¨ç¯å¢ƒ[chrome ç‰ˆæœ¬ 114.0.5735.91ï¼ˆæ­£å¼ç‰ˆæœ¬ï¼‰ ï¼ˆ64 ä½ï¼‰]
- å¼€å‘ç¯å¢ƒ [e.g. mac OS]

### ğŸš‘ å…¶ä»–ä¿¡æ¯

"dependencies": {
"@ant-design/icons": "^4.8.0",
"@ant-design/pro-components": "^2.3.57",
"@ant-design/use-emotion-css": "1.0.4",
"@umijs/route-utils": "^2.2.2",
"antd": "^5.2.2",
"classnames": "^2.3.2",
"lodash": "^4.17.21",
"moment": "^2.29.4",
"omit.js": "^2.0.2",
"rc-menu": "^9.8.2",
"rc-util": "^5.27.2",
"react": "^18.2.0",
"react-cookies": "^0.1.1",
"react-dev-inspector": "^1.8.4",
"react-dom": "^18.2.0",
"react-helmet-async": "^1.3.0"
},

## light2000

æŠ¥é”™ä¿¡æ¯ï¼šTypeError: message.error is not a function

## light2000

æ˜¯æˆ‘çš„é—®é¢˜ï¼Œå¿˜è®°åœ¨åº”ç”¨ä¸­é¡¶å±‚åŒ…è£¹ Appäº†ï¼Œè¯·å…³é—­å§ã€‚

## echoyl

> æ˜¯æˆ‘çš„é—®é¢˜ï¼Œå¿˜è®°åœ¨åº”ç”¨ä¸­é¡¶å±‚åŒ…è£¹ Appäº†ï¼Œè¯·å…³é—­å§ã€‚

è¯·é—®ä¸‹é¡¶å±‚æ˜¯åœ¨å“ªï¼Ÿæˆ‘åœ¨app.tsx é‡Œé¢çš„layoutä¸­çš„childrenRender ä¸­åŠ äº†Appå±‚ï¼Œä½†æ˜¯é¡¶éƒ¨èœå•è·å–ä¸åˆ°

## songlin51

> æ˜¯æˆ‘çš„é—®é¢˜ï¼Œå¿˜è®°åœ¨åº”ç”¨ä¸­é¡¶å±‚åŒ…è£¹ Appäº†ï¼Œè¯·å…³é—­å§ã€‚

å¯ä»¥æä¾›ä¸‹å¦‚ä½•åœ¨é¡¶å±‚åŒ…è£¹Appå—,æ„Ÿè°¢

## songlin51

> > æ˜¯æˆ‘çš„é—®é¢˜ï¼Œå¿˜è®°åœ¨åº”ç”¨ä¸­é¡¶å±‚åŒ…è£¹ Appäº†ï¼Œè¯·å…³é—­å§ã€‚
>
> è¯·é—®ä¸‹é¡¶å±‚æ˜¯åœ¨å“ªï¼Ÿæˆ‘åœ¨app.tsx é‡Œé¢çš„layoutä¸­çš„childrenRender ä¸­åŠ äº†Appå±‚ï¼Œä½†æ˜¯é¡¶éƒ¨èœå•è·å–ä¸åˆ°

https://ant-design.gitee.io/components/app-cn
ä½ çœ‹ä¸‹è¿™ä¸ªä»‹ç»é‡Œçš„:å¦‚ä½•ä½¿ç”¨

## panhezeng

èƒ½æä¾›ä¸‹ä»£ç å—ï¼Œä½¿ç”¨ ant-design-pro åº”è¯¥åŠ åœ¨é‚£é‡Œå•Š <App> </App> æˆ‘åŠ åˆ°è‡ªå·±çš„é¡µé¢ç»„ä»¶å’Œlayoutä¸­çš„childrenRender éƒ½æŠ¥é”™ ã€‚ ant-design-pro çš„ app.tsx æ²¡æœ‰æš´éœ²é¡¶å±‚ç»„ä»¶çš„ä½ç½®å•Š

## panhezeng

> èƒ½æä¾›ä¸‹ä»£ç å—ï¼Œä½¿ç”¨ ant-design-pro åº”è¯¥åŠ åœ¨é‚£é‡Œå•Š æˆ‘åŠ åˆ°è‡ªå·±çš„é¡µé¢ç»„ä»¶å’Œlayoutä¸­çš„childrenRender éƒ½æŠ¥é”™ ã€‚ ant-design-pro çš„ app.tsx æ²¡æœ‰æš´éœ²é¡¶å±‚ç»„ä»¶çš„ä½ç½®å•Š

https://umijs.org/docs/max/antd

antd: {
configProvider: {},
appConfig: {},
},

åœ¨å¯åŠ¨é…ç½®ä¸ŠåŠ ä¸Šè¿™ä¸ªå°±å¯ä»¥äº†

## Valen-C12

> > èƒ½æä¾›ä¸‹ä»£ç å—ï¼Œä½¿ç”¨ ant-design-pro åº”è¯¥åŠ åœ¨é‚£é‡Œå•Š æˆ‘åŠ åˆ°è‡ªå·±çš„é¡µé¢ç»„ä»¶å’Œlayoutä¸­çš„childrenRender éƒ½æŠ¥é”™ ã€‚ ant-design-pro çš„ app.tsx æ²¡æœ‰æš´éœ²é¡¶å±‚ç»„ä»¶çš„ä½ç½®å•Š
>
> https://umijs.org/docs/max/antd
>
> antd: { configProvider: {}, appConfig: {}, },
>
> åœ¨å¯åŠ¨é…ç½®ä¸ŠåŠ ä¸Šè¿™ä¸ªå°±å¯ä»¥äº†

Thank you so much, you save my day, bro

## Pentium286

> > èƒ½æä¾›ä¸‹ä»£ç å—ï¼Œä½¿ç”¨ ant-design-pro åº”è¯¥åŠ åœ¨é‚£é‡Œå•Š æˆ‘åŠ åˆ°è‡ªå·±çš„é¡µé¢ç»„ä»¶å’Œlayoutä¸­çš„childrenRender éƒ½æŠ¥é”™ ã€‚ ant-design-pro çš„ app.tsx æ²¡æœ‰æš´éœ²é¡¶å±‚ç»„ä»¶çš„ä½ç½®å•Š
>
> https://umijs.org/docs/max/antd
>
> antd: { configProvider: {}, appConfig: {}, },
>
> åœ¨å¯åŠ¨é…ç½®ä¸ŠåŠ ä¸Šè¿™ä¸ªå°±å¯ä»¥äº†

æˆ‘å°±å·®è¿™æ®µé…ç½®ğŸ‘
