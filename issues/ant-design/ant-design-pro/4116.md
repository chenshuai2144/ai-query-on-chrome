# UMI SyntaxError: Unexpected token export

`üèÜ  Feature Request`

Create react app + Ant design pro

Jest test

Details:

    /Users/****/Desktop/project/***/***/*****/node_modules/umi/index.js:1
    ({"Object.<anonymous>":function(module,exports,require,__dirname,__filename,global,jest){export { default as Link } from './lib/link';
                                                                                             ^^^^^^

    SyntaxError: Unexpected token export

## chenshuai2144

try update your node.js
or you use` umi/link` in compontents

## EvgenyOrekhov

It is not about Node.js or Create React App. I was able to reproduce this issue on a clean Ant Design Pro repo. All that was needed is an import of `umi/router`: https://github.com/EvgenyOrekhov/ant-design-pro/commit/e04bb9aeb78e7a4894f1dad76fe08d4a89d47618

Steps to reproduce:

1. Clone this example: https://github.com/EvgenyOrekhov/ant-design-pro/tree/umi-bug
2. `npm install`
3. `npm run test:all`

Expected result: all tests should pass.

Actual result: 1 test fails with "Jest encountered an unexpected token" error.

Output:

```text
> umi test "--maxWorkers=1" "--runInBand"

 PASS  src/e2e/baseLayout.e2e.js (13.097s)
 PASS  src/components/Authorized/CheckPermissions.test.js
 PASS  src/e2e/login.e2e.js (5.318s)
 PASS  src/e2e/userLayout.e2e.js
 PASS  src/e2e/home.e2e.js
 PASS  src/e2e/topMenu.e2e.js
 PASS  src/components/AvatarList/index.test.js
 PASS  src/utils/authority.test.js
 PASS  src/utils/utils.test.js
 PASS  src/components/SiderMenu/SiderMenu.test.js
 PASS  src/components/_utils/pathTools.test.js
 FAIL  src/components/Ellipsis/index.test.js
  ‚óè Test suite failed to run

    Jest encountered an unexpected token

    This usually means that you are trying to import a file which Jest cannot parse, e.g. it's not plain JavaScript.

    By default, if Jest sees a Babel config, it will use that to transform your files, ignoring "node_modules".

    Here's what you can do:
     ‚Ä¢ To have some of your "node_modules" files transformed, you can specify a custom "transformIgnorePatterns" in your config.
     ‚Ä¢ If you need a custom transformation specify a "transform" option in your config.
     ‚Ä¢ If you simply want to mock your non-JS modules (e.g. binary assets) you can stub them out with the "moduleNameMapper" config option.

    You'll find more details and examples of these config options in the docs:
    https://jestjs.io/docs/en/configuration.html

    Details:

    /home/user/Downloads/ant-design-pro/node_modules/umi/lib/router.js:2
    export function push() {
    ^^^^^^

    SyntaxError: Unexpected token export

      3 | import classNames from 'classnames';
      4 | // eslint-disable-next-line no-unused-vars
    > 5 | import router from 'umi/router';
        | ^
      6 | import styles from './index.less';
      7 |
      8 | /* eslint react/no-did-mount-set-state: 0 */

      at ScriptTransformer._transformAndBuildScript (node_modules/@jest/transform/build/ScriptTransformer.js:471:17)
      at ScriptTransformer.transform (node_modules/@jest/transform/build/ScriptTransformer.js:513:25)
      at Object.<anonymous> (src/components/Ellipsis/index.js:5:1)
      at Object.<anonymous> (src/components/Ellipsis/index.test.js:1:1)

Test Suites: 1 failed, 11 passed, 12 total
Tests:       49 passed, 49 total
Snapshots:   0 total
Time:        33.421s, estimated 35s
Ran all test suites.
npm ERR! Test failed.  See above for more details.
npm ERR! code ELIFECYCLE
npm ERR! errno 1
npm ERR! ant-design-pro@2.3.1 test:all: `node ./tests/run-tests.js`
npm ERR! Exit status 1
npm ERR!
npm ERR! Failed at the ant-design-pro@2.3.1 test:all script.
npm ERR! This is probably not a problem with npm. There is likely additional logging output above.

npm ERR! A complete log of this run can be found in:
npm ERR!     /home/user/.npm/_logs/2019-05-08T12_56_41_211Z-debug.log
```

Ant Design Pro version: c38761cfd3a37f6833a1aa82e6e2bea1245bbc47
Node.js version: 12.2.0
OS: Ubuntu 19.04

## chenshuai2144

may you need this https://github.com/ant-design/ant-design-pro/blob/master/jest.config.js

## EvgenyOrekhov

@chenshuai2144 As you can see, I have it in my repo: https://github.com/EvgenyOrekhov/ant-design-pro/blob/umi-bug/jest.config.js. Still getting the error.

## chenshuai2144

rm umi/link in src/components/Ellipsis/index.test.js

## EvgenyOrekhov

@chenshuai2144 There is no `umi/link` in [src/components/Ellipsis/index.test.js](https://github.com/EvgenyOrekhov/ant-design-pro/blob/e04bb9aeb78e7a4894f1dad76fe08d4a89d47618/src/components/Ellipsis/index.test.js).

The problem is that it is impossible to test components that use `umi/link` or `umi/router`.

## jieliu218

@chenshuai2144 Exactly, the problem is that it is impossible to test components that use umi/link or umi/router.

The solution I used at the moment is import component manually like:

import Login from 'ant-design-pro/lib/Login';
import 'ant-design-pro/lib/Login/style';

This way can pass in Jest.

@EvgenyOrekhov

## chenshuai2144

Â∑≤ÁªèËøáÊó∂‰∫Ü v4 ‰∏≠Ê≤°ÊúâËøô‰∫õÊñá‰ª∂‰∫Ü

## petro-shkuratenyuk

why was this issue closed? where is description of its solution???

## vadymhimself

still have the same issue in 3.5.36
it works if I run with `umi test` though
@chenshuai2144 pls help
