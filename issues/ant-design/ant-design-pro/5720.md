# é…ç½®antdçš„externalsä¹‹åï¼Œantdè¿˜æ˜¯ä¼šè¢«æ‰“åŒ…è¿›å» ğŸ›[BUG]

`ğŸ›‘ bug`

### ğŸ› bug æè¿°

åœ¨`webpack`çš„é…ç½®é¡¹ä¸­é…ç½®`antd`çš„`externals`é€‰é¡¹ä¹‹åä¹‹åï¼Œ`antd`è¿˜æ˜¯ä¼šè¢«æ‰“åŒ…è¿›å»ã€‚

### ğŸ“· å¤ç°æ­¥éª¤

1. `document.ejs`ä¸­å¼•å…¥`antd`çš„ç›¸å…³cdnå¦‚ä¸‹:
   ![image](https://user-images.githubusercontent.com/31442077/70422341-89fa5880-1aa6-11ea-9728-45afa2fa7269.png)
2. åœ¨`config/plugin.config.ts`é…ç½®`externals`é€‰é¡¹å¦‚ä¸‹ï¼š

```javascript
// externals é…ç½®
config.externals({
  react: "React",
  "react-dom": "ReactDOM",
  moment: "moment",
  antd: "antd",
});
```

3. è¿è¡Œæ‰“åŒ…åˆ†æå‘½ä»¤`yarn analyze`ä¹‹åå‘ç°`antd`è¿˜æ˜¯è¢«æ‰“åŒ…è¿›å»äº†ï¼Œå…¶ä»–çš„externalsé…ç½®é¡¹å¹¶æ²¡æœ‰æ‰“åŒ…è¿›å»ä¾‹å¦‚reactã€react-domç­‰
   ![image](https://user-images.githubusercontent.com/31442077/70422679-1147cc00-1aa7-11ea-96d7-b11133218043.png)

### ğŸ æœŸæœ›ç»“æœ

è¿›è¡Œ`externals`é…ç½®ä¹‹å`antd`å¯ä»¥ä¸è¢«æ‰“åŒ…è¿›å»ã€‚

### Â© ç‰ˆæœ¬ä¿¡æ¯

- Ant Design Pro ç‰ˆæœ¬ 4.0.0
- umi ç‰ˆæœ¬ 2.9.6
- æµè§ˆå™¨ç¯å¢ƒ Chrome 78.0.3904.108
- å¼€å‘ç¯å¢ƒ mac OS 10.15.1

## chenshuai2144

ä½ å¥½åƒå†™é”™äº†

https://umijs.org/config/#externals åœ¨ config.js ä¸­

## zhaofinger

@chenshuai2144 é…ç½®åˆ°configé‡Œæ•ˆæœä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œ`antd`è¿˜æ˜¯ä¼šè¢«æ‰“åŒ…è¿›å»ã€‚
å¦å¤–åœ¨`plugin.config.ts`é‡Œé…ç½®åº”è¯¥ä¹Ÿæ˜¯æ²¡é—®é¢˜çš„ï¼Œå› ä¸ºreactã€react-doméƒ½å·²ç»ç”Ÿæ•ˆäº†ã€‚

## gyf30827

è¿™ä¸ªé—®é¢˜è§£å†³äº†å—ï¼Ÿæˆ‘è¿™é‡Œä¹Ÿé‡åˆ°äº†

## gyf30827

ä½ åº”è¯¥æ˜¯é…ç½®äº†æŒ‰éœ€åŠ è½½å¯¼è‡´å¼•ç”¨çš„æ–¹å¼å˜äº†ï¼Œå¯ä»¥æŠŠæŒ‰éœ€åŠ è½½ä»£ç å»æ‰å°±å¯ä»¥äº†
` plugins: [
    [
      "import", { "libraryName": "antd", "style": true }
    ]
  ]`

## zhaofinger

@gyf30827 å¯¹ï¼Œè°¢è°¢ï¼ç§»é™¤`antd`çš„æŒ‰éœ€åŠ è½½å°±å¯ä»¥äº†ï¼Œproé‡Œé€šè¿‡`umi-plugin-react`æ¥é…ç½®`antd`çš„æŒ‰éœ€åŠ è½½ï¼Œ[æ–‡æ¡£åœ°å€](https://umijs.org/zh/plugin/umi-plugin-react.html#antd)ã€‚

## haobrother

Pro V5ç‰ˆæœ¬æ‰“åŒ…ä¹Ÿæ˜¯è¿™æ ·ï¼ŒexternalsåŒ…å«äº†antd: 'window.antd'ï¼ŒscriptsåŒ…å«äº†å¯¹åº”antdçš„CDNåœ°å€ï¼Œä½†æ˜¯analyzeåå‘ç°antdè¿˜åœ¨é‡Œé¢ã€‚
å¦å¤–ï¼Œå…¨å±€çš„æŒ‰éœ€åŠ è½½å·²ç»è¢«æˆ‘å…³äº†dynamicImport: false
![511605690392_ pic_hd](https://user-images.githubusercontent.com/19492909/99509230-777be500-29c0-11eb-82d6-ad5e21e6b7f9.jpg)

## pw0621

é…ç½®reactã€react-dom externalsåç›´æ¥æŠ¥é”™äº†
![image](https://user-images.githubusercontent.com/37610612/101464233-5a13b880-3979-11eb-8b32-8f8038899792.png)
![image](https://user-images.githubusercontent.com/37610612/101464308-6ef04c00-3979-11eb-94bc-47ddda7e2d99.png)
![image](https://user-images.githubusercontent.com/37610612/101464367-80d1ef00-3979-11eb-839a-9b6cad938498.png)
è¿™ä¸ªéœ€è¦æ€ä¹ˆå¤„ç†

## vinvin1022

react-dom externalsé‚£é‡Œæ˜¯å†™é”™äº†

## chenshuai2144

ä¹Ÿå¯ä»¥è¿™ä¹ˆé…ç½®

externals: {
react: 'React',
'react-dom': 'ReactDOM',
'^/antd/._': 'antd',
'^/dayjs/._': 'dayjs',
},
