# 单独使用ant-design-pro中的部分组件出现样式重复

我在create-react-app创建的项目中使用了antd以及ant-design-pro，并且只使用了ant-design-pro的一些组件。
因为要配置使用本地的图标所以使用react-app-wired配置了如下

```
config = injectBabelPlugin(['import', { libraryName: 'antd', style: true }], config);
```

可是在ant-design-pro/lib/PageHeader中会引入：

```
require('antd/lib/tabs/style/css');
require('antd/lib/breadcrumb/style/css');
```

其中antd/lib/tabs/style/css 会引入

```
require('../../style/index.css');
require('./index.css');
```

导致在加载了antd的less的样式之后又加载了css的样式。

## afc163

对，对于 less 和 css 混用目前没有特别好的办法，有没有什么建议。

## dingyiming

ant-design-pro 的样式覆盖了基于react-app-wired-less自定义的样式,很尴尬

## lyingd

这个问题有进展吗，现在生产打包的css是双倍大小，antd的样式有双份，而且第二份出现在自定义样式之后，导致部分自定义样式无法覆盖antd的样式。

## lyingd

我找到一个插件[NMFR/optimize-css-assets-webpack-plugin](https://github.com/NMFR/optimize-css-assets-webpack-plugin)，可以解决样式重复问题，使用方式可参考：
https://github.com/lyingd/antd-pro-standalone/blob/113da5079c7f4103961698c19cabd50b58dbb52d/webpack.config.js

## fritx

我发现打包后，部分antd的样式又反过来覆盖了自己重写的样式，不知道是不是antd或antd-pro的问题，还没找着

--- updated

```diff
-import './index.less'

 // ...
 app.start('#root');
 // ...

+// 保证我们的样式在最后加载覆盖
+require('./index.less');
```

## lusess123

全部使用less 不可以吗

## chenshuai2144

#1317

## 750973092

还是没有解决啊，用umi创建pro的时候引用单独组件@ant-design/pro-layout还是重复打包两份css;好抓狂；@chenshuai2144
![image](https://user-images.githubusercontent.com/22766860/68996698-6ba2a200-08d8-11ea-8a95-8f04a73d2520.png)

![image](https://user-images.githubusercontent.com/22766860/68996706-98ef5000-08d8-11ea-971e-68c91d668ecf.png)

## wzono

这没有丝毫进展吗 @afc163

## wzono

> 这没有丝毫进展吗 @afc163

这个问题在 pro-components 单独使用时也存在

## chenshuai2144

一般都是因为 打包了一份lib 一份 css 导致的，你检查一下你的代码

## fanck0605

> > 这没有丝毫进展吗 @afc163
>
> 这个问题在 pro-components 单独使用时也存在

最近在 vite 项目里也尝试使用了 `pro-components`，**似乎**只要 `antd` 的引入方式正确，css 不会被重复引入，目前一切工作正常

### 操作方法：

导入 pro-components 的方式保持不变。

导入 antd 时，使用按需引入(和 pro-components 按需引入 antd 的方式**保持一致**，引入 **es** 目录下的 styles。理论上，只需要 styles 按需引入应该就可以了，其他 js 也可以顺手按需一下)

```jsx
import "antd/es/[component-name]/style";
```

**此 comment 已经修改过了，下面的讨论可以忽略。**

## projectcss

> > > 这没有丝毫进展吗 @afc163
> >
> > 这个问题在 pro-components 单独使用时也存在
>
> 最近在 vite 项目里也尝试使用了 `pro-components`，只要导入方式正确，css **似乎**不会被重复引入
>
> 我就只使用了按需引入(**和 pro-components 的导入方式保持一致**，用 babel 插件就行了)，导入了 `antd/es/[component-name]/style/index.js`(**es** 目录下的)，目前一切工作正常
>
> ```js
> import "antd/es/[component-name]/style";
> ```

> > > 这没有丝毫进展吗 @afc163
> >
> > 这个问题在 pro-components 单独使用时也存在
>
> 最近在 vite 项目里也尝试使用了 `pro-components`，只要导入方式正确，css **似乎**不会被重复引入
>
> 我就只使用了按需引入(**和 pro-components 的导入方式保持一致**，用 babel 插件就行了)，导入了 `antd/es/[component-name]/style/index.js`(**es** 目录下的)，目前一切工作正常
>
> ```js
> import "antd/es/[component-name]/style";
> ```
>
> pro-components怎么按需引入的

## fanck0605

> > > > 这没有丝毫进展吗 @afc163
> > >
> > > 这个问题在 pro-components 单独使用时也存在
> >
> > 最近在 vite 项目里也尝试使用了 `pro-components`，只要导入方式正确，css **似乎**不会被重复引入
> > 我就只使用了按需引入(**和 pro-components 的导入方式保持一致**，用 babel 插件就行了)，导入了 `antd/es/[component-name]/style/index.js`(**es** 目录下的)，目前一切工作正常
> >
> > ```js
> > import "antd/es/[component-name]/style";
> > ```
>
> > > > 这没有丝毫进展吗 @afc163
> > >
> > > 这个问题在 pro-components 单独使用时也存在
> >
> > 最近在 vite 项目里也尝试使用了 `pro-components`，只要导入方式正确，css **似乎**不会被重复引入
> > 我就只使用了按需引入(**和 pro-components 的导入方式保持一致**，用 babel 插件就行了)，导入了 `antd/es/[component-name]/style/index.js`(**es** 目录下的)，目前一切工作正常
> >
> > ```js
> > import "antd/es/[component-name]/style";
> > ```
>
> pro-components怎么按需引入的

pro-components **不需要按需引入**

可能是我没说清楚，我是指和 pro-components 按需引入 antd 的方式一样，进行 antd 的按需引入。

比如 pro-components 引入的是antd 的 es 文件夹下的 esmodules，而我们自己引入的是 lib 文件夹下的 commonjs，这样就不可以，styles 会被打包多次，我们自己要也引入 es 文件夹下 esmodules，这样子就不会被多次打包了。

## projectcss

> > > > > 这没有丝毫进展吗 @afc163
> > > >
> > > > 这个问题在 pro-components 单独使用时也存在
> > >
> > > 最近在 vite 项目里也尝试使用了 `pro-components`，只要导入方式正确，css **似乎**不会被重复引入
> > > 我就只使用了按需引入(**和 pro-components 的导入方式保持一致**，用 babel 插件就行了)，导入了 `antd/es/[component-name]/style/index.js`(**es** 目录下的)，目前一切工作正常
> > >
> > > ```js
> > > import "antd/es/[component-name]/style";
> > > ```
> >
> > > > > 这没有丝毫进展吗 @afc163
> > > >
> > > > 这个问题在 pro-components 单独使用时也存在
> > >
> > > 最近在 vite 项目里也尝试使用了 `pro-components`，只要导入方式正确，css **似乎**不会被重复引入
> > > 我就只使用了按需引入(**和 pro-components 的导入方式保持一致**，用 babel 插件就行了)，导入了 `antd/es/[component-name]/style/index.js`(**es** 目录下的)，目前一切工作正常
> > >
> > > ```js
> > > import "antd/es/[component-name]/style";
> > > ```
> >
> > pro-components怎么按需引入的
>
> pro-components **不需要按需引入**
>
> 可能是我没说清楚，我是指和 pro-components 按需引入 antd 的方式一样，进行 antd 的按需引入。
>
> 比如 pro-components 引入的是antd 的 es 文件夹下的 esmodules，而我们自己引入的是 lib 文件夹下的 commonjs，这样就不可以，styles 会被打包多次，我们自己要也引入 es 文件夹下 esmodules，这样子就不会被多次打包了。

但是我们在使用pro-components时都没有引入他的css文件，应该是babel import-plugin帮我们引入的，这应该怎么去改呢

## fanck0605

![image](https://user-images.githubusercontent.com/28819315/164366902-57710986-6af4-48eb-b2dc-17e48fd3541b.png)

pro-components 代码编译了之后，代码里会自动引入 styles， 不要去改它啊，自己引 antd 的时候注意一下就好了

## projectcss

>

嗯嗯是的，也就是说我们用antd的时候需要自己手动去引入antd/es/[组件]/styles下的样式是吗

## fanck0605

> >
>
> 嗯嗯是的，也就是说我们用antd的时候需要自己手动去引入antd/es/[组件]/styles下的样式是吗

对，只要 antd 按需引入就行了，然后记得是 es 文件夹下的。

## projectcss

> > >
> >
> > 嗯嗯是的，也就是说我们用antd的时候需要自己手动去引入antd/es/[组件]/styles下的样式是吗
>
> 对，只要 antd 按需引入就行了，然后记得是 es 文件夹下的。

这个babel-plugin-import后面能提供一个配置吗，现在使用这个插件都是从lib下引入的，提供个配置让我们自定义去引入es/lib下的文件

## fanck0605

这个不是本来就有配置项吗。

https://github.com/umijs/babel-plugin-import

```js
  {
    "libraryName": "antd",
    "libraryDirectory": "es", // 修改这里
    "style": true
  }
```

## isliqian

  <img width="419" alt="image" src="https://github.com/ant-design/ant-design-pro/assets/29324161/dc93c0d1-81c2-4be2-8660-9b5d17b8eec4">

切换主题，因为重复样式，导致不生效。。
