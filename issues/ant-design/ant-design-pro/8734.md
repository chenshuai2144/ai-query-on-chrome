# 🐛[BUG] 提交到自己的gitee和github前做precommit， fabric verify-commit过不去。

### 🐛 bug 描述

提交到自己的gitee和github前做precommit， fabric verify-commit过不去。

### 📷 复现步骤

![image](https://user-images.githubusercontent.com/18542211/125550844-7ba25cd7-671e-4e78-8e6f-c8806a2ce096.png)

### 🏞 期望结果

<!--
描述你原本期望看到的结果
-->

### 💻 复现代码

<!--
提供可复现的代码，仓库，或线上示例
-->

### © 版本信息

- Ant Design Pro 版本: [e.g. 4.0.0]
- umi 版本
- 浏览器环境
- 开发环境 [e.g. mac OS]

### 🚑 其他信息

<!--
如截图等其他信息可以贴在这里
-->

## kaoding

windows 上。

## chenshuai2144

按照规范来写 commit？

## kaoding

是按照规范来的（我在windows上），修改任务东西都commit不了。在commit时，加上--no-verify 就可以的。

## chenshuai2144

你来个录屏试试，我还没碰过兼容性问题

## kaoding

1、从 github 上 clone 下来
2、yarn (不做这步，commit 没有问题）
3、随便修改一个地方
4、再 commit 就出现上面问题

## kaoding

@chenshuai2144 这个问题怎么解决？

## chenshuai2144

commit 符合规范了吗？

## kaoding

> commit 符合规范了吗？

不是 commit 规范问题，我就改一点东西（如下图加点注释）都不能 commit 通过
![image](https://user-images.githubusercontent.com/18542211/126266484-6e3bedeb-38c7-477a-91ab-9da27b526498.png)

出现这种错误（我是找了一台全新widows电脑进行测试的）

![image](https://user-images.githubusercontent.com/18542211/126266631-d355176c-d8ee-44bb-9a24-1b9b545d0445.png)

## chenshuai2144

奇怪了我也是windows，难道是兼容性问题，我是用的正则匹配应该node 版本一致就没什么问题

## kaoding

原因找到了，是在发布 v5 版本时，在 package.json 文件最后添加了
"gitHooks": {
"commit-msg": "fabric verify-commit"
}
导致 commit 不了。
@chenshuai2144

## kaoding

要不先移去这个。

## chenshuai2144

不要呀，fabric verify-commit 是为了增加提交前验证，验证 commit 的合理性，你删掉了功能不就没了
兄弟你不要乱搞呀

## cyqhhj

我今天也遇到这个问题了，就很奇怪

## cyqhhj

@kaoding 怎么解决的？

## kaoding

> @kaoding 怎么解决的？

拿掉 package.json 内的

```
  "gitHooks": {
    "commit-msg": "fabric verify-commit"
  }
```

## chenshuai2144

提交的时候没设置环境变量，要专门处理了

## sunguoxing0628

1. 文件内容

```// https://umijs.org/config/
import { defineConfig } from 'umi';
import { join } from 'path';

import defaultSettings from './defaultSettings';
import proxy from './proxy';
import routes from './routes';

const { REACT_APP_ENV } = process.env;

export default defineConfig({
  devServer: {
    port: 8091,
  },
  hash: true,
  antd: {},
  dva: {
    hmr: true,
  },
  layout: {
    // https://umijs.org/zh-CN/plugins/plugin-layout
    locale: true,
    siderWidth: 208,
    ...defaultSettings,
  },
  // https://umijs.org/zh-CN/plugins/plugin-locale
  locale: {
    // default zh-CN
    default: 'zh-CN',
    antd: true,
    // default true, when it is true, will use `navigator.language` overwrite default
    baseNavigator: true,
  },
  dynamicImport: {
    loading: '@ant-design/pro-layout/es/PageLoading',
  },
  targets: {
    ie: 11,
  },
  // umi routes: https://umijs.org/docs/routing
  routes,
  // Theme for antd: https://ant.design/docs/react/customize-theme-cn
  theme: {
    'primary-color': defaultSettings.primaryColor,
  },
  // esbuild is father build tools
  // https://umijs.org/plugins/plugin-esbuild
  esbuild: {},
  title: false,
  ignoreMomentLocale: true,
  proxy: proxy[REACT_APP_ENV || 'dev'],
  manifest: {
    basePath: '/',
  },
  // Fast Refresh 热更新
  fastRefresh: {},
  openAPI: [
    {
      requestLibPath: "import { request } from 'umi'",
      // 或者使用在线的版本
      // schemaPath: "https://gw.alipayobjects.com/os/antfincdn/M%24jrzTTYJN/oneapi.json"
      schemaPath: join(__dirname, 'oneapi.json'),
      mock: false,
    },
    {
      requestLibPath: "import { request } from 'umi'",
      schemaPath: 'https://gw.alipayobjects.com/os/antfincdn/CA1dOm%2631B/openapi.json',
      projectName: 'swagger',
    },
  ],
  nodeModulesTransform: { type: 'none' },
  mfsu: {},
  webpack5: {},
  exportStatic: {},
});
```

2. 错误信息

```> running commit-msg hook: fabric verify-commit
   ERROR  invalid commit message format.
  Proper commit message format is required for automated changelog generation. Examples:
    💥 feat(compiler): add 'comments' option
    🐛 fix(compiler): fix some bug
    📝 docs(compiler): add some docs
    🌷 UI(compiler): better styles
    🏰 chore(compiler): Made some changes to the scaffolding
    🌐 locale(compiler): Made a small contribution to internationalization
    See .github/commit-convention.md for more details.
commit-msg hook failed (add --no-verify to bypass)
```

@chenshuai2144 对于下载下来的文件，我只增加了下面的一个参数，就报错了，同时也没有找到`.github/commit-convention.md`这个文件在哪里，目前只有拿掉`gitHooks`才能提交，不知道这个是什么问题。

```
devServer: {
    port: 8091,
  },
```

## chenshuai2144

按照规范写 commit，这个报错是commit 有问题不是你的代码有问题

## sunguoxing0628

> 按照规范写commit，这个报错是commit 有问题不是你的代码有问题

@chenshuai2144 好的，是我没注意提示信息，`commit message `应该满足指定格式，如`message`写做`fix: fix some  bug`，这样我就提交成功了。

@kaoding @cyqhhj @yinzixie 你们可以这么试一下。

## kaoding

不是这个原因，我都试过了（我就新拉一个antd pro 新库下来，改几个字，就提交不到自己的库中），就是报，

```
"gitHooks": {
    "commit-msg": "fabric verify-commit"
    }
```

过不去，暂时去掉这个。

## sunguoxing0628

> 不是这个原因，我都试过了（我就新拉一个antd pro 新库下来，改几个字，就提交不到自己的库中），就是报，
>
> ```
> "gitHooks": {
>     "commit-msg": "fabric verify-commit"
>     }
> ```
>
> 过不去，暂时去掉这个。

@kaoding 按照提示信息来看，只是`message`格式的问题，可以注意一下那个冒号，我第一次没注意用的中文冒号也是不行的，实在不行，那就只能按照你说的来了。

## chenjiaxin11

@chenshuai2144 请问这个commit校验规则可以自行配置吗？

## SugarTiger

大兄弟，就是你的commit-msg 格式不对，所以报错了，可以参考这个地址 https://learnku.com/docs/antd-pro/5/commit-msg/11203#472210
注意commit-msg里面的冒号：和描述之间，一定要有个空格，不如都会提示格式不正确。
例如：
错误的：feat:add BASE_API_URL
正确的：feat: add BASE_API_URL

## mansion-sun

原来是空格问题，感觉这个空格没必要，我试了很多次，一直以为是模块名或代码问题，冒号中英文也试过了，谁能想的有空格啊，大佬这个规则着实有点坑，之前公司配置的规则没有渉及空格的！ @chenshuai2144

## jonny-xhl

有没有遇到过merge branch的default message也会通不过。

通过vscode合并分支的默认message也会导致合并失败。

E.g

```
Merge branch 'feature/demo' into development
```

## yangrenmu

![image](https://user-images.githubusercontent.com/18193168/170934169-6334bd41-08e8-47af-8f6b-2ebc6d1e7e8d.png)
这意思是，merge 的信息，都过不了么？

## chenshuai2144

merge 搞个 -n 就能过去了

## LegionMrG

> 按照规范写 commit，这个报错是commit 有问题不是你的代码有问题

我知道是commit有问题，比如我填“style: prettier格式调整”提交就报错，但是填“UI: prettier格式调整”就可以。报错信息说“See .github/commit-convention.md for more details.”但是找一圈没找到这个md在哪，大佬给个地址？

## LegionMrG

> ![image](https://user-images.githubusercontent.com/18193168/170934169-6334bd41-08e8-47af-8f6b-2ebc6d1e7e8d.png) 这意思是，merge 的信息，都过不了么？

兄弟这图哪来的？

## Topppy

> > ![image](https://user-images.githubusercontent.com/18193168/170934169-6334bd41-08e8-47af-8f6b-2ebc6d1e7e8d.png) 这意思是，merge 的信息，都过不了么？
>
> 兄弟这图哪来的？

https://regexper.com/
