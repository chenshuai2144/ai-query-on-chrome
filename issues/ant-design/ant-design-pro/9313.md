# ğŸ‘‘ [éœ€æ±‚] è·¯ç”±åŠ¨æ€è¿‡æ»¤ä»¥åŠèœå•iconæ— æ³•æ˜¾ç¤ºçš„è§£å†³æ€è·¯

`ğŸ˜¸Documentation`

### ğŸ¥° éœ€æ±‚æè¿°

é€šå¸¸åœ¨ä½¿ç”¨æ¡†æ¶éƒ½ä¼šæ¶‰åŠåˆ°è®¤è¯æˆæƒåŠŸèƒ½ï¼Œç³»ç»Ÿçš„åŠŸèƒ½èœå•é€šè¿‡ç”¨æˆ·ç™»å½•åï¼Œä»æœåŠ¡å™¨è·å–èœå•æ•°æ®åæ¸²æŸ“åˆ°é¡µé¢ä¸­ã€‚
åŠ¨æ€è·¯ç”±çš„è·å–æ–¹å¼å®˜ç½‘å·²æä¾›ç›¸å…³çš„æ–¹æ³•ï¼Œhttps://procomponents.ant.design/components/layout#%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8
https://pro.ant.design/zh-CN/docs/advanced-menu

åœ¨ä»£ç å®è·µä¸­ï¼Œä¼šé‡åˆ°ä¸¤ä¸ªé—®é¢˜ï¼š

1. ç³»ç»Ÿèœå•æ˜¾ç¤ºå¯ä»¥æŒ‰ç…§æœåŠ¡å™¨è¿”å›çš„æ•°æ®è¿›è¡Œæ˜¾ç¤ºï¼Œä½†æ˜¯ç›´æ¥ä¿®æ”¹æµè§ˆå™¨çš„åœ°å€ï¼Œè¿˜æ˜¯æ— æ³•é˜²æ­¢ç”¨æˆ·è®¿é—®
2. èœå•iconæ— æ³•æ˜¾ç¤ºï¼Œç½‘ä¸Šæœç´¢åˆ°çš„æ–¹æ³•éƒ½æ˜¯å°†æ‰€æœ‰çš„ant iconå…¨éƒ¨åŠ è½½ï¼Œå°è£…æ–¹æ³•è·å–icon

### ğŸ§ è§£å†³æ–¹æ¡ˆ

é‡‡ç”¨ant design proåŸç”Ÿçš„æ–¹æ³•ï¼Œå°†æ‰€æœ‰çš„é¡µé¢é…ç½®åˆ°router.tsï¼Œå¹¶æ·»åŠ iconï¼Œè¿™ä¸ªæ—¶å€™æ‰€æœ‰èœå•å’Œiconéƒ½èƒ½å¤Ÿæ­£å¸¸æ˜¾ç¤ºã€‚

- è§£å†³ç¬¬äºŒä¸ªé—®é¢˜ï¼šiconæ— æ³•æ˜¾ç¤º

ä½¿ç”¨ä¸¤ä¸ª API, menu.request å’Œ menu.paramsï¼Œè¯·æ±‚æœåŠ¡å™¨è·å–å½“å‰ç”¨æˆ·èœå•ï¼Œé€šè¿‡å‚æ•°defaultMenuDataè·å–routers.tsä¸­æ‰€æœ‰çš„è·¯ç”±ï¼Œç„¶åæ•°æ®è¿‡æ»¤ï¼Œå°†ç”¨æˆ·çš„æ‹¥æœ‰çš„èœå•è¿‡æ»¤å‡ºæ¥ï¼Œå¹¶è¿”å›æ–°çš„MenuData.

```
menu: {
      // æ¯å½“ initialState?.currentUser?.userid å‘ç”Ÿä¿®æ”¹æ—¶é‡æ–°æ‰§è¡Œ request
      params: {
        userId: initialState?.currentUser?.id,
      },
      request: async (params, defaultMenuData) => {
        // initialState.currentUser ä¸­åŒ…å«äº†æ‰€æœ‰ç”¨æˆ·ä¿¡æ¯
        const menus = await buildMenus();
        let menuPaths = extractMenuPath(menus);
        // æ·»åŠ å…¬å…±çš„è·¯å¾„
        menuPaths = menuPaths.concat(['/', '/login', '/home', '/403']);
        setInitialState((s) => ({ ...s, menuPaths }));
        if (menuPaths) {
          const menuData = await filterUserMenu(defaultMenuData, menuPaths);
          return menuData;
        }
        return [];
      },
    },
```

æ–¹æ³•å‡½æ•°-extractMenuPath

```
/**
 * æå–èœå•æ•°æ®æ‰€æœ‰çš„pathå±æ€§
 *
 * @param data èœå•æ•°æ®
 * @returns èœå•Pathé›†åˆ
 */
export const extractMenuPath = (data: any[]) => {
  const stack = data.concat();
  const paths = [];
  while (stack.length !== 0) {
    const node = stack.pop();
    if (node?.path) {
      paths.push(node.path);
    }
    if (node?.children) {
      for (let i = node?.children.length - 1; i >= 0; i--) {
        stack.push(node.children[i]);
      }
    }
  }
  return paths;
};
```

æ–¹æ³•å‡½æ•°-filterUserMenu

```
/**
 * æ ¹æ®ç”¨æˆ·çš„èœå•æƒé™è¿‡æ»¤å¤šä½™çš„è·¯ç”±
 *
 * @param defaultMenuData é»˜è®¤routers.tsé…ç½®
 * @param menuPaths æœåŠ¡å™¨è¿”å›çš„æ‰€æœ‰èœå•Path,å¯ä»¥è°ƒç”¨extractMenuPathæå–
 * @returns æ–°çš„èœå•æ•°æ®
 */
export const filterUserMenu = async (defaultMenuData: MenuDataItem[], menuPaths: string[]) => {
  const result: MenuDataItem[] = [];
  defaultMenuData.forEach(async (node) => {
    if (node?.path) {
      if (!matchPath(node?.path, { path: menuPaths, exact: true })) {
        return;
      }
    }

    if (node?.routes) {
      node.routes = await filterUserMenu(node?.routes, menuPaths);
    }
    result.push(node);
  });
  return result;
};
```

ä»¥ä¸Šæ–¹æ³•ç”¨äºä½¿ç”¨umiåŸç”Ÿæ¸²æŸ“å‡ºæ¥çš„routersï¼Œiconå¯ä»¥æ­£å¸¸æ˜¾ç¤ºã€‚

- æ¥ä¸‹æ¥è§£å†³ç¬¬äºŒä¸ªé—®é¢˜ï¼šç¦æ­¢ç”¨æˆ·ä¿®æ”¹æµè§ˆå™¨åœ°å€è¿›å…¥é¡µé¢ã€‚
  è°ƒæ•´onPageChangeæ–¹æ³•ï¼Œåœ¨è¿›å…¥é¡µé¢çš„æ—¶å€™ï¼Œè·å–location.pathnameå¹¶æ¯”è¾ƒæœåŠ¡è¿”å›çš„èœå•æ•°æ®æ˜¯å¦åŒ¹é…ï¼Œä¸åŒ¹é…è¿”å›/403ã€‚

```
onPageChange: () => {
      const { location } = history;
      // å¦‚æœæ²¡æœ‰ç™»å½•ï¼Œé‡å®šå‘åˆ° login
      if (!cookie.load('token') && location.pathname !== loginPath) {
        history.push(loginPath);
      }
      // ç”¨äºå¤„ç†ç›´æ¥ä¿®æ”¹æµè§ˆå™¨åœ°å€ï¼Œè¿›å…¥é¡µé¢
      if (initialState?.menuPaths) {
        if (!matchPath(location.pathname, { path: initialState.menuPaths, exact: true })) {
          history.push('/403');
        }
      }
    },
```

### ğŸš‘ å…¶ä»–ä¿¡æ¯

<!--
å¦‚æˆªå›¾ç­‰å…¶ä»–ä¿¡æ¯å¯ä»¥è´´åœ¨è¿™é‡Œ
-->

## chenshuai2144

ç¤¾åŒºä¹‹å…‰ ğŸ‡ğŸ‡ğŸ‡ğŸ‡

## lovesL

è¿™ä¸æ˜¯åŠ¨æ€èœå•å˜› æ²¡çœ‹å‡ºå“ªé‡Œè·¯ç”±åŠ¨æ€äº† èœå•æ˜¯åŠ¨æ€çš„

## thx125

> è¿™ä¸æ˜¯åŠ¨æ€èœå•å˜› æ²¡çœ‹å‡ºå“ªé‡Œè·¯ç”±åŠ¨æ€äº† èœå•æ˜¯åŠ¨æ€çš„

æˆ‘çš„æ ‡é¢˜ä¸å¤Ÿä¸¥è°¨ï¼Œæˆ‘è¿™è¾¹å¯ä»¥æ›´æ­£ä¸€ä¸‹

## chenshuai2144

è·¯ç”±ä¸å¯èƒ½åŠ¨æ€çš„ã€‚

## zjstudy

è¿™ä¸ªè§£å†³æ–¹å¼æ¯”è¾ƒåˆç†

## KYX1234

æˆ‘è§‰å¾—å°±è¯¥è¿™æ ·
