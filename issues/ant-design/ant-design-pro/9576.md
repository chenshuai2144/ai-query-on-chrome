# 🧐[问题] Production环境的API Base URL设置?

### 🧐 问题描述

可能是个很基础的问题但我真的找不到解答
请问下各位，我知道开发环境下的API Base URL可在proxy.js中设置
不过若是要在正式环境下编译(yarn build/npm run build)，并将API的target base URL设置在其他外部服务器等与本专案不同的地址
是否有办法强制让他载入proxy.js的设置?
我在官方文档里没有找到正式环境下的API Base URL确切设置在哪
只有提示说正式环境不会使用proxy.js的设置
网上查了下貌似可能是在config/config.js中设置，但没有找到相关示例所以不是很确定
烦请各位解惑了，感激不尽

### 💻 示例代码

略

### 🚑 其他信息

略

## Kisky3

可以试试创建.env文件来定义各个环境的BASE URL设置/
你必须以 REACT*APP* 开头创建自定义环境变量。

例:
.env.production

```
REACT_APP_BASE_URL=$DOMAIN/bar
```

参考:
https://www.html.cn/create-react-app/docs/adding-custom-environment-variables/#%E5%9C%A8-env-%E4%B8%AD%E6%B7%BB%E5%8A%A0%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F

## evolution9502

> 可以试试创建.env文件来定义各个环境的BASE URL设置/ 你必须以 REACT*APP* 开头创建自定义环境变量。
>
> 例: .env.production
>
> ```
> REACT_APP_BASE_URL=$DOMAIN/bar
> ```
>
> 参考: https://www.html.cn/create-react-app/docs/adding-custom-environment-variables/#%E5%9C%A8-env-%E4%B8%AD%E6%B7%BB%E5%8A%A0%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F

您好，
這方法我試過了，在根目錄下添加了.env.production 文件
在裡面添加了REACT_APP_BASE_URL='https://API地址'
但貌似依然沒有用
yarn build後程序一樣是連到服務器本地的地址...

## chenshuai2144

https://umijs.org/zh-CN/docs/config#多环境多份配置

看这个

## evolution9502

> [https://umijs.org/zh-CN/docs/config#多环境多份配置](https://umijs.org/zh-CN/docs/config#%E5%A4%9A%E7%8E%AF%E5%A2%83%E5%A4%9A%E4%BB%BD%E9%85%8D%E7%BD%AE)
>
> 看这个

這篇文檔我先前就看過了
可以再解釋得清楚些嗎?
像是base url的參數是什麼，會被什麼設定覆蓋等等

## chenshuai2144

开发环境是通过porxy来设置。

在线上环境可以通过配置。baseurl 来设置的。不同的环境配置不同的url，写死到代码中。

如果要动态的，那就需要网关的支持了

## derrickxiang

> 开发环境是通过porxy来设置。
>
> 在线上环境可以通过配置。baseurl 来设置的。不同的环境配置不同的url，写死到代码中。
>
> 如果要动态的，那就需要网关的支持了

最近也遇到了同样的问题，怎么部署到非根目录下面，我也研究了[这个文档](https://pro.ant.design/zh-CN/docs/deploy/#%E9%83%A8%E7%BD%B2%E5%88%B0%E9%9D%9E%E6%A0%B9%E7%9B%AE%E5%BD%95)，改了config.ts

`...
  base: '/s3app/',
  publicPath: '/s3app/',`
然后build，部署后一直碰到/scripts/loading.js找不到的问题，检查dist下的index.html：
`
...

<link rel="stylesheet" href="/s3app/umi.043f10e7.css">
<script async="" src="/scripts/loading.js"></script>
</head>
<body>
<div id="root"></div>
<script src="/s3app/umi.14bfb194.js"></script>

</body></html>
`
原来是loading.js没有自动产生/s3app/的路径，这个是哪里还需要改配置？
另外我的api是在另外一台server上，要怎么做数据流配置？
谢谢

## quocbang

> > 开发环境是通过porxy来设置。
> > 在线上环境可以通过配置。baseurl 来设置的。不同的环境配置不同的url，写死到代码中。
> > 如果要动态的，那就需要网关的支持了
>
> 最近也遇到了同样的问题，怎么部署到非根目录下面，我也研究了[这个文档](https://pro.ant.design/zh-CN/docs/deploy/#%E9%83%A8%E7%BD%B2%E5%88%B0%E9%9D%9E%E6%A0%B9%E7%9B%AE%E5%BD%95)，改了config.ts
>
> `... base: '/s3app/', publicPath: '/s3app/',` 然后build，部署后一直碰到/scripts/loading.js找不到的问题，检查dist下的index.html： ` ...
>
> <script async="" src="/scripts/loading.js"></script>
> <script src="/s3app/umi.14bfb194.js"></script> ` 原来是loading.js没有自动产生/s3app/的路径，这个是哪里还需要改配置？ 另外我的api是在另外一台server上，要怎么做数据流配置？ 谢谢

same issue here
