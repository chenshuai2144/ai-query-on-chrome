# ğŸ§[é—®é¢˜] åˆå§‹åŒ–æŒ‰ç…§æŠ¥é”™ Error [ERR_REQUIRE_ESM]: require() of ES Module

### ğŸ§ é—®é¢˜æè¿°

ä½¿ç”¨ Yarn è¿›è¡Œåˆå§‹åŒ–é¡¹ç›®

### ğŸ’» ç¤ºä¾‹ä»£ç 

```cmd
# ä½¿ç”¨ yarn
yarn create umi myapp
```

### ğŸš‘ å…¶ä»–ä¿¡æ¯

```
yarn create v1.22.17
[1/4] Resolving packages...
warning create-umi > sylvanas > @umijs/fabric > stylelint > @stylelint/postcss-markdown@0.36.2: Use the original unforked package instead: postcss-markdown
warning create-umi > yeoman-environment > globby > fast-glob > micromatch > snapdragon > source-map-resolve@0.5.3: See https://github.com/lydell/source-map-resolve#deprecated
warning create-umi > yeoman-environment > globby > fast-glob > micromatch > snapdragon > source-map-resolve > resolve-url@0.2.1: https://github.com/lydell/resolve-url#deprecated
warning create-umi > yeoman-environment > globby > fast-glob > micromatch > snapdragon > source-map-resolve > source-map-url@0.4.1: See https://github.com/lydell/source-map-url#deprecated
warning create-umi > yeoman-environment > globby > fast-glob > micromatch > snapdragon > source-map-resolve > urix@0.1.0: Please see https://github.com/lydell/urix#deprecated
[2/4] Fetching packages...
[3/4] Linking dependencies...
[4/4] Building fresh packages...
success Installed "create-umi@0.27.0" with binaries:
      - create-umi
? Select the boilerplate type ant-design-pro
D:\node\yarn_global\node_modules\create-umi\lib\generators\ant-design-pro\index.js:11
const sortPackage = require('sort-package-json');
                    ^

Error [ERR_REQUIRE_ESM]: require() of ES Module D:\node\yarn_global\node_modules\sort-package-json\index.js from D:\node\yarn_global\node_modules\create-umi\lib\generators\ant-design-pro\index.js not supported.
Instead change the require of D:\node\yarn_global\node_modules\sort-package-json\index.js in D:\node\yarn_global\node_modules\create-umi\lib\generators\ant-design-pro\index.js to a dynamic import() which is available in all CommonJS modules.
    at Object.<anonymous> (D:\node\yarn_global\node_modules\create-umi\lib\generators\ant-design-pro\index.js:11:21)
    at D:\node\yarn_global\node_modules\create-umi\lib\run.js:27:23
    at new Promise (<anonymous>)
    at runGenerator (D:\node\yarn_global\node_modules\create-umi\lib\run.js:21:10)
    at run (D:\node\yarn_global\node_modules\create-umi\lib\run.js:69:12)
    at async D:\node\yarn_global\node_modules\create-umi\cli.js:31:3 {
  code: 'ERR_REQUIRE_ESM'
}
error Command failed.
Exit code: 1
```

## zjxpcyc

ç›´è¯‘é”™è¯¯å¥½åƒæ˜¯ `const sortPackage = require('sort-package-json');` è¿™ä¸€è¡Œåº”è¯¥æ˜¯æ”¹ç”¨ `import`

## who7708

>

æˆ‘ä¹Ÿæ˜¯é‡åˆ°äº†åŒæ ·çš„é—®é¢˜ï¼Œsort-package-json è¿™ä¸ªä¾èµ–åˆšå¥½åœ¨ä»Šå¤©14:00å·¦å³mqåˆšå‡çº§åˆ° 1.56.0 ç‰ˆæœ¬å¯¼è‡´çš„ã€‚
è§£å†³æ–¹æ³•ï¼š

1. npm install -g create-umi
2. å®‰è£… create-umi ç›®å½•ä¸­çš„ package.json ä¿®æ”¹ç‰ˆæœ¬ä¸ºï¼š "sort-package-json": "1.55.0"
3. é‡æ–°å®‰è£… ä¸€ä¸‹ create-umi ä¾èµ– npm install æˆ– yarn install
4. é‡æ–°åˆ›å»ºé¡¹ç›® create-umi myapp æ²¡æœ‰æŠ¥é”™å³è§£å†³
   ![image](https://user-images.githubusercontent.com/10089256/166138910-24bd73d3-09ae-47bf-886d-754f4a3dbdf0.png)

## momtboy

æˆ‘ä¹Ÿé‡åˆ°ç›¸åŒçš„é—®é¢˜äº†

## pengyuwei

é‡åˆ°äº†ç›¸åŒçš„é—®é¢˜ï¼š

```
$ npm config set registry https://registry.npm.taobao.org
$ npm update

up to date, audited 1 package in 219ms

found 0 vulnerabilities
$ npx create-umi myadp
? Select the boilerplate type ant-design-pro
/home/ubuntu/.npm/_npx/1789ec8a15edf54c/node_modules/create-umi/lib/generators/ant-design-pro/index.js:11
const sortPackage = require('sort-package-json');
                    ^

Error [ERR_REQUIRE_ESM]: require() of ES Module /home/ubuntu/.npm/_npx/1789ec8a15edf54c/node_modules/sort-package-json/index.js from /home/ubuntu/.npm/_npx/1789ec8a15edf54c/node_modules/create-umi/lib/generators/ant-design-pro/index.js not supported.
Instead change the require of /home/ubuntu/.npm/_npx/1789ec8a15edf54c/node_modules/sort-package-json/index.js in /home/ubuntu/.npm/_npx/1789ec8a15edf54c/node_modules/create-umi/lib/generators/ant-design-pro/index.js to a dynamic import() which is available in all CommonJS modules.
    at Object.<anonymous> (/home/ubuntu/.npm/_npx/1789ec8a15edf54c/node_modules/create-umi/lib/generators/ant-design-pro/index.js:11:21)
    at /home/ubuntu/.npm/_npx/1789ec8a15edf54c/node_modules/create-umi/lib/run.js:27:23
    at new Promise (<anonymous>)
    at runGenerator (/home/ubuntu/.npm/_npx/1789ec8a15edf54c/node_modules/create-umi/lib/run.js:21:10)
    at run (/home/ubuntu/.npm/_npx/1789ec8a15edf54c/node_modules/create-umi/lib/run.js:69:12)
    at async /home/ubuntu/.npm/_npx/1789ec8a15edf54c/node_modules/create-umi/cli.js:31:3 {
  code: 'ERR_REQUIRE_ESM'
}
```

## evan-gyy

æˆ‘ä¹Ÿé‡åˆ°äº†ï¼Œnodeç‰ˆæœ¬17.1.0ï¼Œsort-package-jsonç‰ˆæœ¬1.22.1

## evan-gyy

è§£å†³æ–¹æ³•ï¼š

1.  æ‰¾åˆ°create-umiä¸‹çš„package.jsonæŸ¥çœ‹sort-package-jsonçš„ä¾èµ–ç‰ˆæœ¬ï¼Œæ¯”å¦‚1.22.1
2.  ç„¶åæ›´æ–°ç‰ˆæœ¬ï¼š`yarn upgrade sort-package-json@1.22.1`
3.  ç”¨create-umiä»£æ›¿create umiåˆ›å»ºé¡¹ç›®ï¼š`yarn create-umi myapp`
4.  åˆ›å»ºæ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæ²¡æœ‰æŠ¥é”™äº†
    ![image](https://user-images.githubusercontent.com/49489433/166195867-c037fa50-76f6-41a2-95f2-39a08ab9a96a.png)

## daqidaqi

è§£å†³ï¼š
v5ç‰ˆæœ¬
ä½¿ç”¨ npm i @ant-design/pro-cli -g å®‰è£…åï¼Œè¿›å…¥@ant-design/pro-cli ç›®å½•ä¸‹ï¼Œä¿®æ”¹ package.jsonï¼Œåœ¨ deependencies ä¸­æ·»åŠ  "sort-package-json": "1.55.0"ï¼Œç„¶åå† pro-cli ç›®å½•ä¸‹ npm iï¼Œä¹‹åå†ç”¨ pro create xxxx åˆ›å»º
![image](https://user-images.githubusercontent.com/101492621/215133613-e3e3e031-8292-4179-ae2b-814ee177bdff.png)
![image](https://user-images.githubusercontent.com/101492621/215133750-abc475ef-c274-4ecd-8f35-51056ef1e0a6.png)
