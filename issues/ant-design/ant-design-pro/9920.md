# å¦‚ä½•åŠ¨æ€åˆ›å»ºèœå•ï¼Ÿåå°åŠ è½½ğŸ§[é—®é¢˜]

### ğŸ§ é—®é¢˜æè¿°

ä½ä»£ç åº”ç”¨ä¸­ï¼Œéœ€è¦ä»ç°æœ‰ç»„ä»¶æ ¹æ®å‚æ•°ä¸åŒæ¸²æŸ“ä¸åŒç»“æœï¼Œæ¯”å¦‚åŠ¨æ€åˆ—è¡¨/èœå•ç­‰

<!--
è¯¦ç»†åœ°æè¿°é—®é¢˜ï¼Œè®©å¤§å®¶éƒ½èƒ½ç†è§£
-->

ä»¥ä¸‹è¿™æ®µä»£ç å°†åœ¨é»˜è®¤è·¯ç”±åŠ è½½åæ ¹æ®åå°é…ç½®åŠ è½½
æ‰€æœ‰åŠ¨æ€é¡µé¢éƒ½æ˜¯ç”¨ `'./develop/dynamicPage'` ç»„ä»¶æ ¹æ® `meta.schemaId` è¿›è¡Œæ¸²æŸ“

```typescript
[
  {
    name: "amisEditor111",
    path: "/editor111",
    locale: false,
    meta: { schemaId: "111111" },
    component: "./develop/dynamicPage",
  },
  {
    name: "å®¢æˆ·ç®¡ç†",
    path: "/customers",
    locale: false,
    meta: { schemaId: "22222" },
    component: "./develop/dynamicPage",
  },
];
```

<!--
å¦‚æœä½ æœ‰è§£å†³æ–¹æ¡ˆï¼Œåœ¨è¿™é‡Œæ¸…æ™°åœ°é˜è¿°
-->

æ ¹æ®è¿™ä¸ªåœ°å€çš„ ä»‹ç»ï¼Œhttps://blog.csdn.net/qq_38506368/article/details/118495903

```javascript
let normalizedRoutes;

// umi3.x éœ€è¦å°† routes é€‰é¡¹ä»ç¬¬ä¸€ä¸ªå‚æ•°ä¸­è§£æ„: patchRoutes({ routes }) {}
export function patchRoutes(routes) {
  if (normalizedRoutes) {
    mergeRoutes(normalizedRoutes, routes);
  }
}

// oldRender è‡³å°‘éœ€è¦è¢«è°ƒç”¨ä¸€æ¬¡
export function render(oldRender) {
  fetch("/api/routes")
    .then((res) => res.json())
    .then((res) => {
      normalizedRoutes = res.routes;
      oldRender();
    });
}

const mergeRoutes = (routes, parentRoute) => {
  if (!Array.isArray(routes)) return [];
  return routes.map((route) => {
    if (route.path) {
      route.path = route.path.startsWith("/")
        ? route.path
        : `${parentRoute?.path || ""}/${route.path}`;
    }
    if (route.component) {
      route.component = ((component) => {
        if (typeof component === "function") {
          return component;
        }
        // eslint-disable-next-line global-require, import/no-dynamic-require, prefer-template
        return require(
          "./pages/" + component.substr(component.indexOf("/") + 1),
        ).default;
      })(route.component);
    }
    if (route.routes) {
      route.routes = mergeRoutes(route.routes, route);
    }
    return route;
  });
};
```

åœ¨ app.tsx ä¸­è°ƒç”¨ï¼š

```JavaScript
export const layout: RunTimeLayoutConfig = ({ initialState, setInitialState }) => {
  return {
    // åå°èœå•
    menu: {
      // æ¯å½“ initialState?.currentUser?.userid å‘ç”Ÿä¿®æ”¹æ—¶é‡æ–°æ‰§è¡Œ request
      params: {
        // userId: initialState?.currentUser?.userid,
        menuData: initialState?.serverSideSettings?.menuData,
      },
      request: async (params, defaultMenuData: []) => {
        const serverSideMenudata = initialState?.serverSideSettings?.menuData;
        if (serverSideMenudata) {
          const routes = [...staticRoutes, ...serverSideMenudata];
          patchRoutes([...routes]); //åŠ¨æ€è·¯ç”±
          return fixMenuItemIcon(routes);
        } else {
          console.log('params, defaultMenuData: ', params, defaultMenuData);

          return defaultMenuData;
        }
      },
    },
```

vscode æ§åˆ¶å°ä½†æ˜¯ä¼šå‡ºç° è¿™ä¸ªé—®é¢˜æŠ¥é”™ï¼š
æ˜¯ä¸æ˜¯å¤„ç†äº† ejsçš„è§£æå™¨å°±èƒ½è§£å†³è¿™ä¸ªé—®é¢˜äº†å‘¢ï¼Ÿ

```log

 error  in ./src/pages/document.ejs

Module parse failed: Unexpected token (1:0)
You may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders
> <!DOCTYPE html>
| <html lang="en">
|   <head>
```

<!--
å¦‚æˆªå›¾ç­‰å…¶ä»–ä¿¡æ¯å¯ä»¥è´´åœ¨è¿™é‡Œ
-->

![image](https://user-images.githubusercontent.com/15613121/173944743-ec1f3ff7-8162-4f64-8466-47951f1783cd.png)

å¯èƒ½ä¸æ­¤éœ€æ±‚ç±»ä¼¼
https://github.com/ant-design/ant-design-pro/issues/9655

## xiahller

æœ‰åŠ¨æ€åŠ è½½è·¯ç”±çš„æ–¹æ³•å—ï¼Œè€Œä¸æ˜¯routesé‡Œé¢é»˜è®¤è·å–ï¼Œä¸ä»…ä»…æ˜¯èœå•åŠ¨æ€è·å–ï¼Œè·¯ç”±å¯ä»¥åŠ¨æ€è·å–å—

## hyzx86

> æœ‰åŠ¨æ€åŠ è½½è·¯ç”±çš„æ–¹æ³•å—ï¼Œè€Œä¸æ˜¯routesé‡Œé¢é»˜è®¤è·å–ï¼Œä¸ä»…ä»…æ˜¯èœå•åŠ¨æ€è·å–ï¼Œè·¯ç”±å¯ä»¥åŠ¨æ€è·å–å—

æˆ‘ä¹Ÿæƒ³çŸ¥é“ã€‚ã€‚
è¿™ä¸ªæ–‡æ¡£ä¸çŸ¥é“æ˜¯è¿‡æœŸçš„è¿˜æ˜¯æ€ä¹ˆçš„ã€‚ã€‚ä¸èµ·ä½œç”¨å•Š

https://umijs.org/zh-CN/docs/runtime-config#patchroutes-routes-

## hyzx86

èœå•å‡ºæ¥äº†ã€‚ã€‚ä½†æ˜¯è·¯ç”±è¿˜æ˜¯404

```javascript
export function patchRoutes({ routes }) {
  routes[0].routes[7].routes.push({
    name: 'amisEditor111',
    path: '/editor111',
    locale: false,
    meta: { schemaId: '40emtqq91aqe855bydkj268gx6' },
    component: dynamic({
      loader: () => import(â€˜./pages/develop/dynamicPage'),
      loading: LoadingComponent,
    }),
  });

  console.log(routes, 'patchRoutespatchRoutes');
  return routes;
}
```

æŒç»­çˆ¬å‘ä¸­...

## hyzx86

ä»¥ä¸Šçš„æµ‹è¯•ï¼Œç»„ä»¶æ˜¯æ‰¾åˆ°äº†ï¼Œä¸æ˜¯undefined äº†

![image](https://user-images.githubusercontent.com/15613121/173977150-3955a97f-91a6-43d6-a331-4dc0ed0d0c58.png)

## xiahller

>

è¯·é—®ä½ æˆªå›¾ä¸Šçš„èœå•å’Œè·¯ç”±éƒ½æ˜¯åŠ¨æ€åŠ è½½çš„å—ï¼Ÿ

## hyzx86

> è¯·é—®ä½ æˆªå›¾ä¸Šçš„èœå•å’Œè·¯ç”±éƒ½æ˜¯åŠ¨æ€åŠ è½½çš„å—ï¼Ÿ`

åªæœ‰ editor111 ï¼Œæˆªå›¾é€‰ä¸­çš„éƒ¨åˆ†

## hyzx86

å®˜æ–¹æ–‡æ¡£ https://umijs.org/zh-CN/docs/runtime-config#patchroutes-routes-
æ²¡ç”¨~~

## xiahller

> > è¯·é—®ä½ æˆªå›¾ä¸Šçš„èœå•å’Œè·¯ç”±éƒ½æ˜¯åŠ¨æ€åŠ è½½çš„å—ï¼Ÿ`
>
> åªæœ‰ editor111 ï¼Œæˆªå›¾é€‰ä¸­çš„éƒ¨åˆ†

https://github.com/ant-design/ant-design-pro/issues/9468ä½ çœ‹çœ‹è¿™ä¸ªå‘¢

## hyzx86

ä¿®å¤ä¸‹ä½ çš„é“¾æ¥ï¼Œç„¶åçœ‹äº†ä¸‹ã€‚ã€‚è¡¨ç¤ºæ²¡çœ‹æ‡‚~ æ‡µé€¼æ ‘ä¸Šæ‡µé€¼æœ

https://github.com/ant-design/ant-design-pro/issues/9468

## hyzx86

æˆ‘è¯•äº†ä»–çš„ä»£ç ï¼Œæ²¡ç”¨ã€‚ã€‚æˆ‘åªæ˜¯æ²¡æœ‰å†™, åŠ ä¸Šå»ä¹Ÿä¸è¡Œã€‚

```
 export function render(oldRender: () => void) {
  // fetch('/api/routes').then(res=>res.json()).then((res) => {
  oldRender();
  // })
}
```

## chenshuai2144

åŠ¨æ€è·¯ç”±æ˜¯æ²¡æœ‰å‰é€”çš„ã€‚è·¯ç”±å¤ªé‡è¦äº†ï¼Œè¿˜æ˜¯ä¹–ä¹–åšåŠ¨æ€èœå•å§

## hyzx86

ä¸ºå•¥æ²¡å‰é€”å•Šã€‚ã€‚
æˆ‘è¦åšä½ä»£ç ï¼Œèœå•ä¸èƒ½åŠ¨æ€æ¸²æŸ“å“‡ã€‚ã€‚
æ‰€ä»¥æˆ‘å¯ä»¥åœ¨ä¸æ”¹å˜ è·¯ç”±å®šä¹‰çš„æƒ…å†µä¸‹ä¿®æ”¹èœå•ï¼Ÿ

æ¯”å¦‚ ä¸‹é¢è¿™ä¸ªã€‚ã€‚
ä½†æ˜¯åŠ¨æ€èœå•åˆè¦æ€ä¹ˆè€å˜ï¼Ÿ

[
{
name: 'amisEditor111',
**path: '/page/:schemaId',**
locale: false,
_meta: { schemaId: '111111' },_
component: './develop/dynamicPage',
},
{
name: 'å®¢æˆ·ç®¡ç†',
**path: '/page/:schemaId',**
locale: false,
component: './develop/dynamicPage',
},

]

## hyzx86

@chenshuai2144 å¤§ä½¬å…ˆåˆ«å…³å•Šã€‚ã€‚ã€‚
é—®é¢˜è¿˜æ²¡è§£å†³å˜~~

## chenshuai2144

èœå•å’Œè·¯ç”±æ˜¯ä¸¤ä¸ªæ¦‚å¿µ
åŠ¨æ€èœå•å·²ç»å¾ˆæ–¹ä¾¿äº†

## xiahller

>

è¯·é—®ï¼Œå¦‚æœéœ€è¦åœ¨é¡µé¢ä¸Šæ·»åŠ èœå•é¡µé¢ï¼Œä½†è·¯ç”±é‡Œé¢ä¸åŒ…æ‹¬æ–°æ·»åŠ çš„é¡µé¢è·¯å¾„ï¼Œå¦‚ä½•åšå‘¢

## chenshuai2144

ä½ å…¨é‡å†™è·¯ç”±ã€‚

è·¯ç”±ä¸å†™ä»£ç ç›´æ¥ä¸ä¼šè¢«ç¼–è¯‘è¿›å»ã€‚

## hyzx86

> ä½ å…¨é‡å†™è·¯ç”±ã€‚
>
> è·¯ç”±ä¸å†™ä»£ç ç›´æ¥ä¸ä¼šè¢«ç¼–è¯‘è¿›å»ã€‚

æ˜¯çš„ æˆ‘è¿™ä¸ªåŠ¨æ€é¡µé¢åœ¨è·¯ç”±å®šä¹‰çš„æ—¶å€™å®é™…ä¸Šå·²ç»å†™äº†
![image](https://user-images.githubusercontent.com/15613121/173983537-e2943914-bcd3-41b4-a8c5-671231b9d9e5.png)

![image](https://user-images.githubusercontent.com/15613121/173983526-b9f98f3b-daa3-4771-b479-59cd8d7e6a52.png)

## xiahller

>

> > ä½ å…¨é‡å†™è·¯ç”±ã€‚
> > è·¯ç”±ä¸å†™ä»£ç ç›´æ¥ä¸ä¼šè¢«ç¼–è¯‘è¿›å»ã€‚
>
> æ˜¯çš„ æˆ‘è¿™ä¸ªåŠ¨æ€é¡µé¢åœ¨è·¯ç”±å®šä¹‰çš„æ—¶å€™å®é™…ä¸Šå·²ç»å†™äº† ![image](https://user-images.githubusercontent.com/15613121/173983537-e2943914-bcd3-41b4-a8c5-671231b9d9e5.png)
>
> ![image](https://user-images.githubusercontent.com/15613121/173983526-b9f98f3b-daa3-4771-b479-59cd8d7e6a52.png)

ä½†æˆ‘ä¸çŸ¥é“å¦‚ä½•è®¾è®¡é¡µé¢æ‰èƒ½è®©ç”¨æˆ·æ·»åŠ çš„èœå•ã€é¡µé¢ï¼ˆç‰¹åˆ«æ˜¯æœ‰å‡ çº§èœå•çš„é‚£ç§é¡µé¢ï¼‰åŒ¹é…èµ·æ¥

## chenshuai2144

```
path: '/page/:schemaId',

path: '/page/:id',
```

è¿™ä¸¤ä¸ª path ä¸ç›¸ç­‰å§

`path: '/page/:id',` å¯ä»¥æ”¾åˆ°æœ€å‰é¢è¯•è¯•ã€‚æœ‰å¯èƒ½è¢«å‰é¢çš„åŒ¹é…äº†

## hyzx86

è¯¶ å¯¹ ã€‚ã€‚å¯ä»¥äº†
æˆ‘å†è¯•è¯•åŠ meta è¡Œä¸è¡Œï¼Œè¿™æ ·å¯è¯»æ€§ä¸å¤ªå¥½
![image](https://user-images.githubusercontent.com/15613121/173984294-9f1be3f5-2672-47ed-945b-04b25aca26d2.png)

## hyzx86

é¢ ä¼ ä¸è¿‡å»ï¼Œ ä¸ç”¨id è¯¥ç”¨name ä¼ å‚å¥½å˜ï¼Œ
æ„Ÿè°¢ç­”å¤

## xiahller

> è¯¶ å¯¹ ã€‚ã€‚å¯ä»¥äº† æˆ‘å†è¯•è¯•åŠ meta è¡Œä¸è¡Œï¼Œè¿™æ ·å¯è¯»æ€§ä¸å¤ªå¥½ ![image](https://user-images.githubusercontent.com/15613121/173984294-9f1be3f5-2672-47ed-945b-04b25aca26d2.png)

å¦‚æœå­˜åœ¨æ–°å¢äºŒçº§ç”šè‡³ä¸‰çº§é¡µé¢å¦‚ä½•è§£å†³ï¼Œæ¯”å¦‚ï¼šæ–°å¢çš„ç¬¬ä¸€çº§æ˜¯é…ç½®çš„amisEditor111ï¼Œä½†è¿˜éœ€è¦æ–°å¢å­çº§

## hyzx86

> å¦‚æœå­˜åœ¨æ–°å¢äºŒçº§ç”šè‡³ä¸‰çº§é¡µé¢å¦‚ä½•è§£å†³ï¼Œæ¯”å¦‚ï¼šæ–°å¢çš„ç¬¬ä¸€çº§æ˜¯é…ç½®çš„amisEditor111ï¼Œä½†è¿˜éœ€è¦æ–°å¢å­çº§

éš¾é“ä¸æ˜¯éšä¾¿åŠ ä¹ˆï¼Ÿ
åˆšæ‰å¤§ä½¬è®²äº† ï¼Œèœå•è·Ÿè·¯ç”±æ˜¯ä¸¤å›äº‹ï¼Œè·¯ç”±é…ç½®å¯ä»¥è®¾ç½®è§„åˆ™
èœå•è¿™é‡Œåªæ˜¯ä¸€ä¸ªè·³è½¬å•Šï¼ŒåŒ¹é…ä¸Šè·¯ç”±è§„åˆ™å°±å¯ä»¥äº†

## xiahller

> > å¦‚æœå­˜åœ¨æ–°å¢äºŒçº§ç”šè‡³ä¸‰çº§é¡µé¢å¦‚ä½•è§£å†³ï¼Œæ¯”å¦‚ï¼šæ–°å¢çš„ç¬¬ä¸€çº§æ˜¯é…ç½®çš„amisEditor111ï¼Œä½†è¿˜éœ€è¦æ–°å¢å­çº§
>
> éš¾é“ä¸æ˜¯éšä¾¿åŠ ä¹ˆï¼Ÿ åˆšæ‰å¤§ä½¬è®²äº† ï¼Œèœå•è·Ÿè·¯ç”±æ˜¯ä¸¤å›äº‹ï¼Œè·¯ç”±é…ç½®å¯ä»¥è®¾ç½®è§„åˆ™ èœå•è¿™é‡Œåªæ˜¯ä¸€ä¸ªè·³è½¬å•Šï¼ŒåŒ¹é…ä¸Šè·¯ç”±è§„åˆ™å°±å¯ä»¥äº†

å¯ä»¥äº†ï¼Œåˆšåˆšè‡ªå·±mockæ•°æ®çš„æ—¶å€™è‡ªå·±å†™é”™äº†æ•°æ®ã€‚è°¢è°¢~å®Œç¾è½å¹•

## hyzx86

ç®€å•æ€»ç»“ä¸‹ï¼Œæˆ‘ä¸çŸ¥é“ dynamic() å¯¼å…¥æ˜¯å¦å­˜åœ¨é—®é¢˜ï¼Œåœ¨ä¸Šé¢çš„æµ‹è¯•ä¸­ï¼Œç»„ä»¶ç¡®å®æ˜¯å¯¼å…¥è¿›å»äº†

1. é‚£ä¹ˆä¼šä¸ä¼šæ˜¯æ‰“åŒ…çš„é—®é¢˜ï¼Ÿæ‰“åŒ…æ—¶åªæ‰“åŒ…é™æ€è·¯ç”±é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šçš„æ–‡ä»¶ï¼Œéš¾é“ä¸èƒ½ç›´æ¥å°†æ‰€æœ‰pages æ–‡ä»¶å¤¹ä¸‹æ‰“åŒ…ä¹ˆï¼Ÿ
2. å¦‚æœç»„ä»¶æ‰¾åˆ°äº†ï¼Œè¿˜æ˜¯æŠ¥404 ï¼Œ é‚£å°±æ˜¯è·¯ç”±è§„åˆ™ä¸èƒ½åŠ¨æ€æ³¨å†Œï¼Ÿï¼Ÿ è¿™ä¸œè¥¿æ²¡å¾—æ³•å­åœ¨è¿è¡Œæ—¶è°ƒæ•´ï¼Ÿ

## fengjihua

/config/routes.ts

```
  {
    name: 'low-code',
    path: '/low-code/:name',
    component: './LowCode',
    hideInMenu: true,
  },
```

/app.tsx

```
export const layout: RunTimeLayoutConfig = ({ initialState, setInitialState }) => {
  return {
    // è‡ªå®šä¹‰èœå•ï¼šåŠ¨æ€æ·»åŠ ä½ä»£ç é¡µé¢
    menu: {
      params: {},
      request: async (params, defaultMenuData: any[]) => {
        console.log('[menu]', params, defaultMenuData);
        const lowCodePages = [
          {
            name: 'suppliers',
            path: '/low-code/suppliers',
          },
          {
            name: 'customers',
            path: '/low-code/customers',
          },
        ];
        defaultMenuData.push(...lowCodePages);
        return defaultMenuData;
      },
    },
    ...initialState?.settings,
  };
};
```

/src/pages/LowCode/index.tsx

```
import { useParams, useLocation } from 'umi';

function LowCode() {
  // ä½¿ç”¨useParamsè·å–åŠ¨æ€è·¯ç”±å‚æ•°
  const { name } = useParams();
  const location = useLocation();

  return (
    <div>
      <h1>Welcome to {name} Page</h1>
      <p>This is a dynamic page for {name}.</p>
      <p>Dynamic routes: {location.pathname}.</p>
    </div>
  );
}

export default LowCode;
```

## xXAvoraXx

https://github.com/ant-design/ant-design-pro/discussions/10898
