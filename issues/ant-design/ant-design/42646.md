# antd upload dragger customrequest not accessing updated state that is set in beforeUpload function

`Invalid`,`unconfirmed`

i recently upgraded react to 18 and after ugrading to version 18 antd upload dragger is not working properly.....i am trying to update some react states in customrequest but the beforeUpload doesnt access the latest one instead it gets the old state....

`  
 const handleBeforeUpload = async (data: any): Promise<void> => {
console.log('restss', data);
setUploadError('');
const resource = new FileResource(data);
const allheader = await resource.read({ till: 1280 });
if (setHookUpWarning !== undefined) setHookUpWarning(false);
console.log('holtercaseidsas', holtercaseid);

    try {
      const result = {
        message: 'Duplicate exists',
      };
      if (result.message !== 'Duplicate exists') {
        const holtercase = holtercases.find((item: any) => item.id === holtercaseid);
        const startdate = await resource.read({ from: 98, till: 109 });
        const status = await findDateDifference(startdate, hookupdate, uploadurl, holtercase?.checkout?.checkoutstart);
        if (status && status === 'EDF_Requires_Review' && setHookUpWarning) {
          setHookUpWarning(true);
        }
        form.setFieldsValue({
          header: allheader,
        });
        if (!data.name.toLowerCase().endsWith('.edf')) {
          setUploadError(`${data.name} is not a valid edf file`);
        } else {
          if (data.size < 20000000) {
            const istestholter = await isTestHoltercase(data, patient_firstname, patient_surname, doctor_firstname, doctor_surname);
            if (istestholter.testcase) {
              await UploadEdf(data, DateTime.fromISO(holtercase?.checkout?.checkoutstart).toFormat('yyyy-MM-dd'));
            } else {
              setUploadError('The EDF file you have uploaded is not long enough for a valid recording.  Holter recordings must be 12 hours or more.');
            }
          } else {
            await UploadEdf(data, DateTime.fromISO(holtercase?.checkout?.checkoutstart).toFormat('yyyy-MM-dd'));
          }
        }
      } else {
        if (setDuplicateHolterCase) {
          const holtercase = holtercases.find((item: any) => item.id === result.holtercaseid);
          if (holtercase) {
            setDuplicateHolterCase(holtercases.find((item: any) => item.id === result.holtercaseid));
          } else {
            setDuplicateHolterCase({ message: 'Exists in different clinic' });
          }
        }
      }
    } catch (err) {
      console.log(err);
    }

};
const handleUpload = async (options: any) => {
const { headers, onSuccess, file, onProgress } = options;
console.log('uploadErrorrrssss', uploadError);
if (uploadurl && setUploadOption && options && file.name.toLowerCase().endsWith('.edf')) {
if (setUploadOption && setStep && setCurrent && uploadError === '') {
setUploadOption(options);
setStep(3);
setCurrent(3);
}
const resource = new FileResource(file);
const staticHeader = await resource.read({ from: 88, till: 168 });
const number_of_data_records = await resource.read({ from: 236, till: 244 });
const duration_of_data_record = await resource.read({ from: 244, till: 252 });
const extracted = await extractEdfInfo(staticHeader);
console.log('extracted', extracted);
if (uploadError === '') {
if (extracted) {
const date = DateTime.fromFormat(extracted?.Startdate?.replace(/X/g, ''), 'dd-MMM-yyyy');

          const diff = date.diff(date.plus({ seconds: +number_of_data_records.replace(/\s/g, '') * +duration_of_data_record.replace(/\s/g, '') }), ['hours', 'minutes', 'seconds']);

          if (setedfDate) {
            setedfDate({
              start: date.toISODate(),
              end: date.plus({ seconds: +number_of_data_records.replace(/\s/g, '') * +duration_of_data_record.replace(/\s/g, '') }).toISODate(),
              duration: diff.toObject(),
            });
          }
        } else {
          if (setedfDate) {
            setedfDate({
              start: staticHeader.replace(/\s/g, '').slice(9, 21),
              end: 'none',
              duration: 0,
            });
          }
        }
      }
    } else if (uploadError === '' && !duplicateHoltercase) {

        axios
          .put(uploadurl as string, file, {
            headers,
            onUploadProgress: (event) => {
              const percent = Math.floor((event.loaded / event.total) * 100);
              if (percent > 0) {
                setUploadProgress(percent);
                onProgress({ percent: percent }, file);
              }
            },
          })
          .then(async ({ data: response }) => {
            const isTestCase = await isTestHoltercase(file, patient_firstname, patient_surname, doctor_firstname, doctor_surname);
            setIsTest(isTestCase.testcase);
            form.setFieldsValue({
              filesize: file.size,
              testfile: isTestCase.testcase,
            });
            onSuccess(response, file);
            form.submit();
          })
          .catch((err) => {
            setUploadError('Request failed with status code 404 ok');
          });

      return {
        abort() {
          console.log('upload progress is aborted.');
        },
      };
    }

};

<Dragger
disabled={uploadurl ? uploadOption !== null : disable}
name="file"
multiple={false}
action={uploadurl as string}
showUploadList={false}
onChange={async (e: any) => onChange(e)}
progress={{ strokeWidth: 10, showInfo: true }}
customRequest={handleUpload}
beforeUpload={handleBeforeUpload} >
<p className="ant-upload-drag-icon">
<InboxOutlined />
</p>
<p className="ant-upload-text">{uploadtext}</p>
{/_ <p className="ant-upload-hint">Make sure the file contains the front and back of the referral form</p> _/}
</Dragger>`

react version : 18.2.0
antd version : 4.20.1
