# tree-shaking: åªä½¿ç”¨ Button, rc-field-form å³ä½¿æ²¡æœ‰ä½¿ç”¨ä¹Ÿä¼šåŒ…æ‹¬åœ¨æœ€ç»ˆ bundle ä¸­

`ğŸ‘·ğŸ»â€â™‚ï¸ Someone working on it`

### Reproduction link

[https://github.com/magicdawn/antd-tree-shaking-demo](https://github.com/magicdawn/antd-tree-shaking-demo)

### Steps to reproduce

åªåŒ…æ‹¬ `Button`

repo main.tsx ä¸º

```tsx
// import { Button } from 'antd'
import Button from "antd/es/button";
console.log(Button);
```

åªä½¿ç”¨ Button, pnpm build å, dist é‡Œæœ‰æ¥è‡ª rc-field-form ä¸­çš„ä»£ç , æœç´¢ (useForm, Form ç­‰

å¯¼å…¥é“¾ä¸º

- antd/es/button
- antd/es/config-provider/index
- antd/es/form/context
- rc-field-form

å¥½åƒ rc-field-form é‡Œ RecForm è¢« vite/rollup è¯†åˆ«ä¸º side effects

```tsx
var RefForm = InternalForm;
RefForm.FormProvider = FormProvider;
RefForm.Field = Field;
RefForm.List = List;
RefForm.useForm = useForm;
RefForm.useWatch = useWatch;
```

æ‰‹åŠ¨ä¿®æ”¹ node_modules/.pnpm/antd@5.6.1_react-dom@18.2.0_react@18.2.0/node_modules/rc-field-form/es/index.js
ä¸º

```ts
var RefForm = /*#__PURE__*/ (function () {
  var f = InternalForm;
  f.FormProvider = FormProvider;
  f.Field = Field;
  f.List = List;
  f.useForm = useForm;
  f.useWatch = useWatch;
  return f;
})();
```

åå†æ¬¡æ‰“åŒ…(pnpm build), å¯ä»¥çœ‹åˆ° useForm æ²¡äº†.
å¤§å°ä¹Ÿå°äº†, 562 -> 454, æœª minify çŠ¶æ€ä¸‹å°‘äº† 100 kB

```txt
$ pb

> antd-demo@0.0.0 build /Users/magicdawn/projects/001_learn/antd/antd-demo
> tsc && vite build

vite v4.3.9 building for production...
âœ“ 225 modules transformed.
dist/index.html                  0.40 kB â”‚ gzip:   0.28 kB
dist/assets/index-a724464a.js  562.84 kB â”‚ gzip: 130.06 kB
âœ“ built in 2.16s

antd-demo on git main via node v18.14.2 took 4s
$ pb

> antd-demo@0.0.0 build /Users/magicdawn/projects/001_learn/antd/antd-demo
> tsc && vite build

vite v4.3.9 building for production...
âœ“ 225 modules transformed.
dist/index.html                  0.40 kB â”‚ gzip:   0.28 kB
dist/assets/index-05c373d8.js  454.76 kB â”‚ gzip: 108.63 kB
âœ“ built in 2.30s
```

### What is expected?

æœŸæœ›ä¼˜åŒ– tree-shaking

### What is actually happening?

åŒ…å«äº†æœªä½¿ç”¨çš„ä»£ç (async-validator, form ç­‰)

| Environment | Info                  |
| ----------- | --------------------- |
| antd        | 5.6.1                 |
| React       | 18.2.0                |
| System      | macos 12.6.1          |
| Browser     | chrome 114.0.5735.106 |

<!-- generated by ant-design-issue-helper. DO NOT REMOVE -->

## BoyYangzai

ref https://github.com/ant-design/ant-design/issues/42499 #42604

## magicdawn

nice !
åç­‰æ–°ç‰ˆ~

## afc163

@magicdawn è¿˜æ²¡æœ‰è§£æ³•ã€‚ã€‚

## zombieJ

è¯•è¯• `5.6.2-alpha.0`ï¼Œåº”è¯¥å¥½äº†ï¼š

<img width="417" alt="æˆªå±2023-06-15 10 44 16" src="https://github.com/ant-design/ant-design/assets/5378891/72b8937e-0cf2-4a70-a0c9-9a092783ad8a">
