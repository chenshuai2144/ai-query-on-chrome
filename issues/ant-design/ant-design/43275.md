# 【help】Upload 使用 阿里云 OSS上传方式，如何取消上传

`unconfirmed`

### What problem does this feature solve?

希望Upload 阿里云 OSS上传方式 可以提供一个参数 取消上传

### What does the proposed API look like?

提供一个 abort 方法 取消 OSS 上传

<!-- generated by ant-design-issue-helper. DO NOT REMOVE -->

## afc163

好的，如果你的后端接口是阿里云 OSS，可以按照以下步骤实现上传中断的功能：

    安装依赖

在项目中安装 ali-oss 库，用于与阿里云 OSS 进行交互：

npm install ali-oss

    创建阿里云 OSS 客户端

在组件中创建一个阿里云 OSS 客户端，用于上传文件和中断上传：
jsx

```tsx
import { Upload, message } from "antd";
import { UploadOutlined } from "@ant-design/icons";
import OSS from "ali-oss";

const props = {
  name: "file",
  action: "your_aliyun_oss_url",
  headers: {
    authorization: "authorization-text",
  },
  beforeUpload(file) {
    // 返回一个 Promise 对象，方便后续调用
    return new Promise((resolve, reject) => {
      try {
        const client = new OSS({
          region: "your_oss_region",
          accessKeyId: "your_access_key_id",
          accessKeySecret: "your_access_key_secret",
          bucket: "your_oss_bucket_name",
        });

        const upload = client.multipartUpload(file.name, file, {
          progress: (p) => {
            console.log(`upload progress: ${p}`);
          },
        });

        // 将上传任务保存到组件状态中，方便后续中断上传
        setUploadTask(upload);

        upload
          .then((res) => {
            resolve(res);
          })
          .catch((err) => {
            reject(err);
          });
      } catch (err) {
        reject(err);
      }
    });
  },
};

const UploadComponent = () => {
  const [uploadTask, setUploadTask] = useState(null);

  const handleAbort = () => {
    if (uploadTask) {
      uploadTask.abort();
      setUploadTask(null);
      message.warning("上传已中断");
    }
  };

  return (
    <>
      <Upload {...props}>
        <Button icon={<UploadOutlined />}>Click to Upload</Button>
      </Upload>
      <Button onClick={handleAbort}>Abort</Button>
    </>
  );
};

export default UploadComponent;
```

在 beforeUpload 方法中，创建一个阿里云 OSS 客户端，使用 multipartUpload 方法上传文件，并将上传任务保存到组件状态中，方便后续中断上传。在 multipartUpload 方法中，可以通过 progress 参数来获取上传进度。

在 handleAbort 方法中，调用上传任务的 abort() 方法中断上传，并将组件状态中的上传任务设置为 null，同时显示一个提示信息。

这样就完成了上传中断的功能。需要注意的是，阿里云 OSS 支持断点续传的功能，中断上传后，重新上传同一个文件时会从中断的位置继续上传，而不是从头开始上传。
