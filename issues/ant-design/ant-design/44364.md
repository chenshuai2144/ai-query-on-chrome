# next13 App Router æ ·å¼å¦‚ä½•è¿›è¡ŒæŒ‰éœ€æŠ½å–å‘¢ ?

`ğŸ¤” Need Reproduce`,`unconfirmed`

### Reproduction link

[https://ant.design/docs/react/server-side-rendering-cn#%E6%8C%89%E9%9C%80%E6%8A%BD%E5%8F%96](https://ant.design/docs/react/server-side-rendering-cn#%E6%8C%89%E9%9C%80%E6%8A%BD%E5%8F%96)

### Steps to reproduce

Ant æ–‡æ¡£ä¸­, åªæè¿°äº† Page Router æŒ‰éœ€æŠ½å–çš„æ–¹å¼

### What is expected?

æä¾› App Router æŒ‰éœ€æŠ½å–çš„æ–¹å¼

### What is actually happening?

åœ¨æ–‡æ¡£ä¸­æœªæ‰¾åˆ° App Router æŒ‰éœ€æŠ½å–æ ·å¼çš„æè¿°

| Environment | Info      |
| ----------- | --------- |
| antd        | 5.8.1     |
| React       | 18.2.0    |
| System      | Mac       |
| Browser     | Chrome114 |

<!-- generated by ant-design-issue-helper. DO NOT REMOVE -->

## kiner-tang

å¯ä»¥å‚è€ƒè¿™ä¸ªç¤ºä¾‹è¿›è¡ŒæŒ‰éœ€æŠ½å–ï¼š
https://ant-design.antgroup.com/docs/react/use-with-next-cn#%E4%BD%BF%E7%94%A8-nextjs-%E7%9A%84-app-router
https://github.com/ant-design/ant-design-examples/tree/main/examples/with-nextjs-app-router-inline-style

## FreeDrifter

> å¯ä»¥å‚è€ƒè¿™ä¸ªç¤ºä¾‹è¿›è¡ŒæŒ‰éœ€æŠ½å–ï¼š https://ant-design.antgroup.com/docs/react/use-with-next-cn#%E4%BD%BF%E7%94%A8-nextjs-%E7%9A%84-app-router https://github.com/ant-design/ant-design-examples/tree/main/examples/with-nextjs-app-router-inline-style

æˆ‘éœ€è¦ä½¿ç”¨è‡ªå®šä¹‰ä¸»é¢˜, æ‰€ä»¥å°† AntdRegister ä»£ç æ”¹æˆä¸‹å›¾æ‰€ç¤º:
![image](https://github.com/ant-design/ant-design/assets/33836381/97377279-6ecd-452c-a04b-d6dd8e63485e)

ä¿®æ”¹å, pnpm build æ‰“åŒ…åå† pnpm start è¿è¡Œ
ç»“æœ nuxt çš„ Link æ ‡ç­¾è·³è½¬å¤±è´¥, æŠ¥å¦‚ä¸‹é”™è¯¯:
![image](https://github.com/ant-design/ant-design/assets/33836381/c418affa-b375-4d06-9327-34d2615cfb8a)

æˆ‘åœ¨ Demo ä¸­çš„ Link ä»£ç å¦‚ä¸‹:
![image](https://github.com/ant-design/ant-design/assets/33836381/e5e25ad5-2506-4a2f-a73c-fe4ab43a0931)

è¾›è‹¦ç¡®è®¤, æ˜¯ä»€ä¹ˆåŸå› å¯¼è‡´çš„è¿™ä¸ªé—®é¢˜ ? å¦‚ä½•è§£å†³ ? æ­¤é—®é¢˜å½±å“é¡¹ç›®, æ¯”è¾ƒç€æ€¥

## kiner-tang

è¿™ä¸ªçœ‹èµ·æ¥ä¸åƒæ˜¯å› ä¸º antd å¯¼è‡´çš„ï¼Œå¯ä»¥æä¾›ä¸€ä¸‹æœ€å°å¤ç°ä»£ç å—

## FreeDrifter

> è¿™ä¸ªçœ‹èµ·æ¥ä¸åƒæ˜¯å› ä¸º antd å¯¼è‡´çš„ï¼Œå¯ä»¥æä¾›ä¸€ä¸‹æœ€å°å¤ç°ä»£ç å—

ç›´æ¥ä¿®æ”¹çš„æ‚¨æä¾›çš„ with-nextjs-app-router-inline-style
å¦‚ä¸‹:
[with-nextjs-app-router-inline-style.zip](https://github.com/ant-design/ant-design/files/12414314/with-nextjs-app-router-inline-style.zip)

å°è¯•è¿‡å…¶ä»–åŠæ³•, å‘ç°åªè¦æ˜¯ä½¿ç”¨ StyleProvider åŒ…è£¹, ä¸” StyleProvider å†…åŒ…å«å…¶ä»–æ ‡ç­¾, å°±ä¼šå‡ºç°æ­¤é—®é¢˜. å¦‚æœåˆ æ‰ StyleProvider, å°±ä¸å†å‡ºç°é—®é¢˜äº†

## MadCcc

![Kapture 2023-08-23 at 09 44 47](https://github.com/ant-design/ant-design/assets/27722486/5e3619b2-294e-460c-b9b0-517c03899d8e)

çœ‹èµ·æ¥æ²¡æœ‰é—®é¢˜

## FreeDrifter

> ![Kapture 2023-08-23 at 09 44 47](https://user-images.githubusercontent.com/27722486/262522393-5e3619b2-294e-460c-b9b0-517c03899d8e.gif)
>
> çœ‹èµ·æ¥æ²¡æœ‰é—®é¢˜

æ˜¯ build åè¿è¡Œçš„å— ? æ‚¨çš„ç³»ç»Ÿç¯å¢ƒæ˜¯ä»€ä¹ˆ ?

## MadCcc

> æ˜¯ build åè¿è¡Œçš„å— ? æ‚¨çš„ç³»ç»Ÿç¯å¢ƒæ˜¯ä»€ä¹ˆ ?

dev

## FreeDrifter

> > æ˜¯ build åè¿è¡Œçš„å— ? æ‚¨çš„ç³»ç»Ÿç¯å¢ƒæ˜¯ä»€ä¹ˆ ?
>
> dev

build ä¹‹åæ‰ä¼šå‡ºç°é—®é¢˜å“ˆ

## MadCcc

åœ¨ layout é‡Œä½¿ç”¨ antd ç»„ä»¶ä¼šæœ‰è¿™ä¸ªé—®é¢˜ï¼Œæš‚æ—¶å¯ä»¥æ‹¿å‡ºå»è§£å†³

## FreeDrifter

åƒ Provider è¿™ç§, æ˜¯éœ€è¦å…¨å±€ç”Ÿæ•ˆçš„. è¿™ä¸ªé—®é¢˜çš„åŸå› æ˜¯ä»€ä¹ˆ ? æœ‰ä»€ä¹ˆå¥½çš„æ›¿ä»£æ–¹æ¡ˆå— ?

## MadCcc

å› ä¸º layout åœ¨åˆ‡æ¢é¡µé¢æ—¶å¹¶æ²¡æœ‰å¸è½½ï¼Œä½†æ˜¯ cache æ¢äº†ä¸€ä¸ªæ–°çš„ï¼Œå¯¼è‡´è·å–ç»„ä»¶çš„æ ·å¼ç¼“å­˜æ—¶å‘½ä¸­ç©ºäº†ã€‚

è¿™ä¸ªé—®é¢˜æˆ‘å¾—å†çœ‹çœ‹ã€‚

## FreeDrifter

å¥½çš„ è¾›è‹¦ æœ‰ç»“æœè¾›è‹¦åé¦ˆ

## MadCcc

è¯•è¯•è¿™æ ·

```tsx
const globalCache = createCache();

export default function StyledComponentsRegistry({
  children,
}: {
  children: React.ReactNode;
}) {
  const cache = typeof window === "undefined" ? createCache() : globalCache;

  useServerInsertedHTML(() => (
    <style
      id="antd"
      dangerouslySetInnerHTML={{ __html: extractStyle(cache, true) }}
    ></style>
  ));

  return (
    <StyleProvider cache={cache}>
      <Button>123</Button>
      {children}
    </StyleProvider>
  );
}
```

å®¢æˆ·ç«¯çš„ cache ä¸åº”è¯¥é‡æ–°åˆ›å»ºã€‚è¿™æ˜¯ä¸€ä¸ª workaroundï¼Œæš‚æ—¶ä¸æ˜æœ‰ä»€ä¹ˆå‰¯ä½œç”¨

## unrjjlmn20185

>

> è¯•è¯•è¿™æ ·
>
> ```tsx
> const globalCache = createCache();
>
> export default function StyledComponentsRegistry({
>   children,
> }: {
>   children: React.ReactNode;
> }) {
>   const cache = typeof window === "undefined" ? createCache() : globalCache;
>
>   useServerInsertedHTML(() => (
>     <style
>       id="antd"
>       dangerouslySetInnerHTML={{ __html: extractStyle(cache, true) }}
>     ></style>
>   ));
>
>   return (
>     <StyleProvider cache={cache}>
>       <Button>123</Button>
>       {children}
>     </StyleProvider>
>   );
> }
> ```
>
> å®¢æˆ·ç«¯çš„ cache ä¸åº”è¯¥é‡æ–°åˆ›å»ºã€‚è¿™æ˜¯ä¸€ä¸ª workaroundï¼Œæš‚æ—¶ä¸æ˜æœ‰ä»€ä¹ˆå‰¯ä½œç”¨

è¬¹æ‹œè¬è³¢è€…ä¹‹åŠ©ï¼Œæ­¤æ³•æœç„¶è§£æˆ‘æ‰€å›°ã€‚ä»Šæ—¥åˆåˆ»ï¼Œæˆ‘äº¦é­é‡åŒä¸€é›£é¡Œã€‚åˆæ™‚ä»¥ç‚ºéŒ¯èª¤èµ·å› ä¹ƒæ–¼ `nextjs`ï¼Œæ•…æœå°‹ç›¸é—œå•é¡ŒåŠå˜—è©¦å„ç¨®è§£æ±ºä¹‹é“ï¼Œä½†çš†ç„¡æ‰€ç²ã€‚ç”±æ–¼å°ˆæ¡ˆä¸­æ‡‰ç”¨ `i18next` æ”¹å‹•è·¯ç”±ï¼Œä»¤æˆ‘å›°æƒ‘ä¸å·²ã€‚ç›´è‡³æœ€çµ‚å¯©æ…æª¢æŸ¥èˆ‡æ¸¬è©¦å¾Œï¼Œå§‹è¦ºå•é¡Œå¯èƒ½èˆ‡ antd æ‰€åŒ…è£¹ä¹‹ `StyledComponentsRegistry` æœ‰é—œã€‚åœ¨è¨»è§£è©²æ®µç¨‹å¼ç¢¼å¾Œï¼Œ`nextjs` çš„éŒ¯èª¤å•é¡Œå¾—ä»¥è§£æ±ºã€‚æˆ‘åŸæ¬²å»ºç«‹æœ€å°é‡ç¾ç¤ºç¯„ï¼Œç„¶è€Œåœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ç™¼ç¾äº†é€™å€‹è§£æ±ºä¹‹é“ã€‚å†æ¬¡æ„Ÿè¬æ‚¨çš„å¹«å¿™ï¼
