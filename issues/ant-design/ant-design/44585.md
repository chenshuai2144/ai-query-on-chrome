# [Form] Request to add debounce validator

`ğŸ’¡ Feature Request`

### What problem does this feature solve?

Mainly for a better validation experience for user and potentially a slightly better performance.

Debounce validator will not be triggered until user stops typing for a defined time period (e.g., 0.5s). And error message (if any) will be removed once user starts typing, so that user will not see a stale error message.

Two benefits from this:

1. User will not see the error message while typing (when `validateTrigger` is `onChange`). And the error message will show up once typing is done and there is something wrong. This will usually happen before user starts typing the next field/input (which is better than `onBlur`)
2. If a customized validator is a heavy function, then it will not be triggered on every value change (when it's `onChange`).

So, overall, user will only see an error message when he/she stops typing and there is something wrong. Otherwise, the error message will never show up if user types everything correctly.

I do see there are quite some issues related to adding debounce into form validation and with this feature built-in, all those problems will be solved! ğŸ˜„

Thanks a lot!

---------- ä¸­æ–‡ ----------

ä¸»è¦ä¸ºäº†ç»™ç”¨æˆ·æä¾›æ›´å¥½çš„validateä½“éªŒä»¥åŠå¯èƒ½å¯¹æå‡æ•ˆç‡æœ‰ä¸€ç‚¹ç‚¹å¸®åŠ©ã€‚

Debounce validatorä»…ä¼šåœ¨ç”¨æˆ·åœæ­¢è¾“å…¥ä¸€å®šæ—¶é—´åè§¦å‘ï¼ˆå¦‚ï¼Œè®¾ç½®äº†0.5sï¼‰ï¼ŒåŒæ—¶é”™è¯¯æé†’ä¹Ÿä¼šåœ¨ç”¨æˆ·å†æ¬¡è¾“å…¥æ—¶è¢«å»é™¤ï¼Œç¡®ä¿è¾“å…¥è¿‡ç¨‹ä¸­ä¸ä¼šçœ‹åˆ°ä¸é€‚ç”¨çš„é”™è¯¯æç¤ºã€‚

ä¸¤ç‚¹å¥½å¤„ï¼š

1. å½“`validateTrigger` æ˜¯ `onChange`çš„æ—¶å€™ï¼Œç”¨æˆ·ä¸ä¼šåœ¨è¾“å…¥çš„è¿‡ç¨‹ä¸­å°±çœ‹åˆ°é”™è¯¯æç¤ºï¼Œä»…ä¼šåœ¨å…¶åœæ­¢è¾“å…¥ä¹‹åå¹¶ä¸”ç¡®å®æœ‰é”™è¯¯æ—¶çœ‹åˆ°ã€‚åªè¦debounceçš„æ—¶é—´æ²¡æœ‰è®¾ç½®å¾ˆé•¿ï¼Œé‚£ä¹ˆç”¨æˆ·å¾€å¾€ä¼šåœ¨å¼€å§‹è¾“å…¥ä¸‹ä¸€ä¸ªæ–‡æœ¬æ¡†ä¹‹å‰å°±çœ‹åˆ°é”™è¯¯æç¤ºï¼Œè¿™æ ·ä¹Ÿè¦å¥½äº`onBlur`ã€‚
2. å¦‚æœä¸€ä¸ªè‡ªå®šä¹‰çš„validatoræ˜¯ä¸€ä¸ªé€»è¾‘å¤æ‚æˆ–è®¡ç®—ç¹ççš„functionï¼Œé‚£ä¹ˆå®ƒä¹Ÿä¸ä¼šåœ¨ç”¨æˆ·æ¯æ”¹å˜ä¸€æ¬¡è¾“å…¥çš„å†…å®¹çš„æ—¶å€™å°±è§¦å‘ã€‚

æ€»å¾—æ¥è¯´ï¼Œç”¨æˆ·åªä¼šåœ¨ä»–åœæ­¢è¾“å…¥å¹¶ä¸”ç¡®å®æœ‰è¯¯çš„æƒ…å†µä¸‹çœ‹åˆ°é”™è¯¯æç¤ºï¼Œå¦‚æœç”¨æˆ·ä¸€åˆ‡æ“ä½œå¾—å½“ï¼Œé‚£ä¹ˆè‡ªå§‹è‡³ç»ˆéƒ½ä¸ä¼šçœ‹åˆ°é”™è¯¯æç¤ºã€‚

æˆ‘ä¹Ÿç¡®å®åœ¨repoé‡Œé¢çœ‹åˆ°äº†ä¸å°‘å…³äºç»™formæ·»åŠ è‡ªå®šä¹‰çš„debounceçš„issueï¼Œæ‰€ä»¥å¦‚æœå®˜æ–¹æ”¯æŒè¯¥åŠŸèƒ½çš„è¯ï¼Œæ‰€æœ‰ç›¸å…³é—®é¢˜å°±å…¨éƒ¨è§£å†³äº†~ï¼

å¤šè°¢äº†~ï¼

### What does the proposed API look like?

It would be great if we just add a new property called something like `validateDebounce` (in millisecond) in the Rule object, and make it `0` or `false` by default (depends on which is easier to add and maintain based on current implementation).
So, it would be something like:

```jsx
<Form.Item
  label="Some Input"
  name="someInput"
  rules={[
    {
      validator: () => {
        /* some code */
      },
      message: "some text",
      validateDebounce: 500,
    },
  ]}
>
  <Input />
</Form.Item>
```

Thanks a lot!

----------ä¸­æ–‡----------

å¦‚æœæˆ‘ä»¬å¯ä»¥åœ¨Rule objecté‡Œé¢æ·»åŠ ä¸€ä¸ªå«åš`validateDebounce` (å•ä½æ¯«ç§’) çš„propertyçš„è¯å°±å¤ªå¥½äº†ï¼é»˜è®¤å€¼å¯ä»¥æ˜¯`0`æˆ–è€…`false`ï¼Œä¸»è¦çœ‹å“ªä¸ªæ›´æ–¹ä¾¿äºåº”ç”¨åˆ°å½“å‰çš„é€»è¾‘ä¸­å¹¶ä¸”æ›´æ˜“äºç»´æŠ¤ã€‚å¤§è‡´çš„æ ¼å¼è¯·å‚è€ƒä¸Šé¢ğŸ‘†ğŸ»

éå¸¸æ„Ÿè°¢~ï¼

<!-- generated by ant-design-issue-helper. DO NOT REMOVE -->

## MadCcc

Try `validator` with a debounced promise?

## Wxh16144

æˆ‘æƒ³æˆ‘å¯èƒ½ä¹Ÿä¼šé‡åˆ°ä½ ç±»ä¼¼éœ€æ±‚ï¼Œæˆ‘æ€è€ƒäº†ä¸€ä¸‹ï¼Œå†™äº†ä¸€ä¸´æ—¶æˆ‘çš„è§£é¢˜æ€è·¯ https://codesandbox.io/s/ji-ben-shi-yong-antd-5-8-6-forked-4qrcyx?file=/demo.tsx:0-2513

## linkfang

> Try `validator` with a debounced promise?

Hi, I tried adding debounce into `validator` function but it doesn't work. The returned `Project.reject('some messages')` will not be got by `validator`.
Here is what I did: https://codesandbox.io/s/basic-usage-antd-5-8-6-forked-g58myw?file=/demo.tsx
I added 2 different debounce functions to the 2 inputs, neither works. You will notice the `console.log()` does appear as expect, but the `reject` is not captured by validator, maybe I didn't do it correctly?

Thanks to @Wxh16144 , who offered a great work around. Basically, we can turn off the `validateTrigger` and manually call the debounced validator. This solved the problem, but still not as good as if AntD supports it out of box. With this built-in, all users can use this feature with just an extra property in `Rule` object without spending time to figure out a work around which not only takes time but also make it a little bit harder to read and maintain.

Here is my version based on @Wxh16144 's solution: https://codesandbox.io/s/biao-dan-xiao-yan-fang-dou-forked-hpdmxl?file=/demo.tsx

But still, it would be great if AntD could support this feature natively. Thanks!

## linkfang

> æˆ‘æƒ³æˆ‘å¯èƒ½ä¹Ÿä¼šé‡åˆ°ä½ ç±»ä¼¼éœ€æ±‚ï¼Œæˆ‘æ€è€ƒäº†ä¸€ä¸‹ï¼Œå†™äº†ä¸€ä¸´æ—¶æˆ‘çš„è§£é¢˜æ€è·¯ https://codesandbox.io/s/ji-ben-shi-yong-antd-5-8-6-forked-4qrcyx?file=/demo.tsx:0-2513

666ï¼Œéå¸¸æ„Ÿè°¢ï¼
æˆ‘ä¹‹å‰ä¸€ç›´å°è¯•æŠŠdebounceåŠ åœ¨validatorä¸Šé¢ï¼Œå®Œå…¨å¿½ç•¥äº†å¯ä»¥å…³é—­triggerï¼ŒæŒ‰ç…§debounceçš„é€»è¾‘call validateã€‚

æˆ‘åœ¨ä½ çš„åŸºç¡€ä¸Šç¨å¾®æ”¹äº†ä¸€ä¸‹ï¼Œå¯ä»¥å‚è€ƒ~
https://codesandbox.io/s/biao-dan-xiao-yan-fang-dou-forked-hpdmxl?file=/demo.tsx
æˆ‘æ˜¯ä»formå±‚çº§å…¨å±€è®¾ç½®debounceï¼Œè¿™æ ·å¯ä»¥çœå»è‡ªå®šä¹‰componentï¼Œä»¥åŠé‡Œé¢çš„stateå’Œhookä¸€ç±»çš„ã€‚

å¦‚æœè¿˜æ˜¯å¸Œæœ›è‡ªå®šä¹‰componentçš„è¯ï¼Œæˆ‘ä¸ªäººçš„å€¾å‘æ˜¯ç›´æ¥åœ¨onChangeé‡Œé¢å¤„ç†é€»è¾‘ï¼Œé¿å…é€»è¾‘è¢«åµŒå…¥ä¸€ä¸ªé•¿é“¾æ¡é‡Œé¢ï¼ˆReactå®˜æ–¹ä¹Ÿæ¨èåœ¨onChangeçš„åœ°æ–¹ç›´æ¥åšè¯¥åšçš„äº‹æƒ…ï¼Œè€Œä¸æ˜¯æŠŠ`useEffect`ä½œä¸ºä¸€ç§event listeneræ¥ç”¨ï¼šhttps://react.dev/learn/you-might-not-need-an-effect#sharing-logic-between-event-handlers ï¼Œä¸ç¡®å®š`useUpdateEffect`æ˜¯ä¸æ˜¯ä¹Ÿæ˜¯ç±»ä¼¼`useEffect`æ˜¯å¤„ç†ä¸€äº›side effectçš„ï¼‰ï¼Œä¸è¿‡`onChange`å¥½åƒä¸å­˜åœ¨åœ¨`Form.Item`é‡Œé¢ï¼Œè™½ç„¶å…¶å®çœŸç”¨çš„è¯ï¼Œä¹Ÿèµ·ä½œç”¨å¹¶ä¸”ä¸ä¼šå‡ºé”™ï¼Œè€Œä¸”AntDçš„[doc](https://ant.design/components/form#formitem)é‡Œé¢ä¹Ÿè¯´å¯ä»¥ç”¨`onChange`ï¼Œåªæ˜¯ä¸è¦ç”¨æ¥ç®¡ç†formçš„å€¼ä¸€ç±»çš„ã€‚æ‰€ä»¥å¦‚æœè‡ªå®šä¹‰componentï¼Œå¯èƒ½è¿˜æ˜¯æŒ‰ç…§ä½ çš„æ–¹æ³•æ¥ï¼Œæˆ–è€…çœ‹æœ‰æ²¡æœ‰åˆ«çš„åŠæ³•èƒ½å¤Ÿçœæ‰`useUpdateEffect`ä¸€ç±»çš„ã€‚

å†æ¬¡æ„Ÿè°¢æä¾›çš„è§£å†³æ–¹æ¡ˆå’Œæ€è·¯~ï¼éå¸¸å—ç”¨ï¼

---------- EN ----------

Thanks a lot! I have been trying to add debounce into validator function and completely forgot we could turn off `validateTrigger` and manually call it with deboucne.

I updated a little bit based on your solution, please refer it here: https://codesandbox.io/s/biao-dan-xiao-yan-fang-dou-forked-hpdmxl?file=/demo.tsx
I set the debounce logic on form level so that we don't need to do a customized component and all the state and effect management in it.

If we prefer to do a customized component, I personally would do the logic inside `onChange` to avoid a long chain logic (reference: https://react.dev/learn/you-might-not-need-an-effect#sharing-logic-between-event-handlers). But it seems `onChange` has some type error with `Form.Item`. Although [AntD](https://ant.design/components/form#formitem) says it's OK to use it to handle logic other than value management. So, for now, I think your solution would be better for customized component, or maybe we could find some other way to remove `useUpdateEffect`.

Anyways, thanks again for your great solution! It helps a lot!

## linkfang

Here are all related issues:

- https://github.com/ant-design/ant-design/issues/40820
- https://github.com/ant-design/ant-design/issues/27753
- https://github.com/ant-design/ant-design/issues/23517

Quite some people were trying the same thing, so it would really be AWESOME if AntD could support debounce validate. Then all future AntD users can just use a simple property `validateDebounce` to achieve what they need instead of taking time to find a proper way to make validator debounce. Thanks! ğŸ˜„

---------- ä¸­æ–‡ ----------
ä»¥ä¸Šæ˜¯æ‰€æœ‰æˆ‘æ‰¾åˆ°çš„ç›¸å…³é—®é¢˜ã€‚ä¸å°‘äººéƒ½æœ‰å°è¯•ç±»ä¼¼çš„åŠŸèƒ½ï¼Œæ‰€ä»¥å¦‚æœAntDå®˜æ–¹æ”¯æŒçš„è¯å°±å¤ªæ£’äº†ï¼è¿™æ ·æ‰€æœ‰æœªæ¥çš„ç”¨æˆ·åªéœ€è¦æ·»åŠ ä¸€ä¸ªç®€å•çš„ `validateDebounce` propertyå°±èƒ½å®ç°ï¼Œå°±ä¸å†éœ€è¦èŠ±æ—¶é—´å»æ‰¾åˆ°ä¸€ä¸ªåˆé€‚å¯ç”¨çš„è§£å†³æ–¹æ¡ˆã€‚æ„Ÿè°¢~ï¼

## Wxh16144

Indeed, I've found people with the same need in issues, as you said, it would improve DX if the tool library supported out-of-the-box by default, looking forward to a design reply from the core members!

------ zh_CN ------
ç¡®å®ï¼Œæˆ‘åœ¨ issues ä¸­ä¹Ÿå‘ç°ç±»ä¼¼åŒæ ·éœ€æ±‚çš„äººï¼Œå¦‚ä½ æ‰€è¯´ï¼Œå¦‚æœå·¥å…·åº“é»˜è®¤æ”¯æŒå¼€ç®±å³ç”¨ï¼Œè¿›ä¸€æ­¥æé«˜ DXï¼ŒæœŸå¾…ä¸€ä¸‹æ ¸å¿ƒæˆå‘˜çš„å›å¤å§ã€‚cc @ant-design/ant-design-collaborators

## zombieJ

It's not well to put in RuleObject since Form.Item support `validateFirst` and this will block the sequence. Create the `validateDebounce` at Form.Item prop instead.

ref https://github.com/ant-design/ant-design/pull/44633

## linkfang

> It's not well to put in RuleObject since Form.Item support `validateFirst` and this will block the sequence. Create the `validateDebounce` at Form.Item prop instead.
>
> ref #44633

Awesome, sounds great!
Thanks A LOT for the super speedy action!!!
And thanks @MadCcc and @Wxh16144 for the help!!!
