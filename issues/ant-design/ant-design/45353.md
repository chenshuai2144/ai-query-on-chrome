# 在modal中进行表单验证, 表单验证不成功时，会触发modal的onCancel事件

`🤔 Need Reproduce`

### Reproduction link

[http://暂无url](http://暂无url)

### Steps to reproduce

formRef.current?.validateFields().then(rsp => { console.log(rsp) }).catch((e) => { console.log(e) })

### What is expected?

点击确认时，表单验证不成功时，不要触发了onCancel事件

### What is actually happening?

自动关闭modal, 并触发了 onCancel 事件

| Environment | Info   |
| ----------- | ------ |
| antd        | 5.10.1 |
| React       | react  |
| System      | win11  |
| Browser     | Chrome |

---

点击确认时，表单验证不成功时，浏览器捕获了 reject， 触发了onCancel事件， 当表单验证成功的则无此问题。

-- Antd 表单验证处理代码段

```
var pending = new Promise(function(resolve, reject) {
    var next2 = function next3(errors) {
      results.push.apply(results, errors);
      total  ;
      if (total === objArrLength) {
        callback(results);
        return results.length ? reject(new AsyncValidationError(results, convertFieldsError(results))) : resolve(source);
      }
    };
```

--

-- Modal 定义

```
<Modal
        title={title}
        open={open}
        width="80%"
        onOk={handleOK}
        onCancel={handleCancel}>
        <Spin spinning={isLoading}>
            <ProForm submitter={false} formRef={formRef} preserve={false}>
                <ProFormText name="name" label="角色名称" width="md" rules={ruleRequired} />
                <ProFormText name="displayName" label="对外展示名称" width="md" rules={ruleRequired} />
            </ProForm>
        </Spin>
    </Modal>
```

-- 事件

```
    const handleCancel = useCallback(async () => {
        console.log("do cancel")
        // onCancel && onCancel()
    }, [])

    const handleOK = useCallback(async () => {
        console.log("hit")
        formRef.current?.validateFields().then(rsp => { console.log(rsp) }).catch((e) => { console.log(e) })
    }, [])
```

点击 确定， 调试结果如下：

hit

modal-edit.tsx?t=1697387705752:25 do cancel

modal-edit.tsx?t=1697387705752:33 {values: {…}, errorFields: Array(2), outOfDate: false}

<!-- generated by ant-design-issue-helper. DO NOT REMOVE -->
