# 👑 [需求] ProFormCaptcha 是否可以支持图形验证码

`form`,`🎖️  featrue`,`AI Reply`

### 🥰 需求描述

<!--
详细地描述需求，让大家都能理解
-->

### 🧐 解决方案

<!--
如果你有解决方案，在这里清晰地阐述
-->

### 🚑 其他信息

<!--
如截图等其他信息可以贴在这里
-->

## chenshuai2144

> TAutomatically replying with ChatGPT can be attempted, but it cannot be guaranteed to be completely accurate and may not fully address all issues. Please feel free to reply if you have any further questions or concerns.
> 此回复基于 ChatGPT 自动生成，可以尝试下方案，官方人员会在一定时间后继续继续处理。

您好，感谢使用 ProFormCaptcha。

目前 ProFormCaptcha 只支持数字验证码，但可以通过修改源码的方式实现图形验证码。

具体实现方式为：

1. 在项目中安装 `canvas` 包

```
npm install canvas
```

2. 在 `ProFormCaptcha` 组件中添加一个 `canvas` 元素

```jsx
import React from "react";
import { randomNum } from "./utils";

class ProFormCaptcha extends React.Component {
  constructor(props) {
    super(props);
    this.state = {
      code: "", // 验证码
    };
    this.canvasRef = React.createRef();
  }

  componentDidMount() {
    const code = randomNum(1000, 9999);
    this.setState(
      {
        code,
      },
      () => {
        this.drawCode(this.state.code);
      },
    );
  }

  drawCode(code) {
    const canvas = this.canvasRef.current;
    const ctx = canvas.getContext("2d");
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    ctx.font = "bold 30px Arial";
    ctx.textAlign = "center";
    ctx.fillText(code, canvas.width / 2, canvas.height / 2 + 10);

    // 绘制干扰线
    for (let i = 0; i < 6; i++) {
      ctx.strokeStyle = "#ccc"; // 颜色
      ctx.beginPath();
      ctx.moveTo(Math.random() * canvas.width, Math.random() * canvas.height);
      ctx.lineTo(Math.random() * canvas.width, Math.random() * canvas.height);
      ctx.stroke();
    }
  }

  handleClick = () => {
    const code = randomNum(1000, 9999);
    this.setState(
      {
        code,
      },
      () => {
        this.drawCode(this.state.code);
      },
    );
  };

  render() {
    const { code } = this.state;
    return (
      <div onClick={this.handleClick}>
        <canvas ref={this.canvasRef} width="120" height="50"></canvas>
        <div>{code}</div>
      </div>
    );
  }
}

export default ProFormCaptcha;
```

3. 修改 `random` 方法，使用 `Math.random()` 的值生成字符。代码示例：

```jsx
export function random() {
  const randomChars =
    "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
  const index = Math.floor(Math.random() * randomChars.length);
  return randomChars.charAt(index);
}

export function randomNum(min, max) {
  let str = "";
  const len = Math.floor(Math.random() * (max - min + 1) + min);
  for (let i = 0; i < len; i++) {
    str += random();
  }
  return str;
}
```

完整代码示例请参考 [ProFormCaptcha 修改为支持图形验证码](https://github.com/ningbaoqi/ProFormCaptcha/tree/feature/graphic-captcha)。

需要注意的是，使用图形验证码可能存在语音阅读障碍。如果您对无障碍体验要求高，可以考虑使用更加普遍的数字验证码。

希望以上内容对您有所帮助，有任何问题可以随时向我提问。

## chenshuai2144

不太好搞，还是 自己实现吧
