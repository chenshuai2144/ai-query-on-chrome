# 🧐[问题]ProFormSelect showSearch时 requst方法如何做到防抖？

`📦  Need to reproduce`

### 🧐 问题描述

1.  requst 如何做到防抖？
2.  requst 返回新数组后option不更新

### 💻 示例代码

```js
<ProFormSelect
  label="xxx"
  showSearch
  request={lodash.debounce(async ({ keyWords }) => {
    if (!keyWords) return [];
    const res = await queryStaff({ keyword: keyWords });
    if (res.status === 200) {
      console.log(res.data.map(({ name, id }) => ({ label: name, value: id })));
      return res.data.map(({ name, id }) => ({ label: name, value: id }));
    }
    return [];
  })}
/>
```

## jiyingzhi

防抖就用你这个方法是可以的

## mouthguo

示例代码没有设置 wait 哦，参考下[文档](https://lodash.com/docs/4.17.15#debounce)默认值为 0 的。

> request 返回新数组后 option 不更新

这个看了下，失去焦点再出现的时候，有了，好像是 bug

## chenshuai2144

不会实时刷新是吗？

## mouthguo

嗯，请求结果没有实时出现在下拉框里面。

## oxygen-xx

@chenshuai2144 这个问题，我也发现了，总之是通过查询更新options，下拉框没有更新，需要失去焦点，再得到焦点的时候，数据才会刷新出来。

## chenshuai2144

这个也是没有复现，我搞了个demo，发现效果还是可以的，来个重现吧

## lucoxlee

同求,可以先混用,坐等更新

```
const handleAppSearch = Debounce(async (name: string) => {
    const res = await appList({name});
    setAppListData(res.data);
}, 800)

<ModalForm
  width={300}
  title="新建"
  formRef={formRef}
  visible={modalVisible}
  onVisibleChange={visible => {
    if (visible === modalVisible) {
      return;
    }
    handleModalVisible(visible);
  }}
  onFinish={okHandle}
>
  <Form.Item
    name="appId"
    label="app"
    rules={[{required: true, message: '请选择app'}]}
  >
    <Select
      showSearch
      placeholder={"请输入APP名称或CODE"}
      defaultActiveFirstOption={false}
      showArrow={false}
      filterOption={false}
      onSearch={handleAppSearch}
      notFoundContent={null}
      style={{width: "100%"}}
    >
      {
        appListData.map(item => <Select.Option key={item.id} value={item.id!}>{item.name}</Select.Option>)
      }
    </Select>
  </Form.Item>
  <ProForm.Group>
    <ProFormText name="name" width={"md"} label="名称" placeholder="请输入名称"
                 rules={[{required: true, message: "请输入！", min: 1}]} />
  </ProForm.Group>
</ModalForm>
```

## MonsterTan

> @chenshuai2144 这个问题，我也发现了，总之是通过查询更新options，下拉框没有更新，需要失去焦点，再得到焦点的时候，数据才会刷新出来。

@chenshuai2144 发现+1。 也是通过request去请求获取数据，第一次能获取ok。但是当输入后，可以发现给后端请求并成功返回，但是select框并没有筛选后的数据.

## jzsn2018

> > @chenshuai2144 这个问题，我也发现了，总之是通过查询更新options，下拉框没有更新，需要失去焦点，再得到焦点的时候，数据才会刷新出来。
>
> @chenshuai2144 发现+1。 也是通过request去请求获取数据，第一次能获取ok。但是当输入后，可以发现给后端请求并成功返回，但是select框并没有筛选后的数据.

同样的问题+1,请问你解决了吗?

## qiangxinglin

+1

## weiqishang

同问，已经升级到最新版本，还是没解决

## DenseW

options没有更新的原因是因为用了lodash.debounce方法，return有问题，直接配置debounceTime={毫秒}就可以实现options更了，且能防抖
![image](https://github.com/ant-design/pro-components/assets/46704005/8dcd8a6e-57c6-42f1-8548-ce26ddef535c)
