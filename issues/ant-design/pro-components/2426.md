# ğŸ‘‘ [éœ€æ±‚] renderFormItem ä¸­æ€ä¹ˆæ‹¿åˆ°æ‰€æœ‰çš„è¡¨æ ¼æ•°æ®å‘¢ï¼Ÿ

### ğŸ§ é—®é¢˜æè¿°

<!--
è¯¦ç»†åœ°æè¿°é—®é¢˜ï¼Œè®©å¤§å®¶éƒ½èƒ½ç†è§£
-->

æˆ‘æœŸæœ›åœ¨ `renderFormItem` ä¸­èƒ½æ‹¿åˆ°æ•´ä¸ªè¡¨æ ¼çš„æ•°æ® `dataSource`ï¼Œæˆ‘çš„å†™æ³•ä¼¼ä¹æœ‰é—®é¢˜ï¼Œ`dataSource`ä¸ºç©ºæ•°ç»„ã€‚

### ğŸ’» ç¤ºä¾‹ä»£ç 

æœŸæœ›åœ¨è¾“å…¥æ¡†äº‹ä»¶ç›‘å¬ä¸­èƒ½æ‹¿åˆ°è¡¨æ ¼æ•°æ®å¹¶æ›´æ–°è¡¨æ ¼

```
  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    setInputValue(e.target.value);
    // æˆ‘æœŸæœ›åœ¨è¿™èƒ½æ‹¿åˆ°è¡¨æ ¼æ•°æ®å¹¶è¿›è¡Œä¿®æ”¹è¡¨æ ¼
    console.log(dataSource)
  };
```

å®Œæ•´ä»£ç 

```
const TagList: React.FC<{
  value?: {
    key: string;
    label: string;
  }[];
  onChange?: (
    value: {
      key: string;
      label: string;
    }[],
  ) => void;
}> = ({ value, onChange, dataSource}) => {
  const ref = useRef<Input | null>(null);
  const [newTags, setNewTags] = useState<
    {
      key: string;
      label: string;
    }[]
  >([]);
  const [inputValue, setInputValue] = useState<string>('');

  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    setInputValue(e.target.value);
    // æˆ‘æœŸæœ›åœ¨è¿™èƒ½æ‹¿åˆ°è¡¨æ ¼æ•°æ®å¹¶è¿›è¡Œä¿®æ”¹è¡¨æ ¼
    console.log(dataSource)
  };

  const handleInputConfirm = () => {
    let tempsTags = [...(value || [])];
    if (inputValue && tempsTags.filter((tag) => tag.label === inputValue).length === 0) {
      tempsTags = [...tempsTags, { key: `new-${tempsTags.length}`, label: inputValue }];
    }
    onChange?.(tempsTags);
    setNewTags([]);
    setInputValue('');
  };

  return (
    <Space>
      {(value || []).concat(newTags).map((item) => (
        <Tag key={item.key}>{item.label}</Tag>
      ))}
      <Input
        ref={ref}
        type="text"
        size="small"
        style={{ width: 78 }}
        value={inputValue}
        onChange={handleInputChange}
        onBlur={handleInputConfirm}
        onPressEnter={handleInputConfirm}
      />
    </Space>
  );
};


const [editableKeys, setEditableRowKeys] = useState<React.Key[]>([]);
const [dataSource, setDataSource] = useState<DataSourceType[]>([]);

const columns: ProColumns<DataSourceType>[] = [
  {
    title: 'æ´»åŠ¨åç§°',
    dataIndex: 'title',
    formItemProps: {
      rules: [
        {
          required: true,
          message: 'æ­¤é¡¹ä¸ºå¿…å¡«é¡¹',
        },
      ],
    },
  },
  {
    title: 'æ ‡ç­¾',
    dataIndex: 'labels',
    width: '40%',
    renderFormItem: () => <TagList dataSource={dataSource}/>,
    render: (_, row) => row?.labels?.map((item) => <Tag key={item.key}>{item.label}</Tag>),
  },
  {
    title: 'æ“ä½œ',
    valueType: 'option',
    render: (text, record, _, action) => [
      <a
        key="editable"
        onClick={() => {
          action.startEditable?.(record.id);
        }}
      >
        ç¼–è¾‘
      </a>,
    ],
  },
];

<EditableProTable<DataSourceType>
  rowKey="id"
  headerTitle="å¯ç¼–è¾‘è¡¨æ ¼"
  columns={columns}
  value={dataSource}
  onChange={setDataSource}
  recordCreatorProps={{
    position: 'end',
    record: { id: (Math.random() * 1000000).toFixed(0) },
  }}
  editable={{
    editableKeys,
    onChange: setEditableRowKeys,
  }}
/>;
```

<!--
å¦‚æœä½ æœ‰è§£å†³æ–¹æ¡ˆï¼Œåœ¨è¿™é‡Œæ¸…æ™°åœ°é˜è¿°
-->

### ğŸš‘ å…¶ä»–ä¿¡æ¯

<!--
å¦‚æˆªå›¾ç­‰å…¶ä»–ä¿¡æ¯å¯ä»¥è´´åœ¨è¿™é‡Œ
-->

## luy19

æˆ–è®¸ä½ å¯ä»¥è€ƒè™‘ç”¨`onValuesChange`ï¼Œ [ç¤ºä¾‹ä»£ç ](https://procomponents.ant.design/components/editable-table#%E5%AE%9E%E6%97%B6%E4%BF%9D%E5%AD%98%E7%9A%84%E7%BC%96%E8%BE%91%E8%A1%A8%E6%A0%BC)

## mtrucc

> æˆ–è®¸ä½ å¯ä»¥è€ƒè™‘ç”¨`onValuesChange`ï¼Œ [ç¤ºä¾‹ä»£ç ](https://procomponents.ant.design/components/editable-table#%E5%AE%9E%E6%97%B6%E4%BF%9D%E5%AD%98%E7%9A%84%E7%BC%96%E8%BE%91%E8%A1%A8%E6%A0%BC)

éå¸¸æ„Ÿè°¢ä½ çš„å›å¤ï¼Œæˆ‘çš„æ•°æ®æ˜¯æ ‘çŠ¶çš„ï¼Œç„¶åæˆ‘åšäº†ä¸€ä¸ªä¸‹æ‹‰æ¡†ï¼Œé€‰æ‹©å…¶ä¸­çš„ä¸€ä¸ªå€¼çš„æ—¶å€™ï¼Œéœ€è¦åœ¨ä¸‹æ–¹æ’å…¥ä¸€ä¸ªæ•°æ®ï¼Œä¹Ÿå°±æ˜¯åœ¨childrenï¼š[]ä¸­æ’å…¥æ•°æ®ï¼Œç„¶åæˆ‘æ˜¯é€šè¿‡idæ‰¾åˆ°è¿™ä¸ªchildrençš„ï¼Œè®©äººå“­ç¬‘ä¸å¾—çš„æ˜¯ï¼ŒrenderFormItemæ–¹æ³•ä¸­æ²¡æ³•è·å–è¿™ä¸€è¡Œçš„idï¼Œåªæœ‰è¡¨å•å¯¹åº”çš„keyï¼Œç¿»äº†ä¸€ä¸‹ï¼Œå‚æ•°ä¸­æœ‰recordKeyã€‚
ç›®å‰æˆ‘æ˜¯æ— æ³•æ‹¿åˆ°æ‰€æœ‰çš„è¡¨æ ¼æ•°æ®è¿›è¡Œæ•°æ®ä¸Šçš„è”åŠ¨ã€‚
![image](https://user-images.githubusercontent.com/16724665/114039656-83a40880-98b5-11eb-9d93-1318b7ff58e2.png)

## chenshuai2144

ç”¨ dataSource å’Œ onDataSourceChange æ¥å®ç°å§ã€‚

## mtrucc

https://github.com/ant-design/pro-components/issues/2201
æˆ‘ä¹Ÿæœ‰ä»–è¿™ç§é—®é¢˜ï¼Œå¹¶ä¸”æ‹¿ä¸åˆ°æ‰€æœ‰çš„è¡¨æ ¼æ•°æ®

## mtrucc

> ç”¨ dataSource å’Œ onDataSourceChange æ¥å®ç°å§ã€‚

å—¯ã€‚ç›®å‰æ˜¯è¿™ä¹ˆä¸€ä¸ªæ€è·¯ï¼Œä¹Ÿæ˜¯è¿™ä¹ˆå†™çš„ï¼Œåªæ˜¯æ‹¿ä¸åˆ°å¯¹åº”è¡Œçš„æ‰€æœ‰å±æ€§ï¼Œåæ¥æˆ‘å¹²è„†ç»™æ‰€æœ‰æ•°æ®ä¸­åŠ å…¥äº†rowKeyï¼šrecordKey è¿™æ ·çš„å±æ€§ï¼Œç„¶åè¿›è¡Œåˆ¤æ–­ã€‚
è¿™æ˜¯ç¬¨åŠæ³•ï¼Œåªèƒ½åšå‚è€ƒï¼Œä¸è¦å­¦æˆ‘ï¼Œï¼Œï¼Œ
å› ä¸ºè¿™ä¹ˆåšä¼šæœ‰æ€§èƒ½é—®é¢˜ï¼Œæ•°æ®é‡ä¸å¤§çš„æ—¶å€™è¿˜å¥½ï¼Œæ•°æ®é‡å¤§çš„æ—¶å€™ï¼Œè®¡ç®—é‡ä¹Ÿä¸å°ã€‚å¹¶ä¸”æ•°æ®å˜åŒ–ä¼¼ä¹ä¹Ÿä¼šå¯¹è¡¨æ ¼çš„domè¿›è¡Œåˆ·æ–°ã€‚

## mtrucc

> ç”¨ dataSource å’Œ onDataSourceChange æ¥å®ç°å§ã€‚

è¿˜æœ‰ä¸ªé—®é¢˜å°±æ˜¯ï¼Œä¸ä»…æ‹¿ä¸åˆ°ï¼Œæ•°æ®å¥½åƒè¿˜æ˜¯è¢«å†»ç»“çš„ï¼Œæ¯”å¦‚æˆ‘è°ƒç”¨äº†`setState`æ–¹æ³•æ›´æ–°äº†è¡¨æ ¼ï¼Œåœ¨`renderFormItem`é‡Œé¢æ‰“å°è¡¨æ ¼æ•°æ®`dataSource`æ˜¯ä¸ªç©ºæ•°ç»„ğŸ˜­

## chenshuai2144

ç”¨ ref

## mtrucc

> ç”¨ ref

é«˜äººå•Šï¼Œæˆ‘å’‹å°±æ²¡æƒ³åˆ°ï¼Œæ˜å¤©è¯•è¯•

## chenshuai2144

ref åœ¨ hooks ä¸­ç›¸å½“äº this.xx

## mtrucc

```
    <EditableProTable<DataSourceType>
      ref={ref}
      headerTitle="å¯ç¼–è¾‘è¡¨æ ¼"
      columns={columns}
      rowKey="id"
      value={dataSource}
      onChange={setDataSource}
      // recordCreatorProps={false}
      recordCreatorProps={{
        newRecordType: 'dataSource',
        record: () => ({
          id: Date.now(),
        }),
      }}
      toolBarRender={() => {
        return [
          <Button
            type="primary"
            key="save"
            onClick={() => {
              // dataSource å°±æ˜¯å½“å‰æ•°æ®ï¼Œå¯ä»¥è°ƒç”¨ api å°†å…¶ä¿å­˜
              console.log(dataSource);
            }}>
            ä¿å­˜æ•°æ®
          </Button>,
        ];
      }}
      editable={false}
    />
```

å¥½åƒæ²¡æ³•æ‹¿åˆ°refã€‚

## chenshuai2144

```
const ref = useRef();

<EditableProTable<DataSourceType>
ref={ref}
headerTitle="å¯ç¼–è¾‘è¡¨æ ¼"
columns={columns}
rowKey="id"
value={dataSource}
onChange={(data) => {
  setDataSource(data);
  ref.current = data;
}}
// recordCreatorProps={false}
recordCreatorProps={{
  newRecordType: "dataSource",
  record: () => ({
    id: Date.now(),
  }),
}}
toolBarRender={() => {
  return [
    <Button type="primary" key="save" onClick={() => {}}>
      ä¿å­˜æ•°æ®
    </Button>,
  ];
}}
editable={false}
/>;

```

## chenshuai2144

ä½ çœ‹ä¸€ä¸‹ï¼Œonchange é‡Œé¢ç”¨ refï¼Œè¿™æ ·å°±å¯ä»¥ä¿è¯ ref é‡Œé¢çš„æ¯æ¬¡éƒ½æ˜¯æ–°çš„

## Hideer

@mtrucc å“ˆå–½ï¼Œæˆ‘å’Œä½ çš„éœ€æ±‚ä¸€æ ·ï¼Œä¹ŸåŒæ ·é‡åˆ°äº†è¿™ä¸ªé—®é¢˜ï¼Œç®€è¿°ä¸‹éœ€æ±‚ï¼ˆåœ¨å˜æ›´ä¸€ä¸ªæ”¯æŒæ ‘çŠ¶çš„å¯ç¼–è¾‘è¡¨æ ¼åœºæ™¯ä¸‹ï¼Œå½“å˜æ›´æŸåˆ—ä¸‹çš„æŸè¡Œå±æ€§ï¼Œéœ€è¦è·å–å½“å‰è¡Œå”¯ä¸€æ ‡è¯†ï¼‰

columnsï¼š
<img width="524" alt="image" src="https://github.com/ant-design/pro-components/assets/31301552/66bc526d-635b-4599-84c6-73a062586191">

field æ–¹æ³•ï¼š
<img width="846" alt="image" src="https://github.com/ant-design/pro-components/assets/31301552/1a8b9254-c9a6-40e6-a869-8ab7847941c9">

é€šè¿‡å›¾ä¸­è¿™äº›æ–¹æ³•éƒ½è·å–ä¸äº†éformå…³è”çš„æ•°æ®

ç¯å¢ƒï¼š
"@ant-design/pro-components": "2.6.8",
"antd": "5.4.7",
