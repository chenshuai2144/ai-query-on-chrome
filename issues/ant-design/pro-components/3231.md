# ğŸ›[BUG]Proç»„ä»¶ä¸­çš„ä¸Šä¼ ç»„ä»¶ä¸Šä¼ æˆåŠŸåä¼šè§¦å‘ä¸¤æ¬¡onchange

`â­•ï¸   bug`,`form`

### ğŸ› bug æè¿°

Proç»„ä»¶ä¸­çš„ä¸Šä¼ ç»„ä»¶ä¸Šä¼ æˆåŠŸåä¼šè§¦å‘ä¸¤æ¬¡onchange

### ğŸ“· å¤ç°æ­¥éª¤

ä½¿ç”¨ProFormUploadDraggerå’ŒDraggerç»„ä»¶åšå¯¹æ¯”

### ğŸ æœŸæœ›ç»“æœ

ä½¿ç”¨ProFormUploadDraggerç»„ä»¶å®Œæˆä¸Šä¼ ååªè§¦å‘ä¸€æ¬¡

### ğŸ’» å¤ç°ä»£ç 

```
<ProFormUploadDragger
  fieldProps={{
    onChange: (info) => {
      const { status } = info.file;
      if (status === 'done') {
        message.success(`${info.file.name} file uploaded successfully.`);
      } else if (status === 'error') {
        message.error(`${info.file.name} file upload failed.`);
      }
    }
  }}
/>

<Dragger
  onChange={(info) => {
    const { status } = info.file;
    if (status === 'done') {
      message.success(`${info.file.name} file uploaded successfully.`);
    } else if (status === 'error') {
      message.error(`${info.file.name} file upload failed.`);
    }
  }}
/>
```

### ğŸš‘ å…¶ä»–ä¿¡æ¯

ç¬¬ä¸€å¼ å›¾ä¸ºantd Proç»„ä»¶ä¸Šä¼ åçš„çŠ¶æ€ï¼Œç¬¬äºŒå¼ å›¾æ˜¯antdç»„ä»¶ä¸Šä¼ åçš„çŠ¶æ€
![image](https://user-images.githubusercontent.com/29800728/125571543-452bc454-512b-4e13-b110-60bbd554177f.png)
![image](https://user-images.githubusercontent.com/29800728/125571573-79d964b9-bcb7-446a-b7df-dcef0a898743.png)

## yaobiao131

åŒæ ·å‡ºç°

## CyberQin

11æœˆ11æ—¥ä»ç„¶ä¼šå‡ºç°ï¼Œè€Œä¸”ä¸ºä»€ä¹ˆç§»é™¤äº†bug labelå•Š

## CyberQin

@chenshuai2144 æ˜¨æ™šæœ‰äººç»™æˆ‘å‘é‚®ä»¶ï¼Œè¯´æ˜¯å°†onchangeå†™åœ¨fieldpropså†…å°±ä¸ä¼šæœ‰è¿™ä¸ªbugï¼Œæˆ‘åšå®Œæµ‹è¯•äº†ï¼Œç¡®å®å¯ä»¥è§£å†³åŒé‡è§¦å‘çš„é—®é¢˜ã€‚å¯èƒ½éœ€è¦æ›´æ–°æ–‡æ¡£æˆ–è€…æ”¹è¿›ç›´æ¥å†™onchangeçš„è§¦å‘

## shanzhaozhen

> @chenshuai2144 æ˜¨æ™šæœ‰äººç»™æˆ‘å‘é‚®ä»¶ï¼Œè¯´æ˜¯å°†onchangeå†™åœ¨fieldpropså†…å°±ä¸ä¼šæœ‰è¿™ä¸ªbugï¼Œæˆ‘åšå®Œæµ‹è¯•äº†ï¼Œç¡®å®å¯ä»¥è§£å†³åŒé‡è§¦å‘çš„é—®é¢˜ã€‚å¯èƒ½éœ€è¦æ›´æ–°æ–‡æ¡£æˆ–è€…æ”¹è¿›ç›´æ¥å†™onchangeçš„è§¦å‘

é‚£å¯èƒ½æ˜¯äº†ï¼Œé‚£æ—¶å€™è§£å†³ä¸äº†æˆ‘é‡æ–°ç”¨éproçš„å°è£…äº†ä¸€æ¬¡å°±èƒ½æ­£å¸¸ç”¨äº†

## juneszh

@chenshuai2144 è¿™è§¦å‘ä¸¤æ¬¡onChangeé—®é¢˜åœ¨æœ€æ–°çš„ç‰ˆæœ¬åˆå¤ç°äº†ï¼Œè€Œä¸”onChangeæ”¾åœ¨fieldpropsé‡Œä¹Ÿä¸è¡Œï¼Œä¼šæŠ¥é”™

> <ProFormUploadDragger
> name={schema.dataIndex}
> fieldProps={{
>         name: 'file',
>         listType: 'picture',
>         action: global.adminPath + '/upload',
>         maxCount: schema.fieldProps.multiple ? 0 : 1,
>         onChange: ({ file, fileList }) => {
>             if (file.status === 'done') {
>                 console.log(file, fileList);
>             } else if (file.status === 'error') {
>                 message.error(`${file.name} file upload failed.`);
>             }
>         },
>         ...schema.fieldProps,
>     }}
> />

![å›¾ç‰‡](https://user-images.githubusercontent.com/2436252/173051445-1fcae019-d52a-4c40-a836-b58c3b020cdd.png)

## CyberQin

![image](https://user-images.githubusercontent.com/15418465/173261758-fd165a66-3bfc-4a84-be90-6a93c176947a.png)
![image](https://user-images.githubusercontent.com/15418465/173261891-30d29d5f-5038-4979-a548-f923521b7aee.png)
![image](https://user-images.githubusercontent.com/15418465/173262323-f6d54aaa-dc61-4b7e-9975-7abcba76304c.png)

ç”¨è‡ªå·±çš„ä»£ç è¯•äº†ä¸€ä¸‹fieldPropsæ¨¡å¼ï¼Œæ²¡æœ‰å¤ç°ï¼Œæ¯æ¬¡è§¦å‘äº‹ä»¶ä»…logä¸€æ¬¡ï¼Œè¿™ä¸ªtypeerrorä½ å¾—è‡ªå·±æ£€æŸ¥ä¸‹ã€‚ç›´æ¥å†™onchangeç‰ˆæœ¬æ²¡æœ‰æºç ï¼Œæš‚ä¸æµ‹è¯•
è¯·é€šè¿‡ä»¥ä¸‹æƒ…å†µæµ‹è¯•ä¸€ä¸‹ï¼š
1ã€æ›´æ–°proformåˆ°1.69.3ï¼Œçœ‹æ˜¯å¦å·²æ¶ˆé™¤bug
2ã€æ£€æŸ¥è‡ªå·±çš„reactè¯­æ³•ï¼Œæ˜¯å¦æ˜¯ç¬”è¯¯

## juneszh

> ![image](https://user-images.githubusercontent.com/15418465/173261758-fd165a66-3bfc-4a84-be90-6a93c176947a.png) ![image](https://user-images.githubusercontent.com/15418465/173261891-30d29d5f-5038-4979-a548-f923521b7aee.png) ![image](https://user-images.githubusercontent.com/15418465/173262323-f6d54aaa-dc61-4b7e-9975-7abcba76304c.png)
>
> ç”¨è‡ªå·±çš„ä»£ç è¯•äº†ä¸€ä¸‹fieldPropsæ¨¡å¼ï¼Œæ²¡æœ‰å¤ç°ï¼Œæ¯æ¬¡è§¦å‘äº‹ä»¶ä»…logä¸€æ¬¡ï¼Œè¿™ä¸ªtypeerrorä½ å¾—è‡ªå·±æ£€æŸ¥ä¸‹ã€‚ç›´æ¥å†™onchangeç‰ˆæœ¬æ²¡æœ‰æºç ï¼Œæš‚ä¸æµ‹è¯• è¯·é€šè¿‡ä»¥ä¸‹æƒ…å†µæµ‹è¯•ä¸€ä¸‹ï¼š 1ã€æ›´æ–°proformåˆ°1.69.3ï¼Œçœ‹æ˜¯å¦å·²æ¶ˆé™¤bug 2ã€æ£€æŸ¥è‡ªå·±çš„reactè¯­æ³•ï¼Œæ˜¯å¦æ˜¯ç¬”è¯¯

è°¢è°¢ä½ çš„æµ‹è¯•ï¼Œå…³äºä½ æå‡ºçš„ä¸¤ä¸ªå¯èƒ½æ€§

1. å·²å°è¯•è¿‡npm updateï¼Œæ²¡æœ‰å¾—åˆ°è§£å†³
2. åªæ˜¯å°†onChangeæ”¾åœ¨ä¸åŒä½ç½®ï¼Œåº”è¯¥ä¸ä¼šæ˜¯è¯­æ³•é—®é¢˜ï¼Œè€Œä¸”buildä¹Ÿæ²¡æœ‰é”™è¯¯ã€‚

å› ä¸ºæˆ‘æ˜¯åœ¨schemaFormçš„renderFormItemé‡Œä½¿ç”¨çš„ProFormUploadDraggerï¼Œä¸ç›´æ¥ä½¿ç”¨ProFormUploadDraggerå¯èƒ½å­˜åœ¨å·®åˆ«ï¼Œæ€€ç–‘è¿™æ˜¯è¯±å‘ç‚¹ï¼Œç¨åæˆ‘æµ‹è¯•ä¸åœ¨schemaFormé‡Œä½¿ç”¨æ˜¯å¦å°±æ²¡é—®é¢˜ã€‚

## juneszh

@HQDragon ä¸å¹¸åœ°ï¼Œæˆ‘å°†ä»£ç ç²¾ç®€åˆ°åªå‰©ProFormUploadDraggerä»ç„¶ä¼šå¤ç°onChangeä¸¤æ¬¡è§¦å‘

ä½†æˆ‘æ³¨æ„åˆ°æˆ‘ä»¬çš„ç»„ä»¶ç‰ˆæœ¬æœ‰äº›è®¸ä¸ä¸€æ ·ï¼š
![å›¾ç‰‡](https://user-images.githubusercontent.com/2436252/173279451-593e6025-a3e5-4158-bc1c-2d653cb9ffaa.png)

å°±æ˜¯antdæˆ‘è¿™è¾¹ç”¨çš„æ˜¯æœ€æ–°çš„4.21.0ï¼Œç„¶åæˆ‘å°è¯•é™åˆ°antd@4.20.0ï¼Œé—®é¢˜ä»ç„¶å¤ç°ï¼Œæœ€åå°è¯•antd@4.19.5ï¼Œä½†æç¤ºï¼š

`npm ERR! Could not resolve dependency:`
`npm ERR! peer antd@">=4.20.0" from @ant-design/pro-form@1.69.3`

å¯è§pro-form@1.69.3ä¸èƒ½å…¼å®¹antd@4.20.0ä»¥ä¸‹ç‰ˆæœ¬ï¼Œä½ æ˜¯å¦‚ä½•åšåˆ°çš„ï¼Ÿ

## CyberQin

![image](https://user-images.githubusercontent.com/15418465/173979908-72f2cb47-ad45-4370-9f94-09f3419a2093.png)
![image](https://user-images.githubusercontent.com/15418465/173979942-8a26d04f-0109-4703-8f63-59c043aa32a6.png)
emmmï¼Œè¦ä¸ä½ å»æ‰@ant-desian/pro-formè¿™ä¸ªä¾èµ–ï¼Œå› ä¸ºç°åœ¨pro-componentå·²ç»åŒ…å«äº†å…¶å®ƒproç»„ä»¶äº†ï¼Œç„¶åç”¨yarnç®¡ç†ä¾èµ–ï¼Ÿæˆ‘æ˜¯æŒ‰ç…§å®˜æ–¹æ¨èçš„tyarnåšçš„ç®¡ç†ã€‚ä¹‹å‰ç”¨pnpmç®¡ç†ï¼Œå¾ˆå¤špeer depä¸ä¼šå®‰è£…ï¼Œæˆ‘å°±æ”¾å¼ƒäº†pnpmã€‚
å¦å¤–ï¼Œantdç‰ˆæœ¬å‡çº§å¹¶æ²¡æœ‰é€ æˆé‡å¤è§¦å‘äº‹ä»¶çš„é—®é¢˜å‘€ã€‚

## CyberQin

@juneszh @chenshuai2144 ä¸è¿‡ï¼Œä»Šå¤©æµ‹è¯•äº†ç›´æ¥onchangeçš„æ–¹æ³•å†™äº‹ä»¶ï¼Œç¡®å®å‘ç”Ÿäº†ä¸¤æ¬¡è§¦å‘ï¼Œè¿™ä¸ªbugåˆå›æ¥äº†= =ï¼
![image](https://user-images.githubusercontent.com/15418465/173980653-70451c10-e58c-4709-9657-847b82ed9bf4.png)
![image](https://user-images.githubusercontent.com/15418465/173980702-ab1dd087-c1c1-44c0-a288-c2640a8c70b1.png)

## juneszh

å¤ç°äº†å°±å¥½XD

æˆ‘è¿™è¾¹ä¹Ÿæ‰¾åˆ°äº†onChangeæŠ¥é”™çš„åŸå› ï¼Œæ˜¯schemaFormçš„renderFormItemä¼šè‡ªåŠ¨èµ‹å€¼é¡¶çº§æ ‡ç­¾propsï¼Œå¯¼è‡´çš„å†²çªï¼Œéœ€è¦å¤–å±‚åŠ ä¸ªåŒ…è£¹å°±è§£å†³ï¼š
<><ProFormUploadDragger fieldProps={...schema.fieldProps} /></>

## CyberQin

>

é‚£æ˜¯ä¸æ˜¯æ„å‘³ç€ï¼Œä½ ä½¿ç”¨fieldPropsæ¨¡å¼ä¹Ÿå¯ä»¥é¿å…é‡å¤è§¦å‘çš„é—®é¢˜ï¼Œå…¶å®ä»å»å¹´å‘ç°è¿™ä¸ªé—®é¢˜èµ·ï¼Œæˆ‘æ‰€æœ‰çš„proç»„ä»¶çš„çŠ¶æ€äº‹ä»¶éƒ½å†™åœ¨è¿™ä¸ªé‡Œé¢äº†ï¼Œä¹‹å‰æœ‰ä¸€ä½è²Œä¼¼æ˜¯å¼€å‘ç»„å¤§ä½¬çš„ä»»åŠ¡ç»™æˆ‘å‘é‚®ä»¶ï¼Œå»ºè®®æˆ‘è¿™ä¹ˆåšã€‚

## juneszh

> >
>
> é‚£æ˜¯ä¸æ˜¯æ„å‘³ç€ï¼Œä½ ä½¿ç”¨fieldPropsæ¨¡å¼ä¹Ÿå¯ä»¥é¿å…é‡å¤è§¦å‘çš„é—®é¢˜ï¼Œå…¶å®ä»å»å¹´å‘ç°è¿™ä¸ªé—®é¢˜èµ·ï¼Œæˆ‘æ‰€æœ‰çš„proç»„ä»¶çš„çŠ¶æ€äº‹ä»¶éƒ½å†™åœ¨è¿™ä¸ªé‡Œé¢äº†ï¼Œä¹‹å‰æœ‰ä¸€ä½è²Œä¼¼æ˜¯å¼€å‘ç»„å¤§ä½¬çš„ä»»åŠ¡ç»™æˆ‘å‘é‚®ä»¶ï¼Œå»ºè®®æˆ‘è¿™ä¹ˆåšã€‚

æ˜¯çš„ï¼Œç°åœ¨å·²ç»å¯ä»¥ä½¿ç”¨fieldPropsçš„onChangeå…ˆè§£å†³ï¼Œå‰©ä¸‹å°±ç­‰å¤§ä½¬æ…¢æ…¢ä¿®å¤bugäº†

## aspirantzhang

è¿˜çœŸæœ‰è¿™ä¸ªé—®é¢˜ã€‚ã€‚ç”¨ fieldProps çš„ onChange å°±æ²¡æ¯›ç—…ã€‚
