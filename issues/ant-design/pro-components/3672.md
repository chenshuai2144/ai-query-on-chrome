# ğŸ§[BUG]ProFromå¥—EditableProTableå¦‚ä½•è¿›è¡Œè¡¨å•éªŒè¯

`table`,`ğŸ“• docs`,`AI Reply`

### ğŸ§ é—®é¢˜æè¿°

æˆ‘ç°åœ¨çš„ä»£ç åªèƒ½åšåˆ°éEditableProTableçš„è¡¨å•éªŒè¯ï¼Œè™½ç„¶æˆ‘åœ¨EditableProTableä¸ŠåŠ äº†rulesè§„åˆ™ï¼Œä½†æ˜¯ç‚¹å‡»submitæäº¤çš„æ—¶å€™åªèƒ½éªŒè¯éEditableProTableçš„è¡¨å•ã€‚EditableProTableè¡¨å•çš„å€¼åªæœ‰åœ¨è¾“å…¥çš„æ—¶å€™èƒ½è¿›è¡ŒéªŒè¯ï¼Œfocusåsubmitå°±æ— æ³•éªŒè¯ï¼Œæƒ³è¯·æ•™ä¸‹å¦‚ä½•è¿›è¡Œè”åŠ¨éªŒè¯ï¼Œæˆ‘å°è¯•è¿‡åœ¨EditableProTableåŠ formï¼Œå¦‚æœProFormå’ŒEditableProTableéƒ½åŠ fromä¼šæœ‰é—®é¢˜ï¼Œå¦‚æœåªåœ¨EditableProTableä¸ŠåŠ fromåˆä¼šå¯¹FroFromæ— æ³•éªŒè¯ã€‚ æ±‚è§£

### ğŸ’» ç¤ºä¾‹ä»£ç 

```
import ProCard from '@ant-design/pro-card';
import { PageContainer } from '@ant-design/pro-layout';
import ProForm, { ProFormDigit, ProFormText } from '@ant-design/pro-form';
import { Form } from 'antd';
import React, { useState } from 'react';
import { EditableProTable, ProColumns } from '@ant-design/pro-table';
import FormFooter from '@/components/FormFooter';
import { errorMsg } from '@/utils/tool';
import '@/style/goods/parameter.less';

type DataSourceType = {
  id: React.Key;
  name?: string;
  value?: string;
};

const columns: ProColumns<DataSourceType>[] = [
  {
    title: 'å‚æ•°åç§°',
    dataIndex: 'name',
    width: '30%',
    formItemProps: {
      rules: [
        {
          required: true,
          message: 'è¯·å¡«å†™å‚æ•°åç§°'
        }
      ]
    },
    fieldProps: {
      allowClear: false
    }
  },
  {
    title: 'å‚æ•°å€¼',
    dataIndex: 'value',
    formItemProps: {
      rules: [
        {
          required: true,
          message: 'è¯·å¡«å†™å‚æ•°å€¼'
        }
      ]
    },
    fieldProps: {
      allowClear: false
    }
  },
  {
    title: 'æ“ä½œ',
    width: 60,
    valueType: 'option'
  }
];

const Page = () => {
  const [useForm] = Form.useForm();
  const [paramsPreview, setParamsPreview] = useState<DataSourceType[]>([
    {
      id: 1,
      name: '',
      value: 'è¿™ä¸ªæ´»åŠ¨çœŸå¥½ç©'
    },
  ]);
  const [editableKeys, setEditableRowKeys] = useState<React.Key[]>(() =>
    paramsPreview.map((item) => item.id)
  );

  return (
    <PageContainer title={false} breadcrumbRender={false}>
      <ProCard style={{ background: '#f0f2f5' }} gutter={[16, 16]} bodyStyle={{ padding: 0 }}>
        <ProCard
          bordered
          headerBordered
          colSpan={{
            xl: '55%'
          }}
          title='æ·»åŠ å•†å“å‚æ•°'
          style={{ height: '100%' }}
        >
          <ProForm
            layout='horizontal'
            form={useForm}
            labelCol={{ span: 4 }}
            // wrapperCol={{ span: 20 }}
            // request={async () => {
            //   return { ...data };
            // }}
            onValuesChange={(values) => {
              if (values.params !== undefined) {
                setParamsPreview(values.params);
              }
            }}
            onFinishFailed={() => {
              errorMsg('è¡¨å•éªŒè¯å¤±è´¥');
            }}
            onFinish={async (values) => {
              console.log(values);
            }}
            // submitter={false}
          >
            <ProFormDigit name='id' hidden />
            <ProFormText width='md' name='name' label='å•†å“å‚æ•°åç§°' rules={[
              {
                required: true,
                message: 'è¯·å¡«å†™å•†å“å‚æ•°åç§°'
              }]
            } />
            <ProForm.Item
              label='å‚æ•°åˆ—è¡¨æ•°æ®'
              name='params'
              initialValue={paramsPreview}
              trigger='onValuesChange'
            >
              <EditableProTable<DataSourceType>
                rowKey='id'
                cardProps={{ bodyStyle: { padding: 0, margin: 0 } }}
                toolBarRender={false}
                columns={columns}
                recordCreatorProps={{
                  newRecordType: 'dataSource',
                  position: 'top',
                  creatorButtonText: 'æ·»åŠ å•†å“å‚æ•°',
                  record: () => ({
                    id: Date.now()
                  })
                }}
                editable={{
                  type: 'multiple',
                  editableKeys,
                  onChange: setEditableRowKeys,
                  actionRender: (row, _, dom) => {
                    return [dom.delete];
                  }
                }}
              />
            </ProForm.Item>

            <FormFooter form={useForm} />
          </ProForm>
        </ProCard>
        <ProCard bordered headerBordered title='å•†å“å‚æ•°é¢„è§ˆ' style={{ height: '100%' }}>
          {paramsPreview.map((item: DataSourceType, index) => {
            return (
              <div className='table-form-item' key={index}>
                <label className='table-form-item__label' style={{ width: 120 }}>{item.name}</label>
                <div className='table-form-item__content' style={{ marginLeft: 120 }}>{item.value}</div>
              </div>
            );
          })}
        </ProCard>
      </ProCard>
    </PageContainer>
  );
};

export default Page;
```

### ğŸš‘ å…¶ä»–ä¿¡æ¯

![image](https://user-images.githubusercontent.com/12706830/133362508-ed764aed-fa5c-4155-a23d-fb6ff261ceed.png)

## submitåªèƒ½å¯¹ProForméªŒè¯

![image](https://user-images.githubusercontent.com/12706830/133362558-5d467097-d76f-4b58-8304-371d61b09dde.png)

## åªæœ‰åœ¨changeçš„æ—¶å€™ä¼šæœ‰éªŒè¯

## chenshuai2144

https://procomponents.ant.design/components/editable-table#%E4%B8%8E-formitem-%E9%85%8D%E5%90%88

è¯•è¯•è¿™ä¸ªæ¨¡å¼ï¼Œç»™ ç¼–è¾‘è¡¨æ ¼é…ç½®ä¸ª name

## codedart2018

> https://procomponents.ant.design/components/editable-table#%E4%B8%8E-formitem-%E9%85%8D%E5%90%88
>
> è¯•è¯•è¿™ä¸ªæ¨¡å¼ï¼Œç»™ ç¼–è¾‘è¡¨æ ¼é…ç½®ä¸ª name

åŠ äº†ä¹Ÿæ²¡æœ‰ç”¨çš„ã€‚éªŒè¯ä¸äº†ï¼Œæˆ‘æŠŠä»£ç æ‹·è´å‡ºæ¥å’Œåœ¨codesanboxä¸Šéƒ½è¯•äº†ä¸è¡Œçš„ï¼Œè¿™ä¸ªåº”è¯¥ç®—æ˜¯ä¸€ä¸ªbugå§ã€‚ä½ ä»¬è‡ªå·±å¯ä»¥å¥—ä¸€ä¸‹ProforméªŒè¯è¯•ä¸‹

```
import ProCard from '@ant-design/pro-card';
import { PageContainer } from '@ant-design/pro-layout';
import ProForm, { ProFormDigit, ProFormInstance, ProFormText } from '@ant-design/pro-form';
import React, { useRef, useState } from 'react';
import { EditableProTable, ProColumns } from '@ant-design/pro-table';
import { errorMsg } from '@/utils/tool';
import '@/style/goods/parameter.less';

type DataSourceType = {
  id: React.Key;
  title?: string;
  decs?: string;
  children?: DataSourceType[];
};

const defaultData: DataSourceType[] = [
  {
    id: '624748504',
    title: 'æ´»åŠ¨åç§°ä¸€',
    decs: 'è¿™ä¸ªæ´»åŠ¨çœŸå¥½ç©'
  },
  {
    id: '624691229',
    title: 'æ´»åŠ¨åç§°äºŒ',
    decs: 'è¿™ä¸ªæ´»åŠ¨çœŸå¥½ç©'
  }
];

const Page = () => {
  const [editableKeys, setEditableRowKeys] = useState<React.Key[]>(() =>
    defaultData.map((item) => item.id)
  );
  const [paramsPreview, setParamsPreview] = useState<DataSourceType[]>([]);
  const formRef = useRef<ProFormInstance<any>>();
  const columns: ProColumns<DataSourceType>[] = [
    {
      title: 'æ´»åŠ¨åç§°',
      dataIndex: 'title',
      formItemProps: {
        rules: [
          {
            required: true,
            message: 'æ­¤é¡¹æ˜¯å¿…å¡«é¡¹'
          }
        ]
      },
      width: '30%'
    },
    {
      title: 'æè¿°',
      dataIndex: 'decs',
      formItemProps: {
        rules: [
          {
            required: true,
            message: 'æ­¤é¡¹æ˜¯å¿…å¡«é¡¹'
          }
        ]
      }
    },
    {
      title: 'æ“ä½œ',
      valueType: 'option',
      width: 60
    }
  ];

  return (
    <PageContainer title={false} breadcrumbRender={false}>
      <ProCard style={{ background: '#f0f2f5' }} gutter={[16, 16]} bodyStyle={{ padding: 0 }}>
        <ProCard
          bordered
          headerBordered
          colSpan={{
            xl: '55%'
          }}
          title='æ·»åŠ å•†å“å‚æ•°'
          style={{ height: '100%' }}
        >
          <ProForm<{
            params: DataSourceType[];
          }>
            layout='horizontal'
            labelCol={{ span: 4 }}
            formRef={formRef}
            initialValues={{
              params: defaultData
            }}
            onFinishFailed={() => {
              errorMsg('è¡¨å•éªŒè¯å¤±è´¥');
            }}
            onFinish={async (values) => {
              console.log(values);
            }}
          >
            <ProFormDigit name='id' hidden />
            <ProFormText width='md' name='name' label='å•†å“å‚æ•°åç§°' rules={[
              {
                required: true,
                message: 'è¯·å¡«å†™å•†å“å‚æ•°åç§°'
              }]
            } />
            <ProForm.Item label='å‚æ•°åˆ—è¡¨æ•°æ®'>
              <EditableProTable<DataSourceType>
                rowKey='id'
                maxLength={5}
                name='params'
                recordCreatorProps={{
                  newRecordType: 'dataSource',
                  position: 'top',
                  creatorButtonText: 'æ·»åŠ å•†å“å‚æ•°',
                  record: () => ({
                    id: Date.now()
                  })
                }}
                columns={columns}
                editable={{
                  type: 'multiple',
                  editableKeys,
                  onChange: setEditableRowKeys,
                  actionRender: (row, _, dom) => {
                    return [dom.delete];
                  }
                }}
              />
            </ProForm.Item>
          </ProForm>
        </ProCard>
        <ProCard bordered headerBordered title='å•†å“å‚æ•°é¢„è§ˆ' style={{ height: '100%' }}>
          {paramsPreview.map((item: DataSourceType, index) => {
            return (
              <div className='table-form-item' key={index}>
                <label className='table-form-item__label' style={{ width: 120 }}>{item.name}</label>
                <div className='table-form-item__content' style={{ marginLeft: 120 }}>{item.value}</div>
              </div>
            );
          })}
        </ProCard>
      </ProCard>
    </PageContainer>
  );
};

export default Page;

```

![image](https://user-images.githubusercontent.com/12706830/133366598-c3f3d761-b29b-4744-b6d1-61e0d5fabdbd.png)

### ä¹Ÿå°±æ˜¯è¯´è¡¨æ ¼éªŒè¯ä¸äº†ï¼ŒonFinishå°±å‡ºç»“æœäº†ã€‚æ­£å¸¸æ˜¯éªŒè¯æ²¡æœ‰é€šè¿‡æœ‰é˜»å¡ï¼ŒonFinishæ˜¯ä¸èƒ½æ‰“å°çš„ã€‚

## puchunjie

è¿™ä¸ªåªèƒ½åœ¨EditableProTable ä¸Šé…ç½®formå®ä¾‹ï¼Œç„¶åé€šè¿‡è¿™ä¸ªå®ä¾‹æ‰‹åŠ¨å»è§¦å‘è¡¨å•æ£€éªŒ

## leshalv

è¯¥æ€ä¹ˆæ”¹ï¼Œè¿˜æ˜¯è¯´è¿™æ˜¯ä¸ªBUGï¼Ÿ

## conviva-zyang

æœ‰ä»€ä¹ˆè§£å†³æ–¹æ¡ˆå—ï¼Ÿ

## chenzhizhen

refer to #2210

## LoveEocding

è§£å†³æ–¹æ¡ˆï¼š ä½¿ç”¨Form.item rules è‡ªå®šä¹‰äº‹ä»¶éªŒè¯ï¼Œè§¦å‘å¯ç¼–è¾‘è¡¨æ ¼å®ä¾‹çš„éªŒè¯ã€‚éªŒè¯å¯è¡Œ
![image](https://user-images.githubusercontent.com/29218661/147633450-f6270979-d8f0-47d8-abd3-889560f2ee1b.png)

## conviva-zyang

æˆ‘æ˜¯è¿™ä¹ˆè§£å†³çš„ï¼Œå¤§å®¶å¯ä»¥è¯•è¯•ã€‚æˆ‘å°è¯•ç»™EditableProTable åŠ äº†editable={{ form: form }} form æ¥è‡ªuseForm()ï¼Œ åœ¨proForm submitçš„æ—¶å€™è°ƒç”¨form.validateFields().

## Tinyuen

ProForm è¿˜å¥½ï¼Œä½†æ˜¯ ProForm ä¸­æœ‰ ProFormListï¼Œ ProFormList ä¸­åµŒå¥—äº† EditableProTable æ€ä¹ˆéªŒè¯ï¼Œæ„æ­»äº†......

## chenshuai2144

<ProForm.Item label='å‚æ•°åˆ—è¡¨æ•°æ®'> åœ¨è¿™é‡Œè‡ªå·±æ‰‹å†™è§„åˆ™å§
