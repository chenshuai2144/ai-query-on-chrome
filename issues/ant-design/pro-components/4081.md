# 🐛[BUG] ProFormList表单互相嵌套 的时候 子表单的复制没有复制到数据

`📝  doc`,`AI Reply`

### 🐛 bug 描述

ProFormList表单互相嵌套的时候，点击子表单的复制，只是生成了新的list，并没有把数据复制过去。现在官方的demo也是这样。

### 🚑 其他信息

![1637302063941](https://user-images.githubusercontent.com/40255722/142573863-4ca7503f-5b4f-440a-8b70-3bc0d6dc60ee.jpg)

## Bierxiensi

![image](https://user-images.githubusercontent.com/40264423/146634183-06a50f5b-ca4f-4c08-a399-c02983bca523.png)
@chenshuai2144 我看到嵌套的form点击复制Icon时会尝试根据name取出需要复制的数据追加在最后一行。我在进入页面尝试使用当前实例的getFieldsValue方法获取对应name的数据，但始终获取不到，我不能理解为什么会这样。
![image](https://user-images.githubusercontent.com/40264423/146634369-fd07de42-4c71-4fb3-b922-43d876d76860.png)
![image](https://user-images.githubusercontent.com/40264423/146634500-33092715-1644-415f-b0a8-e9c117023b91.png)

## qiyulaoshi

我的也是这样 你现在解决了吗

## chenshuai2144

> TAutomatically replying with ChatGPT can be attempted, but it cannot be guaranteed to be completely accurate and may not fully address all issues. Please feel free to reply if you have any further questions or concerns.
> 此回复基于 ChatGPT 自动生成，可以尝试下方案，官方人员会在一定时间后继续继续处理。

此问题可能是由于 ProFormList 的数据存储方式所引起，为了在内部尽快找到问题，建议尝试使用传统的表单数据处理方式来解决。

对于这个问题，可以尝试在 ProFormList 组件使用 `form` 属性，让其子组件能够获取到父组件的表单实例，然后在子组件中引用 `form` 实例的 `getFieldValue(name)` 方法，获取对应的数据，复制后再手动添加到 list 中。代码示例如下：

```
import React from 'react';
import { Form, Input, Button, Space } from 'antd';
import ProForm, {
  ProFormList,
  ProFormText,
} from '@ant-design/pro-form';

const Demo = () => {
  const [form] = Form.useForm();

  return (
    <Form form={form}>
      <ProForm>
        <ProFormList name="pets">
          {(fields, { add, remove, move }) => {
            return (
              <div>
                {fields.map((field, index) => (
                  <div key={field.key}>
                    <Form.Item
                      label="Nickname"
                      name={[field.name, 'nickname']}
                      fieldKey={[field.fieldKey, 'nickname']}
                      rules={[{ required: true, message: 'Missing nickname' }]}
                    >
                      <Input />
                    </Form.Item>
                    <Form.Item
                      label="Animal"
                      name={[field.name, 'animal']}
                      fieldKey={[field.fieldKey, 'animal']}
                      rules={[{ required: true, message: 'Missing animal' }]}
                    >
                      <Input />
                    </Form.Item>
                    <Form.Item
                      label="Age"
                      name={[field.name, 'age']}
                      fieldKey={[field.fieldKey, 'age']}
                      rules={[{ required: true, message: 'Missing age' }]}
                    >
                      <Input />
                    </Form.Item>
                    <Form.Item
                      label="Command"
                      name={[field.name, 'command']}
                      fieldKey={[field.fieldKey, 'command']}
                    >
                      <Input />
                      <Button
                        type="text"
                        onClick={() => {
                          const record = form.getFieldValue(['pets', index]);
                          add(record, index + 1);
                        }}
                      >
                        Copy
                      </Button>
                      <Button
                        type="text"
                        onClick={() => {
                          remove(index);
                        }}
                      >
                        Remove
                      </Button>
                    </Form.Item>
                  </div>
                ))}
                <Form.Item>
                  <Button type="primary" onClick={() => add()}>
                    Add another
                  </Button>
                </Form.Item>
              </div>
            );
          }}
        </ProFormList>
      </ProForm>
    </Form>
  );
};

export default Demo;
```

上述代码示例中，将 ProFormList 嵌套在 ProForm 中，并在表单初始化时获得表单实例并传递给 ProFormList，然后在处理复制事件时，通过上述方式获取并处理数据。

这种方式的好处是能够完整的控制表单数据流，缺点是需要手动处理数据，适用于表单嵌套的情况，对于较为简单的表单场景，推荐使用 ProFormList 自带的数据处理方式。

## chenshuai2144

是时机的，你需要把行号什么的也拼接上去，我增加新的 api 来解决这个问题
