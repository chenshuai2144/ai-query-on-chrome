# 🧐[问题] pro-\*组件在打包的时候会把下面模块一起打包，导致打包体积增加？

`umi`,`AI Reply`

### 🧐 问题描述

通过`yarn analyze`分析发现在使用`pro-form`后会将其下的所有模块统统打包进来，导致打包体积过大，这种现象是否正常？正常的话能不能避免？

### 💻 示例代码

```js
import {
  QueryFilter,
  ProFormDateRangePicker,
  ProFormText,
} from "@ant-design/pro-form";
<QueryFilter>
  <ProFormText name="name" label="企业" />
  <ProFormDateRangePicker name="create" label="分析区间" />
</QueryFilter>;
```

### 🚑 其他信息

![image](https://user-images.githubusercontent.com/43987769/144541676-c06e9e2b-adc5-49e1-9905-44619c5afdf3.png)
![image](https://user-images.githubusercontent.com/43987769/144542050-7b62579d-101b-4bd2-a95a-f96e06079529.png)

比如`pro-form`为例，使用了其中的两个`modules`，但是打包却把355个`modules`全部打包？但是具体到某一个使用`pro-form`的组件发现也进行了一次按需加载？这个话355个`modules`感觉有点不必要呢？

## chenshuai2144

umi@4会考虑优化

## zwmmm

解决了么 我看umi@4发布了

## chenshuai2144

> TAutomatically replying with ChatGPT can be attempted, but it cannot be guaranteed to be completely accurate and may not fully address all issues. Please feel free to reply if you have any further questions or concerns.
> 此回复基于 ChatGPT 自动生成，可以尝试下方案，官方人员会在一定时间后继续继续处理。

umi@4 的动态打包功能对于按需加载的优化是非常显著的，不再会像之前一样把所有依赖都打包进去，而是因为动态 import 实现需要的时候才会去请求加载相应的模块。如果你是在 umi@4 正式版之前使用过的，请升级到最新版本体验一下这个功能。

另外，关于 pro-\* 组件打包过大这个问题，可以在 umi 配置文件 `config/config.ts` 中添加以下配置来支持运行时按需加载。这样会在页面加载时，只会加载用户实际使用的代码，而不会将所有代码均打包进去。

```javascript
export default {
  dynamicImport: {
    loading: "@/components/PageLoading/index",
  },
};
```

同时，也要保证 pro-\* 组件能够正常被按需加载，在`.babelrc` 中确保已经引入了 babel-plugin-import：

```json
{
  "plugins": [
    [
      "import",
      {
        "libraryName": "@ant-design/pro-form",
        "libraryDirectory": "es",
        "style": true
      }
    ]
  ]
}
```

最后，确保在页面中正确使用了按需加载的方式。比如按照楼上提到的，可以采用以下方式：

```javascript
import { QueryFilter } from "@ant-design/pro-table";
import { ProFormText } from "@ant-design/pro-form";
import { ProFormDateRangePicker } from "@ant-design/pro-form";
//后面的代码不变
```

这样，就可以在运行的时候按需加载所需的组件，避免打包的过程中把所有依赖打包进去。

## chenshuai2144

会的，暂时没有很好的解法。
