# ğŸ›[BUG]EditableProTable é€šè¿‡è‡ªå®šä¹‰actionRenderæ–°å»ºä¸€è¡Œæ•°æ®ï¼Œçªç„¶ä¸æ”¯æŒè¿ç»­åˆ›å»ºå¤šæ¡æ•°æ®ï¼Œè¯·é—®æ˜¯ä»€ä¹ˆåŸå› ï¼Ÿ

æé—®å‰å…ˆçœ‹çœ‹ï¼š

https://github.com/ryanhanwu/How-To-Ask-Questions-The-Smart-Way/blob/main/README-zh_CN.md

### ğŸ› bug æè¿°

EditableProTable é€šè¿‡è‡ªå®šä¹‰actionRender
<EditableProTable.RecordCreator
key="add"
newRecordType="dataSource"
record={{ id:Date.now()}} >
<a>æ–°å»º</a>
</EditableProTable.RecordCreator>
æ–°å»ºä¸€è¡Œæ•°æ®ï¼Œçªç„¶ä¸æ”¯æŒè¿ç»­åˆ›å»ºå¤šæ¡æ•°æ®ï¼Œè¯·é—®æ˜¯ä»€ä¹ˆåŸå› ï¼Ÿ

<!--
è¯¦ç»†åœ°æè¿° bugï¼Œè®©å¤§å®¶éƒ½èƒ½ç†è§£
-->

### ğŸ“· å¤ç°æ­¥éª¤

<!--
æ¸…æ™°æè¿°å¤ç°æ­¥éª¤ï¼Œè®©åˆ«äººä¹Ÿèƒ½çœ‹åˆ°é—®é¢˜
-->

### ğŸ æœŸæœ›ç»“æœ

<!--
æè¿°ä½ åŸæœ¬æœŸæœ›çœ‹åˆ°çš„ç»“æœ
-->

### ğŸ’» å¤ç°ä»£ç 

<EditableProTable
columns={columns}
value={dataSource}
rowKey="id"
actionRef={actionRef}
scroll={{ x: 720 }}
recordCreatorProps={false}
onChange={setDataSource}
editable={{
            type: 'multiple',
            editableKeys,
            actionRender: (row, config, defaultDoms) => {
              return [
                config.index === 0 ? (
                  <EditableProTable.RecordCreator
                    key="add"
                    newRecordType="dataSource"
                    record={defaultDataItem}
                  >
                    <a>æ–°å»º</a>
                  </EditableProTable.RecordCreator>
                ) : (
                  defaultDoms.delete
                ),
              ];
            },
            onValuesChange: (record, recordList) => {
              console.log(record);
              setDataSource(recordList);
            },
            onChange: setEditableRowKeys,
          }}
/>

<!--
æä¾›å¯å¤ç°çš„ä»£ç ï¼Œä»“åº“ï¼Œæˆ–çº¿ä¸Šç¤ºä¾‹
-->

### Â© ç‰ˆæœ¬ä¿¡æ¯

- ProComponents ç‰ˆæœ¬: [e.g. 4.0.0]
- umi ç‰ˆæœ¬
- æµè§ˆå™¨ç¯å¢ƒ
- å¼€å‘ç¯å¢ƒ [e.g. mac OS]

### ğŸš‘ å…¶ä»–ä¿¡æ¯

<!--
å¦‚æˆªå›¾ç­‰å…¶ä»–ä¿¡æ¯å¯ä»¥è´´åœ¨è¿™é‡Œ
-->

## yangyan123

æ˜¨å¤©https://procomponents.ant.design/components/table/?current=1&pageSize=5æŒ‚äº†ï¼Œè·Ÿä½ ä»¬å‘æ–°ç‰ˆæœ‰å…³ç³»å—ï¼Ÿ

## chenshuai2144

æ˜¯ä¸ªbugï¼Œä¸ºäº†ä¼˜åŒ–æ€§èƒ½ä¸å°å¿ƒé—­åŒ…äº†ã€‚ç°åœ¨å·²ç»ä¿®å¤äº†ï¼Œå¯ä»¥æ›´æ–°ä¾èµ–äº†ã€‚

## chenshuai2144

> æ˜¨å¤©https://procomponents.ant.design/components/table/?current=1&pageSize=5æŒ‚äº†ï¼Œè·Ÿä½ ä»¬å‘æ–°ç‰ˆæœ‰å…³ç³»å—ï¼Ÿ

sir æŒ‚äº†ã€‚å·²ç»ä¿®å¤äº†

## yangyan123

> äº²ï¼Œæ›´æ–°äº†ä¸€ä¸‹ä¾èµ–ï¼Œä¾æ—§ä¸è¡Œå‘¢

## chenshuai2144

æ¥ä¸ªé‡ç°

## yangyan123

`const textConfig = () => {
// é»˜è®¤æ•°æ®
const defaultData: DataSourceType[] = [
{
id: Date.now(),
code: undefined,
text: '',
},
];
const [id, setId] = useState<string>('');

    // aiAppraisalTexts
    const [editableKeys, setEditableRowKeys] = useState<React.Key[]>(() =>
      // è¯¦æƒ…æ—¶ä¸å¯ç¼–è¾‘
      defaultData.map((item) => item.id),
    );
    // è¡¨æ ¼æ•°æ®
    const [dataSource, setDataSource] = useState<DataSourceType[]>(
      () => defaultData,
    );
    const columns: ProColumns<DataSourceType>[] = [
      {
        title: 'æ¥å£è¿”å›å€¼',
        dataIndex: 'code',
        align: 'center',
        formItemProps: {
          rules: [
            {
              required: true,
              message: 'æ­¤é¡¹æ˜¯å¿…å¡«é¡¹',
            },
          ],
        },
      },
      {
        title: 'ç»“æœæ–‡æ¡ˆ',
        dataIndex: 'text',
        align: 'center',
        formItemProps: {
          rules: [
            {
              required: true,
              message: 'æ­¤é¡¹æ˜¯å¿…å¡«é¡¹',
            },
          ],
        },
      },
      {
        title: 'æ“ä½œ',
        width: 100,
        align: 'center',
        valueType: 'option',
        render: () => null,
      },
    ];

    // åˆå§‹åŒ–è¯¦æƒ…
    const initAiAppraisalTexts = async (obj: any) => {
      const res: any = await aiAppraisalTexts(obj);
      setId(res?.id);
      if (res?.configs) {
        setDataSource(
          res?.configs?.map((item: any, index: number) => ({
            ...item,
            id: index,
          })),
        );
        setEditableRowKeys(() =>
          res?.configs?.map((item: any, index: number) => index),
        );
      }
    };

    // åˆå§‹åŒ–è¯¦æƒ…
    const save = async () => {
      const res: any = await aiAppraisalTexts({
        method: 'PUT',
        id,
        configs: dataSource.map((item: any) => {
          return { code: item.code, text: item.text };
        }),
      });
      if (res?.code === '0' || res?.code === '200') {
        message.success('ä¿å­˜æˆåŠŸ', 1.5, () => {
          setTextConfigModalVisible(false);
        });
      }
    };

    useEffect(() => {
      (async () => {
        // AIæ–‡æ¡ˆé…ç½®
        if (textConfigModalVisible) {
          await initAiAppraisalTexts({ method: 'GET' });
        }
      })();
    }, [textConfigModalVisible]);

    return (
      <Modal
        title="æ–‡æ¡ˆé…ç½®"
        destroyOnClose
        width={820}
        visible={textConfigModalVisible}
        onCancel={() => {
          setTextConfigModalVisible(false);
        }}
        onOk={async () => {
          save();
        }}
      >
        <EditableProTable
          columns={columns}
          value={dataSource}
          rowKey="id"
          actionRef={actionRef}
          scroll={{ x: 720 }}
          recordCreatorProps={false}
          onChange={setDataSource}
          editable={{
            type: 'multiple',
            editableKeys,
            actionRender: (row, config, defaultDoms) => {
              return [
                config.index === 0 ? (
                  <EditableProTable.RecordCreator
                    key="add"
                    newRecordType="dataSource"
                    record={{
                      id: Date.now(),
                      code: undefined,
                      text: '',
                    }}
                  >
                    <a>æ–°å»º</a>
                  </EditableProTable.RecordCreator>
                ) : (
                  defaultDoms.delete
                ),
              ];
            },
            onValuesChange: (record, recordList) => {
              setDataSource(recordList);
            },
            onChange: setEditableRowKeys,
          }}
        />
      </Modal>
    );

};`

## yangyan123

![image](https://user-images.githubusercontent.com/10812007/145350615-8b8d17b8-afd5-483d-8761-5c1ceb33e5c0.png)

## yangyan123

åªèƒ½æ–°å»º1æ¡

## yangyan123

æˆ‘åˆå®éªŒäº†ä¸€æŠŠï¼Œ "@ant-design/pro-form": "^1.34.0",æ­é… "@ant-design/pro-table": "^2.58.1",æ˜¯å¯ä»¥å®ç°æ–°å»ºå¤šæ¡çš„ï¼Œç‰ˆæœ¬ä¸å¯¹å°±ä¸è¡Œäº†
https://codesandbox.io/s/fragrant-river-rl52m?file=/App.tsx

## yangyan123

![image](https://user-images.githubusercontent.com/10812007/145532892-ef79a82f-e5b8-42c0-8503-4506e7462b88.png)
ä¸¤æ¬¡ä¸åŒæ—¶æ®µåˆ›å»ºçš„ï¼Œå–çš„Dtae.now()ï¼Œæ˜¯ä¸€æ ·çš„ï¼Œè¿™å—æ˜¯ä¸æ˜¯ä¹Ÿæœ‰é—®é¢˜
![image](https://user-images.githubusercontent.com/10812007/145533079-dc66ad55-ccca-444c-ac22-4c2b13cc749d.png)
éƒ½æ˜¯æœ€æ–°çš„

## yangyan123

æ²™ç›’ç¯å¢ƒå’Œæˆ‘æœ¬åœ°å±•ç¤ºä¹Ÿä¸åŒï¼Œæˆ‘æœ¬åœ°åŒ…ç®¡ç†æ˜¯yarn

## chenshuai2144

åˆ é™¤lockåœ¨è¯•è¯•ã€‚ä¸å¥½å¤çº¿å‘€
