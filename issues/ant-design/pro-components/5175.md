# 🐛[BUG] shouldCellUpdate and columnsState not working together properly

`⭕️   bug`,`table`,`👏🏻  Welcome pr`

### 🐛 Bug

Good day everyone. There is a bug that is happening in versions of pro-table after 2.56.0.

The bug is that columnState settings or "fixed: 'left'" does not work when shouldCellUpdate function has it's own logic (not shouldCellUpdate: () => true)

So the problem is when column moves its position and this column is fixed to left, it stays on same place and column becomes shadowed by other column. Only after hover - this disappears (I guess rerenders?)

### 📷 Reproduce

https://codesandbox.io/s/valuetype-xuan-ze-lei-forked-oetrmf?file=/App.tsx

1. Open columnState settings (cogwheel)
2. Move column "Test1" to be first (so that "Test" column would be second)
3. Try scrolling columns to the left - enjoy interesting view.

### 🏞 Expected result

Columns should render the same as with shouldCellUpdate: () => true when columnState being changed

### 💻 Reproduce code

```js
{
    title: "Test",
    dataIndex: "test",
    fixed: "left",
    width: 100,
    shouldCellUpdate: (record, prevRecord) => {
      console.log(record);
      return record["test"] !== prevRecord["test"];
    }
},
{
    title: "Test1",
    dataIndex: "test1",
    fixed: "left",
    width: 100,
    shouldCellUpdate: (record, prevRecord) => {
      return record["test1"] !== prevRecord["test1"];
    }
},
```

### © Dependency versions

- ProComponets pro-table: 2.73.0
- umi 3.5.20
- Brave Latest
- macOS 12.3.1

  ## Dunqing

  This is an interesting issue

  ## Lands-1203

  你自己翻译一下：
  ![image](https://user-images.githubusercontent.com/61341868/168246992-9fc53f91-0337-4d7e-a613-c3e2df271a26.png)
  把截图的内容删除就不会出现这个问题，可以说这不算是个bug吧，只能说兼容性不强，官方文档似乎也没有支持这个属性：shouldCellUpdate

  ## Lands-1203

  shouldCellUpdate这个属性是rc-table库的。

  ## Dunqing

> ![image](https://user-images.githubusercontent.com/61341868/168246992-9fc53f91-0337-4d7e-a613-c3e2df271a26.png) 把截图的内容删除就不会出现这个问题，可以说这不算是个bug吧，只能说兼容性不强，官方文档似乎也没有支持这个属性：shouldCellUpdate

理论上Table的所有功能都是要支持的，Antd 的 Table 是支持这个属性的。如果在ProTable使用了这个属性出现了Bug那就应该去做适配修复它

## Lands-1203

> > ![image](https://user-images.githubusercontent.com/61341868/168246992-9fc53f91-0337-4d7e-a613-c3e2df271a26.png) 把截图的内容删除就不会出现这个问题，可以说这不算是个bug吧，只能说兼容性不强，官方文档似乎也没有支持这个属性：shouldCellUpdate
>
> 理论上Table的所有功能都是要支持的，Antd 的 Table 是支持这个属性的。如果在ProTable使用了这个属性出现了Bug那就应该去做适配修复它

在proTable中shouldCellUpdate似乎没有意义

## Dunqing

> 在proTable中shouldCellUpdate似乎没有意义

看起来是个优化性能的一个属性，应该是有用的

## Andreybest

> > > ![image](https://user-images.githubusercontent.com/61341868/168246992-9fc53f91-0337-4d7e-a613-c3e2df271a26.png) 把截图的内容删除就不会出现这个问题，可以说这不算是个bug吧，只能说兼容性不强，官方文档似乎也没有支持这个属性：shouldCellUpdate
> >
> > 理论上Table的所有功能都是要支持的，Antd 的 Table 是支持这个属性的。如果在ProTable使用了这个属性出现了Bug那就应该去做适配修复它
>
> 在proTable中shouldCellUpdate似乎没有意义

ProTable is not performant when using lots of rows and columns, we can't unuse shouldCellUpdate functions

## Lands-1203

> > > > ![图片](https://user-images.githubusercontent.com/61341868/168246992-9fc53f91-0337-4d7e-a613-c3e2df271a26.png)截图的内容删除就不会出现这个问题了
> > >
> > > 它使用表格的这个所有功能都需要支持，Antd 的表格都支持这个属性的。如果 ProTable 中的属性可以设置修复了 Bug 那个
> >
> > 在proTable中shouldCellUpdate似乎没有意义
>
> ProTable 在使用大量行和列时性能不佳，我们不能不使用 shouldCellUpdate 函数

建议你这边在protable上添加属性options={{ setting:false }}，用于暂时解决这个问题。我再看看源代码是否能处理，如果可以，我提交一个Pr

## Lands-1203

这个问题我研究了下源码，最开始的想法是通过监听setting的move和onclick方法。然后在那个时刻，强制让shouldCellUpdate返回true，可以解决这个，也测试了可以完美解决你的这个问题（但我认为官方不会接受）。后来想了想还是不合理，就没有提交Pr。

https://user-images.githubusercontent.com/61341868/168787985-e3f2d626-83ca-4a3f-820b-516b02caa229.mp4

因为我发现**你可以通过 ProTable中的columnsState.onChange解决这个问题**
![image](https://user-images.githubusercontent.com/61341868/168788942-3d457b23-59c7-41b1-a887-245b715829d2.png)
![image](https://user-images.githubusercontent.com/61341868/168785038-f844f408-33ff-493e-bed6-060c410e89e8.png)

![image](https://user-images.githubusercontent.com/61341868/168784985-989b328b-1091-4235-a0c2-bc1c4038a7fb.png)

## Andreybest

@15723185734 thats the point of this issue, columnsState and shouldCellUpdate is not working together.

## Lands-1203

> @15723185734 thats the point of this issue, columnsState and shouldCellUpdate is not working together.

https://codesandbox.io/s/valuetype-xuan-ze-lei-forked-rie5rt?file=/App.tsx
看下这个，视觉上已经解决了这个问题
