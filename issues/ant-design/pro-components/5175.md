# ğŸ›[BUG] shouldCellUpdate and columnsState not working together properly

`â­•ï¸   bug`,`table`,`ğŸ‘ğŸ»  Welcome pr`

### ğŸ› Bug

Good day everyone. There is a bug that is happening in versions of pro-table after 2.56.0.

The bug is that columnState settings or "fixed: 'left'" does not work when shouldCellUpdate function has it's own logic (not shouldCellUpdate: () => true)

So the problem is when column moves its position and this column is fixed to left, it stays on same place and column becomes shadowed by other column. Only after hover - this disappears (I guess rerenders?)

### ğŸ“· Reproduce

https://codesandbox.io/s/valuetype-xuan-ze-lei-forked-oetrmf?file=/App.tsx

1. Open columnState settings (cogwheel)
2. Move column "Test1" to be first (so that "Test" column would be second)
3. Try scrolling columns to the left - enjoy interesting view.

### ğŸ Expected result

Columns should render the same as with shouldCellUpdate: () => true when columnState being changed

### ğŸ’» Reproduce code

```js
{
    title: "Test",
    dataIndex: "test",
    fixed: "left",
    width: 100,
    shouldCellUpdate: (record, prevRecord) => {
      console.log(record);
      return record["test"] !== prevRecord["test"];
    }
},
{
    title: "Test1",
    dataIndex: "test1",
    fixed: "left",
    width: 100,
    shouldCellUpdate: (record, prevRecord) => {
      return record["test1"] !== prevRecord["test1"];
    }
},
```

### Â© Dependency versions

- ProComponets pro-table: 2.73.0
- umi 3.5.20
- Brave Latest
- macOS 12.3.1

  ## Dunqing

  This is an interesting issue

  ## Lands-1203

  ä½ è‡ªå·±ç¿»è¯‘ä¸€ä¸‹ï¼š
  ![image](https://user-images.githubusercontent.com/61341868/168246992-9fc53f91-0337-4d7e-a613-c3e2df271a26.png)
  æŠŠæˆªå›¾çš„å†…å®¹åˆ é™¤å°±ä¸ä¼šå‡ºç°è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥è¯´è¿™ä¸ç®—æ˜¯ä¸ªbugå§ï¼Œåªèƒ½è¯´å…¼å®¹æ€§ä¸å¼ºï¼Œå®˜æ–¹æ–‡æ¡£ä¼¼ä¹ä¹Ÿæ²¡æœ‰æ”¯æŒè¿™ä¸ªå±æ€§ï¼šshouldCellUpdate

  ## Lands-1203

  shouldCellUpdateè¿™ä¸ªå±æ€§æ˜¯rc-tableåº“çš„ã€‚

  ## Dunqing

> ![image](https://user-images.githubusercontent.com/61341868/168246992-9fc53f91-0337-4d7e-a613-c3e2df271a26.png) æŠŠæˆªå›¾çš„å†…å®¹åˆ é™¤å°±ä¸ä¼šå‡ºç°è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥è¯´è¿™ä¸ç®—æ˜¯ä¸ªbugå§ï¼Œåªèƒ½è¯´å…¼å®¹æ€§ä¸å¼ºï¼Œå®˜æ–¹æ–‡æ¡£ä¼¼ä¹ä¹Ÿæ²¡æœ‰æ”¯æŒè¿™ä¸ªå±æ€§ï¼šshouldCellUpdate

ç†è®ºä¸ŠTableçš„æ‰€æœ‰åŠŸèƒ½éƒ½æ˜¯è¦æ”¯æŒçš„ï¼ŒAntd çš„ Table æ˜¯æ”¯æŒè¿™ä¸ªå±æ€§çš„ã€‚å¦‚æœåœ¨ProTableä½¿ç”¨äº†è¿™ä¸ªå±æ€§å‡ºç°äº†Bugé‚£å°±åº”è¯¥å»åšé€‚é…ä¿®å¤å®ƒ

## Lands-1203

> > ![image](https://user-images.githubusercontent.com/61341868/168246992-9fc53f91-0337-4d7e-a613-c3e2df271a26.png) æŠŠæˆªå›¾çš„å†…å®¹åˆ é™¤å°±ä¸ä¼šå‡ºç°è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥è¯´è¿™ä¸ç®—æ˜¯ä¸ªbugå§ï¼Œåªèƒ½è¯´å…¼å®¹æ€§ä¸å¼ºï¼Œå®˜æ–¹æ–‡æ¡£ä¼¼ä¹ä¹Ÿæ²¡æœ‰æ”¯æŒè¿™ä¸ªå±æ€§ï¼šshouldCellUpdate
>
> ç†è®ºä¸ŠTableçš„æ‰€æœ‰åŠŸèƒ½éƒ½æ˜¯è¦æ”¯æŒçš„ï¼ŒAntd çš„ Table æ˜¯æ”¯æŒè¿™ä¸ªå±æ€§çš„ã€‚å¦‚æœåœ¨ProTableä½¿ç”¨äº†è¿™ä¸ªå±æ€§å‡ºç°äº†Bugé‚£å°±åº”è¯¥å»åšé€‚é…ä¿®å¤å®ƒ

åœ¨proTableä¸­shouldCellUpdateä¼¼ä¹æ²¡æœ‰æ„ä¹‰

## Dunqing

> åœ¨proTableä¸­shouldCellUpdateä¼¼ä¹æ²¡æœ‰æ„ä¹‰

çœ‹èµ·æ¥æ˜¯ä¸ªä¼˜åŒ–æ€§èƒ½çš„ä¸€ä¸ªå±æ€§ï¼Œåº”è¯¥æ˜¯æœ‰ç”¨çš„

## Andreybest

> > > ![image](https://user-images.githubusercontent.com/61341868/168246992-9fc53f91-0337-4d7e-a613-c3e2df271a26.png) æŠŠæˆªå›¾çš„å†…å®¹åˆ é™¤å°±ä¸ä¼šå‡ºç°è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥è¯´è¿™ä¸ç®—æ˜¯ä¸ªbugå§ï¼Œåªèƒ½è¯´å…¼å®¹æ€§ä¸å¼ºï¼Œå®˜æ–¹æ–‡æ¡£ä¼¼ä¹ä¹Ÿæ²¡æœ‰æ”¯æŒè¿™ä¸ªå±æ€§ï¼šshouldCellUpdate
> >
> > ç†è®ºä¸ŠTableçš„æ‰€æœ‰åŠŸèƒ½éƒ½æ˜¯è¦æ”¯æŒçš„ï¼ŒAntd çš„ Table æ˜¯æ”¯æŒè¿™ä¸ªå±æ€§çš„ã€‚å¦‚æœåœ¨ProTableä½¿ç”¨äº†è¿™ä¸ªå±æ€§å‡ºç°äº†Bugé‚£å°±åº”è¯¥å»åšé€‚é…ä¿®å¤å®ƒ
>
> åœ¨proTableä¸­shouldCellUpdateä¼¼ä¹æ²¡æœ‰æ„ä¹‰

ProTable is not performant when using lots of rows and columns, we can't unuse shouldCellUpdate functions

## Lands-1203

> > > > ![å›¾ç‰‡](https://user-images.githubusercontent.com/61341868/168246992-9fc53f91-0337-4d7e-a613-c3e2df271a26.png)æˆªå›¾çš„å†…å®¹åˆ é™¤å°±ä¸ä¼šå‡ºç°è¿™ä¸ªé—®é¢˜äº†
> > >
> > > å®ƒä½¿ç”¨è¡¨æ ¼çš„è¿™ä¸ªæ‰€æœ‰åŠŸèƒ½éƒ½éœ€è¦æ”¯æŒï¼ŒAntd çš„è¡¨æ ¼éƒ½æ”¯æŒè¿™ä¸ªå±æ€§çš„ã€‚å¦‚æœ ProTable ä¸­çš„å±æ€§å¯ä»¥è®¾ç½®ä¿®å¤äº† Bug é‚£ä¸ª
> >
> > åœ¨proTableä¸­shouldCellUpdateä¼¼ä¹æ²¡æœ‰æ„ä¹‰
>
> ProTable åœ¨ä½¿ç”¨å¤§é‡è¡Œå’Œåˆ—æ—¶æ€§èƒ½ä¸ä½³ï¼Œæˆ‘ä»¬ä¸èƒ½ä¸ä½¿ç”¨ shouldCellUpdate å‡½æ•°

å»ºè®®ä½ è¿™è¾¹åœ¨protableä¸Šæ·»åŠ å±æ€§options={{ setting:false }}ï¼Œç”¨äºæš‚æ—¶è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æˆ‘å†çœ‹çœ‹æºä»£ç æ˜¯å¦èƒ½å¤„ç†ï¼Œå¦‚æœå¯ä»¥ï¼Œæˆ‘æäº¤ä¸€ä¸ªPr

## Lands-1203

è¿™ä¸ªé—®é¢˜æˆ‘ç ”ç©¶äº†ä¸‹æºç ï¼Œæœ€å¼€å§‹çš„æƒ³æ³•æ˜¯é€šè¿‡ç›‘å¬settingçš„moveå’Œonclickæ–¹æ³•ã€‚ç„¶ååœ¨é‚£ä¸ªæ—¶åˆ»ï¼Œå¼ºåˆ¶è®©shouldCellUpdateè¿”å›trueï¼Œå¯ä»¥è§£å†³è¿™ä¸ªï¼Œä¹Ÿæµ‹è¯•äº†å¯ä»¥å®Œç¾è§£å†³ä½ çš„è¿™ä¸ªé—®é¢˜ï¼ˆä½†æˆ‘è®¤ä¸ºå®˜æ–¹ä¸ä¼šæ¥å—ï¼‰ã€‚åæ¥æƒ³äº†æƒ³è¿˜æ˜¯ä¸åˆç†ï¼Œå°±æ²¡æœ‰æäº¤Prã€‚

https://user-images.githubusercontent.com/61341868/168787985-e3f2d626-83ca-4a3f-820b-516b02caa229.mp4

å› ä¸ºæˆ‘å‘ç°**ä½ å¯ä»¥é€šè¿‡ ProTableä¸­çš„columnsState.onChangeè§£å†³è¿™ä¸ªé—®é¢˜**
![image](https://user-images.githubusercontent.com/61341868/168788942-3d457b23-59c7-41b1-a887-245b715829d2.png)
![image](https://user-images.githubusercontent.com/61341868/168785038-f844f408-33ff-493e-bed6-060c410e89e8.png)

![image](https://user-images.githubusercontent.com/61341868/168784985-989b328b-1091-4235-a0c2-bc1c4038a7fb.png)

## Andreybest

@15723185734 thats the point of this issue, columnsState and shouldCellUpdate is not working together.

## Lands-1203

> @15723185734 thats the point of this issue, columnsState and shouldCellUpdate is not working together.

https://codesandbox.io/s/valuetype-xuan-ze-lei-forked-rie5rt?file=/App.tsx
çœ‹ä¸‹è¿™ä¸ªï¼Œè§†è§‰ä¸Šå·²ç»è§£å†³äº†è¿™ä¸ªé—®é¢˜
