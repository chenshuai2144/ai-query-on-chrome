# EditableProTableå®æ—¶ä¿å­˜çš„ç¼–è¾‘è¡¨æ ¼å¯ä»¥å®ç°æ‹–æ‹½ç§»åŠ¨å—

æé—®å‰å…ˆçœ‹çœ‹ï¼š

https://github.com/ryanhanwu/How-To-Ask-Questions-The-Smart-Way/blob/main/README-zh_CN.md

### ğŸ”© æ‰€å±æ¨¡å—æˆ–ç»„ä»¶

<!--
å¦‚æœä½ çš„åŠŸèƒ½éœ€æ±‚ç‡å±äºæŸä¸ªåŠŸèƒ½æ¨¡å—æˆ–è€…æ˜¯ç»„ä»¶çš„ï¼Œè¯·åœ¨æ­¤å¤„æ ‡æ˜ï¼Œå¦‚å¯¹`table`ç»„ä»¶æœ‰åŠŸèƒ½éœ€æ±‚ï¼Œåˆ™æ³¨æ˜ï¼šç‡å±ç»„ä»¶ï¼šProTable
 -->

EditableProTableç»„ä»¶
å¯ä»¥å®æ—¶ä¿å­˜çš„ç¼–è¾‘è¡¨æ ¼
ä½†æ˜¯æ²¡çœ‹åˆ°è¿™ä¸ªç»„ä»¶å¯ä»¥å®ç°æ‹–æ‹½

### ğŸ¥° éœ€æ±‚æè¿°

<img width="978" alt="image" src="https://user-images.githubusercontent.com/45351947/169437126-57ae0cdd-b14e-4820-b977-a73344b5d28e.png">

<!--
è¯¦ç»†åœ°æè¿°éœ€æ±‚ï¼Œè®©å¤§å®¶éƒ½èƒ½ç†è§£
-->

### â›° åŠŸèƒ½éœ€æ±‚é€‚ç”¨åœºæ™¯

<!--
è¯·ç®€å•æè¿°ä¸€ä¸‹è¿™ä¸ªæ–°åŠŸèƒ½é€šå¸¸æˆ–å¯ä»¥åº”ç”¨åœ¨å“ªäº›åœºæ™¯ä¸‹
-->

### ğŸ§ è§£å†³æ–¹æ¡ˆ

<!--
å¦‚æœä½ æœ‰è§£å†³æ–¹æ¡ˆï¼Œåœ¨è¿™é‡Œæ¸…æ™°åœ°é˜è¿°
-->

### ğŸš‘ å…¶ä»–ä¿¡æ¯

<!--
å¦‚æˆªå›¾ç­‰å…¶ä»–ä¿¡æ¯å¯ä»¥è´´åœ¨è¿™é‡Œ
-->

## chenshuai2144

å¯ä»¥ç»“åˆç”¨ï¼Œä½†æ˜¯æ•°æ®å¤„ç†èµ·æ¥ä¼šæ›´éº»çƒ¦ï¼Œèƒ½ç»•è¿‡å°½é‡ç»•è¿‡æŠŠ

## mraiguo

> å¯ä»¥ç»“åˆç”¨ï¼Œä½†æ˜¯æ•°æ®å¤„ç†èµ·æ¥ä¼šæ›´éº»çƒ¦ï¼Œèƒ½ç»•è¿‡å°½é‡ç»•è¿‡æŠŠ

å¯ä»¥åœ¨å®˜ç½‘æ”¾ä¸ªdemoå—ï¼Ÿ è¿™ä¸ªéœ€æ±‚ç»•ä¸è¿‡ï¼Œè€Œä¸”æ„Ÿè§‰è¿˜ç®—æ˜¯æŒºå¸¸è§çš„

## chenshuai2144

å¾ˆéš¾å†™ï¼Œå†™å‡ºéƒ½æ˜¯bugçš„demoæ²¡ä»€ä¹ˆæ„ä¹‰

## yzh990918

> æé—®å‰å…ˆçœ‹çœ‹ï¼š
>
> https://github.com/ryanhanwu/How-To-Ask-Questions-The-Smart-Way/blob/main/README-zh_CN.md
>
> ### ğŸ”© æ‰€å±æ¨¡å—æˆ–ç»„ä»¶
>
> EditableProTableç»„ä»¶ å¯ä»¥å®æ—¶ä¿å­˜çš„ç¼–è¾‘è¡¨æ ¼ ä½†æ˜¯æ²¡çœ‹åˆ°è¿™ä¸ªç»„ä»¶å¯ä»¥å®ç°æ‹–æ‹½
>
> ### ğŸ¥° éœ€æ±‚æè¿°
>
> <img alt="image" width="978" src="https://user-images.githubusercontent.com/45351947/169437126-57ae0cdd-b14e-4820-b977-a73344b5d28e.png">
>
> ### â›° åŠŸèƒ½éœ€æ±‚é€‚ç”¨åœºæ™¯
>
> ### ğŸ§ è§£å†³æ–¹æ¡ˆ
>
> ### ğŸš‘ å…¶ä»–ä¿¡æ¯

è¯·é—®æœ€åå®ç°äº†å—

## sTeADone

åŸºæœ¬ç…§æŠ„çš„https://juejin.cn/post/7166529533330817031
react-sortable-hocä¸æ”¯æŒreact18 éœ€è¦ç”¨dnd-kit
å¦å¤–æ‹–æ‹½è¡Œçš„æ ·å¼ä¹Ÿæ˜¯ç…§æŠ„

```
// https://juejin.cn/post/7166529533330817031
// åŸºäºdnd-kitå®ç°Antd Tableç»„ä»¶æ‹–æ‹½æ’åº
import React,{ useState, useEffect }  from "react"
import { useSortable } from "@dnd-kit/sortable"
import { DndContext } from "@dnd-kit/core"
import {
  arrayMove,
  SortableContext,
  verticalListSortingStrategy
} from "@dnd-kit/sortable"
import { restrictToVerticalAxis } from "@dnd-kit/modifiers"
import { MenuOutlined } from "@ant-design/icons"
import { EditableProTable } from '@ant-design/pro-components';
import "./style.less"

function SortableItem(props) {
  const id = props["data-row-key"]
  const {
    attributes,
    listeners,
    setNodeRef,
    transform,
    transition,
    isDragging
  } = useSortable({
    id
  })

  const dragStyle = {
    transition,
    // transform: CSS.Translate.toString(transform),
    "--translate-x": `${transform?.x ?? 0}px`,
    "--translate-y": `${transform?.y ?? 0}px`
  }

  const { style, className, children, ...rest } = props
  const cls = [className, "dragItem", id && isDragging ? "dragOverlay" : null]
    .filter(c => c)
    .join(" ")

  return (
    <tr
      id={id}
      ref={setNodeRef}
      {...attributes}
      //{...listeners}
      className={cls}
      style={{ ...style, ...dragStyle }}
      {...rest}
      data-cypress="draggable-item"
    >
      {React.Children.map(children, child => {
        if (child.key === "sort") {
          return React.cloneElement(child, {
            additionalProps: {
              ...listeners,
              "data-cypress": "draggable-handle"
            }
          })
        }
        return child
      })}
    </tr>
  )
}

function DraggableTable({ value, onChange, columns, recordCreatorProps,rowKey="key", ...restProps }) {
  const [editableKeys, setEditableRowKeys] = useState([])
  useEffect(() => {
    setEditableRowKeys(value ? value.map((item, index) => (item[rowKey])) : [])
  }, [value]);

  const handleDragEnd = event => {
    const { active, over } = event
    console.log(active.id, over?.id)
    if (active.id !== over?.id) {
      const oldIndex = value.findIndex(item => item[rowKey] === active.id)
      const newIndex = value.findIndex(item => item[rowKey] === over?.id)

      const next = arrayMove(value, oldIndex, newIndex)
      onChange(next)
    }
  }

  //ç»„ä»¶å†…éƒ¨å¢åŠ sortå’Œactionåˆ—
  columns = [
    {
      title: "Sort",
      dataIndex: "sort",
      width: 44,
      render: () => <MenuOutlined />,
      align: "center",
      editable: false
    },
    ...columns,
    {
      title: 'Action',
      width: 60,
      valueType: 'option',
    },
  ]

  return (
    <DndContext modifiers={[restrictToVerticalAxis]} onDragEnd={handleDragEnd} >
      <SortableContext
        items={value ? value.map(c => c[rowKey]) : [-1]}
        strategy={verticalListSortingStrategy}
      >
        <EditableProTable
          rowKey={rowKey}
          editable={{
            type: 'multiple',
            editableKeys,
            actionRender: (row, config, defaultDoms) => {
              return [defaultDoms.delete];
            }
          }}
          recordCreatorProps={{
            newRecordType: 'dataSource',
            position: 'bottom',
            record: () => ({
              [rowKey]: Date.now().toString(),
            }),
            ...recordCreatorProps
          }}
          value={value}
          columns={columns}
          pagination={false}
          components={{ body: { row: SortableItem } }}
          onChange={onChange}
          ghost
          {...restProps}
        />
      </SortableContext>
    </DndContext>
  )
}

export default DraggableTable;
```
