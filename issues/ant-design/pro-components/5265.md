# 🐛[BUG] EditableProTable rows don't have unique keys in `name` mode

`⭕️   bug`,`👏🏻  Welcome pr`,`AI Reply`

### 🐛 bug 描述

#### Context

In `name` mode, EditableProTable [assigns an index](https://github.com/ant-design/pro-components/blob/d882705b6c2e98e6261e981509b24a62ad66b56c/packages/table/src/components/EditableTable/index.tsx#L178) to each row. `editableUtils.actionRender` uses row index instead of row key to edit and delete rows. Here is [an example test](https://github.com/ant-design/pro-components/blob/d882705b6c2e98e6261e981509b24a62ad66b56c/tests/table/editor-table-two.test.tsx#L892).

#### Problem

This works for flat tables but not for nested tables. In the current implementation, when a table has nested rows, child rows have the same indexes as their parents. This means row indexes are no longer unique. Because child rows have duplicate keys, they are not editable or deletable.

As illustrated below, child rows have the same indexes as their parents:

```javascript
const defaultData: DataSourceType[] = [
  {
    id: 624748504, // Row index is 0.
    title: '活动名称一',
    decs: '这个活动真好玩',
    state: 'open',
    created_at: '2020-05-26T09:42:56Z',
    update_at: '2020-05-26T09:42:56Z',
    children: [
      {
        id: 6246912293, // Row index is 0.
        title: '活动名称二',
        decs: '这个活动真好玩',
        state: 'closed',
        created_at: '2020-05-26T08:19:22Z',
        update_at: '2020-05-26T08:19:22Z',
      },
    ],
  },
  {
    id: 624691229, // Row index is 1.
    title: '活动名称二',
    decs: '这个活动真好玩',
    state: 'closed',
    created_at: '2020-05-26T08:19:22Z',
    update_at: '2020-05-26T08:19:22Z',
  },
];
```

### 💻 复现代码

The easiest way to reproduce this is to look at [this test](https://github.com/ant-design/pro-components/blob/d882705b6c2e98e6261e981509b24a62ad66b56c/tests/table/editor-table-two.test.tsx#L823). The problem arises when we change the test to edit a nested row, `6246912293` (child of `624748504`). There is no easy way to refer to row `6246912293` by row index.

```diff
  it('📝 support onValueChange when has name', async () => {
    const onValueChangeFn = jest.fn();
    const actionRef = React.createRef<ActionType | undefined>();
    const wrapper = render(
      <ProForm
        initialValues={{
          table: defaultData,
        }}
      >
        <EditableProTable<DataSourceType>
          rowKey="id"
          actionRef={actionRef as any}
+         // Note that this table is in name mode.
          name="table"
          pagination={{
            pageSize: 2,
          }}
          editable={{
            onValuesChange: (record) => {
              onValueChangeFn(record.id);
            },
          }}
          toolBarRender={(action) => [
            <a
              key="edit"
              id="start"
              onClick={() => {
+               action?.startEditable('6246912293');
-               action?.startEditable('624748504');
              }}
            >
              开始编辑
            </a>,
            <a
              key="end"
              id="end"
              onClick={() => {
+               action?.startEditable('6246912293');
-               action?.cancelEditable('624748504');
              }}
            >
              结束编辑
            </a>,
          ]}
          columns={columns}
        />
      </ProForm>,
    );
    await waitForComponentToPaint(wrapper, 1200);

    act(() => {
      wrapper.queryByText('开始编辑')?.click();
    });
    await waitForComponentToPaint(wrapper, 1000);

    act(() => {
      fireEvent.change(
        wrapper.container
          .querySelectorAll('.ant-table-tbody tr.ant-table-row')[0]
          .querySelectorAll('td .ant-input')[0],
        {
          target: {
            value: 'qixian',
          },
        },
      );
    });

    await waitForComponentToPaint(wrapper, 100);
    expect(onValueChangeFn).toBeCalledWith(624748504);

    act(() => {
+     // Row 6246912293 does not have a unique index.
+     actionRef.current?.cancelEditable(???);
      actionRef.current?.cancelEditable(0);
    });
    await waitForComponentToPaint(wrapper, 1000);
    expect(
      wrapper.container
        .querySelectorAll('.ant-table-tbody tr.ant-table-row')[0]
        .querySelectorAll('td .ant-input').length,
    ).toBe(0);
  });

```

### © 版本信息

- ProComponents 版本: @ant-design/pro-table@2.74.2
- 开发环境 mac OS

### 🚑 其他信息

<!--
如截图等其他信息可以贴在这里
-->

## Dunqing

Did you fix it in #5244?

## Dunqing

It looks like depth+index can solve this issue

## zhxnlai

> Did you fix it in #5244?

I didn't. The fix seems to require a big change that is out of the scope of that PR.
