# ğŸ§[é—®é¢˜]å¦‚ä½•å®ç°å¤šå±‚å­åˆ—æ–°å¢ï¼Ÿ

### ğŸ§ é—®é¢˜æè¿°

å¼•ç”¨å®˜æ–¹ä»£ç ï¼Œå½“parentKeyè®¾ä¸ºç¬¬ä¸€å±‚çš„idï¼š624748504ï¼Œç‚¹å‡»æ–°å¢ä¸€è¡Œæœ‰æ•ˆï¼Œä½†å½“parentKeyè®¾ä¸ºç¬¬äºŒå±‚çš„idï¼š6246912293æ— æ•ˆä¸”æç¤ºcan't find record by keyï¼Œè¯·é—®è¯¥å¦‚ä½•å®ç°è¿™ç§åœ¨å­åˆ—æ–°å»ºå­åˆ—çš„æƒ…å†µï¼Ÿ

### ğŸ’» ç¤ºä¾‹ä»£ç 

import React, { useState } from 'react';
import type { ProColumns } from '@ant-design/pro-table';
import { EditableProTable } from '@ant-design/pro-table';
import ProCard from '@ant-design/pro-card';
import { ProFormField } from '@ant-design/pro-form';

const waitTime = (time: number = 100) => {
return new Promise((resolve) => {
setTimeout(() => {
resolve(true);
}, time);
});
};

type DataSourceType = {
id?: React.Key;
title?: string;
decs?: string;
state?: string;
created_at?: string;
update_at?: string;
children?: DataSourceType[];
};

const defaultData: DataSourceType[] = [
{
id: 624748504,
title: 'æ´»åŠ¨åç§°ä¸€',
decs: 'è¿™ä¸ªæ´»åŠ¨çœŸå¥½ç©',
state: 'open',
created_at: '2020-05-26T09:42:56Z',
update_at: '2020-05-26T09:42:56Z',
children: [
{
id: 6246912293,
title: 'æ´»åŠ¨åç§°äºŒ',
decs: 'è¿™ä¸ªæ´»åŠ¨çœŸå¥½ç©',
state: 'closed',
created_at: '2020-05-26T08:19:22Z',
update_at: '2020-05-26T08:19:22Z',
},
],
},
{
id: 624691229,
title: 'æ´»åŠ¨åç§°äºŒ',
decs: 'è¿™ä¸ªæ´»åŠ¨çœŸå¥½ç©',
state: 'closed',
created_at: '2020-05-26T08:19:22Z',
update_at: '2020-05-26T08:19:22Z',
},
];

const loopDataSourceFilter = (
data: DataSourceType[],
id: React.Key | undefined,
): DataSourceType[] => {
return data
.map((item) => {
if (item.id !== id) {
if (item.children) {
const newChildren = loopDataSourceFilter(item.children, id);
return {
...item,
children: newChildren.length > 0 ? newChildren : undefined,
};
}
return item;
}
return null;
})
.filter(Boolean) as DataSourceType[];
};
export default () => {
const [editableKeys, setEditableRowKeys] = useState<React.Key[]>([]);
const [dataSource, setDataSource] = useState<DataSourceType[]>(() => defaultData);
const columns: ProColumns<DataSourceType>[] = [
{
title: 'æ´»åŠ¨åç§°',
dataIndex: 'title',
formItemProps: (form, { rowIndex }) => {
return {
rules: rowIndex > 2 ? [{ required: true, message: 'æ­¤é¡¹ä¸ºå¿…å¡«é¡¹' }] : [],
};
},
width: '30%',
},
{
title: 'çŠ¶æ€',
key: 'state',
dataIndex: 'state',
valueType: 'select',
valueEnum: {
all: { text: 'å…¨éƒ¨', status: 'Default' },
open: {
text: 'æœªè§£å†³',
status: 'Error',
},
closed: {
text: 'å·²è§£å†³',
status: 'Success',
},
},
},
{
title: 'æè¿°',
dataIndex: 'decs',
fieldProps: (from, { rowKey, rowIndex }) => {
if (from.getFieldValue([rowKey || '', 'title']) === 'ä¸å¥½ç©') {
return {
disabled: true,
};
}
if (rowIndex > 9) {
return {
disabled: true,
};
}
return {};
},
},
{
title: 'æ´»åŠ¨æ—¶é—´',
dataIndex: 'created_at',
valueType: 'date',
},
{
title: 'æ“ä½œ',
valueType: 'option',
width: 200,
render: (text, record) => [
<a
key="delete"
onClick={() => {
setDataSource(loopDataSourceFilter(dataSource, record.id));
}}
>
åˆ é™¤
</a>,
],
},
];

return (
<>
<EditableProTable<DataSourceType>
expandable={{
          // ä½¿ç”¨ request è¯·æ±‚æ•°æ®æ—¶æ— æ•ˆ
          defaultExpandAllRows: true,
        }}
scroll={{
          x: 960,
        }}
rowKey="id"
headerTitle="å¯ç¼–è¾‘è¡¨æ ¼"
maxLength={5}
recordCreatorProps={{
          position: 'bottom',
          newRecordType: 'dataSource',
          parentKey: () => 624748504,
          record: () => ({ id: (Math.random() * 1000000).toFixed(0) }),
        }}
columns={columns}
value={dataSource}
onChange={setDataSource}
editable={{
          type: 'multiple',
          editableKeys,
          onSave: async (rowKey, data, row) => {
            console.log(rowKey, data, row);
            await waitTime(2000);
          },
          onChange: setEditableRowKeys,
        }}
/>
<ProCard title="è¡¨æ ¼æ•°æ®" headerBordered collapsible defaultCollapsed>
<ProFormField
ignoreFormItem
fieldProps={{
            style: {
              width: '100%',
            },
          }}
mode="read"
valueType="jsonCode"
text={JSON.stringify(dataSource)}
/>
</ProCard>
</>
);
};

## chenshuai2144

https://github.com/ant-design/pro-components/pull/5244

è¿™ä¸ªçœ‹ä¸€ä¸‹ï¼Œä½ çš„æ’ç‰ˆå¤ªçƒ‚äº†ã€‚ä¸æ˜¯ç»™äººçœ‹çš„

## hcl242

æˆ‘ä¹Ÿæ˜¯è¿™ä¸ªé—®é¢˜å°±ç¬¬ä¸€çº§çš„keyä½œä¸ºparentKeyæœ‰æ•ˆ,ç¬¬äºŒå±‚å°±ä¸è¡Œäº†,æç¤º`can't find record by key xx`

## nkylin

same question

## nkylin

<img width="980" alt="image" src="https://user-images.githubusercontent.com/25171786/215420281-af06f784-0bdc-465d-a2c7-6d0df2e902eb.png">

## nkylin

<img width="411" alt="image" src="https://user-images.githubusercontent.com/25171786/215420383-a4a436c3-9b9a-4c14-887a-13749a5df967.png">

## nkylin

t1ä¸‹å¯ä»¥æ·»åŠ å­èŠ‚ç‚¹ï¼Œt11ä¸‹çš„æ·»åŠ å­èŠ‚ç‚¹æŒ‰é’®å°±æŠ¥é”™äº†
