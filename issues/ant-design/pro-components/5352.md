# ğŸ›[BUG] Schema Formå†…åµŒæ¨¡å¼ä¸‹ï¼ˆEmbedï¼‰dependenciesè¡¨å•è”åŠ¨å¤±æ•ˆ

`AI Reply`

æé—®å‰å…ˆçœ‹çœ‹ï¼š

https://github.com/ryanhanwu/How-To-Ask-Questions-The-Smart-Way/blob/main/README-zh_CN.md

### ğŸ› bug æè¿°

ä½¿ç”¨BetaSchemaFormï¼ŒlayoutTypeä¸ºï¼ˆEmbedï¼‰ï¼Œcolumnsä¸­ä½¿ç”¨dependencieså®ç°è¡¨å•è”åŠ¨å¤±æ•ˆï¼Œè¿”å›çš„formRefè°ƒç”¨æ–¹æ³•å–ä¸åˆ°å€¼

<!--
è¯¦ç»†åœ°æè¿° bugï¼Œè®©å¤§å®¶éƒ½èƒ½ç†è§£
-->

### ğŸ“· å¤ç°æ­¥éª¤

è¡¨å•1ç±»å‹å­—æ®µé€‰æ‹©å…¨éƒ¨ï¼ŒçŠ¶æ€å­—æ®µä¸èƒ½æ­£å¸¸è”åŠ¨
![image](https://user-images.githubusercontent.com/56418832/172606972-ad4a038a-ee62-4294-afb9-01b26b88685f.png)

<!--
æ¸…æ™°æè¿°å¤ç°æ­¥éª¤ï¼Œè®©åˆ«äººä¹Ÿèƒ½çœ‹åˆ°é—®é¢˜ï¼Œå¦‚æœå¯èƒ½ï¼Œå°½é‡æä¾›å¯æ‰§è¡Œä»£ç ï¼Œ
å¦‚ï¼šhttps://codesandbox.io/ åœ¨æ­¤å¤„åˆ›å»ºä¸€ä¸ª codesandboxï¼Œæ–¹ä¾¿æˆ‘ä»¬æ›´å¿«çš„æ’æŸ¥å’Œå¤ç°é—®é¢˜
-->

### ğŸ æœŸæœ›ç»“æœ

æœŸæœ›çŠ¶æ€å­—æ®µç¦ç”¨

<!--
æè¿°ä½ åŸæœ¬æœŸæœ›çœ‹åˆ°çš„ç»“æœ
-->

### ğŸ’» å¤ç°ä»£ç 

import type { ProFormColumnsType } from "@ant-design/pro-components";
import {
BetaSchemaForm,
ProForm,
ProFormSelect,
ProFormText
} from "@ant-design/pro-components";
import React from "react";

type DataItem = {
name: string;
state: string;
};
const valueEnum = [
{ label: "å…¨éƒ¨", value: "all1" },
{ label: "æœªè§£å†³", value: "open2" },
{ label: "æœªè§£å†³(å·²åˆ†é…)", value: "assignees1" },
{ label: "å·²è§£å†³", value: "closed1" },
{ label: "è§£å†³ä¸­", value: "processing1" }
];

const columns: ProFormColumnsType<DataItem>[] = [
{
valueType: "select",
title: "ç±»å‹",
dataIndex: "ksCustomer_status",
request: async () => valueEnum
},
{
valueType: "text",
title: "çŠ¶æ€",
dataIndex: "ksCustomer_type",
dependencies: ["ksCustomer_status"], // å†…åµŒæ¨¡å¼ä¸‹ï¼ˆEmbedï¼‰dependenciesè¡¨å•è”åŠ¨å¤±æ•ˆ
fieldProps: (form, config) => {
if (form?.getFieldValue("ksCustomer_status") === "all1") {
console.log(1212121221);
return {
disabled: true,
placeholder: "disabled"
};
} else {
console.log(9999);
return {
placeholder: "normal"
};
}
}
},
{
valueType: "dependency",
fieldProps: {
name: ["ksCustomer_status"]
},
columns: ({ ksCustomer_status }) => {
return ksCustomer_status !== "all1"
? [
{
valueType: "text",
dataIndex: "currentTime",
width: "md"
}
]
: [];
}
}
];

export default () => {
return (
<ProForm>
<h1>ProForm </h1>
<ProFormText name="username" />
<ProFormSelect
name="select-multiple"
label="å¤šé€‰"
valueEnum={{
          red: "Red",
          green: "Green",
          blue: "Blue"
        }}
fieldProps={{
          mode: "multiple"
        }}
placeholder="Please select favorite colors"
rules={[
{
required: true,
message: "Please select your favorite colors!",
type: "array"
}
]}
/>
<h1>è¡¨å•1 </h1>
<BetaSchemaForm<DataItem> layoutType="Embed" columns={columns} />
<h1>è¡¨å•2</h1>
<BetaSchemaForm<DataItem>
layoutType="Embed"
columns={[
{
title: "åˆ›å»ºæ—¶é—´",
key: "showTime",
dataIndex: "createName",
valueType: "date"
},
{
title: "åˆ†ç»„",
valueType: "group",
columns: [
{
title: "æ ‡é¢˜",
width: "md",
dataIndex: "groupTitle",
formItemProps: {
rules: [
{
required: true,
message: "æ­¤é¡¹ä¸ºå¿…å¡«é¡¹"
}
]
}
}
]
}
]}
/>
</ProForm>
);
};

<!--
æä¾›å¯å¤ç°çš„ä»£ç ï¼Œä»“åº“ï¼Œæˆ–çº¿ä¸Šç¤ºä¾‹
-->

### Â© ç‰ˆæœ¬ä¿¡æ¯

"@ant-design/pro-components": "1.1.5",
"antd": "4.21.0",
"react": "18.1.0",
"react-dom": "18.1.0"

### ğŸš‘ å…¶ä»–ä¿¡æ¯

å¤ç°åœ°å€ï¼š https://codesandbox.io/s/schema-biao-dan-forked-4mi57j?file=/App.tsx

<!--
å¦‚æˆªå›¾ç­‰å…¶ä»–ä¿¡æ¯å¯ä»¥è´´åœ¨è¿™é‡Œ
-->

## chenshuai2144

> TAutomatically replying with ChatGPT can be attempted, but it cannot be guaranteed to be completely accurate and may not fully address all issues. Please feel free to reply if you have any further questions or concerns.
> æ­¤å›å¤åŸºäº ChatGPT è‡ªåŠ¨ç”Ÿæˆï¼Œå¯ä»¥å°è¯•ä¸‹æ–¹æ¡ˆï¼Œå®˜æ–¹å‘˜ä¼šåœ¨ä¸€å®šæ—¶é—´åç»§ç»­ç»§ç»­å¤„ç†ã€‚

æ„Ÿè°¢åˆ†äº«ä½ çš„é—®é¢˜ã€‚æ ¹æ®ä½ æä¾›çš„ä¿¡æ¯ï¼Œæˆ‘å‘ç°é—®é¢˜å‡ºåœ¨ `BetaSchemaForm` çš„ `Embed` å¸ƒå±€æ¨¡å¼ä¸‹ï¼Œä½¿ç”¨ `dependencies` å±æ€§çš„è¡¨å•è”åŠ¨ä¼šå¤±æ•ˆã€‚ç»è¿‡æˆ‘åœ¨ä»£ç ä¸­çš„æµ‹è¯•ï¼Œç¡®å®å‡ºç°äº†è¿™ä¸ªé—®é¢˜ã€‚

æˆ‘åœ¨ [Ant Design Pro issues](https://github.com/ant-design/ant-design-pro/issues/3198) ä¸Šæ‰¾åˆ°äº†ç±»ä¼¼çš„é—®é¢˜ã€‚æŒ‰ç…§é‚£ä¸ª issue ä¸­çš„è§£å†³æ–¹æ¡ˆï¼Œæˆ‘å°è¯•ä¿®æ”¹äº†è¡¨å•çš„å®ç°æ–¹å¼ï¼Œä½¿ç”¨ `ProForm.Group` å’Œ `ProFormItem` æ¥æ›¿ä»£ `BetaSchemaForm` ä¸­çš„ `columns`ï¼Œå¹¶åœ¨ `ProFormItem` ä¸­ä½¿ç”¨ `ProFormFieldSet` æ¥å®ç°åµŒå¥—ï¼Œè¿™æ ·å°±å¯ä»¥æ­£å¸¸å®ç°è¡¨å•è”åŠ¨ã€‚å¯ä»¥å‚è€ƒä»¥ä¸‹ä»£ç æ”¹åŠ¨ï¼š

```jsx
import type { ProFormColumnsType } from "@ant-design/pro-components";
import {
  ProForm,
  ProFormSelect,
  ProFormText,
  ProFormDependency,
  ProFormFieldSet,
  ProFormDateTimePicker
} from "@ant-design/pro-components";
import React from "react";

type DataItem = {
  name: string;
  state: string;
};

const valueEnum = [
  { label: "å…¨éƒ¨", value: "all1" },
  { label: "æœªè§£å†³", value: "open2" },
  { label: "æœªè§£å†³(å·²åˆ†é…)", value: "assignees1" },
  { label: "å·²è§£å†³", value: "closed1" },
  { label: "è§£å†³ä¸­", value: "processing1" }
];

export default () => {
  return (
    <ProForm>
      <h1>ProForm </h1>
      <ProFormText name="username" />
      <ProFormSelect
        name="select-multiple"
        label="å¤šé€‰"
        valueEnum={{
          red: "Red",
          green: "Green",
          blue: "Blue"
        }}
        fieldProps={{
          mode: "multiple"
        }}
        placeholder="Please select favorite colors"
        rules={[
          {
            required: true,
            message: "Please select your favorite colors!",
            type: "array"
          }
        ]}
      />
      <h1>è¡¨å•1 </h1>
      <ProForm.Group>
        <ProFormSelect
          name="ksCustomer_status"
          label="ç±»å‹"
          request={async () => valueEnum}
        />
        <ProFormItem
          dependencies={["ksCustomer_status"]}
          name="ksCustomer_type"
          label="çŠ¶æ€"
        >
          <ProFormFieldSet>
            {(form) => {
              if (form?.getFieldValue("ksCustomer_status") === "all1") {
                console.log(1212121221);
                return <ProFormText disabled placeholder="disabled" />;
              } else {
                console.log(9999);
                return <ProFormText placeholder="normal" />;
              }
            }}
          </ProFormFieldSet>
        </ProFormItem>
        <ProFormDependency name={["ksCustomer_status"]}>
          {(ksCustomer_status) => {
            return ksCustomer_status !== "all1" ? (
              <ProFormDateTimePicker name="currentTime" label="æ—¶é—´" />
            ) : null;
          }}
        </ProFormDependency>
      </ProForm.Group>
      <h1>è¡¨å•2</h1>
      <ProForm.Group>
        <ProFormDateTimePicker name="createName" label="åˆ›å»ºæ—¶é—´" />
        <ProFormItem name="groupTitle" label="åˆ†ç»„">
          <ProFormFieldSet>
            <ProFormText
              name="groupTitle"
              width="md"
              placeholder="è¯·è¾“å…¥æ ‡é¢˜"
              rules={[
                {
                  required: true,
                  message: "æ­¤é¡¹ä¸ºå¿…å¡«é¡¹"
                }
              ]}
            />
          </ProFormFieldSet>
        </ProFormItem>
      </ProForm.Group>
    </ProForm>
  );
};
```

å¸Œæœ›æˆ‘çš„å›ç­”å¯ä»¥å¸®åŠ©åˆ°ä½ è§£å†³é—®é¢˜ã€‚å¦‚æœè¿˜æœ‰ä»»ä½•é—®é¢˜ï¼Œæ¬¢è¿ç»§ç»­æå‡ºã€‚
