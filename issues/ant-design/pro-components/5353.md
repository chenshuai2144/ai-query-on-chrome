# EditableProTable ä½¿ç”¨ProFormçš„nameå±æ€§æ—¶å¯¼è‡´åˆ é™¤å¼‚å¸¸ğŸ›[BUG]

`ğŸ¤·ğŸ¼ How to use`,`AI Reply`

### ğŸ› bug æè¿°

åœ¨ProFormä¸‹ä½¿ç”¨EditableProTableå¹¶æ·»åŠ nameå±æ€§ï¼Œå¯¼è‡´åˆ é™¤æ—¶é¡ºåºé”™ä¹±æˆ–æœ€å1è¡Œæ— æ³•åˆ é™¤ï¼Œå¦‚æˆªå›¾æ‰€ç¤ºï¼šåˆ é™¤1åï¼Œå†åˆ é™¤2ï¼Œåˆ™ç»„ä»¶ä¼šå»åˆ é™¤3æ‰€åœ¨è¡Œï¼Œä¸”æœ€åçš„2æ— æ³•åˆ é™¤ï¼›
æ³¨é‡Šæ‰ name={'table'} åˆ™æ“ä½œæ­£å¸¸ï¼

### ğŸ’» å¤ç°ä»£ç 

```
import React, {useRef, useState} from 'react';
import {ActionType, EditableFormInstance, EditableProTable, ProColumns} from "@ant-design/pro-table";
import ProForm from "@ant-design/pro-form";
import ProFormItem from "@ant-design/pro-form/es/components/FormItem";


const default
() => {

    const [editableKeys, setEditableRowKeys] = useState<React.Key[]>([]);
    const [position, setPosition] = useState<'top' | 'bottom' | 'hidden'>('bottom');
    const editableActionRef = useRef<ActionType>();
    const editableFormRef = useRef<EditableFormInstance>();

    const columns: ProColumns[] = [
        {
            title: 'æ´»åŠ¨åç§°',
            dataIndex: 'title',
            tooltip: 'åªè¯»ï¼Œä½¿ç”¨form.getFieldValueè·å–ä¸åˆ°å€¼',
            formItemProps: (form, {rowIndex}) => {
                return {
                    rules: rowIndex > 1 ? [{required: true, message: 'æ­¤é¡¹ä¸ºå¿…å¡«é¡¹'}] : [],
                };
            },
            width: '15%',
        },
        {
            title: 'æ´»åŠ¨åç§°äºŒ',
            dataIndex: 'readonly',
            tooltip: 'åªè¯»ï¼Œä½¿ç”¨form.getFieldValueå¯ä»¥è·å–åˆ°å€¼',
            readonly: true,
            width: '15%',
        },
        {
            title: 'çŠ¶æ€',
            dataIndex: 'state',
            valueType: 'select',
            valueEnum: {
                all: {text: 'å…¨éƒ¨', status: 'Default'},
                open: {
                    text: 'æœªè§£å†³',
                    status: 'Error',
                },
                closed: {
                    text: 'å·²è§£å†³',
                    status: 'Success',
                },
            },
        },
        {
            title: 'æè¿°',
            dataIndex: 'decs',
            fieldProps: (from, {rowKey, rowIndex}) => {
                if (from.getFieldValue([rowKey || '', 'title']) === 'ä¸å¥½ç©') {
                    return {
                        disabled: true,
                    };
                }
                if (rowIndex > 9) {
                    return {
                        disabled: true,
                    };
                }
                return {};
            },
        },
        {
            title: 'å˜é‡è§£é‡Š',
            dataIndex: 'description',
            valueType: 'text',
            width: '20%',
        },
        {
            title: 'æ“ä½œ',
            valueType: 'option',
            width: 200,
        },
    ];

    return (
        <>
            <ProForm formRef={editableFormRef}>
                <ProFormItem>
                    <EditableProTable
                        name={'table'}
                        rowKey="id"
                        actionRef={editableActionRef}
                        formRef={editableFormRef}
                        headerTitle="å¯ç¼–è¾‘è¡¨æ ¼"
                        recordCreatorProps={{
                            position: position as 'top',
                            newRecordType: 'dataSource',
                            record: () => ({id: (Math.random() * 1000000).toFixed(0)}),
                        }}
                        loading={false}
                        columns={columns}
                        editable={{
                            type: 'multiple',
                            editableKeys,
                            onChange: setEditableRowKeys,
                            actionRender: (row, config, defaultDom) => {
                                return [defaultDom.delete];
                            },
                        }}
                    />
                </ProFormItem>
            </ProForm>
        </>
    );
};
```

### Â© ç‰ˆæœ¬ä¿¡æ¯

    "@ant-design/pro-form": "^1.69.3",
    "@ant-design/pro-table": "^2.76.3",

### ğŸš‘ å…¶ä»–ä¿¡æ¯

![image](https://user-images.githubusercontent.com/16718459/172689773-19433cde-be2d-4bba-ba9c-7c0a52f6985f.png)

## Mzhang1994

![Snipaste_2022-06-10_10-54-10](https://user-images.githubusercontent.com/69185609/172981045-0fdbac1a-188c-4d7c-97b3-3aadb8910bab.png)
è‡ªå·±å¯¹æ¯”ä¸€ä¸‹ï¼Œçœ‹å°‘äº†å•¥

## Cooolyu

@Mzhang1994 æŠŠvalueã€onChangeã€onValuesChangeæ–¹æ³•åŠ ä¸Šåé—®é¢˜è¿˜æ˜¯ä¼šå‡ºç°ï¼Œåˆ é™¤åå‡ºç°æŸä¸€è¡Œå…¨éƒ¨åˆ—å˜æˆ-
![image](https://user-images.githubusercontent.com/16718459/172995910-e3711ae0-b5e3-468e-b8c3-098fc0e14179.png)

## Mzhang1994

ä½ æ²¡å¿…è¦å†™nameå±æ€§ï¼Œé™¤éä½ è¦å•ç‹¬å†™åˆ é™¤çš„åŠŸèƒ½ã€‚
![image](https://user-images.githubusercontent.com/69185609/173022027-c3e9faf5-f051-4a73-bb19-f635c3980d65.png)

## Cooolyu

æˆ‘è¿™è¾¹éœ€è¦è¡¨æ ¼é‡Œçš„ä¸¤åˆ—selectè¿›è¡Œè”åŠ¨ï¼Œç›®å‰çœ‹å¿…é¡»è¦åŠ nameæ‰èƒ½ç”Ÿæ•ˆï¼Œå¦å¤–é‡å†™deleteæ–¹æ³•æ—¶è¡Œåˆ é™¤å’Œæ·»åŠ ä¾ç„¶æœ‰è¿™ä¸ªé—®é¢˜@Mzhang1994

## chen-jianpeng

ä¸ FormItem é…åˆä½¿ç”¨çš„æ—¶å€™ï¼Œæˆ‘è¿™é‡Œåˆ é™¤åŠŸèƒ½ä¹Ÿæ˜¯æœ‰é—®é¢˜ï¼Œä¼šä¹±ã€‚

## chenshuai2144

> TAutomatically replying with ChatGPT can be attempted, but it cannot be guaranteed to be completely accurate and may not fully address all issues. Please feel free to reply if you have any further questions or concerns.
> æ­¤å›å¤åŸºäº ChatGPT è‡ªåŠ¨ç”Ÿæˆï¼Œå¯ä»¥å°è¯•ä¸‹æ–¹æ¡ˆï¼Œå®˜æ–¹äººå‘˜ä¼šåœ¨ä¸€å®šæ—¶é—´åç»§ç»­ç»§ç»­å¤„ç†ã€‚

è¿™ä¸ªé—®é¢˜æ˜¯ç”±äº `EditableProTable` çš„åˆ é™¤åŠŸèƒ½åœ¨åˆ é™¤æ—¶æ˜¯ä¾é  `rowKey` æ¥è¿›è¡ŒæŸ¥æ‰¾çš„ï¼Œè€Œåœ¨é…åˆ `ProForm` ä½¿ç”¨æ—¶ï¼Œæ·»åŠ äº† `name` å±æ€§åï¼Œä¼šç»™æ¯ä¸€è¡Œæ•°æ®çš„ `rowKey` åŠ ä¸Šä¸€ä¸ªå‰ç¼€ï¼Œå¯¼è‡´åˆ é™¤æ—¶å‡ºç°äº†æ‰¾ä¸åˆ°å¯¹åº”çš„ `rowKey` çš„é—®é¢˜ã€‚

è§£å†³åŠæ³•æ˜¯åœ¨ä¼ å…¥ `EditableProTable` çš„ `rowKey` ä¸­åŠ ä¸Šå‰ç¼€å³å¯ã€‚å‰ç¼€çš„å€¼å¯ä»¥é€šè¿‡ `ProForm` çš„ `name` å±æ€§è·å–ï¼Œä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š

```typescript
const [form] = Form.useForm();
const name = 'table';
const [prefix, setPrefix] = useState<string>('');

useEffect(() => {
  setPrefix(form.getFieldName([name]));
}, [form, name]);

const columns: ProColumns[] = [
  {
    title: 'å§“å',
    dataIndex: 'name',
    formItemProps: {
      rules: [{ required: true }],
    },
  },
  {
    title: 'ç”µè¯å·ç ',
    dataIndex: 'phone',
    formItemProps: {
      rules: [{ required: true }],
    },
  },
  {
    title: 'æ“ä½œ',
    valueType: 'option',
    width: 200,
    render: (text, record, _, action) => [
      <a
        key="editable"
        onClick={() => {
          action.startEditable?.(record.id);
        }}
      >
        ç¼–è¾‘
      </a>,
      <a
        key="delete"
        onClick={() => {
          action?.cancelEditable?.(record.id);
          const newData = dataSource.filter((item) => item.id !== record.id);
          setDataSource(newData);
        }}
      >
        åˆ é™¤
      </a>,
    ],
  },
];

return (
  <ProForm form={form}>
    <EditableProTable
      rowKey={(record) => `${prefix}-${record.id}`}
      recordCreatorProps={{
        newRecordType: 'dataSource',
      }}
      columns={columns}
      dataSource={dataSource}
      editable={{
        onChange: setDataSource,
      }}
    />
  </ProForm>
);
```

åœ¨è¿™ä¸ªç¤ºä¾‹é‡Œï¼Œæˆ‘ä»¬é€šè¿‡ `form.getFieldName([name])` è·å–åˆ°äº† `name` å±æ€§çš„å‰ç¼€ï¼Œç„¶ååœ¨ `rowKey` ä¸­åŠ ä¸Šäº†è¿™ä¸ªå‰ç¼€ï¼Œåœ¨åˆ é™¤æ—¶å°±ä¸ä¼šå†å‡ºç°é—®é¢˜ã€‚

å¸Œæœ›è¿™ä¸ªè§£å†³åŠæ³•å¯ä»¥è§£å†³ä½ çš„é—®é¢˜ã€‚

## canqi0

æˆ‘ä¹Ÿé‡åˆ°äº†è¿™ä¸ªé—®é¢˜ ç»‘å®šnameæ—¶ æ“ä½œæ›´æ–°è¡¨æ ¼æ•°æ® è®¾ç½®äº†å¿…å¡«çš„åˆ—æ•°æ®ä¼šä¸¢å¤±
çœ‹æ—¥å¿—è§¦å‘äº†ä¸¤æ¬¡æ¸²æŸ“ ç¬¬ä¸€æ¬¡è¿˜æœ‰æ•°æ® ç¬¬äºŒæ¬¡å°±æ²¡äº†

```
import type { ProColumns } from '@ant-design/pro-table';
import { EditableProTable } from '@ant-design/pro-table';
import { hooks } from '@wove/react';
import { Button, Form } from 'antd';
import { nanoid } from 'nanoid';
import React, { useEffect } from 'react';

type DataSourceType = {
  key: React.Key;
  title?: string;
  type?: number;
};

const initialValues: { editableData: DataSourceType[] } = {
  editableData: [
    {
      key: nanoid(),
      title: 'æ´»åŠ¨åç§°1',
      type: 1,
    },
  ],
};

export const TableDemo = () => {
  const [form] = Form.useForm<{ editableData: DataSourceType[] }>();

  // å…¨è¡¨å¯ç¼–è¾‘
  const editableKeys = Form.useWatch('editableData', form)?.map((item) => item.key);

  useEffect(() => {
    form.setFieldsValue(initialValues);
  }, []);

  // ä¸Šç§»
  const onUpClick = hooks.useCallbackRef((index) => {
    const oldEditableData = form.getFieldValue('editableData');
    const editableData = [...oldEditableData];
    editableData[index] = editableData.splice(index - 1, 1, editableData[index])[0];
  // æ•°æ®å­˜åœ¨
    form.setFieldValue('editableData', editableData);
  });

  // ä¸‹ç§»
  const onDownClick = hooks.useCallbackRef((index) => {
    const oldEditableData = form.getFieldValue('editableData');
    const editableData = [...oldEditableData];
    editableData[index] = editableData.splice(index + 1, 1, editableData[index])[0];
    form.setFieldValue('editableData', editableData);
  });

  const columns: ProColumns<DataSourceType>[] = [
    {
      title: 'æ´»åŠ¨åç§°',
      dataIndex: 'title',
      // å¿…å¡«æ ¡éªŒ è¯¥åˆ—ä¸¢å¤±
      formItemProps: {
        rules: [{ required: true, message: 'è¯·è¾“å…¥!' }],
      },
    },
    {
      title: 'æ´»åŠ¨ç±»å‹',
      dataIndex: 'type',
      valueType: 'select',
      fieldProps: {
        options: [
          { value: 1, label: 'ç±»å‹1' },
          { value: 2, label: 'ç±»å‹2' },
        ],
      },
    },
    {
      title: 'æ“ä½œ',
      valueType: 'option',
      render: () => {
        return null;
      },
    },
  ];

  return (
    <Form form={form}>
      <EditableProTable<DataSourceType>
        headerTitle="å¯ç¼–è¾‘è¡¨æ ¼"
        columns={columns}
        scroll={{ x: 'max-content' }}
        rowKey="key"
        name="editableData"
        recordCreatorProps={{
          record: {
            key: nanoid(),
          },
        }}
        editable={{
          type: 'multiple',
          editableKeys,
          // æ“ä½œ
          actionRender: (row, config, defaultDoms) => {
            console.log(row, config);
            return [
              <Button
                type="link"
                style={{ padding: 0 }}
                disabled={config.index == 0}
                onClick={onUpClick.bind(null, config.index)}
              >
                ä¸Šç§»
              </Button>,
              <Button
                type="link"
                style={{ padding: 0 }}
                disabled={config.index == editableKeys.length - 1}
                size="small"
                onClick={onDownClick.bind(null, config.index)}
              >
                ä¸‹ç§»
              </Button>,
              defaultDoms.delete,
            ];
          },
        }}
      />
    </Form>
  );
}
```

å®Œæ•´demo https://www.jianshu.com/p/a58bd3a744a5
æ—¥å¿—
<img width="717" alt="image" src="https://github.com/ant-design/pro-components/assets/89558157/d38a7e20-9d47-463c-91f7-367f0afe7d2d">

5.18 å·²æ‰¾åˆ°åŸå› 
editableKeyså˜åŒ–æ—¶ æ“ä½œæŒ‰é’®ä¸­ä½¿ç”¨çš„editableKeys.length å¯¼è‡´äº†é‡æ–°æ¸²æŸ“

## chenshuai2144

å·²ç»ä¿®å¤äº†ï¼Œæ˜¯ä¿ç•™åˆ é™¤æ•°æ®å¯¼è‡´çš„
