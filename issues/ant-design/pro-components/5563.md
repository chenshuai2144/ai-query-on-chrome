# 👑 [需求]ProFormTreeSelect可以实现搜索结果的关键字高亮吗

`AI Reply`

提问前先看看：

https://github.com/ryanhanwu/How-To-Ask-Questions-The-Smart-Way/blob/main/README-zh_CN.md

### 🔩 所属模块或组件

<!--
如果你的功能需求率属于某个功能模块或者是组件的，请在此处标明，如对`table`组件有功能需求，则注明：率属组件：ProTable
 -->

### 🥰 需求描述

ProFormTreeSelect可以实现搜索结果的关键字高亮吗

### ⛰ 功能需求适用场景

<!--
请简单描述一下这个新功能通常或可以应用在哪些场景下
-->

### 🧐 解决方案

<!--
如果你有解决方案，在这里清晰地阐述
-->

### 🚑 其他信息

<!--
如截图等其他信息可以贴在这里
-->

## chenshuai2144

> TAutomatically replying with ChatGPT can be attempted, but it cannot be guaranteed to be completely accurate and may not fully address all issues. Please feel free to reply if you have any further questions or concerns.
> 此回复基于 ChatGPT 自动生成，可以尝试下方案，官方员会在一定时间后继续继续处理。

感谢您的问题！

ProFormTreeSelect是antd的组件，目前antd的TreeSelect并不支持搜索结果的关键字高亮。不过，可以考虑使用第三方库进行解决。以下是一个示例：

1. 安装第三方库`react-highlight-words`:

```bash
npm install react-highlight-words --save
```

2. 在ProFormTreeSelect中使用`react-highlight-words`组件：

```jsx
import { TreeSelect } from "antd";
import Highlighter from "react-highlight-words";

const TreeNode = TreeSelect.TreeNode;

// 数据源
const treeData = [
  // ...
];

class ProFormTreeSelect extends React.Component {
  state = {
    searchValue: "",
    expandedKeys: [],
  };

  // 展开/收起节点时触发
  onExpand = (expandedKeys) => {
    this.setState({
      expandedKeys,
    });
  };

  // 渲染搜索结果
  renderTreeNodes = (data) =>
    data.map((item) => {
      const { label } = item;
      const { searchValue } = this.state;
      const index = label.indexOf(searchValue);
      const beforeStr = label.substr(0, index);
      const afterStr = label.substr(index + searchValue.length);
      const title =
        index > -1 ? (
          <Highlighter
            highlightStyle={{ backgroundColor: "#ffc069", padding: 0 }}
            searchWords={[searchValue]}
            autoEscape
            textToHighlight={`${beforeStr}${searchValue}${afterStr}`}
          />
        ) : (
          <span>{label}</span>
        );

      if (item.children) {
        return (
          <TreeNode title={title} key={item.key} value={item.value}>
            {this.renderTreeNodes(item.children)}
          </TreeNode>
        );
      }
      return <TreeNode key={item.key} {...item} title={title} />;
    });

  // 搜索节点
  handleTreeSearch = (value) => {
    const expandedKeys = [];
    this.findExpandedKeys(treeData, value, expandedKeys);
    this.setState({
      searchValue: value,
      expandedKeys,
    });
  };

  // 筛选出应该展开的节点keys
  findExpandedKeys = (data, value, expandedKeys) => {
    data.forEach((item) => {
      const { label } = item;
      if (label.indexOf(value) !== -1) {
        expandedKeys.push(item.key);
      }
      if (item.children) {
        this.findExpandedKeys(item.children, value, expandedKeys);
      }
    });
  };

  render() {
    const { searchValue, expandedKeys } = this.state;

    return (
      <TreeSelect
        showSearch
        style={{ width: "100%" }}
        value={this.props.value}
        dropdownStyle={{ maxHeight: 400, overflow: "auto" }}
        placeholder="请选择"
        allowClear
        treeDefaultExpandAll
        onSearch={this.handleTreeSearch}
        onSelect={this.props.onChange}
        treeDefaultExpandedKeys={expandedKeys}
        onExpand={this.onExpand}
      >
        {this.renderTreeNodes(treeData)}
      </TreeSelect>
    );
  }
}
```

该示例使用`react-highlight-words`来渲染搜索结果高亮的文本，同时针对搜索关键字展开树节点，提升用户体验。

对于`react-highlight-words`组件的更多使用说明和参数设置，可以查看官方文档：[react-highlight-words](https://www.npmjs.com/package/react-highlight-words)。

希望这个示例对您有帮助，如果您还有其他问题，欢迎继续提问。
