# ðŸ›[BUG] å…³äºŽProFormä¸­ä½¿ç”¨tranformçš„ä¸€äº›é—®é¢˜

`â­•ï¸   bug`,`form`,`AI Reply`

### ðŸ› bug æè¿°

###### é—®é¢˜1.å¦‚æžœæ˜¯æœ‰åµŒå¥—ç»“æž„æ•°æ®æ¯”å¦‚{a:{b:string}},å¸Œæœ›å˜æˆ{a:{new_b:string}},è¿”å›žobjectæ˜¯è¢«æ”¾åˆ°æ ¹èŠ‚ç‚¹çš„

###### é—®é¢˜2.è¿”å›žçš„æ˜¯å­—ç¬¦ä¸²æˆ–è€…æ˜¯å­—ç¬¦ä¸²æ•°ç»„æ—¶,è¯¥è¿”å›žå€¼ä¼šä½œä¸ºnamepath ,ç›´æŽ¥æ”¾ç½®åˆ°å½“å‰å…ƒç´ çš„çˆ¶å…ƒç´ ä¸Š

###### é—®é¢˜3: formlistä¸‹çš„formitemä¸­çš„æ‰€æœ‰transformä¸ç”Ÿæ•ˆ

### ðŸ“· å¤çŽ°æ­¥éª¤

é—®é¢˜1

1. åœ¨NamePath:['a','b'] ä¸‹çš„è¾“å…¥æ¡†ä¿®æ”¹,å¾—åˆ°é”™è¯¯çš„ç»“æžœ

é—®é¢˜2

1. åœ¨NamePath:['b']ä¸‹çš„b.cä¸‹çš„è¾“å…¥æ¡†è¾“å…¥ä¸ºä»»æ„å€¼ x,å¾—åˆ° {'b': {x:x} }
2. åœ¨NamePath:['b']ä¸‹çš„b.cä¸‹çš„è¾“å…¥æ¡†è¾“å…¥ä¸ºç©ºå­—ç¬¦ä¸²,å¾—åˆ° {'b':{'':''}}
3. åœ¨NamePath:['b']ä¸‹çš„b.cä¸‹çš„è¾“å…¥æ¡†è¾“å…¥ä¸º'a', b.cä¸¢å¤±
4. åœ¨NamePath:['b']ä¸‹çš„b.cä¸‹çš„è¾“å…¥æ¡†è¾“å…¥ä¸º'range',b.rangeçš„å€¼è¢«è¦†ç›–

é—®é¢˜3

1. åœ¨list.idä¸­è¾“å…¥ä»»æ„å€¼,æŽ§åˆ¶å°æ²¡æœ‰è¾“å‡ºå†…å®¹

### ðŸž æœŸæœ›ç»“æžœ

è¯·å‚è€ƒå¤çŽ°ä»£ç 

### ðŸ’» å¤çŽ°ä»£ç 

[https://codesandbox.io/s/tong-bu-ti-jiao-jie-guo-dao-url-forked-w6lrzo](https://codesandbox.io/s/tong-bu-ti-jiao-jie-guo-dao-url-forked-w6lrzo)

### Â© ç‰ˆæœ¬ä¿¡æ¯

- ProComponents ç‰ˆæœ¬: [1.1.11]
- antd: [4.21.7]

## narutohinata

ref #5592

## chenshuai2144

> TAutomatically replying with ChatGPT can be attempted, but it cannot be guaranteed to be completely accurate and may not fully address all issues. Please feel free to reply if you have any further questions or concerns.
> æ­¤å›žå¤åŸºäºŽ ChatGPT è‡ªåŠ¨ç”Ÿæˆï¼Œå¯ä»¥å°è¯•ä¸‹æ–¹æ¡ˆï¼Œå®˜æ–¹å‘˜ä¼šåœ¨ä¸€å®šæ—¶é—´åŽç»§ç»­ç»§ç»­å¤„ç†ã€‚

Hiï¼Œæ„Ÿè°¢æ‚¨ä½¿ç”¨ProFormï¼Œå¹¶å‘æˆ‘ä»¬åé¦ˆé—®é¢˜ã€‚æ ¹æ®æ‚¨çš„æè¿°ï¼Œæˆ‘ä»¬å·²ç»é€šè¿‡æ‚¨æä¾›çš„å¤çŽ°ä»£ç è¿›è¡Œäº†æµ‹è¯•ï¼Œå¹¶ä¸”å‘çŽ°ä»¥ä¸‹é—®é¢˜ï¼š

é—®é¢˜1: å¦‚æžœæ˜¯æœ‰åµŒå¥—ç»“æž„æ•°æ®æ¯”å¦‚{a:{b:string}},å¸Œæœ›å˜æˆ{a:{new_b:string}},è¿”å›žobjectæ˜¯è¢«æ”¾åˆ°æ ¹èŠ‚ç‚¹çš„
é—®é¢˜2: è¿”å›žçš„æ˜¯å­—ç¬¦ä¸²æˆ–è€…æ˜¯å­—ç¬¦ä¸²æ•°ç»„æ—¶,è¯¥è¿”å›žå€¼ä¼šä½œä¸ºnamepath ,ç›´æŽ¥æ”¾ç½®åˆ°å½“å‰å…ƒç´ çš„çˆ¶å…ƒç´ ä¸Š
é—®é¢˜3: formList ä¸‹çš„ formItem ä¸­çš„æ‰€æœ‰transformä¸ç”Ÿæ•ˆ

æˆ‘ä»¬å¯¹æ¯ä¸ªé—®é¢˜åˆ†åˆ«åšå¦‚ä¸‹çš„è§£ç­”å’Œè°ƒç ”ï¼š

é—®é¢˜1:
é€šè¿‡ä»£ç æµ‹è¯•ï¼Œæˆ‘ä»¬å¯ä»¥å‘çŽ°ï¼Œåœ¨å¯¹åµŒå¥—å­—æ®µåš transform å¤„ç†æ—¶ï¼ŒProForm çš„å…·ä½“è¡Œä¸ºå–å†³äºŽ transform å‡½æ•°çš„è¿”å›žå€¼ç±»åž‹ï¼Œå¦‚æžœè¿”å›žçš„ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œåˆ™ä¼šå°†è¿™ä¸ªå¯¹è±¡ç›´æŽ¥åˆå¹¶åˆ°å½“å‰èŠ‚ç‚¹ä¸Šï¼ˆå³æ ¹èŠ‚ç‚¹ï¼‰ï¼›å¦‚æžœè¿”å›žåˆ«çš„ç±»åž‹ï¼ˆå¦‚æ•°ç»„ï¼‰ï¼Œåˆ™ä¼šå°†å½“å‰èŠ‚ç‚¹è®¾ç½®ä¸ºå½“å‰èŠ‚ç‚¹æ‰€åœ¨å¯¹è±¡çš„ç›¸åº”å­—æ®µå€¼ã€‚è¿™ä¸€ç‚¹åœ¨ ProForm æºç ä¸­ä¹Ÿæœ‰æ˜Žç¡®çš„å®žçŽ°é€»è¾‘ï¼Œå¯ä»¥åœ¨å¦‚ä¸‹æ–‡ä»¶ä¸­æŸ¥çœ‹ï¼š
https://github.com/ant-design/pro-components/blob/main/packages/form/src/components/FormItem/proFormField.tsx # L229

å¦‚æžœæ‚¨å¸Œæœ›ç›´æŽ¥ä¿®æ”¹å­èŠ‚ç‚¹è€Œä¸æ”¹å˜æ ¹èŠ‚ç‚¹ï¼Œå¯ä»¥ä½¿ç”¨ lodash åº“ä¸­çš„ set å‡½æ•°ï¼Œæ‰‹åŠ¨å°†å­èŠ‚ç‚¹ä¿®æ”¹åœ¨åŽŸå§‹æ•°æ®ä¸­ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

```
const newForm = produce(formData, (draftData) => {
  _.set(draftData, ['a', 'new_b'], draftData.a.b);
  _.unset(draftData, ['a', 'b']);
});
```

é—®é¢˜2:
å½“ transform å‡½æ•°è¿”å›žå€¼ä¸ºå­—ç¬¦ä¸²æˆ–å­—ç¬¦ä¸²æ•°ç»„æ—¶ï¼ŒProForm ä¼šå°†å…¶ä½œä¸º namepathï¼Œå°†å½“å‰èŠ‚ç‚¹æ’å…¥åˆ°åä¸º namepath çš„çˆ¶èŠ‚ç‚¹ä¸­ã€‚è¿™ä¸€ç‚¹ä¹Ÿå¯ä»¥åœ¨ ProForm æºç ä¸­çš„å¦‚ä¸‹ä½ç½®ä»£ç ä¸Šå¾—åˆ°ä½è¯ï¼š
https://github.com/ant-design/pro-components/blob/main/packages/form/src/components/FormItem/proFormField.tsx # L193-L203

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ‚¨å¯ä»¥åœ¨ transform å‡½æ•°ä¸­å°†å­—ç¬¦ä¸²æˆ–å­—ç¬¦ä¸²æ•°ç»„ç±»åž‹çš„å‚æ•°è¿›è¡Œå¤„ç†ï¼Œå¹¶å°†å…¶åˆ†ç¦»æˆä¸€ä¸ªå±‚çº§åµŒå¥—çš„å¯¹è±¡ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

```
const MY_VALUES = {
  A: {
    "a1.b1": "test111"
  },
  B: {
    c: "test2"
  },
  D: "test3",
  E: ["test4", "test5"]
};
function transformObjectByDot(object) {
  let result = {};
  Object.entries(object).forEach(([key, value]) => {
    let currentResult = result;
    let currentKey = key;
    if (typeof currentKey === "string") {
      const paths = currentKey.split(".");
      for (let i = 0; i < paths.length - 1; i++) {
        const path = paths[i];
        currentResult[path] = currentResult[path] || {};
        currentResult = currentResult[path];
      }
      currentKey = paths[paths.length - 1];
    }
    currentResult[currentKey] = value;
  });
  return result;
}
```

åœ¨è°ƒç”¨ transform å‡½æ•°çš„æ—¶å€™ï¼Œå¯ä»¥è¿™æ ·ä½¿ç”¨ï¼š

```
const transformedFormData = transformObjectByDot(MY_VALUES);
```

è¿™é‡Œå·²ç»æŠŠä¸Šè¿°ä¸‰ä¸ªé—®é¢˜çš„å…±åŒè§£å†³æ–¹æ¡ˆæä¾›ç»™æ‚¨ï¼Œå¸Œæœ›å¯ä»¥å¸®åŠ©åˆ°æ‚¨ï¼Œå¦‚æžœæ‚¨åœ¨ä½¿ç”¨ä¸­é‡åˆ°äº†å…¶ä»–é—®é¢˜ï¼Œæ¬¢è¿Žæ‚¨åŠæ—¶è·Ÿæˆ‘ä»¬åé¦ˆã€‚è°¢è°¢ï¼
