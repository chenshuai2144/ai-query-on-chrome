# ğŸ›[BUG] ProTable æœç´¢æŒ‰é’®æŠ–åŠ¨

### ğŸ› bug æè¿°

é€šè¿‡è·¯ç”±è¿›å…¥ï¼Œæˆ–è€…åˆ·æ–°é¡µé¢ä¼šæ˜¾ç¤ºæ„Ÿè§‰åˆ°é‡ç½®ã€€æŸ¥è¯¢æŒ‰é’®æŠ–åŠ¨ï¼Œå˜å½¢ï¼

### ğŸ“· å¤ç°æ­¥éª¤

<img width="1529" alt="image" src="https://user-images.githubusercontent.com/12706830/187641361-ce8d48da-c757-428a-92b2-3c98fb91a78e.png">

æœç´¢è¡¨æ ¼è¿‡å¤šçš„æƒ…å†µï¼Œå¾ˆæ˜æ˜¾
https://user-images.githubusercontent.com/12706830/187642429-164cc3d2-6a52-44d9-9ec7-eb2d91a16676.mov
<video src="https://user-images.githubusercontent.com/12706830/187642429-164cc3d2-6a52-44d9-9ec7-eb2d91a16676.mov" controls>
ä½ çš„æµè§ˆå™¨ä¸æ”¯æŒ <code>video</code> æ ‡ç­¾ã€‚
</video>

æœç´¢è¿‡å°‘çš„é¡µé¢ï¼Œä¹Ÿæœ‰é—ªåŠ¨
https://user-images.githubusercontent.com/12706830/187643862-e3c936ea-61eb-4410-ad81-f4946b95b2a9.mov
<video src="https://user-images.githubusercontent.com/12706830/187643862-e3c936ea-61eb-4410-ad81-f4946b95b2a9.mov" controls>
ä½ çš„æµè§ˆå™¨ä¸æ”¯æŒ <code>video</code> æ ‡ç­¾ã€‚
</video>

### ğŸ æœŸæœ›ç»“æœ

æœŸæœ›æ­£å¸¸ä¸æŠ–åŠ¨ï¼Œæˆ‘é»˜è®¤ä¸å¢åŠ å¯¼å‡ºæŒ‰é’®ï¼Œå®ƒä¹Ÿä¼šæŠ–åŠ¨ã€‚

### ğŸ’» å¤ç°ä»£ç 

æˆ‘æŠŠæ•´ä¸ªé¡µé¢ä»£ç ï¼Œè´´å‡ºæ¥ã€‚

```
import { useRef, useState } from 'react';
import { Tag, Space, Button, Avatar, Badge, Form, Input, Select } from 'antd';
import PageContainer from '@/components/PageContainer';
import ProTable, { ActionType, ProColumns } from '@ant-design/pro-table';
import { TableListItem } from './types';
import { queryMemberList } from './service';
import {
  formatDate,
  getEdu,
  getGender,
  getMarriage,
  getMonthlyIncome,
  getOccupation,
  sourceFormat,
} from '@/utils/tool';
import PopoverSliderForm from '@/components/PopoverSliderForm';
import {
  eduLabel,
  genderLabel,
  loveStatus,
  marriageLabel,
  occupationsLabel,
} from '@/utils/constant';
import DrawerPanel from './DrawerPanel';

const MemberList = () => {
  const actionRef = useRef<ActionType>();
  const [visible, setVisible] = useState(false);

  const showDrawer = () => {
    setVisible(true);
  };

  const columns: ProColumns<TableListItem>[] = [
    {
      title: 'å…³é”®è¯',
      hideInTable: true,
      colSize: 2,
      renderFormItem: () => {
        return (
          <Form.Item label="" noStyle>
            <Input.Group compact>
              <Form.Item name={['keywords', 'type']} noStyle initialValue={0}>
                <Select placeholder="è¯·é€‰æ‹©" style={{ width: '40%' }}>
                  <Select.Option value={0}>æŒ‰å‘¢ç§°æœ</Select.Option>
                  <Select.Option value={1}>æŒ‰å§“åæœ</Select.Option>
                  <Select.Option value={2}>æŒ‰æ‰‹æœºå·æœ</Select.Option>
                  <Select.Option value={3}>æŒ‰IDæœ</Select.Option>
                </Select>
              </Form.Item>
              <Form.Item name={['keywords', 'name']} noStyle>
                <Input style={{ width: '60%' }} placeholder="è¯·è¾“å…¥å…³é”®è¯" />
              </Form.Item>
            </Input.Group>
          </Form.Item>
        );
      },
    },
    {
      dataIndex: 'love_id',
      title: 'ç”¨æˆ·ID',
      search: false,
      align: 'center',
      width: 100,
    },
    {
      dataIndex: 'avatar',
      title: 'å¤´åƒ',
      search: false,
      align: 'center',
      width: 60,
      render: (_, row) => {
        return (
          <Avatar
            shape="square"
            size={48}
            src={sourceFormat(row.avatar, { m: 1, w: 200, h: 200 })}
          />
        );
      },
    },
    {
      title: 'èµ„æ–™',
      search: false,
      align: 'center',
      width: 330,
      render: (_, row) => {
        return (
          <div className="text-left f-12">
            <div className="text-left">
              <div className="d-flex align-items-end">
                <span className="f-w f-14 mr-10">{row.nickname}</span>
                <div
                  className={row.gender === 1 ? 'col-nan' : row.gender === 2 ? 'col-hot-pink' : ''}
                >
                  {getGender(row.gender)}
                </div>
                {row.marriage > 0 && <span className="ml-10">{getMarriage(row.marriage)}</span>}
              </div>
              <div className="col-6">
                <Space>
                  {row.age > 0 && <span>{row.age}å²</span>}
                  {row.height > 0 && <span>{row.height}cm</span>}
                  {row.weight > 0 && <span>{row.weight}kg</span>}
                  {row.education > 0 && <span>{getEdu(row.education)}</span>}
                  {row.occupation > 0 && <span>{getOccupation(row.occupation)}</span>}
                  {row.monthly_income > 0 && <span>{getMonthlyIncome(row.monthly_income)}</span>}
                </Space>
                <br />
                <Space>
                  <span>ç±è´¯ï¼šé‡åº†å¸‚ æ°¸å·åŒº</span>
                  <span>ç°å±…ï¼šé‡åº†å¸‚ æ°¸å·åŒº</span>
                </Space>
              </div>
            </div>
          </div>
        );
      },
    },
    {
      title: 'å¾®ä¿¡/æ‰‹æœºå·',
      dataIndex: 'mobile',
      // hideInTable: true,
      width: 130,
      align: 'center',
      search: false,
      formItemProps: {
        label: 'æ‰‹æœºå·',
      },
      render: (val, row) => {
        return (
          <Space direction="vertical">
            <span>{row.wechat ? row.wechat : '-'}</span>
            <span>{val ? val : '-'}</span>
          </Space>
        );
      },
    },
    {
      title: 'æ€§åˆ«',
      dataIndex: 'gender',
      hideInTable: true,
      valueType: 'select',
      request: async () => genderLabel,
    },
    {
      title: 'å®å',
      dataIndex: 'auth_realname',
      hideInTable: true,
      valueType: 'select',
      request: async () => [
        { label: 'å·²å®å', value: 1 },
        { label: 'æœªå®å', value: 0 },
      ],
    },
    {
      title: 'å©šå†µ',
      dataIndex: 'marriage',
      hideInTable: true,
      valueType: 'select',
      request: async () => marriageLabel,
      // renderFormItem: ()=> {}
    },
    {
      title: 'å­¦å†',
      dataIndex: 'education',
      hideInTable: true,
      valueType: 'select',
      request: async () => eduLabel,
    },
    {
      title: 'èŒä¸š',
      dataIndex: 'job',
      hideInTable: true,
      valueType: 'select',
      request: async () => occupationsLabel,
    },
    {
      title: 'æ”¶å…¥',
      dataIndex: 'salary',
      hideInTable: true,
      valueType: 'select',
      request: async () => [
        { label: 'æœªå©š', value: 1 },
        { label: 'ç¦»å¼‚', value: 2 },
        { label: 'ä¸§å¶', value: 3 },
      ],
    },
    {
      title: 'å¹´é¾„',
      dataIndex: 'age',
      hideInTable: true,
      renderFormItem: () => {
        return (
          <PopoverSliderForm typeName="å¹´é¾„" min={18} max={45} unit="å²" defaultVal={[20, 25]} />
        );
      },
    },
    {
      title: 'èº«é«˜',
      dataIndex: 'height',
      hideInTable: true,
      renderFormItem: () => {
        return (
          <PopoverSliderForm
            typeName="èº«é«˜"
            min={150}
            max={200}
            unit="CM"
            defaultVal={[158, 175]}
          />
        );
      },
    },
    {
      title: 'ä½“é‡',
      dataIndex: 'weight',
      hideInTable: true,
      renderFormItem: () => {
        return (
          <PopoverSliderForm typeName="ä½“é‡" min={40} max={100} unit="KG" defaultVal={[45, 65]} />
        );
      },
    },
    {
      title: 'è´­æˆ¿',
      dataIndex: 'house',
      hideInTable: true,
      valueType: 'select',
      request: async () => [
        { label: 'å·²è´­æˆ¿ï¼ˆå±…å®¶ï¼‰', value: 1 },
        { label: 'å·²è´­æˆ¿ï¼ˆå¤šå¥—ï¼‰', value: 2 },
        { label: 'æš‚æœªè´­æˆ¿', value: 3 },
        { label: 'éšæ—¶å¯è´­ç½®', value: 4 },
      ],
    },
    {
      dataIndex: 'integral',
      title: 'ç§¯åˆ†',
      search: false,
      align: 'center',
    },
    {
      title: 'å®å',
      dataIndex: 'mobile',
      // hideInTable: true,
      width: 80,
      align: 'center',
      search: false,
      render: () => {
        return <Tag color="success">å·²å®å</Tag>;
      },
    },
    {
      dataIndex: 'love_status',
      title: 'ç›¸äº²çŠ¶æ€',
      width: 100,
      align: 'center',
      valueType: 'select',
      request: async () => loveStatus,
      render: (_, row) => {
        switch (row.love_status as number) {
          case 1:
            return <Tag color="success">å…¬å¼€ç›¸äº²</Tag>;
          case 2:
            return <Tag color="gold">å§”æ‰˜çº¢å¨˜</Tag>;
          case 3:
            return <Tag color="magenta">å·²è„±å•</Tag>;
          default:
            return <Tag>å…³é—­ç›¸äº²</Tag>;
        }
      },
    },
    {
      dataIndex: 'matchmaker',
      title: 'çº¢å¨˜',
      align: 'center',
      request: async () => [{ label: 'ç•ªèŒ„', value: 1 }],
      width: 100,
      valueType: 'select',
    },
    {
      dataIndex: 'status',
      title: 'çŠ¶æ€',
      align: 'center',
      formItemProps: {
        label: 'ç”¨æˆ·çŠ¶æ€',
      },
      request: async () => [
        { label: 'æ­£å¸¸', value: 1 },
        { label: 'å®¡æ ¸ä¸­', value: 2 },
        { label: 'å¼‚å¸¸ç”¨æˆ·', value: 3 },
        { label: 'é»‘åå•', value: 4 },
      ],
      width: 100,
      render: () => {
        return <Tag color="success">æ­£å¸¸</Tag>;
      },
    },
    {
      title: 'æ³¨å†Œæ—¶é—´',
      dataIndex: 'create_time',
      valueType: 'date',
      width: 190,
      align: 'center',
      render: (_, record) => {
        return (
          <Space direction="vertical">
            <div className="col-6">å…¬ä¼—å·</div>
            <div>{formatDate(record.create_time)}</div>
          </Space>
        );
      },
    },
    {
      title: 'æ“ä½œ',
      width: 80,
      search: false,
      align: 'center',
      render: () => {
        return (
          <Space className="mt-6">
            <Badge count={2} style={{ display: 'none' }}>
              <Button size="small" type="primary" ghost style={{ display: 'none' }}>
                æœåŠ¡è·Ÿè¿›
              </Button>
            </Badge>
            <Badge count={2} style={{ display: 'none' }}>
              <Button size="small" type="primary" ghost style={{ display: 'none' }}>
                ç‰µçº¿è®°å½•
              </Button>
            </Badge>
            <Button size="small" type="primary" onClick={showDrawer}>
              è¯¦ç»†èµ„æ–™
            </Button>
          </Space>
        );
      },
    },
  ];

  return (
    <>
      <PageContainer>
        <ProTable<TableListItem>
          headerTitle="ç”¨æˆ·åˆ—è¡¨"
          actionRef={actionRef}
          rowKey="id"
          columns={columns}
          rowSelection={{}}
          search={{
            labelWidth: 'auto',
            span: 4,
            collapsed: false,
            collapseRender: false,
            optionRender: (searchConfig, formProps, dom) => [
              <Button key='out' onClick={() => {
                //searchConfig?.form?.getFieldsValue()
              }}>
                å¯¼å‡º
              </Button>,
              ...dom
            ]
          }}
          // columnsState={}
          request={async (params) => {
            const res = await queryMemberList({ ...params });
            return {
              data: res.result.data,
              success: true,
              total: res.result.total,
            };
          }}
        />
      </PageContainer>
      <DrawerPanel visible={visible} />
    </>
  );
};

export default MemberList;

```

### æ•´ä¸ªpackage.json

```
{
  "name": "jilian",
  "version": "5.2.0",
  "private": true,
  "description": "An out-of-box UI solution for enterprise applications",
  "scripts": {
    "analyze": "cross-env ANALYZE=1 umi build",
    "build": "umi build",
    "deploy": "npm run build && npm run gh-pages",
    "dev": "npm run start:dev",
    "gh-pages": "gh-pages -d dist",
    "i18n-remove": "pro i18n-remove --locale=zh-CN --write",
    "postinstall": "umi g tmp",
    "lint": "umi g tmp && npm run lint:js && npm run lint:style && npm run lint:prettier && npm run tsc",
    "lint-staged": "lint-staged",
    "lint-staged:js": "eslint --ext .js,.jsx,.ts,.tsx ",
    "lint:fix": "eslint --fix --cache --ext .js,.jsx,.ts,.tsx --format=pretty ./src && npm run lint:style",
    "lint:js": "eslint --cache --ext .js,.jsx,.ts,.tsx --format=pretty ./src",
    "lint:prettier": "prettier -c --write \"src/**/*\" --end-of-line auto",
    "lint:style": "stylelint --fix \"src/**/*.less\" --syntax less",
    "openapi": "umi openapi",
    "playwright": "playwright install && playwright test",
    "prepare": "husky install",
    "prettier": "prettier -c --write \"src/**/*\"",
    "serve": "umi-serve",
    "start": "cross-env UMI_ENV=dev umi dev",
    "start:dev": "cross-env REACT_APP_ENV=dev MOCK=none UMI_ENV=dev umi dev",
    "start:no-mock": "cross-env MOCK=none UMI_ENV=dev umi dev",
    "start:no-ui": "cross-env UMI_UI=none UMI_ENV=dev umi dev",
    "start:pre": "cross-env REACT_APP_ENV=pre UMI_ENV=dev umi dev",
    "start:test": "cross-env REACT_APP_ENV=test MOCK=none UMI_ENV=dev umi dev",
    "test": "umi test",
    "test:component": "umi test ./src/components",
    "test:e2e": "node ./tests/run-tests.js",
    "tsc": "tsc --noEmit"
  },
  "lint-staged": {
    "**/*.less": "stylelint --syntax less",
    "**/*.{js,jsx,ts,tsx}": "npm run lint-staged:js",
    "**/*.{js,jsx,tsx,ts,less,md,json}": [
      "prettier --write"
    ]
  },
  "browserslist": [
    "> 1%",
    "last 2 versions",
    "not ie <= 10"
  ],
  "dependencies": {
    "@ant-design/charts": "^1.4.2",
    "@ant-design/icons": "^4.7.0",
    "@ant-design/pro-components": "^1.1.21",
    "@umijs/route-utils": "^2.0.0",
    "antd": "^4.20.0",
    "classnames": "^2.3.0",
    "lodash": "^4.17.0",
    "moment": "^2.29.0",
    "omit.js": "^2.0.2",
    "rc-menu": "^9.1.0",
    "rc-util": "^5.16.0",
    "react": "^17.0.0",
    "react-dev-inspector": "^1.7.0",
    "react-dom": "^17.0.0",
    "react-helmet-async": "^1.2.0",
    "umi": "^3.5.0"
  },
  "devDependencies": {
    "@ant-design/pro-cli": "^2.1.0",
    "@playwright/test": "^1.17.0",
    "@types/classnames": "^2.3.1",
    "@types/express": "^4.17.0",
    "@types/history": "^4.7.0",
    "@types/jest": "^26.0.0",
    "@types/lodash": "^4.14.0",
    "@types/react": "^17.0.0",
    "@types/react-dom": "^17.0.0",
    "@types/react-helmet": "^6.1.0",
    "@umijs/fabric": "^2.11.1",
    "@umijs/openapi": "^1.6.0",
    "@umijs/plugin-blocks": "^2.2.0",
    "@umijs/plugin-esbuild": "^1.4.0",
    "@umijs/plugin-openapi": "^1.3.3",
    "@umijs/preset-ant-design-pro": "^1.3.0",
    "@umijs/preset-dumi": "^1.1.0",
    "@umijs/preset-react": "^2.1.0",
    "compression-webpack-plugin": "^10.0.0",
    "cross-env": "^7.0.0",
    "cross-port-killer": "^1.3.0",
    "detect-installer": "^1.0.0",
    "eslint": "^7.32.0",
    "file-loader": "^6.2.0",
    "gh-pages": "^3.2.0",
    "husky": "^7.0.4",
    "jsdom-global": "^3.0.0",
    "lint-staged": "^10.0.0",
    "mockjs": "^1.1.0",
    "prettier": "^2.5.0",
    "stylelint": "^13.0.0",
    "swagger-ui-dist": "^4.12.0",
    "typescript": "^4.5.0",
    "umi-serve": "^1.9.10",
    "url-loader": "^4.1.1"
  },
  "engines": {
    "node": ">=12.0.0"
  }
}

```

### Â© ç‰ˆæœ¬ä¿¡æ¯

- ProComponents ç‰ˆæœ¬: [1.1.21]
- umi ç‰ˆæœ¬: [3.5.32]
- æµè§ˆå™¨ç¯å¢ƒ
- å¼€å‘ç¯å¢ƒ [e.g. mac OS]

## codedart2018

çœ‹äº†ä¸‹æ˜¯request loadingæ•°æ®çš„æ—¶å€™ã€€button ç»„ä»¶ä¸Šæœ‰loadingæ’‘èµ·ï¼Œå¯¼è‡´æŠ–åŠ¨æ’‘åé¡µé¢ã€‚å¸Œæœ›ç»™ä¸ªå‚æ•°è®©buttonå˜åŒ–çš„æƒ…å†µä¸‹ä¸è¦å˜å¤§æˆ–ç¼©å°ã€‚æˆ–è€…åŠ è½½çš„æ—¶å€™ç›´æ¥ç”¨disabledæŠŠå®ƒç¦ç”¨æ‰ã€‚ç¦æ­¢äºŒæ¬¡ç‚¹å‡»ï¼

## codedart2018

æ²¡æœ‰äººå…³æ³¨å˜›ï¼@chenshuai2144

## codedart2018

æ²¡äººå˜›ï¼

## chenshuai2144

æŒ‰é’®å®½åº¦è¾¹æ¡†å¯¼è‡´çš„ï¼Œä½ æŠŠæŸ¥è¯¢æŒ‰é’®æ‰€å çš„æ ¼å­å¼„å¾—å¤§ä¸€ç‚¹

## YM-20191008

> æŒ‰é’®å®½åº¦è¾¹æ¡†å¯¼è‡´çš„ï¼Œä½ æŠŠæŸ¥è¯¢æŒ‰é’®æ‰€å çš„æ ¼å­å¼„å¾—å¤§ä¸€ç‚¹

å…·ä½“æ€ä¹ˆè®¾ç½®ï¼Œæ„Ÿè°¢

## codedart2018

>

è¿™å°±å…³é—­äº†ï¼Ÿå¼„æ ¼å­ä¸ç°å®ï¼Œæ˜¯ä½ ä»¬loadingæ’‘åçš„ã€‚å¯ä¸å¯ä»¥æ‰‹åŠ¨æ§åˆ¶logingæ ·å¼ä¸æ˜¾ç¤ºï¼
