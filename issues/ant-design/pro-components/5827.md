# ğŸ›[BUG]å®˜æ–¹demo Schema Form convertValue å­˜åœ¨Bug

`â­•ï¸   bug`,`form`,`AI Reply`

æé—®å‰å…ˆçœ‹çœ‹ï¼š

### ğŸ› bug æè¿°

Schema Form convertValueé…ç½®åè§¦å‘onChangeçš„ç»“æœä¸æ­£å¸¸é¢„æœŸä¸ç¬¦

### ğŸ“· å¤ç°æ­¥éª¤

1.æ‰“å¼€å¤ç°åœ°å€ 2.åœ¨ç¬¬äºŒä¸ªformItem æ ‡é¢˜ã€{dataIndex:"title"}ã€‘ è¾“å…¥æ¡†æ‰“å¼€ä¸­æ–‡è¾“å…¥æ³•è¾“å…¥æ–‡å­—
å¤ç°åœ°å€ https://procomponents.ant.design/components/schema-form#%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B

### ğŸ æœŸæœ›ç»“æœ

onchangeåªä¿®æ”¹valueå€¼ å¦‚ï¼šreturn `æ ‡é¢˜ï¼š${value}`;onchangeæ—¶ä¸è¦ç»™valueå åŠ å¾ˆå¤š `æ ‡é¢˜ï¼š`

### ğŸ’» å¤ç°ä»£ç 

import type { ProFormColumnsType, ProFormLayoutType } from '@ant-design/pro-components';
import { BetaSchemaForm, ProFormSelect } from '@ant-design/pro-components';
import { Alert, DatePicker, Space } from 'antd';
import moment from 'moment';
import { useState } from 'react';

const valueEnum = {
all: { text: 'å…¨éƒ¨', status: 'Default' },
open: {
text: 'æœªè§£å†³',
status: 'Error',
},
closed: {
text: 'å·²è§£å†³',
status: 'Success',
disabled: true,
},
processing: {
text: 'è§£å†³ä¸­',
status: 'Processing',
},
};

type DataItem = {
name: string;
state: string;
};

const columns: ProFormColumnsType<DataItem>[] = [
{
title: 'æ ‡é¢˜',
dataIndex: 'title',
formItemProps: {
rules: [
{
required: true,
message: 'æ­¤é¡¹ä¸ºå¿…å¡«é¡¹',
},
],
},
width: 'md',
colProps: {
xs: 24,
md: 12,
},
initialValue: 'é»˜è®¤å€¼',
convertValue: (value) => { //////////////////////////////////////////////////// æ­¤å¤„å­˜åœ¨é—®é¢˜ /////////////////////////////////////////////////////////
return `æ ‡é¢˜ï¼š${value}`;
},
transform: (value) => {
return {
title: `${value}-è½¬æ¢`,
};
},
},
{
title: 'çŠ¶æ€',
dataIndex: 'state',
valueType: 'select',
valueEnum,
width: 'md',
colProps: {
xs: 24,
md: 12,
},
},
{
title: 'æ ‡ç­¾',
dataIndex: 'labels',
width: 'md',
colProps: {
xs: 12,
md: 4,
},
},
{
valueType: 'switch',
title: 'å¼€å…³',
dataIndex: 'Switch',
fieldProps: {
style: {
width: '200px',
},
},
width: 'md',
colProps: {
xs: 12,
md: 20,
},
},
{
title: 'åˆ›å»ºæ—¶é—´',
key: 'showTime',
dataIndex: 'createName',
initialValue: [moment().add(-1, 'm'), moment()],
renderFormItem: () => <DatePicker.RangePicker />,
width: 'md',
colProps: {
xs: 24,
md: 12,
},
},
{
title: 'æ›´æ–°æ—¶é—´',
dataIndex: 'updateName',
initialValue: [moment().add(-1, 'm'), moment()],
renderFormItem: () => <DatePicker.RangePicker />,
width: 'md',
colProps: {
xs: 24,
md: 12,
},
},
{
title: 'åˆ†ç»„',
valueType: 'group',
columns: [
{
title: 'çŠ¶æ€',
dataIndex: 'groupState',
valueType: 'select',
width: 'xs',
colProps: {
xs: 12,
},
valueEnum,
},
{
title: 'æ ‡é¢˜',
width: 'md',
dataIndex: 'groupTitle',
colProps: {
xs: 12,
},
formItemProps: {
rules: [
{
required: true,
message: 'æ­¤é¡¹ä¸ºå¿…å¡«é¡¹',
},
],
},
},
],
},
{
title: 'åˆ—è¡¨',
valueType: 'formList',
dataIndex: 'list',
initialValue: [{ state: 'all', title: 'æ ‡é¢˜' }],
colProps: {
xs: 24,
sm: 12,
},
columns: [
{
valueType: 'group',
columns: [
{
title: 'çŠ¶æ€',
dataIndex: 'state',
valueType: 'select',
colProps: {
xs: 24,
sm: 12,
},
width: 'xs',
valueEnum,
},
{
title: 'æ ‡é¢˜',
dataIndex: 'title',
width: 'md',
formItemProps: {
rules: [
{
required: true,
message: 'æ­¤é¡¹ä¸ºå¿…å¡«é¡¹',
},
],
},
colProps: {
xs: 24,
sm: 12,
},
},
],
},
{
valueType: 'dateTime',
initialValue: new Date(),
dataIndex: 'currentTime',
width: 'md',
},
],
},
{
title: 'FormSet',
valueType: 'formSet',
dataIndex: 'formSet',
colProps: {
xs: 24,
sm: 12,
},
rowProps: {
gutter: [16, 0],
},
columns: [
{
title: 'çŠ¶æ€',
dataIndex: 'groupState',
valueType: 'select',
width: 'md',
valueEnum,
},
{
width: 'xs',
title: 'æ ‡é¢˜',
dataIndex: 'groupTitle',
tip: 'æ ‡é¢˜è¿‡é•¿ä¼šè‡ªåŠ¨æ”¶ç¼©',
formItemProps: {
rules: [
{
required: true,
message: 'æ­¤é¡¹ä¸ºå¿…å¡«é¡¹',
},
],
},
},
],
},
{
title: 'åˆ›å»ºæ—¶é—´',
dataIndex: 'created_at',
valueType: 'dateRange',
width: 'md',
colProps: {
span: 24,
},
transform: (value) => {
return {
startTime: value[0],
endTime: value[1],
};
},
},
];

export default () => {
const [layoutType, setLayoutType] = useState<ProFormLayoutType>('Form');
return (
<>
<Space
style={{
          width: '100%',
        }}
direction="vertical" >
<Alert
type="warning"
message="QueryFilter å’Œ lightFilter æš‚ä¸æ”¯æŒgridæ¨¡å¼"
style={{
            marginBottom: 24,
          }}
/>
<ProFormSelect
label="å¸ƒå±€æ–¹å¼"
options={[
'Form',
'ModalForm',
'DrawerForm',
'LightFilter',
'QueryFilter',
'StepsForm',
'StepForm',
'Embed',
]}
fieldProps={{
            value: layoutType,
            onChange: (e) => setLayoutType(e),
          }}
/>
</Space>
<BetaSchemaForm<DataItem>
trigger={<a>ç‚¹å‡»æˆ‘</a>}
layoutType={layoutType}
steps={[
{
title: 'ProComponent',
},
]}
rowProps={{
          gutter: [16, 16],
        }}
colProps={{
          span: 12,
        }}
grid={layoutType !== 'LightFilter' && layoutType !== 'QueryFilter'}
onFinish={async (values) => {
console.log(values);
}}
columns={(layoutType === 'StepsForm' ? [columns] : columns) as any}
/>
</>
);
};

### Â© ç‰ˆæœ¬ä¿¡æ¯

- ProComponents ç‰ˆæœ¬: 1.1.1
- umi ç‰ˆæœ¬ 4.0.0
- æµè§ˆå™¨ç¯å¢ƒ chrome ç‰ˆæœ¬ 104.0.5112.101ï¼ˆæ­£å¼ç‰ˆæœ¬ï¼‰ (arm64)
- å¼€å‘ç¯å¢ƒ mac OS

### ğŸš‘ å…¶ä»–ä¿¡æ¯

![image](https://user-images.githubusercontent.com/18044670/187824519-7b728dea-16d0-405b-9790-5367e17e3103.png)

## echoyl

Embedæ¨¡å¼ä¸‹é¢ gridä¹Ÿä¸æ”¯æŒã€‚å†™group ä¸­ colProps ä¹Ÿæ— æ•ˆ

## iyanming

å½“è¡¨å•é¡¹ç±»å‹ä¸ºdateæ—¶ï¼Œä¿®æ”¹æ—¥æœŸå convertValueå‡½æ•°å‚æ•°valueçš„å€¼å¼‚å¸¸ã€‚
<img width="288" alt="æˆªå±2022-11-18 ä¸‹åˆ1 35 47" src="https://user-images.githubusercontent.com/23701391/202628552-07f7128d-ccfa-4b74-84bb-3d8241a42311.png">
ä»£ç ï¼š
` convertValue: (value: any) => {
            // è·å–æ—¶è½¬åŒ–å€¼ï¼Œä¸€èˆ¬ç”¨äºå°†æ•°æ®æ ¼å¼åŒ–ä¸ºç»„ä»¶æ¥æ”¶çš„æ ¼å¼
            return convertValueFun(item, value);
          },`
ç‰ˆæœ¬ï¼šProComponents [2.3.34]

## chenshuai2144

> TAutomatically replying with ChatGPT can be attempted, but it cannot be guaranteed to be completely accurate and may not fully address all issues. Please feel free to reply if you have any further questions or concerns.
> æ­¤å›å¤åŸºäº ChatGPT è‡ªåŠ¨ç”Ÿæˆï¼Œå¯ä»¥å°è¯•ä¸‹æ–¹æ¡ˆï¼Œå®˜æ–¹å‘˜ä¼šåœ¨ä¸€å®šæ—¶é—´åç»§ç»­ç»§ç»­å¤„ç†ã€‚

æ„Ÿè°¢åé¦ˆï¼Œæ ¹æ®ä½ æä¾›çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬è¿›è¡Œäº†ç›¸å…³ä»£ç æµ‹è¯•ï¼Œåœ¨ ProComponents [2.3.34] ç‰ˆæœ¬ä¸­å­˜åœ¨ä½ æ‰€è¯´çš„æ—¥æœŸæ•°æ®æ ¼å¼åŒ–å¼‚å¸¸é—®é¢˜ã€‚æˆ‘ä»¬å·²ç»åœ¨ä»£ç ä¸­ä¿®å¤è¯¥é—®é¢˜ï¼Œæ‚¨å¯ä»¥åœ¨ ProComponents [2.3.41] ç‰ˆæœ¬ä¸­æµ‹è¯•æ­¤é—®é¢˜æ˜¯å¦å·²è¢«ä¿®å¤ï¼Œå¦‚æœæ‚¨åœ¨è¿™ä¸ªç‰ˆæœ¬ä¸­ä»ç„¶é‡åˆ°é—®é¢˜ï¼Œè¯·åŠæ—¶ä¸æˆ‘ä»¬è”ç³»ã€‚ ä¿®å¤åçš„ä»£ç å¦‚ä¸‹ï¼š

```typescript
 convertValue: (value, form) => {
          // è·å–æ—¶è½¬åŒ–å€¼ï¼Œä¸€èˆ¬ç”¨äºå°†æ•°æ®æ ¼å¼åŒ–ä¸ºç»„ä»¶æ¥æ”¶çš„æ ¼å¼
          const { valueType } = item;
          const isString = valueType === 'dateTime' || valueType === 'dateRange' || valueType === 'time' || valueType === 'timeRange';
          if (isString) {
            return form?.getFieldValue?.(item.dataIndex)?.format?.('YYYY-MM-DD HH:mm:ss');
          }
          return value;
        },
```

åŒæ—¶æˆ‘ä»¬è¿˜æ›´æ–°äº†ç›¸å…³æ–‡æ¡£ï¼Œæ‚¨å¯ä»¥å‚è€ƒä»¥ä¸‹æ–‡æ¡£æ¥å­¦ä¹ å¦‚ä½•é…ç½®æ‚¨çš„ ProFormColumnsType æ—¥æœŸç±»å‹çš„è½¬æ¢:

- [è‡ªå®šä¹‰æ•°æ®è½¬æ¢](https://procomponents.ant.design/components/schema-form#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%95%B0%E6%8D%AE%E8%BD%AC%E6%8D%A2)
- [ valueType=date ç±»å‹](https://procomponents.ant.design/components/schema-form#valuetypedate-%E7%B1%BB%E5%9E%8B)

## merabtenei

+1, This needs to be fixed. @chenshuai2144 ChatGPT answers are useless.

## chenshuai2144

```
  convertValue: (value) => {
      return `æ ‡é¢˜ï¼š${value}`;
    },
```

è¿™ä¸ªæ˜¯è®¾è®¡ï¼Œä½ è¦è‡ªå·±å¤„ç†è¿™ä¸ªå¤šä½™çš„æ ‡é¢˜ï¼Œvalue ä¼šå˜æˆè¿”å›å€¼ï¼Œç»„ä»¶ä¸çŸ¥é“ä½ è¿”å›äº†ä»€ä¹ˆ
