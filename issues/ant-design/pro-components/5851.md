# ğŸ›[BUG] antd 4 ä¸­æœªæš´éœ² themeï¼Œç¼–è¯‘æŠ¥é”™

`ğŸ§±  antd`

æé—®å‰å…ˆçœ‹çœ‹ï¼š

https://github.com/ryanhanwu/How-To-Ask-Questions-The-Smart-Way/blob/main/README-zh_CN.md

### ğŸ› bug æè¿°

[import { ConfigProvider as AntdConfigProvider, theme as antdTheme } from 'antd';](https://github.com/ant-design/pro-components/blob/master/packages/provider/src/index.tsx#L2)

Antd 4 ä¸­æœªæš´éœ² theme å±æ€§ï¼Œå½“å‰ç¼–è¯‘æŠ¥é”™

### Â© ç‰ˆæœ¬ä¿¡æ¯

- @ant-design/pro-provider @ 2.0.2

### ğŸš‘ å…¶ä»–ä¿¡æ¯

<img width="521" alt="image" src="https://user-images.githubusercontent.com/19386356/188264997-e98630e5-e992-442b-89f0-e57505d0278d.png">

## liuhuapiaoyuan

è¿™ä¸ªé—®é¢˜å¤ªå‘äº†ã€‚ã€‚è¿™2å¤©æ­£å¥½åœ¨å¼„ã€‚ã€‚ã€‚ç»“æœç»™å¡ä½äº†

## hustcer

è¿™ä¸ªä»€ä¹ˆæ—¶å€™èƒ½ä¿®å¤å‘¢ï¼Ÿç­‰ç€ç”¨ï¼Œè°¢è°¢

## hqwlkj

åŒé—®

## xukechu

ç¡®å®æœ‰è¿™ä¸ªé—®é¢˜ï¼Œæš‚æ—¶å†™äº†ä¸ªè„šæœ¬å¯åŠ¨å‰åœ¨ESæ–‡ä»¶å†™å…¥äº†export const theme = null;ä¸´æ—¶è§£å†³äº†ä¸‹ï¼Œä¸ç„¶viteä¸‹å®Œå…¨ç”¨ä¸äº†ã€‚

## baidan4855

> ç¡®å®æœ‰è¿™ä¸ªé—®é¢˜ï¼Œæš‚æ—¶å†™äº†ä¸ªè„šæœ¬å¯åŠ¨å‰åœ¨ESæ–‡ä»¶å†™å…¥äº†export const theme = null;ä¸´æ—¶è§£å†³äº†ä¸‹ï¼Œä¸ç„¶viteä¸‹å®Œå…¨ç”¨ä¸äº†ã€‚

ç…§ä½ çš„æ–¹æ³•å¤„ç†å®Œä»¥åè¿˜ä¼šæœ‰æ–°çš„é”™è¯¯
`Remix App Server started at http://localhost:3000 (http://172.16.0.232:3000)
/Users/user/test-proj/node_modules/@ant-design/pro-components/es/index.js:1
export \* from '@ant-design/pro-card';
^^^^^^

SyntaxError: Unexpected token 'export'
at wrapSafe (internal/modules/cjs/loader.js:1001:16)
at Module.\_compile (internal/modules/cjs/loader.js:1049:27)
at Object.Module.\_extensions..js (internal/modules/cjs/loader.js:1114:10)
at Module.load (internal/modules/cjs/loader.js:950:32)
at Function.Module.\_load (internal/modules/cjs/loader.js:790:14)
at Module.require (internal/modules/cjs/loader.js:974:19)
at require (internal/modules/cjs/helpers.js:92:18)
at Object.<anonymous> (/Users/user/test-proj/app/routes/index.jsx:2:38)
at Module.\_compile (internal/modules/cjs/loader.js:1085:14)
at Object.Module.\_extensions..js (internal/modules/cjs/loader.js:1114:10)
GET / 500 - - 38.846 ms`

## xukechu

>

æ˜¯åœ¨antd/es/index.jsæ–‡ä»¶ä¸‹è¿½åŠ ä¸€ä¸ª"export const theme = null;"

## xukechu

> > ç¡®å®æœ‰è¿™ä¸ªé—®é¢˜ï¼Œæš‚æ—¶å†™äº†ä¸ªè„šæœ¬å¯åŠ¨å‰åœ¨ESæ–‡ä»¶å†™å…¥äº†export const theme = null;ä¸´æ—¶è§£å†³äº†ä¸‹ï¼Œä¸ç„¶viteä¸‹å®Œå…¨ç”¨ä¸äº†ã€‚
>
> ç…§ä½ çš„æ–¹æ³•å¤„ç†å®Œä»¥åè¿˜ä¼šæœ‰æ–°çš„é”™è¯¯ `Remix App Server started at http://localhost:3000 (http://172.16.0.232:3000) /Users/user/test-proj/node_modules/@ant-design/pro-components/es/index.js:1 export \* from '@ant-design/pro-card'; ^^^^^^
>
> SyntaxError: Unexpected token 'export' at wrapSafe (internal/modules/cjs/loader.js:1001:16) at Module.\_compile (internal/modules/cjs/loader.js:1049:27) at Object.Module.\_extensions..js (internal/modules/cjs/loader.js:1114:10) at Module.load (internal/modules/cjs/loader.js:950:32) at Function.Module.\_load (internal/modules/cjs/loader.js:790:14) at Module.require (internal/modules/cjs/loader.js:974:19) at require (internal/modules/cjs/helpers.js:92:18) at Object. (/Users/user/test-proj/app/routes/index.jsx:2:38) at Module.\_compile (internal/modules/cjs/loader.js:1085:14) at Object.Module.\_extensions..js (internal/modules/cjs/loader.js:1114:10) GET / 500 - - 38.846 ms`

`import path from "path";
import fs from "fs/promises";

/\*\*

- antd es/index.jsæ–‡ä»¶æ‰“ä¸ª export const theme = null; è¡¥ä¸é¿å…pro-xç»„ä»¶å¤±è´¥
- \*/
  async function shim() {
  const esFilePath = path.resolve(
  process.cwd(),
  "node_modules/antd/es/index.js"
  );
  try {
  const result = await fs.readFile(esFilePath, "utf-8");
  if (!result.includes("export const theme = null")) {
  await fs.appendFile(esFilePath, `export const theme = null;`, "utf-8");
  }
  } catch (e) {
  console.error(e);
  }
  }

shim();
`

## baidan4855

æˆ‘ç›´æ¥æŠŠè¿™ä¸ªæ–‡ä»¶ä¿®æ”¹äº†ä¸‹ï¼Œåœ¨æœ«å°¾åŠ ä¸Šè¿™ä¸ªå¯¼å‡ºï¼Œä¸è¿‡æˆ‘æ˜¯ç”¨çš„remixä¸æ˜¯viteã€‚

## hqwlkj

>

è¿™ä¸ªé…ç½®æ˜¯æ·»åŠ åœ¨å“ªé‡Œçš„ï¼Ÿ

@xukechu

## xukechu

> >
>
> è¿™ä¸ªé…ç½®æ˜¯æ·»åŠ åœ¨å“ªé‡Œçš„ï¼Ÿ
>
> @xukechu

node_modules/antd/es/index.js

## hqwlkj

> > >
> >
> > è¿™ä¸ªé…ç½®æ˜¯æ·»åŠ åœ¨å“ªé‡Œçš„ï¼Ÿ
> > @xukechu
>
> node_modules/antd/es/index.js

æ²¡æœ‰ä»€ä¹ˆä½œç”¨ï¼Œä¼šå¯¼è‡´å…¶ä»–é—®é¢˜çš„å‡ºç°ï¼Œæˆ‘ä»¥å‰æ˜¯ä½¿ç”¨ vite ä¸€ç›´æŠ¥é”™ï¼Œç°åœ¨æ¢æˆäº† umi æ²¡æœ‰æŠ¥é”™äº†ã€‚

## Chastrlove

https://github.com/ant-design/pro-components/issues/5762#issuecomment-1240310513

## faner11

```
import react from '@vitejs/plugin-react'
import { readFile } from 'fs/promises'
import * as path from 'path'
import { defineConfig } from 'vite'
import ignoreStylePlugin from 'vite-ignore-style'

// https://vitejs.dev/config/
export default defineConfig({
  base: '/indexed-algorithm/',
  plugins: [
    react(),
    ignoreStylePlugin({
      libraryName: 'antd'
    }),
    {
      // å‡çº§antd 5 ååˆ é™¤
      name: 'add-missing-theme',
      apply: 'build',
      transform: (code, id) => {
        const reg = /antd(?:\/|\\{1,2})es(?:\/|\\{1,2})index\.js/
        if (reg.test(id)) {
          return `${code}\nexport const theme = undefined;`
        }
        return code
      }
    }
  ],
  css: {
    preprocessorOptions: {
      less: {
        modifyVars: {
          '@root-entry-name': 'variable'
        },
        javascriptEnabled: true
      }
    }
  },
  resolve: {
    alias: [
      { find: /^~/, replacement: '' },
      {
        find: '@',
        replacement: path.resolve(__dirname, 'src')
      }
    ]
  },
  optimizeDeps: {
    esbuildOptions: {
      plugins: [
        {
        // å‡çº§antd 5 ååˆ é™¤
          name: 'add-missing-theme',
          setup(build) {
            build.onLoad(
              { filter: /antd(?:\/|\\{1,2})es(?:\/|\\{1,2})index\.js/ },
              async (args) => {
                const text = await readFile(args.path, 'utf8')
                return {
                  contents: `${text}\nexport const theme = undefined;`,
                  loader: 'js'
                }
              }
            )
          }
        }
      ]
    }
  }
})

```

## chenshuai2144

ä¸‹ä¸ªç‰ˆæœ¬çš„antd ä¼šæ”¯æŒä¸€ä¸‹ï¼Œå¤§å®¶ç­‰ä¸€ç­‰

## hsbtr

> ä¸‹ä¸ªç‰ˆæœ¬çš„antd ä¼šæ”¯æŒä¸€ä¸‹ï¼Œå¤§å®¶ç­‰ä¸€ç­‰

åœ¨pro-components@2.3.30ä¸­è¿˜æ˜¯ä¼šå‡ºç°è¿™ä¸ªé”™è¯¯ï¼Œæœ‰ä»€ä¹ˆä¸´æ—¶ä¿®å¤æ–¹æ³•å—

## chenshuai2144

å…³æ‰ babel import

## Boyceman

> ä¸‹ä¸ªç‰ˆæœ¬çš„antd ä¼šæ”¯æŒä¸€ä¸‹ï¼Œå¤§å®¶ç­‰ä¸€ç­‰

å“ªä¸ªç‰ˆæœ¬çš„antdå¯ä»¥ï¼Ÿ

## hsbtr

> > ä¸‹ä¸ªç‰ˆæœ¬çš„antd ä¼šæ”¯æŒä¸€ä¸‹ï¼Œå¤§å®¶ç­‰ä¸€ç­‰
>
> å“ªä¸ªç‰ˆæœ¬çš„antdå¯ä»¥ï¼Ÿ

antd 5.xçš„è¿™ä¸ªé—®é¢˜å·²ç»æ²¡æœ‰

## Boyceman

> > > ä¸‹ä¸ªç‰ˆæœ¬çš„antd ä¼šæ”¯æŒä¸€ä¸‹ï¼Œå¤§å®¶ç­‰ä¸€ç­‰
> >
> > å“ªä¸ªç‰ˆæœ¬çš„antdå¯ä»¥ï¼Ÿ
>
> antd 5.xçš„è¿™ä¸ªé—®é¢˜å·²ç»æ²¡æœ‰

è¯·é—®4.xæœ‰æ²¡æœ‰å¥½ç”¨çš„ç‰ˆæœ¬å‘¢ï¼Ÿå› ä¸ºå‡çº§antdç‰µä¸€å‘åŠ¨å…¨èº«ï¼Œä¸æ•¢å¦„åŠ¨ä¸»è¦æ˜¯ğŸ˜‚

## hsbtr

> > > > ä¸‹ä¸ªç‰ˆæœ¬çš„antd ä¼šæ”¯æŒä¸€ä¸‹ï¼Œå¤§å®¶ç­‰ä¸€ç­‰
> > >
> > > å“ªä¸ªç‰ˆæœ¬çš„antdå¯ä»¥ï¼Ÿ
> >
> > antd 5.xçš„è¿™ä¸ªé—®é¢˜å·²ç»æ²¡æœ‰
>
> è¯·é—®4.xæœ‰æ²¡æœ‰å¥½ç”¨çš„ç‰ˆæœ¬å‘¢ï¼Ÿå› ä¸ºå‡çº§antdç‰µä¸€å‘åŠ¨å…¨èº«ï¼Œä¸æ•¢å¦„åŠ¨ä¸»è¦æ˜¯ğŸ˜‚
> è¿™ä¸ªå°±ä¸æ¸…æ¥šäº†ï¼Œå¯ä»¥å°è¯•æ›´åˆ°æœ€æ–°çš„4.xç‰ˆæœ¬
