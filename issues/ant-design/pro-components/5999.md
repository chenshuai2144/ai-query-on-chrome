# 使用ProFrom配合ProFormUploadButton时通过formRef获取的最后一个文件状态始终是uploading

`AI Reply`

提问前先看看：

https://github.com/ryanhanwu/How-To-Ask-Questions-The-Smart-Way/blob/main/README-zh_CN.md

### 🐛 bug 描述

<!--
详细地描述 bug，让大家都能理解
-->

### 📷 复现步骤

<!--
清晰描述复现步骤，让别人也能看到问题，如果可能，尽量提供可执行代码，
如：https://codesandbox.io/ 在此处创建一个 codesandbox，方便我们更快的排查和复现问题
-->

https://codesandbox.io/s/loving-silence-29j75j?file=/src/App.tsx:0-1075

### 🏞 期望结果

<!--
描述你原本期望看到的结果
-->

### 💻 复现代码

<!--
提供可复现的代码，仓库，或线上示例
-->

### © 版本信息

- ProComponents 版本: [e.g. 4.0.0]
- umi 版本
- 浏览器环境
- 开发环境 [e.g. mac OS]

### 🚑 其他信息

<!--
如截图等其他信息可以贴在这里
-->

![Uploading image.png…]()

## chenshuai2144

> TAutomatically replying with ChatGPT can be attempted, but it cannot be guaranteed to be completely accurate and may not fully address all issues. Please feel free to reply if you have any further questions or concerns.
> 此回复基于 ChatGPT 自动生成，可以尝试下方案，官方员会在一定时间后继续继续处理。

针对您提供的代码示例，问题可能出在上传文件的状态没有被正确改变。您可以尝试添加一个 onChange 回调函数来获取上传文件的状态并更新组件状态。例如：

```jsx
const handleChange = (info: any) => {
  if (info.file.status === "done") {
    message.success(`${info.file.name} 文件上传成功`);
  } else if (info.file.status === "error") {
    message.error(`${info.file.name} 文件上传失败`);
  }
  // 更新组件状态
  setFileList(info.fileList);
};

<ProFormUploadButton
  name="fileList"
  label="文件上传"
  action="https://www.mocky.io/v2/5cc8019d300000980a055e76"
  listType="picture-card"
  fileList={fileList}
  onChange={handleChange} // 添加 onChange 回调函数
>
  <PlusOutlined />
</ProFormUploadButton>;
```

此外，推荐您阅读 Ant Design Pro Form 官方文档中的 Upload 提交到后台一节，了解如何将上传文件提交到后台处理。希望能对您有所帮助。

## chenshuai2144

再晚一点去拿 就可以了。form里面存的是onchange的数据，是由一定的延时的
