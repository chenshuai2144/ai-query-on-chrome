# ğŸ›[BUG] ProTableå¯¹äºselectçš„valueTypeï¼Œç‚¹å‡»è¡Œå–æ¶ˆï¼Œå†ç‚¹å‡»ç¼–è¾‘ï¼Œä¼šå‡ºç°æŠ¥é”™

`â­•ï¸   bug`,`table`,`AI Reply`

### ğŸ› bug æè¿°

è¿™é‡Œçš„ä»£ç æœ‰é—®é¢˜ï¼Œä¸åº”è¯¥ç›´æ¥ä½¿ç”¨rowçš„æ•°æ®ï¼Œè¿™æ ·çš„è¯ä¼šç»•è¿‡renderTextæ–¹æ³•
https://github.com/ant-design/pro-components/blob/master/packages/utils/src/useEditableArray/index.tsx#L424

<!--
è¯¦ç»†åœ°æè¿° bugï¼Œè®©å¤§å®¶éƒ½èƒ½ç†è§£
-->

### ğŸ“· å¤ç°æ­¥éª¤

1. å…ˆç‚¹å‡»editï¼Œä»€ä¹ˆä¹Ÿä¸åšï¼Œå±•ç¤ºç¬¦åˆé¢„æœŸ
   ![image](https://user-images.githubusercontent.com/26563778/193309510-8f94a9f1-0d62-4d37-b212-d8120041ebc8.png)
   ![image](https://user-images.githubusercontent.com/26563778/193309630-97076804-cb61-4a01-9862-6b7eb0524989.png)

2. ç„¶åç‚¹å‡»å–æ¶ˆè¿˜åŸï¼Œç¬¦åˆé¢„æœŸ

3. å†ç‚¹å‡»ç¼–è¾‘ï¼Œå‡ºé”™äº†
   ![image](https://user-images.githubusercontent.com/26563778/193309748-1b4bf6bf-1fca-4978-bd55-a9ec7dd50457.png)

<!--
æ¸…æ™°æè¿°å¤ç°æ­¥éª¤ï¼Œè®©åˆ«äººä¹Ÿèƒ½çœ‹åˆ°é—®é¢˜ï¼Œå¦‚æœå¯èƒ½ï¼Œå°½é‡æä¾›å¯æ‰§è¡Œä»£ç ï¼Œ
å¦‚ï¼šhttps://codesandbox.io/ åœ¨æ­¤å¤„åˆ›å»ºä¸€ä¸ª codesandboxï¼Œæ–¹ä¾¿æˆ‘ä»¬æ›´å¿«çš„æ’æŸ¥å’Œå¤ç°é—®é¢˜
-->

### ğŸ æœŸæœ›ç»“æœ

ç¬¬3æ­¥åº”è¯¥å’Œç¬¬1æ­¥å±•ç¤ºçš„æ•ˆæœä¸€è‡´

<!--
æè¿°ä½ åŸæœ¬æœŸæœ›çœ‹åˆ°çš„ç»“æœ
-->

### ğŸ’» å¤ç°ä»£ç 

è¿™æ˜¯æˆ‘çš„åˆ—é…ç½®ï¼Œä½¿ç”¨renderTextå±æ€§æ¥è®©selectç»„ä»¶å¾—åˆ° string[] ç±»å‹çš„value

```javascript
{
        title: 'Team Admin',
        dataIndex: 'admin_identity_list',
        fieldProps: {
          showSearch: true,
          loading: isLoading,
          options: data?.map(({ identity_id, username }) => ({
            value: identity_id,
            label: username,
          })),
          mode: 'multiple',
          placeholder: 'search by team admin',
        },
        valueType: 'select',
        formItemProps: {
          rules: [{ required: true, message: 'Please select team admin!' }],
        },
        renderText: (_, record) => record.admin_identity_list.map((user) => user.id),
        render: (_, record) => (
          <Space>
            {record.admin_identity_list.map((user) => (
              <Tag key={user.id}>{user.user.username}</Tag>
            ))}
          </Space>
        ),
      },
```

<!--
æä¾›å¯å¤ç°çš„ä»£ç ï¼Œä»“åº“ï¼Œæˆ–çº¿ä¸Šç¤ºä¾‹
-->

### Â© ç‰ˆæœ¬ä¿¡æ¯

- ProComponents ç‰ˆæœ¬: [e.g. 4.0.0]
- umi ç‰ˆæœ¬
- æµè§ˆå™¨ç¯å¢ƒ
- å¼€å‘ç¯å¢ƒ [e.g. mac OS]

### ğŸš‘ å…¶ä»–ä¿¡æ¯

<!--
å¦‚æˆªå›¾ç­‰å…¶ä»–ä¿¡æ¯å¯ä»¥è´´åœ¨è¿™é‡Œ
-->

## ahungrynoob

```javascript
{
        title: 'action',
        valueType: 'option',
        key: 'option',
        render: (_text, record, _index, action) => [
          <a
            key="edit"
            // eslint-disable-next-line react/jsx-no-bind
            onClick={() => {
              // here we hack bug: https://github.com/ant-design/pro-components/issues/6024
              form.setFieldValue([record.id, 'admin_identity_list'], record.admin_identity_list.map(user=>user.id))
              action?.startEditable?.(record.id)
            }}
          >
            Edit
          </a>,
        ],
      },
```

å¯ä»¥æš‚æ—¶è¿™ä¹ˆç»•ï¼Œä½†æ€»è§‰å¾—ä¸å¤ªå¥½

## chenshuai2144

> TAutomatically replying with ChatGPT can be attempted, but it cannot be guaranteed to be completely accurate and may not fully address all issues. Please feel free to reply if you have any further questions or concerns.
> æ­¤å›å¤åŸºäº ChatGPT è‡ªåŠ¨ç”Ÿæˆï¼Œå¯ä»¥å°è¯•ä¸‹æ–¹æ¡ˆï¼Œå®˜æ–¹å‘˜ä¼šåœ¨ä¸€å®šæ—¶é—´åç»§ç»­ç»§ç»­å¤„ç†ã€‚

ä½ å¥½ï¼Œæ„Ÿè°¢ä½ çš„åé¦ˆã€‚ç±»ä¼¼è¿™ç§ bug é€šå¸¸æ˜¯é€»è¾‘ä¸Šçš„é—®é¢˜ï¼Œéœ€è¦é€ä¸ªæ’æŸ¥è§£å†³ï¼Œä¸‹é¢è¿‡ç¨‹è¯·å‚è€ƒã€‚

é¦–å…ˆï¼Œæ ¹æ®æè¿°ä»¥åŠå…¶ä¸­æä¾›çš„ä»£ç ï¼Œå¯ä»¥çœ‹å‡ºå¯èƒ½æ˜¯å› ä¸º row çš„æ•°æ®ä¸ renderText æ–¹æ³•è·å–åˆ°æ•°æ®å­˜åœ¨å‡ºå…¥ï¼Œå¯¼è‡´å‡ºç°é”™è¯¯ã€‚

åœ¨ renderText ä¸­ï¼Œå‡è®¾å¯¹åº”çš„å­—æ®µä¸º columnï¼Œåœ¨ value type ä¸º 'select' æ—¶ï¼Œä»£ç å°±æ˜¯è¿™æ ·çš„ï¼š

```javascript
(_, row) => row[column].map((value) => value.id);
```

ç„¶è€Œï¼Œåœ¨ useEditableArray çš„ startEditable æ–¹æ³•ä¸­ï¼Œä¼šå†æ¬¡è°ƒç”¨ renderTextï¼Œè€Œæ­¤æ—¶ä¼ å…¥çš„ row æ•°æ®åªåŒ…å«äº†è¢«ç¼–è¾‘çš„é‚£è¡Œæ•°æ®ï¼Œè¿™å¯¼è‡´äº†ä»¥ä¸‹é”™è¯¯ï¼š

```javascript
Uncaught TypeError: undefined is not iterable (cannot read property [Symbol.iterator])
```

å› æ­¤æˆ‘ä»¬éœ€è¦ç»è¿‡ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤æ¥è§£å†³è¿™ä¸ªé”™è¯¯ã€‚

1. è°ƒè¯•å‡ºé—®é¢˜æ‰€åœ¨ã€‚æ ¹æ®é”™è¯¯ä¿¡æ¯ï¼Œæˆ‘ä»¬é€šå¸¸å¯ä»¥æ–­è¨€æ­¤é—®é¢˜æ˜¯å› ä¸º row[column] ä¸ºç©ºæˆ–ä¸å­˜åœ¨å¯¼è‡´çš„ã€‚å› æ­¤ï¼Œåœ¨ startEditable å‰æ‰€åœ¨çš„è°ƒç”¨é“¾ä¸­æ·»åŠ  console.logï¼Œä»¥è·å–æˆ‘ä»¬ä¼ å…¥ startEditable ä¸­çš„ row æ—¶ï¼Œ row[column] çš„å€¼ï¼Œä»¥æ­¤ç¡®è®¤ç»“è®ºã€‚

2. ç¡®è®¤é—®é¢˜å¯èƒ½å‡ºç°çš„èŒƒå›´ã€‚åœ¨ç¡®è®¤é—®é¢˜æ‰€åœ¨åï¼Œéœ€è¦è€ƒè™‘æ­¤é—®é¢˜æ˜¯å¦å¯èƒ½å‡ºç°åœ¨å…¶ä»–çš„åœ°æ–¹ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ renderText çš„é€»è¾‘å¯ä»¥å°† row[column] æ˜ç¡®è½¬æ¢ä¸º id æ•°ç»„ï¼Œè€Œä½¿ç”¨ç›¸åŒæ•°æ®çš„åœ°æ–¹æ²¡åšè¿™ä¸ªå·¥ä½œï¼Œä¹Ÿè®¸æ˜¯å…¶ä»–åœ°æ–¹çš„ bug æ‰€å¯¼è‡´çš„ã€‚è¯·å°è¯•è€ƒè™‘æ•°æ®ä¼ é€’çš„å„ä¸ªç‚¹ã€‚

3. é€šè¿‡å¯åŠ¨å¯ç¼–è¾‘æ¨¡å¼ä¹‹å‰çš„é€»è¾‘æ¥ä¿®æ­£é—®é¢˜ã€‚ç”±äºæ­¤é—®é¢˜ä¸ä»£ç çš„è¡Œä¸ºç¼ºé™·/ååŒäº’åŠ¨æœ‰å…³ï¼Œå¦‚æœä¿®æ­£æ­¤é—®é¢˜å¯èƒ½å¯¼è‡´å…¶ä»–é—®é¢˜çš„å‡ºç°ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åº”è¯¥åœ¨è°ƒç”¨ startEditable å‰çš„é€»è¾‘ä¸­è¿›è¡Œä¿®æ­£ï¼Œå¹¶å°½å¯èƒ½å°‘çš„ä¿®æ”¹ã€‚è¯·æ ¹æ®ç¬¬ä¸€æ­¥ä¸­çš„æ—¥å¿—ä¿¡æ¯ï¼Œè€ƒè™‘åœ¨è°ƒç”¨ startEditable ä¹‹å‰é’ˆå¯¹ row[column] çš„é—®é¢˜è¿›è¡Œä¿®æ­£ã€‚å¯èƒ½ä¼šä½¿ç”¨æ•°æ®è½¬æ¢æˆ–å…¶ä»–è¡Œä¸ºã€‚

## chenshuai2144

æ‰“å¼€ labelInValue åº”è¯¥å°±èƒ½è§£å†³ä½ çš„é—®é¢˜äº†ï¼Œæˆ–è€…ç”¨ coverValueï¼Œè¿™æ ·æ¯æ¬¡ç¼–è¾‘éƒ½èƒ½è½¬åŒ–ä¸€ä¸‹
