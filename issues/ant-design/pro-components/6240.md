# ğŸ›[BUG] [Pro-Table] rowSelectionè®¾ç½®preserveSelectedRowKeysä¸ºtrueï¼Œç¿»é¡µåªä¿ç•™äº†rowKeysæ²¡æœ‰ä¿ç•™rows

`â­•ï¸   bug`,`table`,`AI Reply`

æé—®å‰å…ˆçœ‹çœ‹ï¼š

https://github.com/ryanhanwu/How-To-Ask-Questions-The-Smart-Way/blob/main/README-zh_CN.md

### ğŸ› bug æè¿°

owSelectionè®¾ç½®preserveSelectedRowKeysä¸ºtrueï¼Œç¿»é¡µåªä¿ç•™äº†rowKeysçš„å€¼æ²¡æœ‰ä¿ç•™rowsçš„å€¼

### ğŸ“· å¤ç°æ­¥éª¤

1. è®¾ç½®pro-table rowSelection.preserveSelectedRowKeys = true
2. è®¾ç½®pro-table toolBarRender={(action, { selectedRows, selectedRowKeys }) => {
   console.log('selectedRows: ', selectedRowKeys, selectedRows)
   return <div />
   }}
3. ç¬¬ä¸€é¡µé€‰ä¸­å‡ ä¸ªï¼Œç¿»é¡µå¼‚æ­¥è·å–æ•°æ®ï¼Œç»§ç»­é€‰ä¸­å‡ ä¸ªï¼ŒæŸ¥çœ‹æ§åˆ¶å°
   <img width="510" alt="image" src="https://user-images.githubusercontent.com/27920863/202430940-7a796cba-463c-4c21-a4e7-5c581b551d8b.png">

### ğŸ æœŸæœ›ç»“æœ

è®¾ç½® rowSelection.preserveSelectedRowKeys = trueæ—¶ï¼ŒrowKeys å’Œ rows çš„å€¼éƒ½èƒ½å¾—åˆ°ä¿ç•™

### ğŸ’» å¤ç°ä»£ç 

æºç ç›¸å…³ä¿¡æ¯, æ¯æ¬¡ dataSource å˜åŒ– preserveRecordsRef å’Œ newCache éƒ½ä¼šå˜ï¼Œ å¯¼è‡´ selectedRowsRef åªèƒ½æ‹¿åˆ°å½“å‰é¡µçš„ rowsæ•°æ®
<img width="548" alt="image" src="https://user-images.githubusercontent.com/27920863/202431158-80e571b1-b6c1-4aeb-a2dc-e3fdc44c585f.png">

### Â© ç‰ˆæœ¬ä¿¡æ¯

- ProComponents ç‰ˆæœ¬: [2.3.34]
- æµè§ˆå™¨ç¯å¢ƒ chrome 100+
- å¼€å‘ç¯å¢ƒ [ mac OS]

### ğŸš‘ å…¶ä»–ä¿¡æ¯

antd 5.0.0-rc.1

## luotongzhou

è™½ç„¶å¯ä»¥åœ¨ rowSelection.onChange äº‹ä»¶é€šè¿‡å—æ§æ–¹å¼è§£å†³çš„æˆ‘çš„éœ€æ±‚ï¼Œä½†æ— ç–‘å¢åŠ äº†æ•´ä¸ªé¡µé¢çš„æ¸²æŸ“è´Ÿæ‹…ï¼Œæ¯•ç«Ÿé™¤äº†è¡¨æ ¼è¿˜ä¼šæœ‰å…¶ä»–ç»„ä»¶åœ¨å½“å‰é¡µé¢

## chenshuai2144

> TAutomatically replying with ChatGPT can be attempted, but it cannot be guaranteed to be completely accurate and may not fully address all issues. Please feel free to reply if you have any further questions or concerns.
> æ­¤å›å¤åŸºäº ChatGPT è‡ªåŠ¨ç”Ÿæˆï¼Œå¯ä»¥å°è¯•ä¸‹æ–¹æ¡ˆï¼Œå®˜æ–¹å‘˜ä¼šåœ¨ä¸€å®šæ—¶é—´åç»§ç»­ç»§ç»­å¤„ç†ã€‚

å¯¹äº `ProTable` ç»„ä»¶ä¸­çš„ `rowSelection` è®¾ç½® `preserveSelectedRowKeys` å±æ€§ä¸º `true` åï¼Œåœ¨ç¿»é¡µæ—¶åªä¿ç•™äº† `rowKeys` è€Œæ²¡æœ‰ä¿ç•™ `rows` çš„é—®é¢˜ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ä¸ªæ­¥éª¤è§£å†³ï¼š

1. åœ¨è¿™ä¸ª `ProTable` ç»„ä»¶çš„ state ä¸­å¢åŠ ä¸€ä¸ª `selectedRows` çš„æ•°ç»„ï¼Œç”¨æ¥å­˜å‚¨é€‰ä¸­çš„æ‰€æœ‰è¡Œæ•°æ®ã€‚

```jsx
const [selectedRows, setSelectedRows] = useState([]);
```

2. åœ¨ `rowSelection` çš„ `onChange` äº‹ä»¶ä¸­ï¼Œæ›´æ–°è¿™ä¸ª `selectedRows` çš„å€¼ã€‚

```jsx
const rowSelection = {
  onChange: (selectedRowKeys, selectedRows) => {
    setSelectedRows(selectedRows);
  },
  selectedRowKeys,
  type: 'checkbox',
  preserveSelectedRowKeys: true,
};

return (
  <ProTable
    ...
    rowSelection={rowSelection}
    dataSource={dataSource}
    // åœ¨ ProTable ä¸­å¢åŠ  onSelectRow å‡½æ•°æ¥è®°å½•é€‰ä¸­çš„è¡Œæ•°æ®
    onSelectRow={(record, selected, selectedRows) => {
      setSelectedRows(selectedRows);
    }}
    ...
  />
);
```

è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨ `selectedRows` æ•°ç»„ä¸­å­˜å‚¨æ‰€æœ‰é€‰ä¸­çš„è¡Œæ•°æ®ï¼Œå¹¶åœ¨ç¿»é¡µæ—¶ä¿ç•™ä¸‹æ¥ã€‚å¦å¤–ï¼Œ`onSelectRow` å‡½æ•°ä¹Ÿå¾ˆå…³é”®ï¼Œå®ƒè®°å½•äº†é€‰ä¸­çš„æ‰€æœ‰è¡Œæ•°æ®ï¼Œå¹¶è§¦å‘äº† `rowSelection` çš„ `onChange` äº‹ä»¶ï¼Œä»è€Œæ›´æ–°äº† `selectedRows` æ•°ç»„çš„å€¼ã€‚

å‚è€ƒæ–‡æ¡£ï¼š

- [antd pro-table çš„rowSelection è¿˜åŸé€‰ä¸­æ•°æ®](https://blog.csdn.net/weixin_47368643/article/details/113874657)

## chenshuai2144

å·²ç»å…¨éƒ¨ä½¿ç”¨äº†antdçš„è¯­æ³•äº†ï¼Œå†è¯•è¯•
