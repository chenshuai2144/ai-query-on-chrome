# ğŸ›[BUG]ProLayout does not work with React 18

`â­•ï¸   bug`,`layout`

æé—®å‰å…ˆçœ‹çœ‹ï¼š

https://github.com/ryanhanwu/How-To-Ask-Questions-The-Smart-Way/blob/main/README-zh_CN.md

### ğŸ› bug æè¿°

å‡çº§åˆ°React 18å, ProLayoutæ— æ³•æ¸²æŸ“ï¼ŒæŸ¥çœ‹æµè§ˆå™¨é‡Œé¢çš„æ—¥å¿—ï¼Œå‡ºç°å¾ˆå¤šé”™è¯¯ï¼š
index.mjs:634 Uncaught TypeError: Cannot read properties of undefined (reading '0')
at useSWRHandler (index.mjs:634:1)
at useSWRArgs (index.mjs:612:1)
at BaseProLayout (ProLayout.js:201:1)
at renderWithHooks (react-dom.development.js:16305:1)
at updateFunctionComponent (react-dom.development.js:19588:1)
at beginWork (react-dom.development.js:21601:1)
at HTMLUnknownElement.callCallback (react-dom.development.js:4164:1)
at Object.invokeGuardedCallbackDev (react-dom.development.js:4213:1)
at invokeGuardedCallback (react-dom.development.js:4277:1)
at beginWork$1 (react-dom.development.js:27451:1)
useSWRHandler @ index.mjs:634
useSWRArgs @ index.mjs:612
BaseProLayout @ ProLayout.js:201
renderWithHooks @ react-dom.development.js:16305
updateFunctionComponent @ react-dom.development.js:19588
beginWork @ react-dom.development.js:21601
callCallback @ react-dom.development.js:4164
invokeGuardedCallbackDev @ react-dom.development.js:4213
invokeGuardedCallback @ react-dom.development.js:4277
beginWork$1 @ react-dom.development.js:27451
performUnitOfWork @ react-dom.development.js:26557
workLoopSync @ react-dom.development.js:26466
renderRootSync @ react-dom.development.js:26434
recoverFromConcurrentError @ react-dom.development.js:25850
performSyncWorkOnRoot @ react-dom.development.js:26096
flushSyncCallbacks @ react-dom.development.js:12042
commitRootImpl @ react-dom.development.js:26959
commitRoot @ react-dom.development.js:26682
finishConcurrentRender @ react-dom.development.js:25981
performConcurrentWorkOnRoot @ react-dom.development.js:25809
workLoop @ scheduler.development.js:266
flushWork @ scheduler.development.js:239
performWorkUntilDeadline @ scheduler.development.js:533
react-dom.development.js:18687 The above error occurred in the <BaseProLayout> component:

    at BaseProLayout (http://localhost:3001/static/js/bundle.js:14779:13)
    at FormProvider (http://localhost:3001/static/js/bundle.js:88668:31)
    at LocaleProvider (http://localhost:3001/static/js/bundle.js:46893:90)
    at ProviderChildren (http://localhost:3001/static/js/bundle.js:40521:24)
    at LocaleReceiver (http://localhost:3001/static/js/bundle.js:46768:90)
    at ConfigProvider (http://localhost:3001/static/js/bundle.js:40624:13)
    at div
    at SWRConfig$1 (http://localhost:3001/static/js/bundle.js:169152:21)
    at ConfigProviderWrap (http://localhost:3001/static/js/bundle.js:20702:24)
    at ProviderChildren (http://localhost:3001/static/js/bundle.js:40521:24)
    at LocaleReceiver (http://localhost:3001/static/js/bundle.js:46768:90)
    at ConfigProvider (http://localhost:3001/static/js/bundle.js:40624:13)
    at ProLayout (http://localhost:3001/static/js/bundle.js:15073:28)
    at header
    at div
    at App

ç»è¿‡è°ƒè¯•ï¼Œå‘ç°ProLayout.jsä¸‹é¢çš„userStateè¿›å»äº†ä¸¤æ¬¡ï¼Œç¬¬äºŒæ¬¡ï¼ŒdefaultId=â€™pro-layout-2'çš„æ—¶å€™æŠ¥é”™ã€‚
var \_useState = useState(function () {
layoutIndex += 1;
return "pro-layout-".concat(layoutIndex);
}),

### ğŸ“· å¤ç°æ­¥éª¤

1. é€šè¿‡yarn create react-app web-test --template typescriptåˆ›å»ºä¸€ä¸ªreacté¡¹ç›®.
2. yarn add antd @ant-design/pro-componentsæ·»åŠ ä¾èµ–ã€‚
3. æ£€æŸ¥react, react-domç‰ˆæœ¬ï¼Œå‡ä¸º18.2.0.
4. ä¿®æ”¹App.tsx, æ·»åŠ æœ€ç®€å•çš„ProLayoutã€‚

```
   function App() {

  return (
    <div className="App">
        <ProLayout id="layout">
          <PageContainer title="æµ‹è¯•" />
        </ProLayout>
    </div>
  );
}
```

5. å¯åŠ¨é¡¹ç›® yarn start.
6. æµè§ˆå™¨ä¸­æ‰“å¼€åœ°å€â€http://localhost:3000ï¼Œé¡µé¢æ— æ³•æ˜¾ç¤ºã€‚
7. ä¿®æ”¹index.tsxä»£ç ï¼š

```
// const root = createRoot(
//     document.getElementById('root') as HTMLElement
// );
//
// root.render(
//     <React.StrictMode>
//       <App />
//     </React.StrictMode>
// );

ReactDOM.render(
    <React.StrictMode>
      <App />
    </React.StrictMode>,
    document.getElementById('root') as HTMLElement);
```

8. é”™è¯¯æ¶ˆå¤±ã€‚é¡µé¢å¯ä»¥æ­£å¸¸æ˜¾ç¤ºã€‚
9. ç»“è®ºï¼šReactDOM.renderåœ¨react18ä¸­åˆ—ä¸ºå°†è¢«ç§»é™¤çš„åŠŸèƒ½ï¼Œå®˜æ–¹è¦æ±‚æ”¹æˆcreateRootçš„æ–¹å¼ã€‚ä½†æ˜¯createRootçš„æ–¹å¼ProLayoutæ— æ³•æ­£å¸¸æ˜¾ç¤ºã€‚

### ğŸ æœŸæœ›ç»“æœ

åœ¨createRootæ–¹å¼ä¸‹ï¼Œé¡µé¢æ­£å¸¸æ˜¾ç¤ºProLayoutï¼Œä¸å‡ºç°é”™è¯¯ã€‚

### ğŸ’» å¤ç°ä»£ç 

index.tsx

```
// ä¸èƒ½æ­£å¸¸æ˜¾ç¤ºçš„ä»£ç 
// const root = createRoot(
//     document.getElementById('root') as HTMLElement
// );
//
// root.render(
//     <React.StrictMode>
//       <App />
//     </React.StrictMode>
// );

// å¯ä»¥æ­£å¸¸æ˜¾ç¤ºçš„ä»£ç 
ReactDOM.render(
    <React.StrictMode>
      <App />
    </React.StrictMode>,
    document.getElementById('root') as HTMLElement);

```

app.tsx

```
function App() {

  return (
    <div className="App">
        <ProLayout id="layout">
          <PageContainer title="æµ‹è¯•" />
        </ProLayout>
    </div>
  );
}
```

### Â© ç‰ˆæœ¬ä¿¡æ¯

- ProComponents ç‰ˆæœ¬: 2.3.34
- Antdç‰ˆæœ¬ï¼š4.23.3
- æµè§ˆå™¨ç¯å¢ƒï¼šChrome
- å¼€å‘ç¯å¢ƒ : mac OS

### ğŸš‘ å…¶ä»–ä¿¡æ¯

è¯•è¿‡å…¶å®ƒç‰ˆæœ¬ProComponentsï¼š2.3.35ï¼Œ Antdï¼š 5.0.0ï¼ŒåŒæ ·çš„é—®é¢˜

## yikuyirong

å»æ‰ <React.StrictMode /> è¯•è¯•

## liuzhaowei55

> å»æ‰ <React.StrictMode /> è¯•è¯•

é‡åˆ°ç›¸åŒçš„é—®é¢˜ï¼Œè¿™ä¸ªè§£å†³æ–¹æ¡ˆæœ‰æ•ˆã€‚

## folt

I am getting this error. StrictMode is the mode that reports a potential problem. ProLayout has some potential problems that weren't there before.

## DODO7419

ä»€ä¹ˆæ—¶é—´èƒ½ä¿®å¤è¿™ä¸ªé—®é¢˜å‘¢

## liu-wh

å»æ‰<React.StrictMode />å¯ä»¥æ­£å¸¸æ¸²æŸ“, ä½†æ˜¯å½“ä½¿ç”¨è·¯ç”±è·³è½¬æ—¶, ä¼šå†æ¬¡æŠ¥é”™

## zjf9035

> å»æ‰<React.StrictMode />å¯ä»¥æ­£å¸¸æ¸²æŸ“, ä½†æ˜¯å½“ä½¿ç”¨è·¯ç”±è·³è½¬æ—¶, ä¼šå†æ¬¡æŠ¥é”™

åŒè·¯ç”±è·³è½¬æŠ¥é”™ï¼Œæœ‰å•¥è§£å†³åŠæ³•å—

## chenshuai2144

å„ä½æ›´æ–°ä¸‹æœ€æ–°ç‰ˆæœ¬ï¼Œå‡çº§åˆ°äº† swr@2

## liu-wh

> å„ä½æ›´æ–°ä¸‹æœ€æ–°ç‰ˆæœ¬ï¼Œå‡çº§åˆ°äº† swr@2
> åˆšåˆšè¯•äº†ä¸€ä¸‹, å‡çº§åˆ°äº†2.3.37, è¿˜æ˜¯ä¼šæŠ¥é”™, ä¸è¿‡æŠ¥é”™å˜
> ![image](https://user-images.githubusercontent.com/52809998/208611619-8fd46bb7-8b80-48d7-9eb8-f95812c14573.png)

## chenshuai2144

create react app çœ‹èµ·æ¥æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚

## horizon0514

è¿™ä¸ªé—®é¢˜æœ‰è¿›å±•å—

## horizon0514

> create react app çœ‹èµ·æ¥æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚

nextjs æœ‰é—®é¢˜

## guojiabing

![image](https://user-images.githubusercontent.com/39938818/221462412-35828d81-a0bc-47b9-b1c7-1aba3e15b356.png)
æˆ‘ä¹Ÿæ˜¯ç›¸åŒçš„é—®é¢˜ï¼Œä½ é‚£è§£å†³äº†å—ï¼Ÿ

> ![image](https://user-images.githubusercontent.com/52809998/208611619-8fd46bb7-8b80-48d7-9eb8-f95812c14573.png)

## zhiwehu

+1

## hsbtr

è¿™ä¸ªé—®é¢˜æœ‰è¿›å±•å—ï¼Ÿåœ¨ä½¿ç”¨antd 5.4.7 pro-component 2.4.14è¿˜æ˜¯æœ‰è¿™ä¸ªé—®é¢˜ï¼›è·¯ç”±è·³è½¬å°±ä¼šæŠ¥é”™

## hsbtr

> create react app çœ‹èµ·æ¥æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚

react 18.xç‰ˆæœ¬ä½¿ç”¨è·¯ç”±è·³è½¬å°±ä¼šæœ‰è¿™ä¸ªé—®é¢˜

## hsbtr

> > å»æ‰<React.StrictMode />å¯ä»¥æ­£å¸¸æ¸²æŸ“, ä½†æ˜¯å½“ä½¿ç”¨è·¯ç”±è·³è½¬æ—¶, ä¼šå†æ¬¡æŠ¥é”™
>
> åŒè·¯ç”±è·³è½¬æŠ¥é”™ï¼Œæœ‰å•¥è§£å†³åŠæ³•å—

å¦‚ä½•ç»„ä»¶æ˜¯ä»¥react.lazyå¯¼å…¥ï¼Œé‚£ä¹ˆåœ¨prolayoutä¸­å°±å¿…é¡»ä½¿ç”¨react.suspenseåŒ…è£¹outletç»„ä»¶ï¼Œä¸èƒ½å†prolayoutå¤–å±‚ä½¿ç”¨react.outletï¼Œè¿™æ ·ä¼šé€ æˆprolayoutå‡ºç°é—ªçƒé—®é¢˜ï¼ŒåŒæ—¶ä¹Ÿä¼šé€ æˆè·¯ç”±è·³è½¬å°±æŠ¥é”™
![image](https://github.com/ant-design/pro-components/assets/46487804/4560e979-15ab-4c40-bdb8-1bfa7389bf45)

## liu-wh

> > > å»æ‰<React.StrictMode />å¯ä»¥æ­£å¸¸æ¸²æŸ“, ä½†æ˜¯å½“ä½¿ç”¨è·¯ç”±è·³è½¬æ—¶, ä¼šå†æ¬¡æŠ¥é”™
> >
> > åŒè·¯ç”±è·³è½¬æŠ¥é”™ï¼Œæœ‰å•¥è§£å†³åŠæ³•å—
>
> å¦‚ä½•ç»„ä»¶æ˜¯ä»¥react.lazyå¯¼å…¥ï¼Œé‚£ä¹ˆåœ¨prolayoutä¸­å°±å¿…é¡»ä½¿ç”¨react.suspenseåŒ…è£¹outletç»„ä»¶ï¼Œä¸èƒ½å†prolayoutå¤–å±‚ä½¿ç”¨react.outletï¼Œè¿™æ ·ä¼šé€ æˆprolayoutå‡ºç°é—ªçƒé—®é¢˜ï¼ŒåŒæ—¶ä¹Ÿä¼šé€ æˆè·¯ç”±è·³è½¬å°±æŠ¥é”™ ![image](https://user-images.githubusercontent.com/46487804/238528265-4560e979-15ab-4c40-bdb8-1bfa7389bf45.png)

è¯•ç€åœ¨Outletå¤–ä¾§åŠ äº†Suspense, è§£å†³äº† æ„Ÿè°¢!!!
