# ğŸ›[BUG] SchemaForm ä¸­ JSXä¸­è‡ªå®šä¹‰transformä¸è¢«è°ƒç”¨

`form`,`ğŸ“¦  Need to reproduce`

è‡ªå®šä¹‰valueType

```
import useRemoteOption from "@/components/value-type/remote-enum/use-remote-option";
import { ProFormCascader } from "@ant-design/pro-components"; // è¿™é‡Œæœ‰bug https://github.com/ant-design/pro-components/issues/6290

export const RemoteCascade = (props) => {
  const { names = [], joinBy = '-', linkToUrl, ...rest } = props
  const { data } = useRemoteOption({ linkToUrl });

  const handleTransform = (values) => {
    console.log("handleTransform", values)
    const result = { [props.name]: values }
    names.forEach((name, idx) => {
      result[name] = values![idx]
    })
    return result;
  }
  return (
    <ProFormCascader
      {...rest}
      fieldProps={{
        displayRender: label => label.join(joinBy),
        options: data,
      }}
      transform={handleTransform}
    />
  )
}

/**
 * fieldProps:{
 *   names:["province","city"],
 *   joinBy:'-',
 *   linkToUrl: 'xxxx' //remoteè¿”å›candidateValues
 * }
 */
const RemoteCascadeValueType = {
  render: (item, props) => {
    const { fieldProps } = props;
    const { joinBy = "-", names = [] } = fieldProps || []
    const value = names.map(it => item![it]).join(joinBy)
    return <div>{value}</div>
  },
  renderFormItem: (__, props) => {
    const { fieldProps } = props;
    return <RemoteCascade {...props} {...fieldProps} />;
  },
};
export default RemoteCascadeValueType;

```

æµ‹è¯•ä»£ç ï¼š

```
import { BetaSchemaForm, ProForm } from '@ant-design/pro-components';
import { message } from "antd";
import EleProProvider from "@/components/value-type/ele-pro-provider";
import { RemoteCascade } from "@/components/value-type/remote-cascade";

export default () => {

  return (
    <EleProProvider>
      <ProForm onFinish={async (values) => {
        message.success('æäº¤æˆåŠŸ' + JSON.stringify(values));
      }}>
        <BetaSchemaForm
          layoutType="Embed"
          columns={[
            {
              title: 'æ‰€åœ¨åŸå¸‚',
              valueType: 'RemoteCascade',
              dataIndex: "addressProvinceCity",
              fieldProps: {
                width: 'md',
                names: ['addressProvince', 'addressCity'],
                linkToUrl: '/api/test/cities',
                placeholder: "è¯·é€‰æ‹©æ‰€22åœ¨åŸå¸‚",
              },
            },
          ]} />

        <RemoteCascade
          linkToUrl={"/api/test/cities"}
          width="md"
          name="data2"
          label="åˆåŒç”Ÿæ•ˆæ—¶é—´"
          names={['addressProvince2', 'addressCity2']}
          placeholder="è¯·é€‰æ‹©æ‰€2åœ¨åŸå¸‚"
        />

      </ProForm>
    </EleProProvider>
  );
};

```

addressProvinceCityä¸­çš„å®šä¹‰ï¼Œå¹¶æœªè§¦å‘handleTransform

è¿è¡Œç»“æœå¦‚ä¸‹
<img width="1211" alt="image" src="https://user-images.githubusercontent.com/1215976/204433413-775d7dca-c675-4c15-91ce-d04cc274bd26.png">

tips:
package.json

```
 "dependencies": {
    "@ant-design/icons": "^4.7.0",
    "@ant-design/pro-components": "^2.3.13",
    "@umijs/route-utils": "^2.1.3",
    "antd": "^4.23.3",
    "classnames": "^2.3.2",
    "lodash": "^4.17.21",
    "moment": "^2.29.4",
    "omit.js": "^2.0.2",
    "rc-menu": "^9.6.4",
    "rc-util": "^5.24.4",
    "react": "^17.0.0",
    "react-dev-inspector": "^1.8.1",
    "react-dom": "^17.0.0",
    "react-helmet-async": "^1.3.0",
    "ahooks": "^3.7.2",
    "deepdash": "^5.3.9",
    "echarts": "5.3.3",
    "echarts-for-react": "^3.0.2",
    "file-saver": "^2.0.5",
    "jwt-decode": "^3.1.2",
    "numeral": "^2.0.6",
    "path-to-regexp": "^6.2.0",
    "rc-texty": "^0.2.0",
    "react-fast-marquee": "^1.3.5"
  },
```

## kala888

demoï¼šhttps://github.com/kala888/antd-procomponnet-bug

## chenshuai2144

æä¸ªåœ¨çº¿çš„ï¼Œ

## kala888

@chenshuai2144
é—®é¢˜æ‰¾åˆ°äº†ï¼Œæ€»ç»“å¦‚ä¸‹ï¼š

é—®é¢˜ï¼š

1. è‡ªå®šä¹‰valueType=â€œRemoteCascadeâ€çš„Componentï¼ŒRemoteCascadeï¼Œå…¶ä¸­è¿”å›çš„Componentæ˜¯ ProFormCascaderã€‚RemoteCascade å®šä¹‰transformã€‚
2. å•ç‹¬ä»¥JSXæ–¹å¼æ˜¯ä¸€ä¸ªRemoteCascadeï¼Œtransformç”Ÿæ•ˆ
3. åœ¨schema formä¸­ä½¿ç”¨valueType=â€œRemoteCascadeâ€ï¼ŒRemoteCascadeä¸­ä¼ é€’ç»™ProFormCascaderçš„transformï¼Œä¸ç”Ÿæ•ˆã€‚
4. åœ¨æ­¥éª¤3çš„åŸºç¡€ä¸Šï¼Œå¦‚æœåœ¨JSONä¸­ï¼Œå®šä¹‰ä½¿ç”¨ transform: ()=>xxxx, ç”Ÿæ•ˆã€‚

æœŸæœ›ï¼šåœ¨æ­¥éª¤3ä¸­å¯ä»¥ä½¿ç”¨Compnentä¸­å®šä¹‰çš„transformï¼Œè€Œä¸æ˜¯åœ¨æ­¥éª¤4é‡å¤å®šä¹‰ã€‚

é—®é¢˜åŸå› åˆ†æï¼š
åœ¨schema formä¸­transformå¤±æ•ˆåŸå› ï¼š

1. schema form åœ¨åˆ›å»ºç»„ä»¶çš„æ—¶å€™ï¼Œé¦–å…ˆä¼šæ ¹æ®JSONå®šä¹‰åˆ›å»ºä¸€ä¸ªProFormItemï¼Œå¹¶å»ºç«‹transformçš„ç¼“å­˜ï¼Œkeyæ˜¯dataIndexï¼Œä»£ç å¦‚ä¸‹ï¼š
   <img width="735" alt="image" src="https://github.com/ant-design/pro-components/assets/1215976/e3a7d931-8d6a-4fab-aa3d-5237e4ece6fe">
   ç”±äºJSONä¸­æ²¡æœ‰å®šä¹‰transformï¼Œè¿™é‡Œç¼“å­˜ä¸ºç©ºã€‚

2. ä»¥JSXæ–¹å¼æ˜¯ä¸€ä¸ªRemoteCascadeçš„æ—¶å€™ï¼Œæ¡†æ¶ä¹Ÿä¼šåˆ›å»ºProFormItemï¼Œå¹¶å»ºç«‹transformçš„ç¼“å­˜ï¼Œkeyæ˜¯nameã€‚
3. å‡ºé—®é¢˜çš„è‡ªå®šä¹‰ValueTypeï¼Œ Componentä¸­æ²¡æœ‰æŒ‡å®šnameå±æ€§(rest ä¸­å¹¶æ²¡æœ‰nameï¼Œè€Œæ˜¯id)ï¼Œæ•…è€Œåœ¨Schemaåˆ›å»ºValueType Componentå®ä¾‹çš„æ—¶å€™åˆ›å»ºä¸äº†transformçš„ç¼“å­˜ã€‚

```
  <ProFormCascader
      {...rest}
      fieldProps={{
        displayRender: label => label.join(joinBy),
        options: data,
      }}
      transform={handleTransform}
    />
```

è§£å†³æ–¹æ¡ˆ ï¼š
åœ¨è‡ªå®šä¹‰Componentä¸­ï¼Œå‘ProFormCascaderä¼ é€’name, å»ºç«‹nameï¼štransformçš„ç¼“å­˜ï¼Œ

æ­£ç¡®ä»£ç ï¼š

```
mport useRemoteOption from "@/components/value-type/remote-enum/use-remote-option";
import { ProFormCascader } from "@ant-design/pro-components";

export const RemoteCascade = (props) => {
  const { names = [], joinBy = '-', linkToUrl, ...rest } = props
  const { data } = useRemoteOption({ linkToUrl });

  const handleTransform = (values) => {
    console.log("handleTransform", values)
    const result = { [props.name]: values }
    names.forEach((name, idx) => {
      result[name] = values![idx]
    })
    return result;
  }
  return (
    <ProFormCascader
      // è¿™é‡Œå¾ˆé‡è¦ï¼Œå°±æ˜¯è¿™é‡Œæ²¡æŒ‡å®šå¯¼è‡´transformå¤±æ•ˆ
      name={rest.id}
      {...rest}
      fieldProps={{
        displayRender: label => label.join(joinBy),
        options: data,
      }}
      transform={handleTransform}
    />
  )
}

```

åŒç†ï¼ŒconvertValueä¹Ÿæœ‰è¿™ä¸ªé—®é¢˜ï¼ŒæŒ‡å®šnameå°±è¡Œäº†ã€‚
