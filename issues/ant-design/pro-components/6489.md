# ğŸ§[é—®é¢˜] Protableå¦‚ä½•åœ¨toolbarä¸­filter(è½»é‡ç­›é€‰)è‡ªåŠ¨ä¼ å…¥requestä¸­filterå‚æ•°ï¼Ÿ

`â­•ï¸   bug`,`table`,`AI Reply`

### ğŸ§ é—®é¢˜æè¿°

å®˜æ–¹æ–‡æ¡£ä¸­æœ‰ç¤ºä¾‹ [Toolbar è‡ªå®šä¹‰](https://procomponents.ant.design/components/table#toolbar-%E8%87%AA%E5%AE%9A%E4%B9%89)ï¼Œå…¶ä¸­é…ç½®Protableçš„toolbarå±æ€§ä¸­æœ‰ä¸€ä¸ªå•ç‹¬`filter`

```ts
toolbar={{
        filter: (
          <LightFilter>
            <ProFormDatePicker name="startdate" label="å“åº”æ—¥æœŸ" />
          </LightFilter>
        ),
        menu: {
          type: 'tab',
          activeKey: activeKey,
          items: [
            {
              key: 'tab1',
              label: <span>åº”ç”¨{renderBadge(99, activeKey === 'tab1')}</span>,
            },
            {
              key: 'tab2',
              label: <span>é¡¹ç›®{renderBadge(30, activeKey === 'tab2')}</span>,
            },
            {
              key: 'tab3',
              label: <span>æ–‡ç« {renderBadge(30, activeKey === 'tab3')}</span>,
            },
          ],
          onChange: (key) => {
            setActiveKey(key as string);
          },
    }
}
```

å¦å¤–åœ¨`columns`å®šä¹‰ä¸­åˆæœ‰è®¾ç½®è¡¨å¤´`status`å¯è¿›è¡Œç­›é€‰ï¼š

```ts
const columns: ProColumns<TableListItem>[] = [
  {
    title: 'åº”ç”¨åç§°',
    dataIndex: 'name',
    render: (_) => <a>{_}</a>,
  },
  // .........
  {
    title: 'çŠ¶æ€',
    dataIndex: 'status',
    initialValue: 'all',
    filters: true,  // è¿™é‡Œå®šä¹‰è¡¨å¤´å¯ç­›é€‰
    onFilter: true,
    valueEnum: {
      all: { text: 'å…¨éƒ¨', status: 'Default' },
      close: { text: 'å¾…å‘å¸ƒ', status: 'Default' },
      running: { text: 'å‘å¸ƒä¸­', status: 'Processing' },
      online: { text: 'å‘å¸ƒæˆåŠŸ', status: 'Success' },
      error: { text: 'å‘å¸ƒå¤±è´¥', status: 'Error' },
    },
  },
  // ........
];
```

![image](https://user-images.githubusercontent.com/56813612/211306077-15223844-62a7-4fec-a43b-1eaad8419a32.png)

æˆ‘çš„é—®é¢˜æ˜¯ï¼šrequestå‡½æ•°ç­¾åï¼š`(params?: {pageSize,current},sort,filter) => {data,success,total}`

1ã€é€šè¿‡å¯¹æŸåˆ—çš„è¡¨å¤´è®¾ç½®`filters=true`ï¼Œç„¶åå†åœ¨è¡¨å¤´ä¸Šè¿›è¡Œç­›é€‰ï¼ˆç±»ä¼¼Excelä¸­ç­›é€‰ï¼‰ï¼Œå…¶ä¸­requestå‡½æ•°å‚æ•°`(filter)`èƒ½æ‹¿åˆ°ç­›é€‰ç»“æœï¼ˆä¸Šå›¾ç²‰è‰²åŒºåŸŸå†…ï¼‰ã€‚ä½†æ˜¯è®¾ç½®toolbarä¸­filter(è½»é‡ç­›é€‰ç»„ä»¶X)åï¼ˆä¸Šå›¾ç»¿è‰²åŒºåŸŸå†…ï¼‰ï¼Œå¹¶ä¸ä¼šè‡ªåŠ¨è§¦å‘requestï¼Œå°±ç®—å½“å‰é€‰ä¸­å®ƒçš„å€¼ä¹‹åï¼Œç‚¹èœå•æ é‡Œé¢çš„åˆ·æ–°æŒ‰é’®æ‰‹åŠ¨è§¦å‘requestï¼Œå…¶ä¸­filterè¿˜æ˜¯æ²¡æœ‰è¿™ä¸ª(è½»é‡ç­›é€‰ç»„ä»¶X)çš„å€¼ï¼Œparamså‚æ•°ä¸­ä¹Ÿæ²¡æœ‰ï¼Ÿ

2ã€`toolbar={filter: component}`å’Œ`search={filterType: 'light'}`ä¸¤è€…åŒºåˆ«ï¼Ÿæˆ‘æŸ¥é˜…äº†å¤§éƒ¨åˆ†æ¡ˆä¾‹å’Œäº²è‡ªå®è·µåå¾—çŸ¥ï¼š

- ä¸¤è€…éƒ½ä¼šæ˜¾ç¤ºåœ¨`toolbar`åŒºåŸŸï¼ˆä¸Šå›¾ç»¿æ¡†å†…ï¼‰
- `search`ä¼šè‡ªåŠ¨æ•è·ç»“æœå¹¶å°†å…¶ä¼ å…¥`request`çš„`params`å‚æ•°ï¼Œè€Œé`filter`ï¼

å…¶å®è¿™ä¸¤ä¸ªé—®é¢˜å°±æ˜¯`toolbar={filter: component}`ç­›é€‰åï¼Œæ€ä¹ˆæŠŠå€¼ä¼ åˆ°`request`çš„`filter`å‚æ•°å†…ã€‚éº»çƒ¦å¼€å‘è€…çœ‹ä¸‹ï¼Œè°¢è°¢æ‚¨

### ğŸ’» ç¤ºä¾‹ä»£ç 

```ts
import type { ProColumns } from '@ant-design/pro-components';
import { LightFilter, ProFormDatePicker, ProTable } from '@ant-design/pro-components';
import { Badge, Button } from 'antd';
import React, { useState } from 'react';

export type TableListItem = {
  key: number;
  name: string;
  containers: number;
  status: string;
  creator: string;
  createdAt: number;
};

const valueEnum = {
  0: 'close',
  1: 'running',
  2: 'online',
  3: 'error',
};

const tableListDataSource: TableListItem[] = [];

const creators = ['ä»˜å°å°', 'æ›²ä¸½ä¸½', 'æ—ä¸œä¸œ', 'é™ˆå¸…å¸…', 'å…¼æŸæŸ'];

for (let i = 0; i < 5; i += 1) {
  tableListDataSource.push({
    key: i,
    name: 'AppName',
    containers: Math.floor(Math.random() * 20),
    status: valueEnum[Math.floor(Math.random() * 10) % 4],
    createdAt: Date.now() - Math.floor(Math.random() * 2000),
    creator: creators[Math.floor(Math.random() * creators.length)],
  });
}

const columns: ProColumns<TableListItem>[] = [
  {
    title: 'åº”ç”¨åç§°',
    dataIndex: 'name',
    render: (_) => <a>{_}</a>,
  },
  {
    title: 'åˆ›å»ºè€…',
    dataIndex: 'creator',
    valueEnum: {
      all: { text: 'å…¨éƒ¨' },
      ä»˜å°å°: { text: 'ä»˜å°å°' },
      æ›²ä¸½ä¸½: { text: 'æ›²ä¸½ä¸½' },
      æ—ä¸œä¸œ: { text: 'æ—ä¸œä¸œ' },
      é™ˆå¸…å¸…: { text: 'é™ˆå¸…å¸…' },
      å…¼æŸæŸ: { text: 'å…¼æŸæŸ' },
    },
  },
  {
    title: 'çŠ¶æ€',
    dataIndex: 'status',
    initialValue: 'all',
    filters: true,
    onFilter: true,
    valueEnum: {
      all: { text: 'å…¨éƒ¨', status: 'Default' },
      close: { text: 'å¾…å‘å¸ƒ', status: 'Default' },
      running: { text: 'å‘å¸ƒä¸­', status: 'Processing' },
      online: { text: 'å‘å¸ƒæˆåŠŸ', status: 'Success' },
      error: { text: 'å‘å¸ƒå¤±è´¥', status: 'Error' },
    },
  },
  {
    title: 'å®¹å™¨æ•°é‡',
    dataIndex: 'containers',
    align: 'right',
    sorter: (a, b) => a.containers - b.containers,
  },
  {
    title: 'æ“ä½œ',
    key: 'option',
    width: 120,
    valueType: 'option',
    render: (_, record) => [
      record.status === 'close' && <a key="link">å‘å¸ƒ</a>,
      (record.status === 'running' || record.status === 'online') && <a key="warn">åœç”¨</a>,
      record.status === 'error' && <a key="republish">é‡æ–°å‘å¸ƒ</a>,
      <a
        key="republish"
        style={
          record.status === 'running'
            ? {
                color: 'rgba(0,0,0,.25)',
                cursor: 'not-allowed',
              }
            : {}
        }
      >
        ç›‘æ§
      </a>,
    ],
  },
];

const renderBadge = (count: number, active = false) => {
  return (
    <Badge
      count={count}
      style={{
        marginBlockStart: -2,
        marginInlineStart: 4,
        color: active ? '#1890FF' : '#999',
        backgroundColor: active ? '#E6F7FF' : '#eee',
      }}
    />
  );
};

export default () => {
  const [activeKey, setActiveKey] = useState<React.Key>('tab1');

  return (
    <ProTable<TableListItem>
      columns={columns}
      request={(params, sorter, filter) => {
        // è¡¨å•æœç´¢é¡¹ä¼šä» params ä¼ å…¥ï¼Œä¼ é€’ç»™åç«¯æ¥å£ã€‚
        console.log(params, sorter, filter);
        return Promise.resolve({
          data: tableListDataSource,
          success: true,
        });
      }}
      toolbar={{
        filter: (
          <LightFilter>
            <ProFormDatePicker name="startdate" label="å“åº”æ—¥æœŸ" />
          </LightFilter>
        ),
        menu: {
          type: 'tab',
          activeKey: activeKey,
          items: [
            {
              key: 'tab1',
              label: <span>åº”ç”¨{renderBadge(99, activeKey === 'tab1')}</span>,
            },
            {
              key: 'tab2',
              label: <span>é¡¹ç›®{renderBadge(30, activeKey === 'tab2')}</span>,
            },
            {
              key: 'tab3',
              label: <span>æ–‡ç« {renderBadge(30, activeKey === 'tab3')}</span>,
            },
          ],
          onChange: (key) => {
            setActiveKey(key as string);
          },
        },
        actions: [
          <Button key="primary" type="primary">
            æ–°å»ºåº”ç”¨
          </Button>,
        ],
      }}
      rowKey="key"
      pagination={{
        showQuickJumper: true,
      }}
      search={false}
      dateFormatter="string"
      options={{
        setting: {
          draggable: true,
          checkable: true,
          checkedReset: false,
          extra: [<a key="confirm">ç¡®è®¤</a>],
        },
      }}
    />
  );
};
```

### ğŸš‘ å…¶ä»–ä¿¡æ¯

<!--
å¦‚æˆªå›¾ç­‰å…¶ä»–ä¿¡æ¯å¯ä»¥è´´åœ¨è¿™é‡Œ
-->

## drsanwujiang

åŒæ ·é‡åˆ°äº†è¿™ä¸ªé—®é¢˜ï¼Œtoolbarçš„filterå±æ€§ç›®å‰çœ‹æ¥å¹¶ä¸ä¼šäº§ç”Ÿå®é™…æ•ˆæœ

## jeryqwq

æ”¹ä¸ºæ¸²æŸ“å‡½æ•°ï¼Œ ä¼ å…¥ä¸€ä¸ªformRefå»å¤„ç†è·å–filterè¡¨å•çš„å€¼ï¼Ÿrequestçš„æ—¶å€™å¦‚æœæœ‰çš„è¯å†mergeï¼Ÿ

## chenshuai2144

> TAutomatically replying with ChatGPT can be attempted, but it cannot be guaranteed to be completely accurate and may not fully address all issues. Please feel free to reply if you have any further questions or concerns.
> æ­¤å›å¤åŸºäº ChatGPT è‡ªåŠ¨ç”Ÿæˆï¼Œå¯ä»¥å°è¯•ä¸‹æ–¹æ¡ˆï¼Œå®˜æ–¹å‘˜ä¼šåœ¨ä¸€å®šæ—¶é—´åç»§ç»­ç»§ç»­å¤„ç†ã€‚

æ˜¯çš„ï¼Œä½ å¯ä»¥é€šè¿‡å°†filterå±æ€§æ”¹ä¸ºä¸€ä¸ªå‡½æ•°ï¼Œå‡½æ•°æ¥æ”¶ä¸€ä¸ªå‚æ•°å¯¹è±¡ï¼Œè¯¥å‚æ•°å¯¹è±¡åŒ…å«ä¸€ä¸ª ref å¼•ç”¨å’Œ updateã€submitã€resetä¸‰ä¸ªå›è°ƒå‡½æ•°ã€‚ä½ å¯ä»¥é€šè¿‡ ref è·å–è¡¨å•çš„å€¼ï¼Œç„¶ååœ¨è°ƒç”¨ request å‡½æ•°çš„æ—¶å€™å°†å…¶ merge åˆ°åŸæ¥çš„ filter ä¸­ã€‚ä¸‹é¢æ˜¯ä¿®æ”¹çš„ä»£ç ç¤ºä¾‹ï¼Œéƒ¨åˆ†ä»£ç è§£é‡Šè¯¦è§æ³¨é‡Šã€‚

```ts
import type { FilterDropdownProps } from '@ant-design/pro-table/lib/components/Filter';
import type { ProColumns } from '@ant-design/pro-table';
import {
  LightFilter,
  ProFormDatePicker,
  ProFormSelect,
  ProFormText,
} from '@ant-design/pro-form';
import { Badge, Button } from 'antd';
import React, { useEffect, useState } from 'react';
import { request } from 'umi';

export type TableListItem = {
  key: number;
  name: string;
  containers: number;
  status: string;
  creator: string;
  createdAt: number;
};

const valueEnum = {
  0: 'close',
  1: 'running',
  2: 'online',
  3: 'error',
};

const tableListDataSource: TableListItem[] = [];

const creators = ['ä»˜å°å°', 'æ›²ä¸½ä¸½', 'æ—ä¸œä¸œ', 'é™ˆå¸…å¸…', 'å…¼æŸæŸ'];

for (let i = 0; i < 5; i += 1) {
  tableListDataSource.push({
    key: i,
    name: 'AppName',
    containers: Math.floor(Math.random() * 20),
    status: valueEnum[Math.floor(Math.random() * 10) % 4],
    createdAt: Date.now() - Math.floor(Math.random() * 2000),
    creator: creators[Math.floor(Math.random() * creators.length)],
  });
}

const columns: ProColumns<TableListItem>[] = [
  {
    title: 'åº”ç”¨åç§°',
    dataIndex: 'name',
    render: (_) => <a>{_}</a>,
  },
  {
    title: 'åˆ›å»ºè€…',
    dataIndex: 'creator',
    valueEnum: {
      all: { text: 'å…¨éƒ¨' },
      ä»˜å°å°: { text: 'ä»˜å°å°' },
      æ›²ä¸½ä¸½: { text: 'æ›²ä¸½ä¸½' },
      æ—ä¸œä¸œ: { text: 'æ—ä¸œä¸œ' },
      é™ˆå¸…å¸…: { text: 'é™ˆå¸…å¸…' },
      å…¼æŸæŸ: { text: 'å…¼æŸæŸ' },
    },
  },
  {
    title: 'çŠ¶æ€',
    dataIndex: 'status',
    initialValue: 'all',
    filters: true,
    onFilter: true,
    valueEnum: {
      all: { text: 'å…¨éƒ¨', status: 'Default' },
      close: { text: 'å¾…å‘å¸ƒ', status: 'Default' },
      running: { text: 'å‘å¸ƒä¸­', status: 'Processing' },
      online: { text: 'å‘å¸ƒæˆåŠŸ', status: 'Success' },
      error: { text: 'å‘å¸ƒå¤±è´¥', status: 'Error' },
    },
  },
  {
    title: 'å®¹å™¨æ•°é‡',
    dataIndex: 'containers',
    align: 'right',
    sorter: (a, b) => a.containers - b.containers,
  },
  {
    title: 'æ“ä½œ',
    key: 'option',
    width: 120,
    valueType: 'option',
    render: (_, record) => [
      record.status === 'close' && <a key="link">å‘å¸ƒ</a>,
      (record.status === 'running' || record.status === 'online') && <a key="warn">åœç”¨</a>,
      record.status === 'error' && <a key="republish">é‡æ–°å‘å¸ƒ</a>,
      <a
        key="republish"
        style={
          record.status === 'running'
            ? {
                color: 'rgba(0,0,0,.25)',
                cursor: 'not-allowed',
              }
            : {}
        }
      >
        ç›‘æ§
      </a>,
    ],
  },
];

const renderBadge = (count: number, active = false) => {
  return (
    <Badge
      count={count}
      style={{
        marginBlockStart: -2,
        marginInlineStart: 4,
        color: active ? '#1890FF' : '#999',
        backgroundColor: active ? '#E6F7FF' : '#eee',
      }}
    />
  );
};

const LightFilterContainer: React.FC<FilterDropdownProps> = ({ ref, update, submit, reset }) => {
  const [params, setParams] = useState({})
  const getData = async () => {
    const resData = await request("https://run.mocky.io/v3/945fc6a5-6b7c-4f0a-9d2d-6d026a6c07b6")
    console.log(`resData`, resData)
  }

  const onFinish = async (values: any) => {
    console.log(`onFinish`, values)
    setParams(values)
    getData()
    submit()
  }

  const onCancel = () => {
    console.log(`onCancel`)
    reset()
  }

  useEffect(() => {
    console.log(`params`, params)
    update(params)
  }, [params, update])

  return (
    <LightFilter onFinish={onFinish} onReset={onCancel}>
      <ProFormText name="name" label="åº”ç”¨åç§°" />
      <ProFormSelect
        name="creator"
        label="åˆ›å»ºè€…"
        options={[
          {
            value: 'ä»˜å°å°',
            label: 'ä»˜å°å°',
          },
          {
            value: 'æ›²ä¸½ä¸½',
            label: 'æ›²ä¸½ä¸½',
          },
          {
            value: 'æ—ä¸œä¸œ',
            label: 'æ—ä¸œä¸œ',
          },
          {
            value: 'é™ˆå¸…å¸…',
            label: 'é™ˆå¸…å¸…',
          },
          {
            value: 'å…¼æŸæŸ',
            label: 'å…¼æŸæŸ',
          },
        ]}
      />
      <ProFormSelect.Group name="status" label="çŠ¶æ€" width="md" >
        <ProFormSelect.Option value="close">å¾…å‘å¸ƒ</ProFormSelect.Option>
        <ProFormSelect.Option value="running">å‘å¸ƒä¸­</ProFormSelect.Option>
        <ProFormSelect.Option value="online">å‘å¸ƒæˆåŠŸ</ProFormSelect.Option>
        <ProFormSelect.Option value="error">å‘å¸ƒå¤±è´¥</ProFormSelect.Option>
      </ProFormSelect.Group>
      <ProFormDatePicker name="startdate" label="å“åº”æ—¥æœŸ" />
    </LightFilter>
  );
}

export default () => {
  const [activeKey, setActiveKey] = useState<React.Key>('tab1');
  const filterRef = React.useRef({}).current;  // å®šä¹‰ä¸€ä¸ª ref

  return (
    <ProTable<TableListItem>
      columns={columns}
      request={(params, sorter, filter) => {
        console.log(`params`, params)
        console.log(`sorter`, sorter)
        console.log(`filter`, filter)

        // é€šè¿‡ ref è·å–è¡¨å•çš„å€¼
        const formValues = filterRef?.value?.getFieldsValue() ?? {}
        console.log(`formValues`, formValues)

        // å°† formValues merge åˆ° filter ä¸­
        const mergedFilter = { ...filter, ...formValues }
        console.log(`mergedFilter`, mergedFilter)

        return Promise.resolve({
          data: tableListDataSource,
          success: true,
        });
      }}
      toolbar={{
        filter: filterRef,  // å°† filter æ”¹ä¸ºç»„ä»¶
        menu: {
          type: 'tab',
          activeKey: activeKey,
          items: [
            {
              key: 'tab1',
              label: <span>åº”ç”¨{renderBadge(99, activeKey === 'tab1')}</span>,
            },
            {
              key:


## mzcc666GtHb

å¦‚æœsearchä¸ºfalse ,æˆ–è€…filtertype æ˜¯ light çš„æ—¶å€™, formRef è·å–ä¸åˆ°


## chenshuai2144

åæœŸä¸€ç‚¹æ‹¿æ˜¯å¯ä»¥æ‹¿åˆ°äº†ï¼Œfiltertype=light ä¹Ÿæ˜¯ç”¨çš„ä¸€ä¸ªform


```
