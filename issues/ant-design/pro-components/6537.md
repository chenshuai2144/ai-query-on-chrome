# ğŸ§[é—®é¢˜ | question] ProTable toolbar search not works as expected when query

`AI Reply`

Default search works as expected, searchs,returns and changes table.
But when i try to use

```
toolbar={{
        search: {
          onSearch: async (value) => {
            const data = request(
              "http://localhost:5999/services/database/products",
              {
                headers: {
                  "Content-Type": "application/json",
                },
                method: "POST",
                data: {
                  mpName: value,
                },
              }
            );
            console.log(data);

            return data;
        },
  }}
```

does nothing to Table
Is there any guide to use this
![image](https://user-images.githubusercontent.com/112181162/213989271-558082fc-b8bf-4b45-a986-7f091d4fba24.png)
instead of this search query?
![image](https://user-images.githubusercontent.com/112181162/213989427-baa87b00-4df3-4c24-a35a-28bd07841100.png)'

Whole code:

```
import type { ProColumns } from "@ant-design/pro-components";
import { ProTable } from "@ant-design/pro-table";
import { Button } from "antd";
import { useEffect, useState } from "react";
import request from "umi-request";

export type TableListItem = {
  mpName: string;
};

const columns: ProColumns<TableListItem>[] = [
  {
    title: "Product",
    dataIndex: "mpName",
    render: (_) => <a>{_}</a>,
    ellipsis: false,
  },
];

export default () => {
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    setLoading(false);
  });
  return (
    <ProTable<TableListItem>
      columns={columns}
      loading={loading}
      request={async (params = {}, sorter, filter) => {
        const data = request<TableListItem[]>(
          "http://localhost:5999/ozon/services/database/products",
          {
            headers: {
              "Content-Type": "application/json",
            },
            method: "POST",
            data: {
              mpName: params.mpName,
            },
          }
        );
        console.log(data);
        return data;
      }}
      toolbar={{
        search: {
          onSearch: async (value) => {
            // setSearchLoading(true)
            // setSearchLoading(false)
            const data = request(
              "http://localhost:5999/services/database/products",
              {
                headers: {
                  "Content-Type": "application/json",
                },
                method: "POST",
                data: {
                  mpName: value,
                },
              }
            );
            console.log(data);

            return data;
          },
          key: "mpName",
          placeholder: "search by name",
          style: { width: 304 },
          allowClear: true,
          loading: false,
        },
        actions: [
          <Button
            key="primary"
            type="primary"
            onClick={() => {
              alert("add");
            }}
          >
            æ·»åŠ 
          </Button>,
        ],
      }}
      rowKey="mpName"
    />
  );
};
```

What i expect?

I expect that the search field will change the table upon return, just like the standard search

## chenshuai2144

> TAutomatically replying with ChatGPT can be attempted, but it cannot be guaranteed to be completely accurate and may not fully address all issues. Please feel free to reply if you have any further questions or concerns.
> æ­¤å›å¤åŸºäº ChatGPT è‡ªåŠ¨ç”Ÿæˆï¼Œå¯ä»¥å°è¯•ä¸‹æ–¹æ¡ˆï¼Œå®˜æ–¹å‘˜ä¼šåœ¨ä¸€å®šæ—¶é—´åç»§ç»­ç»§ç»­å¤„ç†ã€‚

ğŸ‘‹[è§£å†³æ–¹æ¡ˆ | Solution]
æ ¹æ®ä½ çš„æè¿°ï¼Œä½ åœ¨ ProTable ç»„ä»¶ä¸­ä½¿ç”¨äº†ä¸€ä¸ªè‡ªå®šä¹‰æœç´¢åŠŸèƒ½ï¼Œä½†æ˜¯æ²¡æœ‰å®ç°é¢„æœŸçš„æ•ˆæœã€‚
é¦–å…ˆï¼Œä½ å¿…é¡»ä¿è¯è¾“å…¥æ¡†çš„ `key` å’Œè¯·æ±‚å‚æ•°çš„ `key` æ˜¯ç›¸åŒçš„ã€‚
å…¶æ¬¡ï¼Œä½ éœ€è¦å°†è¯·æ±‚è¿”å›çš„æ•°æ®æ ¼å¼è½¬æ¢æˆé€‚åˆ ProTable æ¸²æŸ“çš„æ ¼å¼ï¼Œä¾‹å¦‚ï¼š{ total: number, data: [] }ã€‚
æœ€åï¼Œä½ éœ€è¦æ›´æ–° ProTable ç»„ä»¶çš„ `dataSource` å¹¶ä¸”å…³é—­æœç´¢æ¡†çš„åŠ è½½çŠ¶æ€ã€‚
ä½ å¯ä»¥ä½¿ç”¨å¦‚ä¸‹ä»£ç å®ç°è¿™äº›åŠŸèƒ½ï¼š

```typescript
import { message } from 'antd';
import React, { useState } from 'react';
import { ProColumns, ProTable } from '@ant-design/pro-table';
import request from 'umi-request';

export interface TableListItem {
  name: string;
  age: number;
  address: string;
  [propName: string]: any;
}

const columns: ProColumns<TableListItem>[] = [
  {
    title: 'Name',
    dataIndex: 'name',
    formItemProps: {
      rules: [
        {
          required: true,
          message: 'Name is required',
        },
      ],
    },
  },
  {
    title: 'Age',
    dataIndex: 'age',
    sorter: true,
  },
  {
    title: 'Address',
    dataIndex: 'address',
    search: false,
  },
];

const fetchTableData = async (params: any) => {
  const response = await request('/api/table/list', {
    method: 'POST',
    params,
  });
  const { data, total } = response;
  return {
    data,
    total,
  };
};

const fetchCustomData = async (params: any) => {
  const response = await request('/api/table/custom', {
    method: 'POST',
    params,
  });
  const { data, total } = response;
  return {
    data,
    total,
  };
};

export default () => {
  const [customSearchLoading, setCustomSearchLoading] = useState(false);

  return (
    <ProTable<TableListItem>
      columns={columns}
      request={fetchTableData}
      rowKey="key"
      search={{
        defaultCollapsed: false,
        placeholder: 'Please input search keyword',
      }}
      toolbar={{
        title: 'Table Title',
        tooltip: 'This is a toolbar tooltip',
        search: {
          placeholder: 'Search Name',
          allowClear: true,
          onSearch: async (value) => {
            setCustomSearchLoading(true);
            if (!value) {
              setCustomSearchLoading(false);
              message.warning('Please input search keyword');
              return;
            }

            const response = await fetchCustomData({
              name: value,
            });

            console.log(response);

            setCustomSearchLoading(false);

            return response;
          },
        },
      }}
      loading={customSearchLoading}
    />
  );
};
```

æˆ‘å»ºè®®ä½ ä½¿ç”¨è¿™ä¸ªä»£ç ä½œä¸ºå‚è€ƒï¼Œå¹¶ç›¸åº”åœ°æ”¹å˜è¯·æ±‚ URL å’Œè¿”å›çš„æ•°æ®æ ¼å¼ã€‚è¿˜æœ‰ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ä¸Šé¢ç»™å‡ºçš„ä»£ç å—åªæ˜¯ä¸ºäº†å±•ç¤ºå¦‚ä½•ä½¿ç”¨è‡ªå®šä¹‰æœç´¢åŠŸèƒ½ï¼Œå®ç°äº†æ¯”å®˜æ–¹ä»£ç æ›´ç®€å•çš„å®ç°é€»è¾‘ã€‚å¦‚æœå¯èƒ½ï¼Œè¯·éµå¾ª Ant Design Pro å®˜æ–¹æ–‡æ¡£çš„è§„èŒƒã€‚
