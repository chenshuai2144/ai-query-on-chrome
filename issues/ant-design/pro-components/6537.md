# 🧐[问题 | question] ProTable toolbar search not works as expected when query

`AI Reply`

Default search works as expected, searchs,returns and changes table.
But when i try to use

```
toolbar={{
        search: {
          onSearch: async (value) => {
            const data = request(
              "http://localhost:5999/services/database/products",
              {
                headers: {
                  "Content-Type": "application/json",
                },
                method: "POST",
                data: {
                  mpName: value,
                },
              }
            );
            console.log(data);

            return data;
        },
  }}
```

does nothing to Table
Is there any guide to use this
![image](https://user-images.githubusercontent.com/112181162/213989271-558082fc-b8bf-4b45-a986-7f091d4fba24.png)
instead of this search query?
![image](https://user-images.githubusercontent.com/112181162/213989427-baa87b00-4df3-4c24-a35a-28bd07841100.png)'

Whole code:

```
import type { ProColumns } from "@ant-design/pro-components";
import { ProTable } from "@ant-design/pro-table";
import { Button } from "antd";
import { useEffect, useState } from "react";
import request from "umi-request";

export type TableListItem = {
  mpName: string;
};

const columns: ProColumns<TableListItem>[] = [
  {
    title: "Product",
    dataIndex: "mpName",
    render: (_) => <a>{_}</a>,
    ellipsis: false,
  },
];

export default () => {
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    setLoading(false);
  });
  return (
    <ProTable<TableListItem>
      columns={columns}
      loading={loading}
      request={async (params = {}, sorter, filter) => {
        const data = request<TableListItem[]>(
          "http://localhost:5999/ozon/services/database/products",
          {
            headers: {
              "Content-Type": "application/json",
            },
            method: "POST",
            data: {
              mpName: params.mpName,
            },
          }
        );
        console.log(data);
        return data;
      }}
      toolbar={{
        search: {
          onSearch: async (value) => {
            // setSearchLoading(true)
            // setSearchLoading(false)
            const data = request(
              "http://localhost:5999/services/database/products",
              {
                headers: {
                  "Content-Type": "application/json",
                },
                method: "POST",
                data: {
                  mpName: value,
                },
              }
            );
            console.log(data);

            return data;
          },
          key: "mpName",
          placeholder: "search by name",
          style: { width: 304 },
          allowClear: true,
          loading: false,
        },
        actions: [
          <Button
            key="primary"
            type="primary"
            onClick={() => {
              alert("add");
            }}
          >
            添加
          </Button>,
        ],
      }}
      rowKey="mpName"
    />
  );
};
```

What i expect?

I expect that the search field will change the table upon return, just like the standard search

## chenshuai2144

> TAutomatically replying with ChatGPT can be attempted, but it cannot be guaranteed to be completely accurate and may not fully address all issues. Please feel free to reply if you have any further questions or concerns.
> 此回复基于 ChatGPT 自动生成，可以尝试下方案，官方员会在一定时间后继续继续处理。

👋[解决方案 | Solution]
根据你的描述，你在 ProTable 组件中使用了一个自定义搜索功能，但是没有实现预期的效果。
首先，你必须保证输入框的 `key` 和请求参数的 `key` 是相同的。
其次，你需要将请求返回的数据格式转换成适合 ProTable 渲染的格式，例如：{ total: number, data: [] }。
最后，你需要更新 ProTable 组件的 `dataSource` 并且关闭搜索框的加载状态。
你可以使用如下代码实现这些功能：

```typescript
import { message } from 'antd';
import React, { useState } from 'react';
import { ProColumns, ProTable } from '@ant-design/pro-table';
import request from 'umi-request';

export interface TableListItem {
  name: string;
  age: number;
  address: string;
  [propName: string]: any;
}

const columns: ProColumns<TableListItem>[] = [
  {
    title: 'Name',
    dataIndex: 'name',
    formItemProps: {
      rules: [
        {
          required: true,
          message: 'Name is required',
        },
      ],
    },
  },
  {
    title: 'Age',
    dataIndex: 'age',
    sorter: true,
  },
  {
    title: 'Address',
    dataIndex: 'address',
    search: false,
  },
];

const fetchTableData = async (params: any) => {
  const response = await request('/api/table/list', {
    method: 'POST',
    params,
  });
  const { data, total } = response;
  return {
    data,
    total,
  };
};

const fetchCustomData = async (params: any) => {
  const response = await request('/api/table/custom', {
    method: 'POST',
    params,
  });
  const { data, total } = response;
  return {
    data,
    total,
  };
};

export default () => {
  const [customSearchLoading, setCustomSearchLoading] = useState(false);

  return (
    <ProTable<TableListItem>
      columns={columns}
      request={fetchTableData}
      rowKey="key"
      search={{
        defaultCollapsed: false,
        placeholder: 'Please input search keyword',
      }}
      toolbar={{
        title: 'Table Title',
        tooltip: 'This is a toolbar tooltip',
        search: {
          placeholder: 'Search Name',
          allowClear: true,
          onSearch: async (value) => {
            setCustomSearchLoading(true);
            if (!value) {
              setCustomSearchLoading(false);
              message.warning('Please input search keyword');
              return;
            }

            const response = await fetchCustomData({
              name: value,
            });

            console.log(response);

            setCustomSearchLoading(false);

            return response;
          },
        },
      }}
      loading={customSearchLoading}
    />
  );
};
```

我建议你使用这个代码作为参考，并相应地改变请求 URL 和返回的数据格式。还有，值得注意的是上面给出的代码块只是为了展示如何使用自定义搜索功能，实现了比官方代码更简单的实现逻辑。如果可能，请遵循 Ant Design Pro 官方文档的规范。
