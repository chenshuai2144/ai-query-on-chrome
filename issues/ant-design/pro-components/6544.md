# 🐛[BUG] ProTable组件 最后一页的数据删除以后， reload列表页， 页码还是请求当前页， 不会自动减1 ？

`AI Reply`

版本：ant-design/pro-components@1.1.14
版本：ant-design/pro-components@1.1.25

## wjf40390

我写了一个工具方法，可以参考下https://github.com/ant-design/pro-components/issues/72#issuecomment-1439358372

## chenshuai2144

> TAutomatically replying with ChatGPT can be attempted, but it cannot be guaranteed to be completely accurate and may not fully address all issues. Please feel free to reply if you have any further questions or concerns.
> 此回复基于 ChatGPT 自动生成，可以尝试下方案，官方员会在一定时间后继续继续处理。

你可以试试下面的代码，来解决你遇到的问题：

```javascript
import { ProTableProps } from '@ant-design/pro-table';
import { TablePaginationConfig } from 'antd/lib/table/interface';
import { useState } from 'react';

interface PaginationUtilProps {
  pageInfo: TablePaginationConfig;
  dataSourceLength: number;
  pageSize?: TablePaginationConfig['pageSize'];
  onPaginationChange?: (pageInfo: TablePaginationConfig) => void;
}

export const usePagination = <T extends object = any>(
  props: PaginationUtilProps = { pageInfo: { current: 1, pageSize: 20 }, dataSourceLength: 0 },
): [ProTableProps<T>['pagination'], (newPageInfo: TablePaginationConfig) => void] => {
  const { pageInfo: initialPageInfo, dataSourceLength, pageSize = 20 } = props;
  const [pageInfo, setPageInfo] = useState(initialPageInfo);
  const maxPage = Math.ceil(dataSourceLength / pageSize);

  const onPaginationChange = (newPageInfo: TablePaginationConfig) => {
    const { current, pageSize } = newPageInfo;
    if (current > maxPage) {
      newPageInfo.current = maxPage;
      setPageInfo(newPageInfo);
    } else onPaginationChange && onPaginationChange(newPageInfo);
  };

  const pagination = {
    ...pageInfo,
    total: dataSourceLength,
    onChange: onPaginationChange,
  };
  return [pagination, setPageInfo];
};
```

这段代码是让你通过 useState 来使用 antd 的分页，解决 antd 分页 bug，使用方法如下：

```javascript
import { usePagination } from '@/utils/hooks';
import ProTable from '@ant-design/pro-table';
import { request } from '@/utils';
import { Button } from 'antd';

type TableListItem = {
  name: string;
  age: number;
};

export default () => {
  const [paginationProps, setPaginationProps] = usePagination<TableListItem>({
    pageInfo: { current: 1, pageSize: 10 },
    dataSourceLength: 80,
  });

  return (
    <>
      <div style={{ width: 200 }}>
        <Button onClick={() => setPaginationProps({ ...paginationProps, current: 2 })}>点击跳转到第二页</Button>
      </div>
      <ProTable<TableListItem>
        request={async () => ({ data: [], success: true })}
        pagination={paginationProps}
        columns={[
          {
            title: '姓名',
            dataIndex: 'name',
          },
          {
            title: '年龄',
            dataIndex: 'age',
          },
        ]}
      />
    </>
  );
};
```

完整代码可见：https://codesandbox.io/s/zealous-tdd-oyy1s?file=/src/pages/TableList.tsx

## chenshuai2144

官网不会做这种边界不清晰的事情，这里建议删除之后自己处理一下
