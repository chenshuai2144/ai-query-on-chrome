# ğŸ›[BUG] ProTableç»„ä»¶ æœ€åä¸€é¡µçš„æ•°æ®åˆ é™¤ä»¥åï¼Œ reloadåˆ—è¡¨é¡µï¼Œ é¡µç è¿˜æ˜¯è¯·æ±‚å½“å‰é¡µï¼Œ ä¸ä¼šè‡ªåŠ¨å‡1 ï¼Ÿ

`AI Reply`

ç‰ˆæœ¬ï¼šant-design/pro-components@1.1.14
ç‰ˆæœ¬ï¼šant-design/pro-components@1.1.25

## wjf40390

æˆ‘å†™äº†ä¸€ä¸ªå·¥å…·æ–¹æ³•ï¼Œå¯ä»¥å‚è€ƒä¸‹https://github.com/ant-design/pro-components/issues/72#issuecomment-1439358372

## chenshuai2144

> TAutomatically replying with ChatGPT can be attempted, but it cannot be guaranteed to be completely accurate and may not fully address all issues. Please feel free to reply if you have any further questions or concerns.
> æ­¤å›å¤åŸºäº ChatGPT è‡ªåŠ¨ç”Ÿæˆï¼Œå¯ä»¥å°è¯•ä¸‹æ–¹æ¡ˆï¼Œå®˜æ–¹å‘˜ä¼šåœ¨ä¸€å®šæ—¶é—´åç»§ç»­ç»§ç»­å¤„ç†ã€‚

ä½ å¯ä»¥è¯•è¯•ä¸‹é¢çš„ä»£ç ï¼Œæ¥è§£å†³ä½ é‡åˆ°çš„é—®é¢˜ï¼š

```javascript
import { ProTableProps } from '@ant-design/pro-table';
import { TablePaginationConfig } from 'antd/lib/table/interface';
import { useState } from 'react';

interface PaginationUtilProps {
  pageInfo: TablePaginationConfig;
  dataSourceLength: number;
  pageSize?: TablePaginationConfig['pageSize'];
  onPaginationChange?: (pageInfo: TablePaginationConfig) => void;
}

export const usePagination = <T extends object = any>(
  props: PaginationUtilProps = { pageInfo: { current: 1, pageSize: 20 }, dataSourceLength: 0 },
): [ProTableProps<T>['pagination'], (newPageInfo: TablePaginationConfig) => void] => {
  const { pageInfo: initialPageInfo, dataSourceLength, pageSize = 20 } = props;
  const [pageInfo, setPageInfo] = useState(initialPageInfo);
  const maxPage = Math.ceil(dataSourceLength / pageSize);

  const onPaginationChange = (newPageInfo: TablePaginationConfig) => {
    const { current, pageSize } = newPageInfo;
    if (current > maxPage) {
      newPageInfo.current = maxPage;
      setPageInfo(newPageInfo);
    } else onPaginationChange && onPaginationChange(newPageInfo);
  };

  const pagination = {
    ...pageInfo,
    total: dataSourceLength,
    onChange: onPaginationChange,
  };
  return [pagination, setPageInfo];
};
```

è¿™æ®µä»£ç æ˜¯è®©ä½ é€šè¿‡ useState æ¥ä½¿ç”¨ antd çš„åˆ†é¡µï¼Œè§£å†³ antd åˆ†é¡µ bugï¼Œä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š

```javascript
import { usePagination } from '@/utils/hooks';
import ProTable from '@ant-design/pro-table';
import { request } from '@/utils';
import { Button } from 'antd';

type TableListItem = {
  name: string;
  age: number;
};

export default () => {
  const [paginationProps, setPaginationProps] = usePagination<TableListItem>({
    pageInfo: { current: 1, pageSize: 10 },
    dataSourceLength: 80,
  });

  return (
    <>
      <div style={{ width: 200 }}>
        <Button onClick={() => setPaginationProps({ ...paginationProps, current: 2 })}>ç‚¹å‡»è·³è½¬åˆ°ç¬¬äºŒé¡µ</Button>
      </div>
      <ProTable<TableListItem>
        request={async () => ({ data: [], success: true })}
        pagination={paginationProps}
        columns={[
          {
            title: 'å§“å',
            dataIndex: 'name',
          },
          {
            title: 'å¹´é¾„',
            dataIndex: 'age',
          },
        ]}
      />
    </>
  );
};
```

å®Œæ•´ä»£ç å¯è§ï¼šhttps://codesandbox.io/s/zealous-tdd-oyy1s?file=/src/pages/TableList.tsx

## chenshuai2144

å®˜ç½‘ä¸ä¼šåšè¿™ç§è¾¹ç•Œä¸æ¸…æ™°çš„äº‹æƒ…ï¼Œè¿™é‡Œå»ºè®®åˆ é™¤ä¹‹åè‡ªå·±å¤„ç†ä¸€ä¸‹
