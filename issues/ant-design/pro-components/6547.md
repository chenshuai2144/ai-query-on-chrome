# 🧐[问题] Protable 里的 Column Config/Selection 变化后, 有回调函数吗？我想保存已经选择的列。

`AI Reply`

### 🧐 问题描述

用户选择了Protable 里的 Column Config/Selection后,
我们想保存已经选择的列。

## Gip886

![image](https://user-images.githubusercontent.com/49873054/217735738-4b2bad02-7fad-4195-afd8-57a7ab6afbf7.png)

## chenshuai2144

> TAutomatically replying with ChatGPT can be attempted, but it cannot be guaranteed to be completely accurate and may not fully address all issues. Please feel free to reply if you have any further questions or concerns.
> 此回复基于 ChatGPT 自动生成，可以尝试下方案，官方员会在一定时间后继续继续处理。

### 🌵 回答

在Protable中，我们可以使用onColumnsStateChange事件来获取columns的状态更改，保存所选择的列。在使用onColumnsStateChange事件之前，需要将columns中的每一项的hideInTable属性值设置为false。

具体实现如下：

```jsx
import React, { useState } from "react";
import { Table } from "antd";
import ProTable, { TableDropdown } from "@ant-design/pro-table";

const dataSource = [
  {
    key: "1",
    name: "Mike",
    age: 32,
    address: "10 Downing Street",
  },
  {
    key: "2",
    name: "John",
    age: 42,
    address: "10 Downing Street",
  },
];

const columns = [
  {
    title: "Name",
    dataIndex: "name",
    key: "name",
  },
  {
    title: "Age",
    dataIndex: "age",
    key: "age",
    hideInTable: false,
  },
  {
    title: "Address",
    dataIndex: "address",
    key: "address",
    hideInTable: false,
  },
  {
    title: "",
    key: "option",
    valueType: "option",
    render: () => [
      <TableDropdown
        key="edit"
        onSelect={() => ({})}
        menus={[
          {
            key: "copy",
            name: "Copy",
          },
          {
            key: "delete",
            name: "Delete",
          },
        ]}
      />,
    ],
  },
];

export default () => {
  const [selectedColumns, setSelectedColumns] = useState([]);

  const handleColumnsStateChange = (val) => {
    // Map all selected columns and get the key
    const selected = Object.keys(val).filter((item) => !!val[item]);
    setSelectedColumns(selected);
  };

  return (
    <ProTable
      dataSource={dataSource}
      columns={columns}
      options={{
        search: true,
        setting: true,
        fullScreen: true,
      }}
      onColumnsStateChange={handleColumnsStateChange}
    />
  );
};
```

我们在这个例子中，使用了useState Hook中的selectedColumns来保存所选择的列key。在handleColumnsStateChange方法中，我们使用Object.keys和filter来从val中获取所有已选中的列的key值，然后将其保存在变量selected中，并赋值给selectedColumns。

另外，onColumnsStateChange还可以在columns状态发生变化时，立即执行回调函数来获取当前的state状态。该回调函数接受一个回调值作为参数，该回调值包含了当前columns的状态。这样，就可以在列的状态发生变化之后，立即执行相关逻辑，从而做到完美的适应。演示代码如下：

```jsx
const handleColumnsStateChange = (val) => {
  // Map all selected columns and get the key
  const selected = Object.keys(val).filter((item) => !!val[item]);
  setSelectedColumns(selected);

  // Print current columns status
  console.log(val);
};
```

### 📚 参考文档

- ProTable onColumnsStateChange：https://procomponents.ant.design/components/table/#onColumnsStateChange
