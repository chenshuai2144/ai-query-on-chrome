# ğŸ›[BUG]æ‹–åŠ¨æ’åºè¡¨æ ¼æ‹–åŠ¨çš„å…ƒç´ æ ·å¼ä¸¢å¤±

`â­•ï¸   bug`,`table`,`AI Reply`

### ğŸ› bug æè¿°

![image](https://user-images.githubusercontent.com/22299421/215746405-f686ebef-4250-4678-88b6-661d0063942f.png)

### ğŸ“· å¤ç°æ­¥éª¤

æ‹–åŠ¨è¡¨æ ¼è¡Œï¼Œæ ·å¼ä¸¢å¤±ï¼ˆæˆ‘çŸ¥é“å¯ä»¥é€šè¿‡è®¾ç½® class æ¥æ‰‹åŠ¨è®¾ç½®ï¼Œèƒ½ä¸èƒ½æä¾›è‡ªåŠ¨å¤„ç†çš„æ–¹æ¡ˆï¼Ÿï¼‰

### ğŸ æœŸæœ›ç»“æœ

æ‹–åŠ¨çš„è¡Œçš„æ ·å¼ä¸ä¸¢å¤±

### ğŸ’» å¤ç°ä»£ç 

https://procomponents.ant.design/components/drag-sort-table#dragsorttable-drag

### Â© ç‰ˆæœ¬ä¿¡æ¯

- ProComponents ç‰ˆæœ¬: [e.g. 4.0.0]
- umi ç‰ˆæœ¬
- æµè§ˆå™¨ç¯å¢ƒ
- å¼€å‘ç¯å¢ƒ [e.g. mac OS]

### ğŸš‘ å…¶ä»–ä¿¡æ¯

<!--
å¦‚æˆªå›¾ç­‰å…¶ä»–ä¿¡æ¯å¯ä»¥è´´åœ¨è¿™é‡Œ
-->

## chenshuai2144

> TAutomatically replying with ChatGPT can be attempted, but it cannot be guaranteed to be completely accurate and may not fully address all issues. Please feel free to reply if you have any further questions or concerns.
> æ­¤å›å¤åŸºäº ChatGPT è‡ªåŠ¨ç”Ÿæˆï¼Œå¯ä»¥å°è¯•ä¸‹æ–¹æ¡ˆï¼Œå®˜æ–¹å‘˜ä¼šåœ¨ä¸€å®šæ—¶é—´åç»§ç»­ç»§ç»­å¤„ç†ã€‚

ç”±äºæˆªå›¾ä¸èƒ½çœ‹åˆ°å®Œæ•´çš„ä»£ç ï¼Œå› æ­¤æˆ‘åªèƒ½æš‚æ—¶æä¾›ä»¥ä¸‹æ–¹å¼æ¥è§£å†³é—®é¢˜ã€‚

ä½ å¯ä»¥åœ¨ä½ çš„ CSS æ ·å¼ä¸­ä¸ºæ‹–åŠ¨æ—¶çš„å…ƒç´ æ·»åŠ ä¸€ä¸ªæ ·å¼ï¼š`user-select: none;`ã€‚è¿™æ ·åšå¯ä»¥é˜²æ­¢æœªé€‰æ‹©çš„æ–‡æœ¬åœ¨æ‹–åŠ¨æ—¶å‡ºç°ã€‚

ä½ å¯ä»¥åœ¨ä½ çš„ä»£ç ä¸­è¿™æ ·æ·»åŠ ï¼š

```
td, th {
  user-select: none;
}
```

å¯¹ `td` å’Œ `th` åº”ç”¨è¿™æ ·çš„æ ·å¼ï¼Œè¿™æ ·å°±å¯ä»¥é¿å…æ–‡æœ¬çš„é€‰æ‹©ã€‚

å¦‚æœæ‚¨è®¤ä¸ºè¿™ä»æœªè§£å†³é—®é¢˜ï¼Œè¯·æ‚¨æä¾›ä¸€ä¸ªæ›´è¯¦ç»†æ›´å…¨é¢çš„ code ç¤ºä¾‹ï¼Œæˆ‘ä»¬ä¼šå°½å¿«ä¸ºæ‚¨è§£å†³ã€‚

å¯ä»¥å‚è€ƒæ–‡æ¡£ï¼š

- [user-select](https://developer.mozilla.org/en-US/docs/Web/CSS/user-select)

## bigmgreen

å‡ºç°æ ·å¼ä¸¢å¤±é—®é¢˜çš„åŸå› æ˜¯æ‹–æ‹½æ—¶ä¼š clone ä¸€ä¸ªå…ƒç´ è·Ÿéšé¼ æ ‡ç§»åŠ¨ï¼Œè¿™ä¸ªå…ƒç´ å°±æ˜¯ä¸¢å¤±æ ·å¼çš„å…ƒç´ ï¼Œreact-sortable-hoc é»˜è®¤ä¼šæŠŠè¿™ä¸ªå…ƒç´ æ’å…¥åˆ° body ä¸Šï¼Œè€Œ ProTable ç»„ä»¶çš„æ ·å¼æœ‰åµŒå¥—å±‚çº§ï¼Œå› æ­¤ä¸¢å¤±äº†æ ·å¼ï¼Œç®€å•çš„è§£å†³æ–¹å¼é€šè¿‡ helperClass é‡æ–°å¤å†™ä¸‹æ ·å¼ï¼Œå¦‚æœæƒ³å°‘å†™äº›æ ·å¼ï¼Œå¯ä»¥å†è®¾ç½®ä¸‹ helperContainer è®©æŠŠ clone å…ƒç´ æ’å…¥åˆ°æŒ‡å®šä½ç½®ï¼Œæˆ‘æ˜¯è¿™æ ·æŒ‡å®šçš„

```jsx
const SortContainer = SortableContainer((props: any) => <tbody ref={tbodyRef} {...props} />)
```

è¿™ä¸ªæ—¶å€™ä¼šå‘ç°å¤§éƒ¨åˆ†æ ·å¼å·²ç»å›æ¥äº†ï¼Œä½†æ˜¯ td å®½åº¦å¤±æ•ˆï¼Œè§‚å¯Ÿåäº†è§£åˆ°ï¼Œæ˜¯ç”±äº clone å…ƒç´ çš„ `position: fixed;` å¯¼è‡´ï¼Œéœ€è¦æ‰‹åŠ¨è®¾ç½®ä¸‹å„ä¸ª td çš„å®½åº¦ï¼Œç›®å‰æˆ‘å°±è§£å†³åˆ°è¿™é‡Œäº†...

## mraiguo

> å‡ºç°æ ·å¼ä¸¢å¤±é—®é¢˜çš„åŸå› æ˜¯æ‹–æ‹½æ—¶ä¼š clone ä¸€ä¸ªå…ƒç´ è·Ÿéšé¼ æ ‡ç§»åŠ¨ï¼Œè¿™ä¸ªå…ƒç´ å°±æ˜¯ä¸¢å¤±æ ·å¼çš„å…ƒç´ ï¼Œreact-sortable-hoc é»˜è®¤ä¼šæŠŠè¿™ä¸ªå…ƒç´ æ’å…¥åˆ° body ä¸Šï¼Œè€Œ ProTable ç»„ä»¶çš„æ ·å¼æœ‰åµŒå¥—å±‚çº§ï¼Œå› æ­¤ä¸¢å¤±äº†æ ·å¼ï¼Œç®€å•çš„è§£å†³æ–¹å¼é€šè¿‡ helperClass é‡æ–°å¤å†™ä¸‹æ ·å¼ï¼Œå¦‚æœæƒ³å°‘å†™äº›æ ·å¼ï¼Œå¯ä»¥å†è®¾ç½®ä¸‹ helperContainer è®©æŠŠ clone å…ƒç´ æ’å…¥åˆ°æŒ‡å®šä½ç½®ï¼Œæˆ‘æ˜¯è¿™æ ·æŒ‡å®šçš„
>
> ```js
> const SortContainer = SortableContainer((props: any) => <tbody ref={tbodyRef} {...props} />)
> ```
>
> è¿™ä¸ªæ—¶å€™ä¼šå‘ç°å¤§éƒ¨åˆ†æ ·å¼å·²ç»å›æ¥äº†ï¼Œä½†æ˜¯ td å®½åº¦å¤±æ•ˆï¼Œè§‚å¯Ÿåäº†è§£åˆ°ï¼Œæ˜¯ç”±äº clone å…ƒç´ çš„ `position: fixed;` å¯¼è‡´ï¼Œéœ€è¦æ‰‹åŠ¨è®¾ç½®ä¸‹å„ä¸ª td çš„å®½åº¦ï¼Œç›®å‰æˆ‘å°±è§£å†³åˆ°è¿™é‡Œäº†...

æ˜¯çš„ï¼Œç›®å‰ä¹Ÿæ˜¯å¤„ç†åˆ°è¿™ä¸€æ­¥ï¼ˆå°±æ˜¯issueä¸Šè¯´çš„è‡ªå®šä¹‰classæ–¹å¼ï¼‰ï¼Œå› ä¸ºfixedçš„å…ƒç´ ä¼šè„±ç¦»tableçš„colgroup çš„ col é…ç½®è¿™ä¸ªtdå®½åº¦é—®é¢˜æ— æ³•å¤„ç†

## chenshuai2144

> TAutomatically replying with ChatGPT can be attempted, but it cannot be guaranteed to be completely accurate and may not fully address all issues. Please feel free to reply if you have any further questions or concerns.
> æ­¤å›å¤åŸºäº ChatGPT è‡ªåŠ¨ç”Ÿæˆï¼Œå¯ä»¥å°è¯•ä¸‹æ–¹æ¡ˆï¼Œå®˜æ–¹äººå‘˜ä¼šåœ¨ä¸€å®šæ—¶é—´åç»§ç»­ç»§ç»­å¤„ç†ã€‚

æ˜¯çš„ï¼Œå› ä¸ºè®¾ç½®äº† `position: fixed;`ï¼Œå°†å…ƒç´ ä»æ–‡æ¡£æµä¸­ç§»é™¤ã€‚ç”±äºæ¯ä¸ª table éƒ½æœ‰è‡ªå·±çš„ colgroup å’Œ col é…ç½®ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨å°†æ¯ä¸ª td çš„å®½åº¦å¤åˆ¶åˆ° clone å…ƒç´ çš„å¯¹åº” td ä¸Šï¼Œä»¥ä¿æŒä¸åŸå§‹è¡¨æ ¼ä¸­çš„æ ·å¼ä¸€è‡´ã€‚

è¿™é‡Œæœ‰ä¸€äº›ä»£ç ç¤ºä¾‹ï¼Œç”¨äºè§£å†³è¿™ä¸ªé—®é¢˜ï¼š

```jsx
import React, { useCallback, useEffect, useRef } from "react";
import { SortableContainer, SortableElement } from "react-sortable-hoc";

const DragSortTable = ({ dataSource, onSortEnd }) => {
  const tbodyRef = useRef(null);

  // å¤åˆ¶ td çš„æ ·å¼
  const setCellWidth = useCallback(() => {
    if (!tbodyRef.current) return;

    const tHeadCols =
      tbodyRef.current.previousElementSibling.querySelectorAll("col");
    const tBodyCols = tbodyRef.current.querySelectorAll("col");

    const tBodyTd = tbodyRef.current.querySelector("tr > td");

    const tableOffsetLeft = tbodyRef.current.parentNode.parentNode.offsetLeft;

    [...tHeadCols, ...tBodyCols].forEach((col, i) => {
      const width = col.offsetWidth;
      const left = col.offsetLeft;

      const cloneTds = tbodyRef.current.querySelectorAll(
        `tr > td:nth-child(${i + 1})`,
      );

      cloneTds.forEach((td) => {
        td.style.width = `${width}px`;
        td.style.position = "absolute";
        td.style.left = `${left}px`;
        td.style.top = "0px";
      });
    });

    tBodyTd &&
      (tbodyRef.current.parentElement.parentElement.style.width = `${tBodyTd.offsetWidth}px`);
    tbodyRef.current.parentElement.parentElement.style.position = "relative";
    tbodyRef.current.parentElement.parentElement.style.left = `${tableOffsetLeft}px`;
  }, []);

  useEffect(() => {
    setCellWidth();
    window.addEventListener("resize", setCellWidth);
    return () => window.removeEventListener("resize", setCellWidth);
  }, [setCellWidth]);

  const SortableItem = SortableElement(({ item }) => (
    <tr className="drag-sort-body-row">
      {item.map((cell, i) => (
        <td key={i}>{cell}</td>
      ))}
    </tr>
  ));

  const sortableDataSource = dataSource.map((item) => item.slice());

  const SortableList = SortableContainer(({ items }) => (
    <tbody ref={tbodyRef}>
      {items.map((item, index) => (
        <SortableItem key={index} index={index} item={item} />
      ))}
    </tbody>
  ));

  return (
    <table className="drag-sort-table">
      <colgroup>
        {dataSource[0].map((_, i) => (
          <col key={i} />
        ))}
      </colgroup>
      <SortableList
        items={sortableDataSource}
        onSortEnd={onSortEnd}
        helperClass="dragging-item"
      />
    </table>
  );
};
```

æ¢å¤æ ·å¼çš„å…³é”®åœ¨äºæ‰‹åŠ¨è®¡ç®—å¹¶è®¾ç½®æ¯ä¸ª td çš„æ ·å¼å±æ€§ï¼ˆå¦‚å®½åº¦ï¼Œä½ç½®ç­‰ï¼‰ã€‚ä¸Šé¢çš„ä»£ç å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ helperClass å’Œ helperContainer ä»¥åŠå¦‚ä½•ç›‘å¬ window çš„ resize äº‹ä»¶å¹¶é‡æ–°è®¾ç½®æ¯ä¸ª td çš„å®½åº¦ã€‚

å¦‚æœæ‚¨çš„è¡¨æ ¼ä¸æ˜¯æ‹–åŠ¨æ’åºï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ css æ–¹å¼æ¥é˜²æ­¢ç”¨æˆ·é€‰æ‹©æ‹–åŠ¨æœŸé—´çš„æ–‡æœ¬ã€‚

```css
td,
th {
  user-select: none;
}
```

è¿™å¯ä»¥é˜²æ­¢æœªé€‰æ‹©çš„æ–‡æœ¬åœ¨æ‹–åŠ¨æ—¶å‡ºç°ã€‚

è¿™å°±æ˜¯æˆ‘å¯ä»¥ä¸ºæ‚¨æä¾›çš„è§£å†³æ–¹æ¡ˆã€‚å¸Œæœ›è¿™å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼

## haobarry

å®˜æ–¹ä¾‹å­æ˜¯å¦‚ä½•å¤„ç†çš„ å®šä¹‰äº†ä¸€ä¸ªclass drag-visible ä½†æ˜¯æ²¡çœ‹åˆ°æ€ä¹ˆä½¿ç”¨åˆ°çš„

## haobarry

> ### ğŸ› bug æè¿°
>
> ![image](https://user-images.githubusercontent.com/22299421/215746405-f686ebef-4250-4678-88b6-661d0063942f.png)
>
> ### ğŸ“· å¤ç°æ­¥éª¤
>
> æ‹–åŠ¨è¡¨æ ¼è¡Œï¼Œæ ·å¼ä¸¢å¤±ï¼ˆæˆ‘çŸ¥é“å¯ä»¥é€šè¿‡è®¾ç½® class æ¥æ‰‹åŠ¨è®¾ç½®ï¼Œèƒ½ä¸èƒ½æä¾›è‡ªåŠ¨å¤„ç†çš„æ–¹æ¡ˆï¼Ÿï¼‰
>
> ### ğŸ æœŸæœ›ç»“æœ
>
> æ‹–åŠ¨çš„è¡Œçš„æ ·å¼ä¸ä¸¢å¤±
>
> ### ğŸ’» å¤ç°ä»£ç 
>
> https://procomponents.ant.design/components/drag-sort-table#dragsorttable-drag
>
> ### Â© ç‰ˆæœ¬ä¿¡æ¯
>
>     * ProComponents ç‰ˆæœ¬: [e.g. 4.0.0]
>
>     * umi ç‰ˆæœ¬
>
>     * æµè§ˆå™¨ç¯å¢ƒ
>
>     * å¼€å‘ç¯å¢ƒ [e.g. mac OS]
>
> ### ğŸš‘ å…¶ä»–ä¿¡æ¯
>
> ã€
> å¦‚ä½•ä½¿ç”¨è‡ªå®šä¹‰ç±»å¤„ç†ï¼Ÿ

## chenshuai2144

ä¿®å¤å•¦ï¼Œæˆ‘ä»¬æ¢äº†åº•å±‚ï¼Œè¿™æ¬¡ä¸ä¼šç¢°åˆ°è¿™ä¸ªé—®é¢˜äº†
