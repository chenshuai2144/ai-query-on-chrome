# ğŸ›[BUG] Failed to switch theme using vitejs

`AI Reply`

æé—®å‰å…ˆçœ‹çœ‹ï¼š

https://github.com/ryanhanwu/How-To-Ask-Questions-The-Smart-Way/blob/main/README-zh_CN.md

### ğŸ› bug æè¿°

Theme switching fails from the third switch when using StrictMode with the vitejs and Layout pro components. In the demo, if you perform the theme switch 3x, you will see that from the third attempt, the theme does not switch anymore, if you remove StrictMode from React, the switch occurs fluidly.

### ğŸ“· å¤ç°æ­¥éª¤

Just click on the icon to change to Dark, then to Light, and finally to Dark again.
![image](https://user-images.githubusercontent.com/121313313/218284217-35e4004d-2a60-4342-ab25-07b13263ce46.png)

### ğŸ æœŸæœ›ç»“æœ

![image](https://user-images.githubusercontent.com/121313313/218284268-5a572036-1946-49e1-899b-6c2e5f476cc4.png)

### ğŸ’» å¤ç°ä»£ç 

https://stackblitz.com/edit/vitejs-vite-th7stb

### Â© ç‰ˆæœ¬ä¿¡æ¯

- ProComponents ç‰ˆæœ¬: 2.3.54
- vitejs ç‰ˆæœ¬: 4.1.1
- antd: 5.2.0
- React: 18.2.0
- å¼€å‘ç¯å¢ƒ: Windows 11

### ğŸš‘ å…¶ä»–ä¿¡æ¯

<!--
å¦‚æˆªå›¾ç­‰å…¶ä»–ä¿¡æ¯å¯ä»¥è´´åœ¨è¿™é‡Œ
-->

## chenshuai2144

> TAutomatically replying with ChatGPT can be attempted, but it cannot be guaranteed to be completely accurate and may not fully address all issues. Please feel free to reply if you have any further questions or concerns.
> æ­¤å›å¤åŸºäº ChatGPT è‡ªåŠ¨ç”Ÿæˆï¼Œå¯ä»¥å°è¯•ä¸‹æ–¹æ¡ˆï¼Œå®˜æ–¹å‘˜ä¼šåœ¨ä¸€å®šæ—¶é—´åç»§ç»­ç»§ç»­å¤„ç†ã€‚

æ ¹æ®æ‚¨æä¾›çš„ä¿¡æ¯ï¼Œè¿™å¯èƒ½æ˜¯ä¸€ä¸ªä¸ React 18 ä¸­ StrictMode æœ‰å…³çš„é—®é¢˜ã€‚æ‚¨å¯ä»¥å°è¯•æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬çš„ Reactï¼ˆç›®å‰æ˜¯18.2.0ï¼‰ä»¥è§£å†³æ­¤é—®é¢˜ã€‚

åŒæ—¶ï¼Œä¹Ÿå¯ä»¥å°è¯•ä½¿ç”¨ `React.unstable_useTransistioin` å‡½æ•°æ¥è·å–æ›´å¤šçš„è·Ÿè¸ªä¿¡æ¯ï¼Œä»¥ä¾¿æ›´å¥½åœ°æ‰¾å‡ºé—®é¢˜æ‰€åœ¨ï¼š

```jsx
import { useTransition } from "react";

const animation = {
  from: { opacity: 0 },
  enter: { opacity: 1 },
  leave: { opacity: 0 },
};

function App() {
  const [theme, setTheme] = useState("light");

  const transitions = useTransition(theme, {
    ...animation,
    config: { duration: 200 },
  });

  const changeTheme = () => {
    setTheme((prevTheme) => (prevTheme === "light" ? "dark" : "light"));
  };

  return (
    <div>
      <h1>Hello React</h1>

      {transitions((style, item) => (
        <div style={{ ...style }}>
          <MyLayout style={{ ...style }} theme={item} />
        </div>
      ))}

      <button onClick={changeTheme}>Toggle Theme</button>
    </div>
  );
}
```

è¿™é‡Œä½¿ç”¨äº† `useTransition` å‡½æ•°ï¼Œå®ƒæ”¯æŒ `Spring` é£æ ¼çš„åŠ¨ç”»ï¼Œå¯ä»¥å¸®åŠ©æ‚¨åœ¨åˆ‡æ¢è¿‡ç¨‹ä¸­è¿›è¡Œæ›´ç»†è‡´çš„æ§åˆ¶å’Œè°ƒè¯•ã€‚

å¯¹äº Layout Pro çš„ä½¿ç”¨ï¼Œæ‚¨ä¹Ÿå¯ä»¥å°è¯•å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼Œäº†è§£æ›´å¤šçš„ä½¿ç”¨æŠ€å·§å’Œæœ€ä½³å®è·µï¼š

- å®˜æ–¹æ–‡æ¡£ï¼šhttps://procomponents.ant.design/components/layout-cn/

## andersonrochas

> > TAutomatically replying with ChatGPT can be attempted, but it cannot be guaranteed to be completely accurate and may not fully address all issues. Please feel free to reply if you have any further questions or concerns.
> > æ­¤å›å¤åŸºäº ChatGPT è‡ªåŠ¨ç”Ÿæˆï¼Œå¯ä»¥å°è¯•ä¸‹æ–¹æ¡ˆï¼Œå®˜æ–¹å‘˜ä¼šåœ¨ä¸€å®šæ—¶é—´åç»§ç»­ç»§ç»­å¤„ç†ã€‚
>
> æ ¹æ®æ‚¨æä¾›çš„ä¿¡æ¯ï¼Œè¿™å¯èƒ½æ˜¯ä¸€ä¸ªä¸ React 18 ä¸­ StrictMode æœ‰å…³çš„é—®é¢˜ã€‚æ‚¨å¯ä»¥å°è¯•æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬çš„ Reactï¼ˆç›®å‰æ˜¯18.2.0ï¼‰ä»¥è§£å†³æ­¤é—®é¢˜ã€‚
>
> åŒæ—¶ï¼Œä¹Ÿå¯ä»¥å°è¯•ä½¿ç”¨ `React.unstable_useTransistioin` å‡½æ•°æ¥è·å–æ›´å¤šçš„è·Ÿè¸ªä¿¡æ¯ï¼Œä»¥ä¾¿æ›´å¥½åœ°æ‰¾å‡ºé—®é¢˜æ‰€åœ¨ï¼š
>
> ```js
> import { useTransition } from "react";
>
> const animation = {
>   from: { opacity: 0 },
>   enter: { opacity: 1 },
>   leave: { opacity: 0 },
> };
>
> function App() {
>   const [theme, setTheme] = useState("light");
>
>   const transitions = useTransition(theme, {
>     ...animation,
>     config: { duration: 200 },
>   });
>
>   const changeTheme = () => {
>     setTheme((prevTheme) => (prevTheme === "light" ? "dark" : "light"));
>   };
>
>   return (
>     <div>
>       <h1>Hello React</h1>
>
>       {transitions((style, item) => (
>         <div style={{ ...style }}>
>           <MyLayout style={{ ...style }} theme={item} />
>         </div>
>       ))}
>
>       <button onClick={changeTheme}>Toggle Theme</button>
>     </div>
>   );
> }
> ```
>
> è¿™é‡Œä½¿ç”¨äº† `useTransition` å‡½æ•°ï¼Œå®ƒæ”¯æŒ `Spring` é£æ ¼çš„åŠ¨ç”»ï¼Œå¯ä»¥å¸®åŠ©æ‚¨åœ¨åˆ‡æ¢è¿‡ç¨‹ä¸­è¿›è¡Œæ›´ç»†è‡´çš„æ§åˆ¶å’Œè°ƒè¯•ã€‚
>
> å¯¹äº Layout Pro çš„ä½¿ç”¨ï¼Œæ‚¨ä¹Ÿå¯ä»¥å°è¯•å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼Œäº†è§£æ›´å¤šçš„ä½¿ç”¨æŠ€å·§å’Œæœ€ä½³å®è·µï¼š
>
> - å®˜æ–¹æ–‡æ¡£ï¼šhttps://procomponents.ant.design/components/layout-cn/

Hello, I tried it your way and I tried using ChatGPT too, using transitions there was no effect, already using the AI â€‹â€‹suggestion (Add the key property passing the theme value), it worked perfectly. I've updated the example with the suggestion: https://stackblitz.com/edit/vitejs-vite-qlm1xy
