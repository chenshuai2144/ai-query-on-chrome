# ğŸ›[BUG]ProFormList ç»„ä»¶æ— æ³•é€šè¿‡actionRefè·å–æŸä¸€è¡Œæ•°æ®

`AI Reply`

### ğŸ› bug æè¿°

ProFormList ç»„ä»¶æ— æ³•é€šè¿‡actionRefè·å–æŸä¸€è¡Œæ•°æ®å’Œformlistä¸­çš„æ‰€æœ‰æ•°æ®
const row = actionRef.current?.get(1); // è¿”å›çš„æ˜¯undefined

### ğŸ’» å¤ç°ä»£ç 

https://codesandbox.io/s/rzvhik

<!--
æä¾›å¯å¤ç°çš„ä»£ç ï¼Œä»“åº“ï¼Œæˆ–çº¿ä¸Šç¤ºä¾‹
-->

### Â© ç‰ˆæœ¬ä¿¡æ¯

- ProComponents ç‰ˆæœ¬: [2.3.54]
- umi ç‰ˆæœ¬
- æµè§ˆå™¨ç¯å¢ƒ
- å¼€å‘ç¯å¢ƒ [e.g. mac OS]

### ğŸš‘ å…¶ä»–ä¿¡æ¯

<!--
å¦‚æˆªå›¾ç­‰å…¶ä»–ä¿¡æ¯å¯ä»¥è´´åœ¨è¿™é‡Œ
-->

## flyingmylo

ç¤ºä¾‹ä¸­æ²¡å†™è¿™ä¸ªï¼š
![image](https://user-images.githubusercontent.com/22828986/218916048-2cabbc6a-13e8-4791-9e7f-9525deb67b24.png)

## 2018Cool

åŠ ä¸Šäº†ä¹Ÿä¸è¡Œ

## flyingmylo

>

ç¤ºä¾‹ä¸­åŠ ä¸Šäº†æ˜¯å¯ä»¥çš„ï¼Œå¯èƒ½ä½ é€»è¾‘é‡Œå†™çš„æœ‰é—®é¢˜å§ã€‚

## chenshuai2144

> TAutomatically replying with ChatGPT can be attempted, but it cannot be guaranteed to be completely accurate and may not fully address all issues. Please feel free to reply if you have any further questions or concerns.
> æ­¤å›å¤åŸºäº ChatGPT è‡ªåŠ¨ç”Ÿæˆï¼Œå¯ä»¥å°è¯•ä¸‹æ–¹æ¡ˆï¼Œå®˜æ–¹å‘˜ä¼šåœ¨ä¸€å®šæ—¶é—´åç»§ç»­ç»§ç»­å¤„ç†ã€‚

æ ¹æ®ä½ æä¾›çš„ä¿¡æ¯ï¼Œå‘ç°ä½ ä½¿ç”¨çš„æ˜¯ ProFormList çš„ actionRef åŠŸèƒ½æ— æ³•è·å–åˆ°æŸä¸€è¡Œå’Œè·å–æ‰€æœ‰æ•°æ®ã€‚

é€šè¿‡æŸ¥é˜… ProFormList çš„æ–‡æ¡£ï¼Œå‘ç°åœ¨æ—©æœŸçš„ç‰ˆæœ¬æœ‰ä¸ª issue å…³äºæ— æ³•å¾—åˆ° FormInstance æ¡ˆä¾‹(https://github.com/ant-design/pro-components/issues/1473)ã€‚åœ¨æœ€æ–°çš„ 2.3.54 ç‰ˆæœ¬å·²ç»ä¿®å¤ã€‚

å› æ­¤å»ºè®®ä½ å…ˆæ›´æ–° ProComponents çš„ç‰ˆæœ¬ï¼Œå¦‚æœä»æœ‰é—®é¢˜å¯ä»¥æä¾›æ›´å¤šç»†èŠ‚ï¼Œä»¥ä¾¿æˆ‘èƒ½å¤Ÿæ›´å¥½çš„å¸®åŠ©ä½ ã€‚åŒæ—¶ï¼Œå¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£å¯¹ ProFormList çš„è®²è§£(https://procomponents.ant.design/components/form-list-cn/)ã€‚

å¦å¤–ï¼Œåœ¨ä½ çš„ä»£ç å®ç°çš„æ—¶å€™ï¼Œå»ºè®®å¯¹ list å’Œ ref è¿›è¡Œéå†ä»¥åŠä¼˜å…ˆç»‘å®š actionRef ä»¥ä¾¿è°ƒç”¨ç»„ä»¶å†…éƒ¨çš„æ–¹æ³•ã€‚

```jsx
import React, { useRef } from 'react';
import ProForm, {
  ProFormList,
  ProFormText,
  ProFormDatePicker,
  ProFormDateTimePicker,
} from '@ant-design/pro-form';

const handleAdd = (values, ref) => {
  console.log('handleAdd call');
  console.log(values);
  console.log(ref.current.getFieldValue());
};

const Page: React.FC = () => {
  const actionRef = useRef();

  return (
    <div>
      <ProForm initialValues={{ users: [{ name: 'cjf', sex: 'male' }] }}>
        <ProFormList
          name="users"
          label="ç”¨æˆ·ä¿¡æ¯"
          rules={[{ required: true, message: 'è¯·è¾“å…¥è‡³å°‘ä¸€ä¸ªç”¨æˆ·ä¿¡æ¯' }]}
          key="UserList"
          actionRef={actionRef}
        >
          {(fields, { add, remove }, { list }) => {
            console.log(11111); // æ­¤å¤„åº”è¯¥è¾“å‡ºä¸¤æ¬¡ï¼Œåˆ†åˆ«æ˜¯ç¬¬ä¸€æ¬¡æ¸²æŸ“å’Œæ·»åŠ ä¸€è¡Œè®°å½•çš„ä¹‹åè§¦å‘ã€‚
            console.log(actionRef.current); // æ­¤å¤„åº”è¯¥å¯ä»¥è¾“å‡ºéç©ºçš„å€¼
          return (
            <>
              {fields.map((field, index) => (
                <div style={{ display: 'flex', marginBottom: 8 }} key={field.key}>
                  <ProFormText
                    // ä½ çš„å®ç°å¯èƒ½è¿˜éœ€è¦æ ¹æ®è¡¨å•å€¼çš„å®æ—¶å˜åŒ–å»ä¿®æ”¹æŸä¸ª field çš„å€¼ï¼Œè¿™ç§æƒ…å†µä¸‹å¯ä»¥åœ¨è¿™é‡Œé€šè¿‡ setFieldValue æ›´æ–°å€¼
                    width="md"
                    name={[field.name, 'name']}
                    fieldKey={[field.fieldKey, 'name']}
                    label={`ç”¨æˆ· ${index + 1} å§“å`}
                    placeholder="è¯·è¾“å…¥"
                    rules={[{ required: true, message: 'è¯·è¾“å…¥ç”¨æˆ·å§“å' }]}
                  />
                  <ProFormDatePicker
                    width="md"
                    name={[field.name, 'birth']}
                    label="ç”Ÿæ—¥"
                    fieldKey={[field.fieldKey, 'birth']}
                    rules={[{ required: true, message: 'è¯·é€‰æ‹©ç”¨æˆ·ç”Ÿæ—¥' }]}
                  />
                  <ProFormDateTimePicker
                    width="md"
                    name={[field.name, 'time']}
                    label="æ—¶é—´"
                    fieldKey={[field.fieldKey, 'time']}
                  />
                  <div style={{ marginLeft: 8 }}>
                    <a key={`${field.name}_${field.key}_remove`} onClick={() => remove(field.name)}>
                      åˆ é™¤
                    </a>
                  </div>
                </div>
              ))}
              <div
                style={{
                  display: 'flex',
                  justifyContent: 'center',
                }}
              >
                <a onClick={() => {add(); handleAdd(list, actionRef)}}>æ·»åŠ ç”¨æˆ·</a>
              </div>
            </>
          );
        }}
        </ProFormList>
      </ProForm>
    </div>
  );
};

export default Page;

```

## tsuyoii

> > TAutomatically replying with ChatGPT can be attempted, but it cannot be guaranteed to be completely accurate and may not fully address all issues. Please feel free to reply if you have any further questions or concerns.
> > æ­¤å›å¤åŸºäº ChatGPT è‡ªåŠ¨ç”Ÿæˆï¼Œå¯ä»¥å°è¯•ä¸‹æ–¹æ¡ˆï¼Œå®˜æ–¹å‘˜ä¼šåœ¨ä¸€å®šæ—¶é—´åç»§ç»­ç»§ç»­å¤„ç†ã€‚
>
> æ ¹æ®ä½ æä¾›çš„ä¿¡æ¯ï¼Œå‘ç°ä½ ä½¿ç”¨çš„æ˜¯ ProFormList çš„ actionRef åŠŸèƒ½æ— æ³•è·å–åˆ°æŸä¸€è¡Œå’Œè·å–æ‰€æœ‰æ•°æ®ã€‚
>
> é€šè¿‡æŸ¥é˜… ProFormList çš„æ–‡æ¡£ï¼Œå‘ç°åœ¨æ—©æœŸçš„ç‰ˆæœ¬æœ‰ä¸ª issue å…³äºæ— æ³•å¾—åˆ° FormInstance æ¡ˆä¾‹([https://github.com/ant-design/pro-components/issues/1473)ã€‚åœ¨æœ€æ–°çš„](https://github.com/ant-design/pro-components/issues/1473)%E3%80%82%E5%9C%A8%E6%9C%80%E6%96%B0%E7%9A%84) 2.3.54 ç‰ˆæœ¬å·²ç»ä¿®å¤ã€‚
>
> å› æ­¤å»ºè®®ä½ å…ˆæ›´æ–° ProComponents çš„ç‰ˆæœ¬ï¼Œå¦‚æœä»æœ‰é—®é¢˜å¯ä»¥æä¾›æ›´å¤šç»†èŠ‚ï¼Œä»¥ä¾¿æˆ‘èƒ½å¤Ÿæ›´å¥½çš„å¸®åŠ©ä½ ã€‚åŒæ—¶ï¼Œå¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£å¯¹ ProFormList çš„è®²è§£([https://procomponents.ant.design/components/form-list-cn/)ã€‚](https://procomponents.ant.design/components/form-list-cn/)%E3%80%82)
>
> å¦å¤–ï¼Œåœ¨ä½ çš„ä»£ç å®ç°çš„æ—¶å€™ï¼Œå»ºè®®å¯¹ list å’Œ ref è¿›è¡Œéå†ä»¥åŠä¼˜å…ˆç»‘å®š actionRef ä»¥ä¾¿è°ƒç”¨ç»„ä»¶å†…éƒ¨çš„æ–¹æ³•ã€‚
>
> ```js
> import React, { useRef } from 'react';
> import ProForm, {
>   ProFormList,
>   ProFormText,
>   ProFormDatePicker,
>   ProFormDateTimePicker,
> } from '@ant-design/pro-form';
>
> const handleAdd = (values, ref) => {
>   console.log('handleAdd call');
>   console.log(values);
>   console.log(ref.current.getFieldValue());
> };
>
> const Page: React.FC = () => {
>   const actionRef = useRef();
>
>   return (
>     <div>
>       <ProForm initialValues={{ users: [{ name: 'cjf', sex: 'male' }] }}>
>         <ProFormList
>           name="users"
>           label="ç”¨æˆ·ä¿¡æ¯"
>           rules={[{ required: true, message: 'è¯·è¾“å…¥è‡³å°‘ä¸€ä¸ªç”¨æˆ·ä¿¡æ¯' }]}
>           key="UserList"
>           actionRef={actionRef}
>         >
>           {(fields, { add, remove }, { list }) => {
>             console.log(11111); // æ­¤å¤„åº”è¯¥è¾“å‡ºä¸¤æ¬¡ï¼Œåˆ†åˆ«æ˜¯ç¬¬ä¸€æ¬¡æ¸²æŸ“å’Œæ·»åŠ ä¸€è¡Œè®°å½•çš„ä¹‹åè§¦å‘ã€‚
>             console.log(actionRef.current); // æ­¤å¤„åº”è¯¥å¯ä»¥è¾“å‡ºéç©ºçš„å€¼
>           return (
>             <>
>               {fields.map((field, index) => (
>                 <div style={{ display: 'flex', marginBottom: 8 }} key={field.key}>
>                   <ProFormText
>                     // ä½ çš„å®ç°å¯èƒ½è¿˜éœ€è¦æ ¹æ®è¡¨å•å€¼çš„å®æ—¶å˜åŒ–å»ä¿®æ”¹æŸä¸ª field çš„å€¼ï¼Œè¿™ç§æƒ…å†µä¸‹å¯ä»¥åœ¨è¿™é‡Œé€šè¿‡ setFieldValue æ›´æ–°å€¼
>                     width="md"
>                     name={[field.name, 'name']}
>                     fieldKey={[field.fieldKey, 'name']}
>                     label={`ç”¨æˆ· ${index + 1} å§“å`}
>                     placeholder="è¯·è¾“å…¥"
>                     rules={[{ required: true, message: 'è¯·è¾“å…¥ç”¨æˆ·å§“å' }]}
>                   />
>                   <ProFormDatePicker
>                     width="md"
>                     name={[field.name, 'birth']}
>                     label="ç”Ÿæ—¥"
>                     fieldKey={[field.fieldKey, 'birth']}
>                     rules={[{ required: true, message: 'è¯·é€‰æ‹©ç”¨æˆ·ç”Ÿæ—¥' }]}
>                   />
>                   <ProFormDateTimePicker
>                     width="md"
>                     name={[field.name, 'time']}
>                     label="æ—¶é—´"
>                     fieldKey={[field.fieldKey, 'time']}
>                   />
>                   <div style={{ marginLeft: 8 }}>
>                     <a key={`${field.name}_${field.key}_remove`} onClick={() => remove(field.name)}>
>                       åˆ é™¤
>                     </a>
>                   </div>
>                 </div>
>               ))}
>               <div
>                 style={{
>                   display: 'flex',
>                   justifyContent: 'center',
>                 }}
>               >
>                 <a onClick={() => {add(); handleAdd(list, actionRef)}}>æ·»åŠ ç”¨æˆ·</a>
>               </div>
>             </>
>           );
>         }}
>         </ProFormList>
>       </ProForm>
>     </div>
>   );
> };
>
> export default Page;
> ```
>
> æŠ¥é”™å•¦å“¥
> <img width="612" alt="image" src="https://user-images.githubusercontent.com/49632080/233245735-16c476a5-f362-4838-912d-f8c8920d0781.png">
