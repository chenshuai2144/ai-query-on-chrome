# ğŸ›[BUG]ProFormçš„formRefæˆ–è€…formï¼Œè°ƒç”¨getFieldInstanceæ–¹æ³•è·å–ProformTextï¼Œåªèƒ½å¾—åˆ°undefinedï¼Œä½†æ˜¯Inputå°±å¯ä»¥æ­£ç¡®æ‹¿åˆ°å€¼

`AI Reply`

### ğŸ› bug æè¿°

ProFormçš„formRefï¼Œè°ƒç”¨setFieldsValueæ­£å¸¸ï¼Œä½†æ˜¯è°ƒç”¨getFieldInstanceæ–¹æ³•è·å–ProformTextï¼Œåªèƒ½å¾—åˆ°undefined

### ğŸ’» å¤ç°ä»£ç 

```
import { Button, Form, Input } from 'antd'
import { ProForm, ProFormText, ProFormInstance } from '@ant-design/pro-components';
import { useRef } from 'react'

export default () => {

    //const [form] = Form.useForm()
    const form =ProForm.useFormInstance()
    const formRef = useRef<ProFormInstance>()

    return (

        <>
            <ProForm
                form={form}
                formRef={formRef}
            >
                <Form.Item name='hello'>
                    <Input />
                </Form.Item>

                <ProFormText name='world' />
            </ProForm>ld
            <Button type='primary' onClick={() => {
                console.log('form=Form.useForm()è·å–åˆ°çš„å€¼hello', form?.getFieldInstance('hello')) // è·å–åˆ°input
                console.log('form=Form.useForm()è·å–åˆ°çš„å€¼world', form?.getFieldInstance('world')) // undefined
                console.log('form=ProForm.useFormInstance()è·å–åˆ°çš„å€¼hello', form?.getFieldInstance('hello')) // undefined
                console.log('form=ProForm.useFormInstance()è·å–åˆ°çš„å€¼world', form?.getFieldInstance('world')) // undefined
                console.log('formRefè·å–åˆ°çš„å€¼hello', formRef?.current?.getFieldInstance('hello')) // è·å–åˆ°input
                console.log('formRefè·å–åˆ°çš„å€¼world', formRef?.current?.getFieldInstance('world')) // undefined
            }}>è·å–</Button>
        </>

    )
}
```

### Â© ç‰ˆæœ¬ä¿¡æ¯

- ProComponents ç‰ˆæœ¬: ^2.3.54
- umi ç‰ˆæœ¬
- æµè§ˆå™¨ç¯å¢ƒ:Google Chrome
- å¼€å‘ç¯å¢ƒ win11

## chenshuai2144

> TAutomatically replying with ChatGPT can be attempted, but it cannot be guaranteed to be completely accurate and may not fully address all issues. Please feel free to reply if you have any further questions or concerns.
> æ­¤å›å¤åŸºäº ChatGPT è‡ªåŠ¨ç”Ÿæˆï¼Œå¯ä»¥å°è¯•ä¸‹æ–¹æ¡ˆï¼Œå®˜æ–¹å‘˜ä¼šåœ¨ä¸€å®šæ—¶é—´åç»§ç»­ç»§ç»­å¤„ç†ã€‚

### ğŸ”é—®é¢˜åˆ†æ

æ ¹æ®æä¾›çš„ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å­˜åœ¨ `form` å’Œ `formRef` ä¸¤ä¸ªä¸åŒçš„è¡¨å•å®ä¾‹ã€‚å…¶ä¸­ `form` æ˜¯ä½¿ç”¨ `ProForm.useFormInstance()` æ–¹æ³•è·å–çš„ï¼Œ`formRef` æ˜¯ä½¿ç”¨ `useRef()` åˆ›å»ºçš„å¹¶å°†å…¶ä¼ é€’åˆ° `ProForm` çš„ `formRef`å±æ€§ä¸Šã€‚

é’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦æŸ¥çœ‹ `getFieldInstance` æ–¹æ³•çš„å®ç°è¿‡ç¨‹ï¼Œå¯ä»¥ä» `@ant-design/pro-utils` åŒ…ä¸­æŸ¥çœ‹è¯¥æ–¹æ³•çš„å…·ä½“å®ç°å’Œå†…éƒ¨å®ç°æ˜¯å¦å­˜åœ¨é”™è¯¯ã€‚

åŒæ—¶æˆ‘ä»¬éœ€è¦è€ƒè™‘ ProFormText ç»„ä»¶å’Œè¡¨å•å®ä¾‹ä¹‹é—´çš„å…³ç³»ï¼Œå› ä¸ºåªæœ‰åœ¨ ProFormText å®ä¾‹æ³¨å†Œåˆ°è¡¨å•å®ä¾‹æ—¶ï¼Œæ‰ä¼šæ­£å¸¸è·å–å…¶å®ä¾‹å¹¶ä½¿ç”¨ `getFieldInstance` æ–¹æ³•ã€‚

### ğŸŒ± è§£å†³æ–¹æ¡ˆ

æˆ‘ä»¬å¯ä»¥å°è¯•å°† `form` å’Œ `formRef` ä¸¤ä¸ªè¡¨å•å®ä¾‹æ˜¾å¼åœ°å£°æ˜ä¸º `ProFormInstance` ç±»å‹ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š

```jsx
import { Button, Form, Input } from 'antd';
import { ProForm, ProFormText } from '@ant-design/pro-components';
import type ProFormInstance from '@ant-design/pro-form/lib/interface';

const MyForm = () => {
  const formRef = useRef<ProFormInstance>(null);
  const [form] = ProForm.useFormInstance<ProFormInstance>();

  useEffect(() => {
    // æ³¨å†Œè¡¨å•é¡¹ï¼Œè¿™é‡Œæ˜¯åœ¨ç»„ä»¶ mount åæ³¨å†Œ
    formRef.current?.setFieldInstance('world', [null]);
  }, []);

  return (
    <ProForm form={form} formRef={formRef}>
      <Form.Item name="hello">
        <Input />
      </Form.Item>

      <ProFormText name="world" />
      <Button
        onClick={() => {
          console.log('form.getFieldInstance(hello)', form.getFieldInstance('hello'));
          console.log('form.getFieldInstance(world)', form.getFieldInstance('world'));
          console.log('formRef.getFieldInstance(hello)', formRef.current?.getFieldInstance('hello'));
          console.log('formRef.getFieldInstance(world)', formRef.current?.getFieldInstance('world'));
        }}
      >
        è·å–
      </Button>
    </ProForm>
  );
}

export default MyForm;
```

ä»ä»£ç ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ `useEffect` å›è°ƒä¸­ä¸º `ProFormText` æ³¨å†Œåˆ°è¡¨å•å®ä¾‹ä¸­ï¼Œä»¥ç¡®ä¿èƒ½å¤Ÿæ­£å¸¸è·å–å…¶å®ä¾‹ã€‚æ­¤å¤–ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ `formRef.current` å¯èƒ½ä¸ºç©ºï¼Œå› æ­¤éœ€è¦åœ¨è°ƒç”¨æ–¹æ³•æ—¶åšå¥½ç©ºå€¼åˆ¤æ–­ã€‚

### ğŸ“š æ–‡æ¡£å‚è€ƒ

- @ant-design/pro-utils çš„ getFieldInstance æ–¹æ³•å®ç°
- @ant-design/pro-form çš„ useFormInstance æ–¹æ³•
- @ant-design/pro-form çš„ ProFormInstance æ¥å£ç±»å‹å®šä¹‰
