# ğŸ›[BUG]å•å…ƒæµ‹è¯•EditableProTableå‘ç°onValuesChangeä¸å›è°ƒ/å›è°ƒçš„recordæ²¡æœ‰id

`AI Reply`

æé—®å‰å…ˆçœ‹çœ‹ï¼š

https://github.com/ryanhanwu/How-To-Ask-Questions-The-Smart-Way/blob/main/README-zh_CN.md

### ğŸ› bug æè¿°

componentå†…ç”¨äº†EditableProTableï¼Œæœ¬åœ°å’Œéƒ¨ç½²ååŠŸèƒ½éƒ½æ­£å¸¸ï¼ŒonValuesChangeçš„å›è°ƒä¹Ÿéƒ½æ­£å¸¸ã€‚ä½†æ˜¯å•å…ƒæµ‹è¯•çš„æ—¶å€™å‘ç°onValuesChangeçš„å›è°ƒä¸æ­£å¸¸

**åœ¨å…¬å¸å’Œå®¶é‡Œå¤ç°å‡ºçš„bugè¿˜ä¸ä¸€æ ·**
å…¬å¸ï¼šonValuesChangeä¼šå›è°ƒï¼Œä½†æ˜¯recordæ‹¿ä¸åˆ°æ²¡æœ‰åœ¨columnç”¨åˆ°çš„fieldï¼ˆæ¯”å¦‚åœ¨columnæ²¡ç”¨åˆ°idã€decs2è¿™ä¸¤ä¸ªcolumnï¼ŒonValuesChangeçš„recordé‡Œé¢å°±æ²¡æœ‰idå’Œdesc2è¿™ä¸¤ä¸ªå­—æ®µï¼ŒåŠ ä¸Šå°±æœ‰äº†ï¼ï¼ï¼‰
å®¶é‡Œï¼šonValuesChangeç›´æ¥ä¸å›è°ƒäº†ã€‚

ä»¥ä¸Šbugéƒ½æ˜¯å•å…ƒæµ‹è¯•ç¯å¢ƒæ‰ä¼šæœ‰çš„bugï¼Œæµè§ˆå™¨ç¯å¢ƒæ­£å¸¸ã€‚å•å…ƒæµ‹è¯•ä»£ç æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ï¼Œæ€€ç–‘æ˜¯å•å…ƒæµ‹è¯•libraryç‰ˆæœ¬çš„é—®é¢˜ï¼Ÿ

### ğŸ“· å¤ç°æ­¥éª¤

1. component App2å†…ä½¿ç”¨EditableProTable ï¼ˆä»£ç æˆªå›¾åœ¨ä¸‹é¢ï¼‰
2. EditableProTableå±æ€§ï¼šcontrolledï¼Œå¯åŒæ—¶å¤šè¡Œç¼–è¾‘ï¼ˆtype: 'multiple'ï¼‰ï¼Œä½¿ç”¨onValuesChangeå›è°ƒç›‘å¬æŸäº›å­—æ®µ
3. å¯¹App2ç¼–å†™å•å…ƒæµ‹è¯•ï¼Œå‘ç°onValuesChangeä¸å›è°ƒ(æ²¡æ‰“å°log)ã€‚

### ğŸ æœŸæœ›ç»“æœ

å•å…ƒæµ‹è¯•ä¸€æ ·èƒ½å¤Ÿå›è°ƒonValuesChangeï¼Œå› ä¸ºå®é™…ä»£ç é‡Œæœ‰å¾ˆå¤šåˆ¤æ–­ã€‚ã€‚ã€‚

### ğŸ’» å¤ç°ä»£ç 

App2.tsx:
`

import type { ProColumns } from '@ant-design/pro-table';
import { EditableProTable, } from '@ant-design/pro-table';
import React, { useEffect, useState } from 'react';

type DataSourceType = {
id: React.Key;
title: string;
decs: string;
decs2: string;
state: string;
};
const App2 = ({
editable,
}: {
editable: boolean;
}) => {

    const [editableKeys, setEditableRowKeys] = useState<React.Key[]>([]);
    const [dataSource, setDataSource] = useState<DataSourceType[]>(
        [
            {
                id: 'uuid-1',
                title: 'æ´»åŠ¨åç§°ä¸€',
                decs: 'è¿™ä¸ªæ´»åŠ¨çœŸå¥½ç©1-1',
                decs2: 'è¿™ä¸ªæ´»åŠ¨çœŸå¥½ç©1-2',
                state: 'true',
            },
            {
                id: 'uuid-2',
                title: 'æ´»åŠ¨åç§°äºŒ',
                decs: 'è¿™ä¸ªæ´»åŠ¨çœŸå¥½ç©2-1',
                decs2: 'è¿™ä¸ªæ´»åŠ¨çœŸå¥½ç©2-2',
                state: 'true',
            },
        ]
    );


    const columns: ProColumns<DataSourceType>[] = [
        {
            title: 'æ´»åŠ¨åç§°',
            dataIndex: 'title',
        },
        {
            title: 'çŠ¶æ€',
            dataIndex: 'state',
            valueType: 'radio',
            valueEnum: {
                true: { text: 'true', },
                false: { text: 'false', },
            },
        },
        {
            title: 'æè¿°',
            dataIndex: 'decs',
        },
        {
            title: 'æè¿°2',
            dataIndex: 'decs2',
        },
    ];

    useEffect(() => {
        console.log('dataSource updates:', JSON.stringify(dataSource));
        setEditableRowKeys(dataSource.map(item => item.id));
    }, [dataSource]);

    const onValuesChange = (record: DataSourceType, dataSource: DataSourceType[]) => {
        console.log('onValuesChange, record:', JSON.stringify(record));
        console.log(record.id.toString());
        setDataSource(dataSource);
    }

    return (
        <EditableProTable<DataSourceType>
            headerTitle="å¯ç¼–è¾‘è¡¨æ ¼"
            columns={columns}
            rowKey="id"
            value={dataSource}
            recordCreatorProps={false}
            controlled
            editable={{
                type: 'multiple',
                editableKeys,
                onValuesChange: onValuesChange,
            }}
        />
    );

};

export default App2;`

App2.test.tsx:
`import { act, cleanup, fireEvent, render } from '@testing-library/react';
import { waitForComponentToPaint } from '../../tests/util';
import App2 from './App2';

describe('App2', () => {
afterEach(() => {
cleanup();
});

it('App2: change item radio', async () => {

    const wrapper = render(<App2 editable={true} />,);
    expect(wrapper.container.querySelectorAll('tr.ant-table-row.ant-table-row-level-0').length).toBeGreaterThan(0);
    const firstRadioElement = wrapper.container.querySelectorAll('tr.ant-table-row.ant-table-row-level-0')[0].querySelectorAll('input.ant-radio-input')[0];
    expect(firstRadioElement).toBeInTheDocument();
    const previousValue = firstRadioElement.checked;
    expect(previousValue).toEqual(true);

    const secondRadioElement = wrapper.container.querySelectorAll('tr.ant-table-row.ant-table-row-level-0')[0].querySelectorAll('input.ant-radio-input')[1];
    expect(secondRadioElement).toBeInTheDocument();
    await act(async () => {
      fireEvent.click(secondRadioElement);
    })
    waitForComponentToPaint(wrapper, 100);
    const firstRadioElementContent = wrapper.container.querySelectorAll('tr.ant-table-row.ant-table-row-level-0')[0].querySelectorAll('input.ant-radio-input')[0].checked;
    expect(firstRadioElementContent).toEqual(false);
    // wrapper.debug(wrapper.container, 100000)

});

});`

### Â© ç‰ˆæœ¬ä¿¡æ¯

- ProComponents ç‰ˆæœ¬: [e.g. 4.0.0]
- umi ç‰ˆæœ¬ V3çš„
- æµè§ˆå™¨ç¯å¢ƒ chromeæ­£å¸¸ï¼Œå•å…ƒæµ‹è¯•ç¯å¢ƒï¼ˆjsdomï¼‰ä¸æ­£å¸¸
- å¼€å‘ç¯å¢ƒ [e.g. mac OS] windows

**package.json:**
"@ant-design/icons": "^4.7.0",
"@ant-design/pro-card": "^1.19.0",
"@ant-design/pro-descriptions": "^1.10.0",
"@ant-design/pro-form": "^1.64.0",
"@ant-design/pro-layout": "^6.35.0",
"@ant-design/pro-table": "^2.71.0",
"antd": "^4.19.0",
"react": "^17.0.2",
"react-dom": "^17.0.0",
"react-window": "^1.8.8",
"umi": "^3.5.0",
**devDependencies:**
"@ant-design/pro-cli": "^2.1.0",
"@testing-library/dom": "^8.20.0",
"@testing-library/jest-dom": "^5.16.5",
"@testing-library/react": "12.1.5",
"@testing-library/react-hooks": "^8.0.1",
"@testing-library/user-event": "^14.4.3",
"@types/jest": "^26.0.0",
"@types/react": "^17.0.0",
"@types/react-dom": "^17.0.0",
"jsdom-global": "^3.0.0",

**nodeç‰ˆæœ¬**
å…¬å¸jenkinsé»˜è®¤æ˜¯14.17.3

### ğŸš‘ å…¶ä»–ä¿¡æ¯

<!--
å¦‚æˆªå›¾ç­‰å…¶ä»–ä¿¡æ¯å¯ä»¥è´´åœ¨è¿™é‡Œ
-->

æµè§ˆå™¨ç¯å¢ƒä¸‹æ ‡é»„çš„logéƒ½èƒ½æ‰“å°ï¼š
![image](https://user-images.githubusercontent.com/22339523/221275606-0df24c91-a751-44e8-aec5-e4c8f54a1ca2.png)

å•å…ƒæµ‹è¯•ç¯å¢ƒä¸‹åªæ‰“å°ç¬¬ä¸€ä¸ª
![image](https://user-images.githubusercontent.com/22339523/221275760-496ae783-5a35-4b8c-b704-96c0889f033f.png)

éº»çƒ¦å¸®å¿™çœ‹ä¸€ä¸‹è°¢è°¢äº†

## tnngo

å»ºè®®åˆ é™¤æ‰å•å…ƒæµ‹è¯•å°±è¡Œäº†

## LittleChives

æ‚¨å¥½,é‚®ä»¶å·²ç»æ”¶åˆ°,è°¢è°¢!

## chenshuai2144

> TAutomatically replying with ChatGPT can be attempted, but it cannot be guaranteed to be completely accurate and may not fully address all issues. Please feel free to reply if you have any further questions or concerns.
> æ­¤å›å¤åŸºäº ChatGPT è‡ªåŠ¨ç”Ÿæˆï¼Œå¯ä»¥å°è¯•ä¸‹æ–¹æ¡ˆï¼Œå®˜æ–¹å‘˜ä¼šåœ¨ä¸€å®šæ—¶é—´åç»§ç»­ç»§ç»­å¤„ç†ã€‚

ä¸å®¢æ°”ï¼Œæœ‰å…¶ä»–é—®é¢˜å¯ä»¥ç»§ç»­è”ç³»æˆ‘ã€‚ç¥æ‚¨å·¥ä½œæ„‰å¿«ï¼

## chenshuai2144

> TAutomatically replying with ChatGPT can be attempted, but it cannot be guaranteed to be completely accurate and may not fully address all issues. Please feel free to reply if you have any further questions or concerns.
> æ­¤å›å¤åŸºäº ChatGPT è‡ªåŠ¨ç”Ÿæˆï¼Œå¯ä»¥å°è¯•ä¸‹æ–¹æ¡ˆï¼Œå®˜æ–¹å‘˜ä¼šåœ¨ä¸€å®šæ—¶é—´åç»§ç»­ç»§ç»­å¤„ç†ã€‚

æ‚¨å¥½ï¼Œæ ¹æ®æ‚¨çš„æè¿°ï¼Œè¿™ä¸ªé—®é¢˜å¯èƒ½ä¸å•å…ƒæµ‹è¯•ç¯å¢ƒæœ‰å…³ï¼Œå› ä¸ºä»£ç åœ¨æµè§ˆå™¨ä¸­è¿è¡Œæ­£å¸¸ã€‚è¯·å°è¯•ä»¥ä¸‹æ–¹æ³•ï¼š

1. æ£€æŸ¥å•å…ƒæµ‹è¯•ç¯å¢ƒæ˜¯å¦æ­£ç¡®ã€‚æ‚¨å¯ä»¥æ£€æŸ¥test.jsæ–‡ä»¶ï¼Œç¡®ä¿æ‰€æœ‰çš„ä¾èµ–é¡¹å’Œå¼•ç”¨é¡¹éƒ½æ˜¯æ­£ç¡®çš„ã€‚

2. æ£€æŸ¥æµ‹è¯•æ‰€ç”¨çš„åº“ç‰ˆæœ¬æ˜¯å¦æ­£ç¡®ã€‚å°è¯•ä½¿ç”¨ä¸å®é™…ç¯å¢ƒç›¸åŒçš„åº“ç‰ˆæœ¬ï¼š

   - "@testing-library/dom": "^8.20.0",
   - "@testing-library/jest-dom": "^5.16.5",
   - "@testing-library/react": "12.1.5",
   - "@testing-library/react-hooks": "^8.0.1",
   - "@testing-library/user-event": "^14.4.3",

3. æ£€æŸ¥ç»„ä»¶å†…çš„ä»£ç ï¼Œæ£€æŸ¥onValuesChangeäº‹ä»¶å›è°ƒå‡½æ•°çš„å‚æ•°æ˜¯å¦æ­£ç¡®ï¼Œæ£€æŸ¥Reactçš„ç‰ˆæœ¬æ˜¯å¦æ˜¯17.0.2åŠä»¥ä¸Šã€‚

4. æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–å½±å“onValuesChangeå›è°ƒå‡½æ•°çš„äº‹ä»¶ï¼Œå¦‚æ•°æ®ä¸åŒæ­¥ã€æ§åˆ¶ç»„ä»¶çš„çŠ¶æ€ä¸æ­£ç¡®ç­‰ã€‚

å¦‚æœä»¥ä¸Šæ–¹æ³•æ— æ³•è§£å†³é—®é¢˜ï¼Œè¯·æä¾›æ›´å¤šä¿¡æ¯ï¼Œæˆ‘ä¼šå°½åŠ›å¸®æ‚¨è§£å†³é—®é¢˜ã€‚
