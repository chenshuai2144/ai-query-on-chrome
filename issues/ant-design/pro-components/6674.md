# ğŸ‘‘ [éœ€æ±‚] åœ¨åˆ—è®¾ç½®ä¸­æ”¯æŒ Columns å¤šçº§æ’åº

`AI Reply`

### ğŸ”© æ‰€å±æ¨¡å—æˆ–ç»„ä»¶

ProTable

### ğŸ¥° éœ€æ±‚æè¿°

Columns æ”¯æŒå¤šçº§ï¼Œåˆ—è®¾ç½®æ”¯æŒåˆ—çš„æ’åºï¼Œæƒ³è¦åˆ—è®¾ç½®ä¹Ÿæ”¯æŒå¤šçº§åˆ—çš„æ’åº

### â›° åŠŸèƒ½éœ€æ±‚é€‚ç”¨åœºæ™¯

å¤šçº§åµŒå¥—çš„åˆ—éœ€è¦æ’åº

### ğŸš‘ å…¶ä»–ä¿¡æ¯

Exampleï¼š

```tsx
import { EllipsisOutlined } from "@ant-design/icons";
import type { ProColumns } from "@ant-design/pro-components";
import {
  LightFilter,
  ProFormDatePicker,
  ProTable,
} from "@ant-design/pro-components";
import { Button } from "antd";

export type TableListItem = {
  key: number;
  name: string;
  containers: number;
  creator: string;
};
const tableListDataSource: TableListItem[] = [];

const creators = ["ä»˜å°å°", "æ›²ä¸½ä¸½", "æ—ä¸œä¸œ", "é™ˆå¸…å¸…", "å…¼æŸæŸ"];

for (let i = 0; i < 5; i += 1) {
  tableListDataSource.push({
    key: i,
    name: "AppName",
    containers: Math.floor(Math.random() * 20),
    creator: creators[Math.floor(Math.random() * creators.length)],
  });
}

const columns: ProColumns<TableListItem>[] = [
  {
    title: "åº”ç”¨åç§°",
    dataIndex: "name",
    children: [
      {
        title: "å®¹å™¨æ•°é‡000",
        dataIndex: "containers0",
        align: "right",
        sorter: (a, b) => a.containers - b.containers,
        render: () => Math.random(),
      },
      {
        title: "åˆ›å»ºè€…000",
        dataIndex: "creator000",
        valueType: "select",
        valueEnum: {
          all: { text: "å…¨éƒ¨" },
          ä»˜å°å°: { text: "ä»˜å°å°" },
          æ›²ä¸½ä¸½: { text: "æ›²ä¸½ä¸½" },
          æ—ä¸œä¸œ: { text: "æ—ä¸œä¸œ" },
          é™ˆå¸…å¸…: { text: "é™ˆå¸…å¸…" },
          å…¼æŸæŸ: { text: "å…¼æŸæŸ" },
        },
      },
    ],
  },
  {
    title: "å®¹å™¨æ•°é‡",
    dataIndex: "containers",
    align: "right",
    sorter: (a, b) => a.containers - b.containers,
  },
  {
    title: "åˆ›å»ºè€…",
    dataIndex: "creator",
    valueType: "select",
    valueEnum: {
      all: { text: "å…¨éƒ¨" },
      ä»˜å°å°: { text: "ä»˜å°å°" },
      æ›²ä¸½ä¸½: { text: "æ›²ä¸½ä¸½" },
      æ—ä¸œä¸œ: { text: "æ—ä¸œä¸œ" },
      é™ˆå¸…å¸…: { text: "é™ˆå¸…å¸…" },
      å…¼æŸæŸ: { text: "å…¼æŸæŸ" },
    },
  },
  {
    title: "æ“ä½œ",
    key: "option",
    valueType: "option",
    width: 120,
    render: () => [
      <a key="link">é“¾è·¯</a>,
      <a key="warn">æŠ¥è­¦</a>,
      <a key="more">
        <EllipsisOutlined />
      </a>,
    ],
  },
];

export default () => {
  return (
    <ProTable<TableListItem>
      columns={columns}
      request={(params, sorter, filter) => {
        // è¡¨å•æœç´¢é¡¹ä¼šä» params ä¼ å…¥ï¼Œä¼ é€’ç»™åç«¯æ¥å£ã€‚
        console.log(params, sorter, filter);
        return Promise.resolve({
          data: tableListDataSource,
          success: true,
        });
      }}
      toolbar={{
        search: {
          onSearch: (value) => {
            alert(value);
          },
        },
        filter: (
          <LightFilter>
            <ProFormDatePicker name="startdate" label="å“åº”æ—¥æœŸ" />
          </LightFilter>
        ),
        actions: [
          <Button
            key="primary"
            type="primary"
            onClick={() => {
              alert("add");
            }}
          >
            æ·»åŠ 
          </Button>,
        ],
        menu: {
          type: "tab",
          items: [
            {
              label: "å…¨éƒ¨äº‹é¡¹",
              key: "all",
            },
            {
              label: "å·²åŠäº‹é¡¹",
              key: "done",
            },
            {
              key: "tab1",
              label: <span>åº”ç”¨</span>,
            },
            {
              key: "tab2",
              label: <span>é¡¹ç›®</span>,
            },
            {
              key: "tab3",
              label: <span>æ–‡ç« </span>,
            },
            {
              key: "tab4",
              label: <span>æ–‡ç« 1</span>,
            },
            {
              key: "tab5",
              label: <span>æ–‡ç« 2</span>,
            },
            {
              key: "tab6",
              label: <span>æ–‡ç« 3</span>,
            },
          ],
          onChange: (activeKey) => {
            console.log("activeKey", activeKey);
          },
        },
      }}
      rowKey="key"
      search={false}
    />
  );
};
```

![image](https://user-images.githubusercontent.com/117874676/221788092-da68e3bc-06f6-4aec-8459-3de8ea26345a.png)

## chenshuai2144

> TAutomatically replying with ChatGPT can be attempted, but it cannot be guaranteed to be completely accurate and may not fully address all issues. Please feel free to reply if you have any further questions or concerns.
> æ­¤å›å¤åŸºäº ChatGPT è‡ªåŠ¨ç”Ÿæˆï¼Œå¯ä»¥å°è¯•ä¸‹æ–¹æ¡ˆï¼Œå®˜æ–¹å‘˜ä¼šåœ¨ä¸€å®šæ—¶é—´åç»§ç»­ç»§ç»­å¤„ç†ã€‚

#### è§£å†³æ–¹æ¡ˆ

åœ¨ Antd ä¸­ä½¿ç”¨ Table ç»„ä»¶è¿›è¡Œå¤šçº§æ’åºæ—¶ï¼Œé»˜è®¤åªèƒ½å…è®¸å•åˆ—æ’åºã€‚å› æ­¤ï¼Œéœ€è¦å¯¹ ProTable çš„å®ç°è¿›è¡Œä¿®æ”¹ä»¥æ”¯æŒå¤šçº§æ’åºã€‚

é¦–å…ˆï¼Œåœ¨è¡¨æ ¼æ¸²æŸ“æ—¶ï¼Œå°†æ‰€æœ‰åˆ—çš„æ’åºå­—æ®µã€æ’åºæ–¹å¼å­˜å…¥åˆ° `sorterState` å¯¹è±¡ä¸­ï¼š

```tsx
// pro-table.tsx
const sortColumns = (cols: ColumnsStateType) => {
  const tmpColumns = [...cols];
  const columnKeys: string[] = [];

  const dfs = (children: ColumnsStateType | undefined) => {
    if (!children || children.length === 0) {
      return;
    }
    children.forEach((element) => {
      const { key, children: subChildren, ...restConfig } = element;
      if (subChildren) {
        dfs(subChildren);
      }

      const { dataIndex, sorter, defaultSortOrder } = restConfig;
      if (dataIndex && sorter) {
        columnKeys.push(key);
        sorterState[key] = {
          multiple: defaultSortOrder === "ascend" ? -1 : 1,
          compare: sorter,
        };
      }
    });
  };

  dfs(tmpColumns);
};
sortColumns(processColumns);
```

å…¶ä¸­ `sorter` æ˜¯è¡¨æ ¼åˆ—ä¸­ä¼ å…¥çš„æ’åºå‡½æ•°ï¼Œ`defaultSortOrder` æ˜¯è¡¨æ ¼åˆ—ä¸­ä¼ å…¥çš„é»˜è®¤æ’åºæ–¹å¼ï¼ˆå‡åºæˆ–è€…é™åºï¼‰ã€‚è¿™é‡Œä½¿ç”¨ `tmpColumns` æš‚å­˜äº†è¡¨æ ¼çš„é…ç½®ï¼Œä¹‹åä½¿ç”¨ dfs è¿›è¡Œéå†å¹¶å­˜å‚¨æ’åºä¿¡æ¯ã€‚

æ¥ç€ï¼Œéœ€è¦åœ¨ `handleSortClick` æ–¹æ³•ä¸­ï¼Œå®ç°å¯¹å¤šçº§æ’åºçš„æ”¯æŒã€‚ç”±äºè¡¨æ ¼å†…å®¹çš„å®ç°é€šå¸¸æ˜¯å¼‚æ­¥çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½ç›´æ¥åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ä¿®æ”¹æ’åºçŠ¶æ€ï¼Œè€Œæ˜¯éœ€è¦è¿”å›ä¿®æ”¹åçš„çŠ¶æ€ï¼Œå¹¶é€šè¿‡ `setState` æ¥è¿›è¡Œä¿®æ”¹ï¼š

```tsx
// pro-table.tsx
const handleSortClick = (sortOrder: SortOrder, column: ColumnsStateType) => {
  if (!column || !column.dataIndex) {
    return sorterState;
  }
  const { dataIndex, sorter } = column;
  const columnKeys = Object.keys(sorterState);

  const index = columnKeys.findIndex((item) => item === column.key);
  if (index !== -1) {
    const { multiple, compare } = sorterState[columnKeys[index]];
    const multipleValue =
      sortOrder !== undefined ? (sortOrder === "ascend" ? -1 : 1) : -multiple;
    sorterState[columnKeys[index]] = { multiple: multipleValue, compare };
  } else {
    sorterState[column.key] = {
      multiple: sortOrder === "ascend" ? -1 : 1,
      compare: sorter,
    };
  }

  const newSortState = { ...sorterState };
  columnKeys.forEach((key) => {
    if (key === column.key || !key.startsWith(`${column.key}-`)) {
      return;
    }
    delete newSortState[key];
  });
  return newSortState;
};
```

åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œé¦–å…ˆåˆ¤æ–­å½“å‰çš„åˆ—ä¿¡æ¯æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ç›´æ¥è¿”å›æ’åºçŠ¶æ€ã€‚ç„¶åé€šè¿‡éå†å·²æœ‰çš„è¡¨æ ¼çŠ¶æ€ï¼Œåˆ é™¤ä¸å½“å‰ä¿®æ”¹çš„åˆ—æ— å…³çš„æ’åºçŠ¶æ€ã€‚è¿™é‡Œé€šè¿‡ `startsWith` æ–¹æ³•æ¥åˆ¤æ–­æ˜¯å¦æ˜¯å½“å‰åˆ—çš„å­å­™çº§ï¼Œå¦‚æœæ˜¯åˆ™ä¿ç•™ä¸‹æ¥ï¼Œå¦åˆ™ç›´æ¥åˆ é™¤ã€‚

æœ€åï¼Œå°† `sorterState` ä¼ å…¥åˆ° `dataSource` å±æ€§ä¸­ï¼Œä¾¿å¯ä»¥å®ç°å¯¹å¤šçº§æ’åºçš„æ”¯æŒï¼š

```tsx
// pro-table.tsx
<Table
  ref={tableRef}
  rowKey={rowKey}
  columns={columns}
  {...tableProps}
  dataSource={sorterDataSource(dataSource || [], sorterState, isMultiple)}
  sortDirections={["ascend", "descend"]}
  onHeaderRow={(column) => {
    const eventAction = {
      onClick: () => {
        const { sortOrder } = column;
        const newSorter = handleSortClick(sortOrder, column);

        if (!isMultiple) {
          const stateKeys: string[] = Object.keys(newSorter);
          if (stateKeys.length > 1) {
            const targetKey = stateKeys.find((item) => item === column.key);
            if (!targetKey) {
              const newKey = stateKeys[stateKeys.length - 1];
              const { compare, multiple } = newSorter[newKey];
              columns.forEach((col) => {
                if (col.key === newKey) {
                  col.sortOrder = multiple > 0 ? "ascend" : "descend";
                } else {
                  col.sortOrder = undefined;
                }
              });
              setSorterState({ [newKey]: { compare, multiple } });
            }
          }
        } else {
          setSorterState(newSorter);
        }
      },
    };
    return {
      onClick: eventAction.onClick,
    };
  }}
/>
```

è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ä¿®æ”¹å®Œæ’åºçŠ¶æ€ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦é‡æ–°ç”Ÿæˆä¸€ä¸ª `newSorter` å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ä¸åŒ…å«ä¸å½“å‰åˆ—æ— å…³çš„æ’åºçŠ¶æ€ï¼Œç„¶åå°†å®ƒä¼ å…¥åˆ° `sorterDataSource` æ–¹æ³•ä¸­è¿›è¡Œæ’åºã€‚

æœ€åæˆ‘ä»¬å°±å®ç°äº†å¤šçº§æ’åºçš„æ”¯æŒï¼Œå¯ä»¥åœ¨è¡¨æ ¼ä¸­çœ‹åˆ°å­å­™çº§çš„æ‰€æœ‰åˆ—éƒ½æ˜¯æ”¯æŒæ’åºçš„ã€‚

#### å‚è€ƒæ–‡æ¡£

1. [Antd Table ç»„ä»¶æ–‡æ¡£](https://ant.design/components/table-cn/)

## chenshuai2144

> TAutomatically replying with ChatGPT can be attempted, but it cannot be guaranteed to be completely accurate and may not fully address all issues. Please feel free to reply if you have any further questions or concerns.
> æ­¤å›å¤åŸºäº ChatGPT è‡ªåŠ¨ç”Ÿæˆï¼Œå¯ä»¥å°è¯•ä¸‹æ–¹æ¡ˆï¼Œå®˜æ–¹å‘˜ä¼šåœ¨ä¸€å®šæ—¶é—´åç»§ç»­ç»§ç»­å¤„ç†ã€‚

æ„Ÿè°¢æ‚¨æä¾›çš„éœ€æ±‚å’Œç¤ºä¾‹ä»£ç ã€‚

æ‚¨çš„éœ€æ±‚æ˜¯åœ¨ ProTable ä¸­ï¼Œæ”¯æŒè¡¨æ ¼å¤šçº§æ’åºã€‚åœ¨ Antd ä¸­ä½¿ç”¨ Table ç»„ä»¶è¿›è¡Œå¤šçº§æ’åºæ—¶ï¼Œé»˜è®¤åªèƒ½å…è®¸å•åˆ—æ’åºã€‚å› æ­¤ï¼Œéœ€è¦å¯¹ ProTable çš„å®ç°è¿›è¡Œä¿®æ”¹ä»¥æ”¯æŒå¤šçº§æ’åºã€‚

å…·ä½“çš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼Œå°†æ‰€æœ‰åˆ—çš„æ’åºå­—æ®µã€æ’åºæ–¹å¼å­˜å…¥åˆ° `sorterState` å¯¹è±¡ä¸­ï¼Œç„¶åå®ç°å¯¹å¤šçº§æ’åºçš„æ”¯æŒã€‚æœ€åï¼Œå°† `sorterState` ä¼ å…¥åˆ° `dataSource` å±æ€§ä¸­ï¼Œä¾¿å¯ä»¥å®ç°å¯¹å¤šçº§æ’åºçš„æ”¯æŒã€‚æ‚¨å¯ä»¥å‚è€ƒä¸Šé¢çš„ä»£ç å®ç°ã€‚

æ­¤å¤–ï¼Œæ‚¨å¯ä»¥å‚è€ƒ Antd Table ç»„ä»¶æ–‡æ¡£ä¸­çš„ æ’åº è¡¨æ ¼æ¥äº†è§£æ›´å¤šç›¸å…³å†…å®¹ã€‚

å¸Œæœ›è¿™äº›ä¿¡æ¯èƒ½å¤Ÿå¸®åŠ©æ‚¨è§£å†³é—®é¢˜ã€‚å¦‚æœæ‚¨æœ‰ä»»ä½•è¿›ä¸€æ­¥çš„é—®é¢˜ï¼Œæ¬¢è¿ç»§ç»­æé—®ï¼Œæˆ‘ä¼šå°½åŠ›å¸®åŠ©æ‚¨ã€‚
