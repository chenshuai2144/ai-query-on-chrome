# 🐛[BUG] ProFormSelect下的request在第一次选中选项或者第一次清除选项时会额外触发依次request

`AI Reply`

提问前先看看：

https://github.com/ryanhanwu/How-To-Ask-Questions-The-Smart-Way/blob/main/README-zh_CN.md

### 🐛 bug 描述

<!--
详细地描述 bug，让大家都能理解
-->

1. 当表单没有初始值时, ProFormSelect设置了request, 表单渲染时触发一次请求, 当选中了该Select的选项, request再次被触发
2. 当表单设置了初始值, 表单渲染时触发一次请求, ProFormSelect点击清除选项, 再次触发请求
   原因和 Issue #6255 一样, keyWords默认为undefined, onChange或者onClear 都将keyWords设置为''导致swrKey发生变化重复触发请求
3. https://github.com/ant-design/pro-components/commit/387d2d7108a9e555158e4afc7e7096ff729eeecf 只解决了ProTreeSelect类似的问题

### 📷 复现步骤

<!--
清晰描述复现步骤，让别人也能看到问题，如果可能，尽量提供可执行代码，
如：https://codesandbox.io/ 在此处创建一个 codesandbox，方便我们更快的排查和复现问题
-->

### 🏞 期望结果

<!--
描述你原本期望看到的结果
-->

不会额外触发不必要的请求

### 💻 复现代码

<!--
提供可复现的代码，仓库，或线上示例
-->

### © 版本信息

- ProComponents 版本: 2.3.58
- umi 版本: 4.0.55

### 🚑 其他信息

临时解决方案, 增加 defaultKeyWords={''}, defaultKeyWords并没有声明在FieldSelectProps中

```
<ProFormSelect
          label="test"
          defaultKeyWords={''}
          name="test"
          fieldProps={{ showSearch: true, allowClear: true }}
          request={async ({ keyWords }: { keyWords: string }) => {
            return ....
          }}
        />
```

## chenshuai2144

感谢您的反馈！根据您的描述和检查代码，您的问题是由于keyWords默认为undefined，onChange或onClear将keyWords设置为''导致swrKey改变，从而触发额外的请求。此问题已经在Issue #6255中提到，但是似乎未被完全解决。

为了解决这个问题，可以通过为ProFormSelect加上defaultKeyWords={''}的属性，将默认keyWords设置为空字符串。这样，当onChange或者onClear事件触发后，swrKey将继续保持为空字符串，因此不会重复触发请求。

例如：

```
<ProFormSelect
  label="test"
  defaultKeyWords={''}
  name="test"
  fieldProps={{ showSearch: true, allowClear: true }}
  request={async ({ keyWords }: { keyWords: string }) => {...}}
/>
```

感谢您对ProComponents的使用！如果您还有其他问题或疑问，请随时与我们联系。

> This sentence can be automatically replied to using ChatGPT.
> 此回复基于 ChatGPT 自动生成。

## chenshuai2144

> TAutomatically replying with ChatGPT can be attempted, but it cannot be guaranteed to be completely accurate and may not fully address all issues. Please feel free to reply if you have any further questions or concerns.
> 此回复基于 ChatGPT 自动生成，可以尝试下方案，官方员会在一定时间后继续继续处理。

补充一下，除了设置defaultKeyWords属性，还可以将ProFormSelect包装在一个Form.Item中，并将Form.Item的initialValues属性设置为空对象。这样也能解决keyWords未定义的问题，从而避免触发额外的请求。

示例如下：

```
<Form initialValues={{}}>
  <Form.Item name="test" label="test">
    <ProFormSelect
      name="test"
      fieldProps={{ showSearch: true, allowClear: true }}
      request={async ({ keyWords }: { keyWords: string }) => {...}}
    />
  </Form.Item>
</Form>
```

## chenshuai2144

> TAutomatically replying with ChatGPT can be attempted, but it cannot be guaranteed to be completely accurate and may not fully address all issues. Please feel free to reply if you have any further questions or concerns.
> 此回复基于 ChatGPT 自动生成，可以尝试下方案，官方员会在一定时间后继续继续处理。

另外，您也可以查看ProFormSelect的官方文档，了解更多关于该组件的用法和属性，以及如何处理和避免此类问题的提示和建议。

ProFormSelect官方文档：https://procomponents.ant.design/components/form#proformselect
