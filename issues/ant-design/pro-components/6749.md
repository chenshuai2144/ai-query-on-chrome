# 🧐[问题] 嵌套的列排序

`AI Reply`

### 🔩 所属模块或组件

ProTable

### 🥰 需求描述

Columns 的列设置支持列的排序（非 sorter 排序），不知道怎么配置可以支持 嵌套列内部的排序

### ⛰ 功能需求适用场景

多级嵌套的列需要排序

### 🚑 其他信息

Example：

```tsx
import { EllipsisOutlined } from "@ant-design/icons";
import type { ProColumns } from "@ant-design/pro-components";
import {
  LightFilter,
  ProFormDatePicker,
  ProTable,
} from "@ant-design/pro-components";
import { Button } from "antd";

export type TableListItem = {
  key: number;
  name: string;
  containers: number;
  creator: string;
};
const tableListDataSource: TableListItem[] = [];

const creators = ["付小小", "曲丽丽", "林东东", "陈帅帅", "兼某某"];

for (let i = 0; i < 5; i += 1) {
  tableListDataSource.push({
    key: i,
    name: "AppName",
    containers: Math.floor(Math.random() * 20),
    creator: creators[Math.floor(Math.random() * creators.length)],
  });
}

const columns: ProColumns<TableListItem>[] = [
  {
    title: "应用名称",
    dataIndex: "name",
    children: [
      {
        title: "容器数量000",
        dataIndex: "containers0",
        align: "right",
        sorter: (a, b) => a.containers - b.containers,
        render: () => Math.random(),
      },
      {
        title: "创建者000",
        dataIndex: "creator000",
        valueType: "select",
        valueEnum: {
          all: { text: "全部" },
          付小小: { text: "付小小" },
          曲丽丽: { text: "曲丽丽" },
          林东东: { text: "林东东" },
          陈帅帅: { text: "陈帅帅" },
          兼某某: { text: "兼某某" },
        },
      },
    ],
  },
  {
    title: "容器数量",
    dataIndex: "containers",
    align: "right",
    sorter: (a, b) => a.containers - b.containers,
  },
  {
    title: "创建者",
    dataIndex: "creator",
    valueType: "select",
    valueEnum: {
      all: { text: "全部" },
      付小小: { text: "付小小" },
      曲丽丽: { text: "曲丽丽" },
      林东东: { text: "林东东" },
      陈帅帅: { text: "陈帅帅" },
      兼某某: { text: "兼某某" },
    },
  },
  {
    title: "操作",
    key: "option",
    valueType: "option",
    width: 120,
    render: () => [
      <a key="link">链路</a>,
      <a key="warn">报警</a>,
      <a key="more">
        <EllipsisOutlined />
      </a>,
    ],
  },
];

export default () => {
  return (
    <ProTable<TableListItem>
      columns={columns}
      request={(params, sorter, filter) => {
        // 表单搜索项会从 params 传入，传递给后端接口。
        console.log(params, sorter, filter);
        return Promise.resolve({
          data: tableListDataSource,
          success: true,
        });
      }}
      toolbar={{
        search: {
          onSearch: (value) => {
            alert(value);
          },
        },
        filter: (
          <LightFilter>
            <ProFormDatePicker name="startdate" label="响应日期" />
          </LightFilter>
        ),
        actions: [
          <Button
            key="primary"
            type="primary"
            onClick={() => {
              alert("add");
            }}
          >
            添加
          </Button>,
        ],
        menu: {
          type: "tab",
          items: [
            {
              label: "全部事项",
              key: "all",
            },
            {
              label: "已办事项",
              key: "done",
            },
            {
              key: "tab1",
              label: <span>应用</span>,
            },
            {
              key: "tab2",
              label: <span>项目</span>,
            },
            {
              key: "tab3",
              label: <span>文章</span>,
            },
            {
              key: "tab4",
              label: <span>文章1</span>,
            },
            {
              key: "tab5",
              label: <span>文章2</span>,
            },
            {
              key: "tab6",
              label: <span>文章3</span>,
            },
          ],
          onChange: (activeKey) => {
            console.log("activeKey", activeKey);
          },
        },
      }}
      rowKey="key"
      search={false}
    />
  );
};
```

![image](https://user-images.githubusercontent.com/117874676/221788092-da68e3bc-06f6-4aec-8459-3de8ea26345a.png)

## chenshuai2144

> TAutomatically replying with ChatGPT can be attempted, but it cannot be guaranteed to be completely accurate and may not fully address all issues. Please feel free to reply if you have any further questions or concerns.
> 此回复基于 ChatGPT 自动生成，可以尝试下方案，官方人员会在一定时间后继续继续处理。

### 📝 解决方案

嵌套列内部排序可以通过在 `children` 配置项中设置 `sorter` 排序函数来实现。因为 ProTable 组件使用的是 antd 的 Table 组件，所以 `children` 配置项和 sorter 排序函数的用法与 antd 的 Table 组件相同。

同时需要注意，因为涉及到嵌套列，需要多层访问对象的属性，所以排序函数的写法需要做一些修改。可以使用 `a[column1][column2]` 的方式来访问嵌套列中子列的数据。

代码示例：

```tsx
import { EllipsisOutlined } from "@ant-design/icons";
import { ProColumns } from "@ant-design/pro-table";
import {
  LightFilter,
  ProFormDatePicker,
  ProTable,
} from "@ant-design/pro-components";
import { Button } from "antd";

export type TableListItem = {
  key: number;
  name: string;
  containers: number;
  creator: string;
};

const tableListDataSource: TableListItem[] = [];
const creators = ["付小小", "曲丽丽", "林东东", "陈帅帅", "兼某某"];

for (let i = 0; i < 5; i += 1) {
  tableListDataSource.push({
    key: i,
    name: "AppName",
    containers: Math.floor(Math.random() * 20),
    creator: creators[Math.floor(Math.random() * creators.length)],
  });
}

const columns: ProColumns<TableListItem>[] = [
  {
    title: "应用名称",
    dataIndex: "name",
    children: [
      {
        title: "容器数量000",
        dataIndex: "containers0",
        align: "right",
        sorter: (a, b) => a.children[0].containers - b.children[0].containers,
        render: () => Math.random(),
      },
      {
        title: "创建者000",
        dataIndex: "creator000",
        valueType: "select",
        valueEnum: {
          all: { text: "全部" },
          付小小: { text: "付小小" },
          曲丽丽: { text: "曲丽丽" },
          林东东: { text: "林东东" },
          陈帅帅: { text: "陈帅帅" },
          兼某某: { text: "兼某某" },
        },
      },
    ],
  },
  {
    title: "容器数量",
    dataIndex: "containers",
    align: "right",
    sorter: (a, b) => a.containers - b.containers,
  },
  {
    title: "创建者",
    dataIndex: "creator",
    valueType: "select",
    valueEnum: {
      all: { text: "全部" },
      付小小: { text: "付小小" },
      曲丽丽: { text: "曲丽丽" },
      林东东: { text: "林东东" },
      陈帅帅: { text: "陈帅帅" },
      兼某某: { text: "兼某某" },
    },
  },
  {
    title: "操作",
    key: "option",
    valueType: "option",
    width: 120,
    render: () => [
      <a key="link">链路</a>,
      <a key="warn">报警</a>,
      <a key="more">
        <EllipsisOutlined />
      </a>,
    ],
  },
];

export default () => {
  return (
    <ProTable<TableListItem>
      columns={columns}
      dataSource={tableListDataSource}
      search={false}
      rowKey="key"
      toolbar={{
        search: {
          onSearch: (value) => {
            alert(value);
          },
        },
        filter: (
          <LightFilter>
            <ProFormDatePicker name="startdate" label="响应日期" />
          </LightFilter>
        ),
        actions: [
          <Button
            key="primary"
            type="primary"
            onClick={() => {
              alert("add");
            }}
          >
            添加
          </Button>,
        ],
        menu: {
          type: "tab",
          items: [
            {
              label: "全部事项",
              key: "all",
            },
            {
              label: "已办事项",
              key: "done",
            },
            {
              key: "tab1",
              label: <span>应用</span>,
            },
            {
              key: "tab2",
              label: <span>项目</span>,
            },
            {
              key: "tab3",
              label: <span>文章</span>,
            },
            {
              key: "tab4",
              label: <span>文章1</span>,
            },
            {
              key: "tab5",
              label: <span>文章2</span>,
            },
            {
              key: "tab6",
              label: <span>文章3</span>,
            },
          ],
          onChange: (activeKey) => {
            console.log("activeKey", activeKey);
          },
        },
      }}
    />
  );
};
```

效果图：

![image](https://user-images.githubusercontent.com/117874676/139553238-5cf333c5-9d8e-42c7-9f11-712389b12410.png)

## ClarenceAS

想要的效果是：容器数量000 和 创建者000 可以交换位置
![image](https://user-images.githubusercontent.com/117874676/224239165-6303fac0-d07b-4234-832d-9fe4a024a765.png)

## chenshuai2144

不支持的，这种功能太过于灵活推荐自己实现一下
