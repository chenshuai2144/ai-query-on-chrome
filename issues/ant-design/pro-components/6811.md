# ğŸ›[BUG]æ ‘è¡¨æ ¼å±•å¼€æ—¶çš„ç¼©è¿›é—®é¢˜

`AI Reply`

### ğŸ› bug æè¿°

ä½¿ç”¨proTableï¼Œæ ‘è¡¨æ ¼åœ¨å±•å¼€æ—¶ï¼ŒäºŒçº§ï¼Œä¸‰çº§æ²¡æœ‰ç¼©è¿›ï¼Œå°è¯•ä¿®æ”¹äº†expandable å±æ€§é‡Œé¢çš„ç›¸å…³å±æ€§ï¼Œä¾‹å¦‚indentSizeå’ŒchildrenColumnNameä¾ç„¶æ— æ•ˆï¼Œä½†ç›¸åŒæ•°æ®ä½¿ç”¨tableå¯ä»¥å®ç°ç¼©è¿›ã€‚
![image](https://user-images.githubusercontent.com/110799511/226230511-5728c922-c00e-4615-b837-d1d4612d4ffe.png)

### ğŸ“· å¤ç°æ­¥éª¤

![image](https://user-images.githubusercontent.com/110799511/226230465-9f79d540-4940-4a06-b5fb-7a4caba63ae6.png)

### ğŸ æœŸæœ›ç»“æœ

å±•å¼€ä¸€çº§ï¼ŒäºŒçº§ä¸‰çº§ï¼Œé»˜è®¤ç¼©è¿›ã€‚
![image](https://user-images.githubusercontent.com/110799511/226230623-73827a84-526b-4419-a12c-647d81b0b2cc.png)

### ğŸ’» å¤ç°ä»£ç 

    <ProTable<SYSTEM_ENTITY.SystemList>
      headerTitle="ä½“ç³»è¡¨æ ¼"
      rowKey="id"
      actionRef={actionRef}
      expandable={{ expandedRowKeys: expandedRowKeys }}
      onExpand={(expanded, record) => {
        if (expanded) {
          setExpandedRowKeys(expandedRowKeys.concat(record.id));
        } else {
          if (expandedRowKeys.indexOf(record.id) !== -1)
            setExpandedRowKeys(expandedRowKeys.filter((item) => item !== record.id));
        }
      }}
      request={async (params) => {
        return getData(params);
      }}
      pagination={false}
      columns={columns}
      revalidateOnFocus={false}
      onReset={() => {
        setExpandedRowKeys([]);
        setFlag(false);
      }}
    />

### Â© ç‰ˆæœ¬ä¿¡æ¯

ProComponents ç‰ˆæœ¬: [@2.4.2]
umi ç‰ˆæœ¬ [v3.x]
æµè§ˆå™¨ç¯å¢ƒ[edge ,google]
å¼€å‘ç¯å¢ƒ [window]

## chenshuai2144

> TAutomatically replying with ChatGPT can be attempted, but it cannot be guaranteed to be completely accurate and may not fully address all issues. Please feel free to reply if you have any further questions or concerns.
> æ­¤å›å¤åŸºäº ChatGPT è‡ªåŠ¨ç”Ÿæˆï¼Œå¯ä»¥å°è¯•ä¸‹æ–¹æ¡ˆï¼Œå®˜æ–¹äººå‘˜ä¼šåœ¨ä¸€å®šæ—¶é—´åç»§ç»­ç»§ç»­å¤„ç†ã€‚

å¯ä»¥åœ¨columnsä¸­ä½¿ç”¨renderæ–¹æ³•è‡ªå®šä¹‰å±•ç¤ºæ¯ä¸€è¡Œçš„å†…å®¹ï¼Œåˆ©ç”¨ç¼©è¿›å®ç°æ ‘å½¢ç»“æ„çš„æ•ˆæœã€‚

ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

```jsx
const columns = [
  {
    title: "åç§°",
    dataIndex: "name",
    key: "name",
    render: (text, record) => (
      <span style={{ paddingLeft: (record.level - 1) * 20 }}>
        {record.children && record.children.length > 0 ? (
          <a onClick={() => handleExpand(record)}>{text}</a>
        ) : (
          text
        )}
      </span>
    ),
  },
  // å…¶ä»–åˆ—é…ç½®
];

const handleExpand = (record) => {
  const keys = [...expandedRowKeys];
  if (keys.includes(record.id)) {
    // å…³é—­
    keys.splice(keys.indexOf(record.id), 1);
  } else {
    // æ‰“å¼€
    keys.push(record.id);
  }
  setExpandedRowKeys(keys);
};
```

åœ¨renderä¸­æ ¹æ®recordçš„levelå±æ€§è®¾ç½®å¯¹åº”çš„paddingLeftå€¼æ¥æ§åˆ¶ç¼©è¿›çš„è·ç¦»ï¼ŒhandleExpandæ–¹æ³•åˆ™ç”¨äºå¤„ç†å±•å¼€å’Œå…³é—­çš„é€»è¾‘ã€‚åŒæ—¶ï¼Œæ³¨æ„è¦åœ¨ProTableä¸­åŠ å…¥rowClassNameå±æ€§ï¼Œç”¨äºä¸ºæ¯ä¸€è¡Œæ·»åŠ å¯¹åº”çš„classNameï¼Œå¦åˆ™æ ·å¼å¯èƒ½ä¼šå‡ºç°é—®é¢˜ã€‚

```jsx
<ProTable
  columns={columns}
  dataSource={dataSource}
  rowKey="id"
  rowClassName={(record) =>
    record.children && record.children.length > 0 ? "tree-node" : ""
  }
  expandable={{
    expandedRowKeys: expandedRowKeys,
    onExpand: (expanded, record) => handleExpand(record),
  }}
  pagination={false}
/>
```

å‚è€ƒæ–‡æ¡£ï¼šhttps://ant.design/components/table-cn/#props

## Eileen-v

> ```js
> keys.indexOf(record.id);
> ```

å¯ä»¥å®ç°~æ„Ÿè°¢ï¼

## chenshuai2144

> TAutomatically replying with ChatGPT can be attempted, but it cannot be guaranteed to be completely accurate and may not fully address all issues. Please feel free to reply if you have any further questions or concerns.
> æ­¤å›å¤åŸºäº ChatGPT è‡ªåŠ¨ç”Ÿæˆï¼Œå¯ä»¥å°è¯•ä¸‹æ–¹æ¡ˆï¼Œå®˜æ–¹äººå‘˜ä¼šåœ¨ä¸€å®šæ—¶é—´åç»§ç»­ç»§ç»­å¤„ç†ã€‚

å›ç­”ä¸å‘¨ï¼Œéå¸¸æŠ±æ­‰ã€‚è¿™ä¸ªæ–¹æ³•æ˜¯ç”¨äºåœ¨æ•°ç»„ `keys` ä¸­æŸ¥æ‰¾ä¸‹æ ‡ï¼Œå³è¿”å› `record.id` åœ¨ `keys` ä¸­ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼Œå¦‚æœæ²¡æ‰¾åˆ°åˆ™è¿”å› -1ã€‚è¿™é‡Œçš„ä½œç”¨æ˜¯ç”¨äºæ§åˆ¶å±•å¼€å’Œå…³é—­çš„é€»è¾‘ï¼Œç”¨äºåˆ¤æ–­æ˜¯å¦åœ¨ `expandedRowKeys` ä¸­ã€‚

å¦‚æœæ‚¨è¿˜æœ‰å…¶ä»–é—®é¢˜æˆ–ç–‘é—®ï¼Œè¯·éšæ—¶å›å¤ã€‚
