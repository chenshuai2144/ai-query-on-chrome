# 🐛[BUG] 最新版嵌套form存在bug，2.3.27版本都是OK的

`AI Reply`

复现地址：
https://codesandbox.io/s/schema-biao-dan-forked-2lfp8g?file=/App.tsx
复现步骤：先输入dd看日志结果
2.3.27
![image](https://user-images.githubusercontent.com/4630157/227132551-37fef016-7d80-421d-a1e8-db9fb3a516de.png)
最新版：
![image](https://user-images.githubusercontent.com/4630157/227133630-86ecd8fd-9ed7-4a6f-a397-bfe81414fdb7.png)

子form的`formRef.current.getFieldsValues()`获取的值不一致，但是问题只出现在一次输入，第二次输入就表现正常了。

## ldwonday

@chenshuai2144 麻烦看看这个问题吧

## chenshuai2144

> TAutomatically replying with ChatGPT can be attempted, but it cannot be guaranteed to be completely accurate and may not fully address all issues. Please feel free to reply if you have any further questions or concerns.
> 此回复基于 ChatGPT 自动生成，可以尝试下方案，官方人员会在一定时间后继续继续处理。

你好，根据你提供的信息，我了解到你遇到了在嵌套表单中使用 formRef 时出现的问题，第一次输入子表单时获取的值与实际不一致，但第二次输入就能正常显示。我来给你提供一些可能有帮助的解决方法吧。

1. 确认使用的版本

首先，确认一下你的代码所依赖的 `@formily/react` 版本是否正确。如果使用的是最新版，可以试着回退到老版本查看是否能解决问题。你提供的截图显示你使用的是 `@formily/react` 系列的版本，但是并没有具体的版本号。可以确认一下你使用的版本，如果当前版本有 bug，回退到上一个稳定版本可能能够解决问题。

2. 触发表单校验

第二个可能有用的方法是尝试手动触发一下表单校验。例如，使用 `formRef.current.validate()` 来强制触发表单校验。因为这个问题似乎是在表单值更新后才出现的，所以可能是因为表单的校验机制没有及时启动，手动调用一下可以确保表单值的正确性。

3. 使用表单组件的 update 方法

第三个方法是使用 `FormProvider` 组件提供的 `update` 方法，手动更新表单值。这种方法的基本思路是：手动调用 `update` 方法更新表单值后，再使用 `formRef.current.getFieldsValues()` 获取更新后的值。这个方法的具体实现会有很多细节需要注意，就不在这里展开了。相关的文档参考：https://formilyjs.org/zh-CN/docs/api/form-provider#update。

以上是我能想到的几种可能有用的解决方法。希望对你有所帮助！
