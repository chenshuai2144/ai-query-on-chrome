# @ant-design/pro-layout æœåŠ¡å™¨åŠ¨æ€åŠ è½½è·¯ç”±èœå•æŠ¥é”™ ğŸ›[BUG]

`AI Reply`

### ğŸ› bug æè¿°

![image](https://user-images.githubusercontent.com/20655248/228160761-30611450-8bc8-4beb-a5de-b4303e8d3832.png)
pageage.json åˆ é™¤@ant-design/pro-layout 6.27.2ç‰ˆæœ¬ï¼Œå–@ant-design/pro-componentsé‡Œçš„layoutç‰ˆæœ¬ï¼Œåœ¨node_modulesé‡Œé¢çœ‹layoutç‰ˆæœ¬ä¸º7.6.0ï¼Œç»“æœåŠ¨æ€åŠ è½½è·¯ç”±èœå•å‡ºç°æ§åˆ¶å°æŠ¥é”™ï¼Œå·¦ä¾§çš„è·¯ç”±èœå•å‡ºç°å¼‚å¸¸ï¼Œ @ant-design/pro-layout 6.27.2ç‰ˆæœ¬ä¸ä¼šå‡ºç°æ§åˆ¶å°æŠ¥é”™ï¼Œ7.6.0ç‰ˆæœ¬ä¼šå‡ºç°æ§åˆ¶å°æŠ¥é”™ã€‚å¦‚å›¾

![image](https://user-images.githubusercontent.com/20655248/228161516-ead6cc0a-f818-425a-acf0-90ff4a2075c5.png)

ä»£ç å¦‚ä¸‹

![image](https://user-images.githubusercontent.com/20655248/228161700-7af5a79e-02f1-4595-a34b-799be456f598.png)

### Â© ç‰ˆæœ¬ä¿¡æ¯

- ProComponents ç‰ˆæœ¬: [e.g. 5.0.0]
- umi ç‰ˆæœ¬
- æµè§ˆå™¨ç¯å¢ƒ
- å¼€å‘ç¯å¢ƒ [e.g. mac OS]

### ğŸš‘ å…¶ä»–ä¿¡æ¯

<!--
å¦‚æˆªå›¾ç­‰å…¶ä»–ä¿¡æ¯å¯ä»¥è´´åœ¨è¿™é‡Œ
-->

## chenshuai2144

> TAutomatically replying with ChatGPT can be attempted, but it cannot be guaranteed to be completely accurate and may not fully address all issues. Please feel free to reply if you have any further questions or concerns.
> æ­¤å›å¤åŸºäº ChatGPT è‡ªåŠ¨ç”Ÿæˆï¼Œå¯ä»¥å°è¯•ä¸‹æ–¹æ¡ˆï¼Œå®˜æ–¹äººå‘˜ä¼šåœ¨ä¸€å®šæ—¶é—´åç»§ç»­ç»§ç»­å¤„ç†ã€‚

### å¯èƒ½è§£å†³åŠæ³•

å°è¯•ä½¿ç”¨ @ant-design/pro-layout æœ€æ–°ç‰ˆæœ¬ï¼ˆç›®å‰æ˜¯ 7.11.0ï¼‰ï¼Œå¹¶æŸ¥çœ‹ç›¸åº”çš„æ–‡æ¡£é€‚é…æ›´æ–°ç‰ˆæœ¬çš„ APIã€‚å¦‚æœä½ ä¸æƒ³æ›´æ–°ç‰ˆæœ¬ï¼Œä¹Ÿå¯ä»¥æŒ‰ç…§ä¸‹é¢çš„æ–¹æ³•è¿›è¡Œè§£å†³ã€‚

æ ¹æ®æ§åˆ¶å°çš„æŠ¥é”™ä¿¡æ¯ï¼Œå¤§æ¦‚å¯ä»¥åˆ¤æ–­é—®é¢˜å‡ºç°åœ¨ ProMenu ç»„ä»¶ä¸­ã€‚è¿™é‡Œæœ‰ä¸¤ç§å¯èƒ½çš„è§£å†³åŠæ³•ï¼š

#### è§£å†³åŠæ³•ä¸€

åœ¨ä½¿ç”¨ ProMenu ç»„ä»¶çš„åœ°æ–¹ï¼Œæ‰‹åŠ¨ä¸ºå…¶æ·»åŠ  onOpenChange å’Œ selectedKeys ä¸¤ä¸ªå±æ€§ã€‚å¯å‚è€ƒä¸‹é¢çš„ä»£ç ã€‚

```jsx
import { useState } from 'react';
import { useIntl } from 'umi';
import { getMenuData, getPageTitle } from '@ant-design/pro-layout';
import ProMenu from '@ant-design/pro-menu';

const BasicLayout = (props) => {
  const {
    children,
    location = {
      pathname: '/',
    },
  } = props;
  const { formatMessage } = useIntl();
  const menuDataRef = useRef([]);
  const [collapsed, setCollapsed] = useState(false);
  const [openKeys, setOpenKeys] = useState<string[]>([]);
  const [selectedKeys, setSelectedKeys] = useState<string[]>([]);
  const menuData = useMemo(() => getMenuData(), []);
  useEffect(() => {
    const { query } = location;
    const isMatch = (pathname: string, breadcrumbMap: any) => {
      const pathKey = Object.keys(breadcrumbMap).find((key) => pathToRegexp(key).test(pathname));
      return breadcrumbMap[pathKey];
    };
    const pathname = getMenuMatchKeys(menuData, location.pathname)
      .map((item) => item.path)
      .filter((item) => item && !item.startsWith('#'))
      .join('') as string;
    const pageTitleInfo = getPageTitle({
      pathname,
      formatMessage,
      breadcrumb: getMenuData(),
      ...props,
    });
    // set page title
    document.title = pageTitleInfo.pageTitle || pageTitleInfo.title;
    menuDataRef.current = isMatch(pathname, breadcrumbMap)?.breadcrumb || [];
    setSelectedKeys([pathname]);
  }, [location.pathname]);
  const handleMenuCollapse = (payload: boolean) => {
    setCollapsed(payload);
  };
  const menu = useMemo(
    () => (
      <ProMenu
        style={{
          width: collapsed ? 80 : 256,
        }}
        title="Ant Design Pro"
        selectedKeys={selectedKeys}
        onOpenChange={setOpenKeys}
        request={{
          url: '/api/menus',
        }}
        {...props}
        menuData={menuData}
        collapsed={collapsed}
        location={location}
        isMobile={false}
        onCollapse={handleMenuCollapse}
      />
    ),
    [collapsed, location.pathname],
  );
  return (
    <div style={{ height: '100%' }}>
      {menu}
      <div style={{ height: 'calc(100vh - 64px)' }}>{children}</div>
    </div>
  );
};

export default BasicLayout;

```

#### è§£å†³åŠæ³•äºŒ

æ‰‹åŠ¨ä¿®æ”¹ ProMenu ç»„ä»¶çš„æºç ã€‚ç›®å‰è¿™ä¸ªé—®é¢˜åœ¨ ProMenu çš„ issue åœ°å€ä¸Šå·²ç»æœ‰äº†ä¿®å¤ï¼Œä½†è¿˜æœªåˆå¹¶åˆ°æ­£å¼ç‰ˆä¸­ã€‚å¦‚æœä½ æƒ³ä½“éªŒæ­¤è§£å†³åŠæ³•ï¼Œè¯·åœ¨ node_modules/@ant-design/pro-layout/lib/ProMenu.js æ–‡ä»¶ä¸­æ‰¾åˆ°ä¸‹é¢è¿™æ®µä»£ç 

```js
controlledKeysChanged: function controlledKeysChanged(_, _ref) {
  var selectedKeys = _ref.selectedKeys;

  _this.setState({
    selectedKeys: selectedKeys,
  });
}
```

å¹¶ä¿®æ”¹ä¸ºä»¥ä¸‹å†…å®¹ï¼š

```js
controlledKeysChanged: function controlledKeysChanged(
  prevProps,
  { selectedKeys },
) {
  const { selectedKeys: selectedKeysPro } = this.props;
  if (
    selectedKeysPro !== undefined &&
    prevProps &&
    prevProps.selectedKeys === selectedKeysPro
  ) {
    // if it's not pro-components call, do not update
    return;
  }
  this.setState({
    selectedKeys,
  });
}
```

æ­¤æ–¹æ³•éœ€è¦æ‰‹åŠ¨ä¿®æ”¹æºç å¹¶ä¿å­˜ï¼Œä¸å¤ªå‹å¥½ã€‚å»ºè®®å°è¯•ç¬¬ä¸€ç§è§£å†³åŠæ³•ã€‚

## chenshuai2144

key ç›¸åŒäº†ï¼Œå¤„ç†ä¸€ä¸‹ä½ çš„æ•°æ®å§ï¼Œè·¯å¾„ä¸è¦ç›¸åŒï¼Œæˆ–è€… ä¸“é—¨è®¾ç½®ä¸€ä¸ª key
