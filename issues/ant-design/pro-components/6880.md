# 🧐[问题] proTable: toolbar setting 支持自定义columns吗?

`AI Reply`

比如我提供一个全量的columns给toobar,但是 table使用的columns只前者的一个子集

## chenshuai2144

> TAutomatically replying with ChatGPT can be attempted, but it cannot be guaranteed to be completely accurate and may not fully address all issues. Please feel free to reply if you have any further questions or concerns.
> 此回复基于 ChatGPT 自动生成，可以尝试下方案，官方人员会在一定时间后继续继续处理。

您好，感谢您提出问题。如果我理解您的问题正确，您想在 proTable 的 toolbar 中添加一个下拉列表，然后可以用于选择当前表格要显示哪些列。如果我描述的不正确，请告诉我。

可以使用 `columnSetting` 的方式来处理这个问题。您需要为 `columnSetting` 提供两个参数：一个是所有可选择的列的列表（`options`），另一个是当前表格要显示哪些列的列表（`value`）。

首先，在 ProTable 组件的 `columns` 属性中定义所有可选择的列的列表。假设在 `columns` 中定义了以下两个数据列：

```javascript
const columns = [
  {
    title: "Name",
    dataIndex: "name",
    key: "name",
    width: 100,
  },
  {
    title: "Age",
    dataIndex: "age",
    key: "age",
    width: 100,
  },
];
```

接下来，在 ProTable 的 toolbar 中添加下拉列表，以供用户选择要显示的列。可以使用 `FormItem`、`Select` 和 `ProForm` 组件来完成此操作。下面是完整的代码示例。

```javascript
import ProTable, { ProColumns } from '@ant-design/pro-table';
import React, { useState } from 'react';
import { Form, Select } from 'antd';
import type { FormInstance } from 'antd/lib/form';
import { useLocalStorageState } from '@umijs/hooks';
import '@ant-design/pro-table/dist/table.css';

const TableDemo: React.FC = () => {
  const [columns, setColumns] = useLocalStorageState('pro-table-columns-demo', [
    {
      title: 'Name',
      dataIndex: 'name',
      key: 'name',
      width: 100,
    },
    {
      title: 'Age',
      dataIndex: 'age',
      key: 'age',
      width: 100,
    },
    {
      title: 'Address',
      dataIndex: 'address',
      key: 'address',
      width: 200,
    },
    {
      title: 'Phone',
      dataIndex: 'phone',
      key: 'phone',
      width: 150,
    },
  ]);
  const [selectedColumns, setSelectedColumns] = useState<
    { title: string; dataIndex: string }[]
  >(() =>
    columns.filter((column) => column.key !== 'option' && column.key !== 'selection')
  );

  const columnsWithoutSelection = columns.filter(
    (column) => column.key !== 'option' && column.key !== 'selection'
  );
  const options = columnsWithoutSelection.map((column) => ({
    value: column.dataIndex,
    label: column.title,
  }));

  const formRef = React.useRef<FormInstance>();
  const onFormReset = () => formRef.current?.resetFields();
  const onFormSubmit = async () => {
    const values = await formRef.current?.validateFields();
    if (values) {
      const newColumns = columnsWithoutSelection.filter((column) =>
        values.columns.includes(column.dataIndex)
      );
      setColumns([...newColumns, { title: 'Option', key: 'option', fixed: 'right' }]);
      setSelectedColumns(newColumns);
    }
  };

  const columns: ProColumns[] = [
    ...selectedColumns,
    {
      title: 'Operation',
      valueType: 'option',
      key: 'option',
      fixed: 'right',
      render: () => [<a key="editable">Edit</a>, <a key="delete">Delete</a>],
    },
  ];

  return (
    <div style={{ padding: 24 }}>
      <ProTable
        columns={columns}
        rowKey="key"
        dataSource={[
          { key: 1, name: 'John Brown', age: 32, address: 'New York No. 1 Lake Park', phone: '1234567890' },
          { key: 2, name: 'Jim Green', age: 42, address: 'London No. 1 Lake Park', phone: '1234567891' },
          { key: 3, name: 'Joe Black', age: 32, address: 'Sidney No. 1 Lake Park', phone: '1234567892' },
        ]}
        search={false}
        toolbar={{
          actions: [
            <Button
              key="reset"
              onClick={onFormReset}
            >
              Reset
            </Button>,
            <Button
              key="submit"
              type="primary"
              onClick={onFormSubmit}
            >
              Submit
            </Button>,
          ],
          content: (
            <>
              <Form
                ref={formRef}
              >
                <Form.Item
                  noStyle
                  name="columns"
                >
                  <Select
                    mode="multiple"
                    options={options}
                    placeholder="Please select columns to display"
                    style={{ minWidth: 280, maxWidth: 600 }}
                    allowClear
                    maxTagCount={3}
                  />
                </Form.Item>
              </Form>
            </>
          ),
        }}
        options={{
          density: true,
          fullScreen: true,
          setting: true,
        }}
        headerTitle="Basic Table"
        style={{ width: '100%' }}
      />
    </div>
  );
};

export default TableDemo;
```

此代码示例中，首先定义了 `columns`，其中包括两个初始列以及两个可以选择的列，即 Address 和 Phone。然后，在组件中定义了两个状态：`columns` 和 `selectedColumns`，作为当前表格要显示的所有列和用户选择的列。在 ProTable 的 `columns` 属性中只显示 `selectedColumns` 列，其中包括操作列。

在表格的 toolbar 中添加了一个表单，其包含一个多选的下拉列表。该下拉列表的选项来自于 `options`，其定义为 `columns` 中除了操作列和选择列之外的所有列。使用表单的 `onFormSubmit` 方法可以根据用户选择的列更新表格的 `columns` 和 `selectedColumns`。在这个函数中，根据 `columns` 的选择更新 `selectedColumns`，然后将更新后的 `columns` 更新到状态中。

最后，将更新后的 `selectedColumns` 和操作列定义为 ProTable 组件的 `columns` 属性。即，ProTable 将只显示用户选择的列和操作列。

## chenshuai2144

可以看源码自己实现一下，本来只是个辅助小工作，不希望太复杂
