# ğŸ§[é—®é¢˜] å…³äºloadingçŠ¶æ€çš„é—®é¢˜

`AI Reply`

ä¸€èˆ¬ä¸šåŠ¡éƒ½ä¼šåœ¨æœ€åä¸€åˆ—å¢åŠ ä¸€äº›ç¼–è¾‘æˆ–è€…åˆ é™¤æ“ä½œï¼ŒæŒ‰ç†è¯´åœ¨è¿›è¡Œåˆ é™¤æ“ä½œçš„æ—¶å€™ï¼Œæ˜¯è¦è®©tableæ•´ä¸ªè¿›å…¥loadingçŠ¶æ€ï¼Œç„¶ååœ¨æ“ä½œå®Œåˆ·æ–°ä¸€ä¸‹tableæŠŠã€‚
å¦‚ä¸‹ï¼Œæ¨¡æ‹Ÿä¸€ä¸‹ä¸šåŠ¡è€—æ—¶çš„æ–¹æ³•

```
{
    title: 'æ“ä½œ',
    valueType: 'option',
    align: 'center',
    render: (_, record, idx, action) => <>
        <Popconfirm
            placement="topRight"
            title='ç¡®è®¤åˆ é™¤ï¼Ÿ'
            onConfirm={async () => {
                setLoading(true);
                await new Promise(resolve => setTimeout(resolve, 1500));
                action?.reload();
                setLoading(false);
            }
            onCancel={() => {
            }}
        >
            <a onClick={() => { }}>åˆ é™¤</a>
        </Popconfirm>
    </>
}
```

protableçš„requesté»˜è®¤æ‰˜ç®¡äº†loadingçŠ¶æ€ï¼Œç°åœ¨æ”¹ä¸ºæ‰‹åŠ¨ç®¡ç†ä¹‹åã€‚é€šè¿‡tableçš„requesté»˜è®¤çš„loadingçŠ¶æ€å°±æ²¡äº†ã€‚
è¿™æ ·æŸ¥è¯¢ã€ç¿»é¡µçš„æ—¶å€™éƒ½éœ€è¦æ‰‹åŠ¨è¿›è¡ŒloadingçŠ¶æ€ç®¡ç†ã€‚
ä½†æ˜¯æ²¡æ‰¾åˆ°æ¯”è¾ƒåˆé€‚çš„åœ°æ–¹ç»Ÿä¸€è®¾ç½®çŠ¶æ€ï¼Œåœ¨onSubmité‡Œå¼€å¯loadingå¯¹ç¿»é¡µæ— æ•ˆæœï¼Œè¿™æ ·åˆå¾—åœ¨paginationé‡Œçš„onchangeå†è®¾ç½®ä¸€æ¬¡ã€‚è€Œä¸”æ²¡æœ‰åˆé€‚çš„åœ°æ–¹è®¾ç½®å…³é—­loadingï¼Ÿè¯•äº†ä¸‹ç”±onSubmité‡Œå¼€å¯loadingåï¼Œåœ¨postDataå’Œrequesté‡Œéƒ½æ²¡æ³•å…³é—­loadingã€‚

æƒ³é—®é—®æœ‰æ²¡æœ‰ä»€ä¹ˆä¼˜é›…çš„æ–¹å¼èƒ½å…¼é¡¾è¿™äº›æƒ…å†µå‘¢ã€‚

## chenshuai2144

> TAutomatically replying with ChatGPT can be attempted, but it cannot be guaranteed to be completely accurate and may not fully address all issues. Please feel free to reply if you have any further questions or concerns.
> æ­¤å›å¤åŸºäº ChatGPT è‡ªåŠ¨ç”Ÿæˆï¼Œå¯ä»¥å°è¯•ä¸‹æ–¹æ¡ˆï¼Œå®˜æ–¹äººå‘˜ä¼šåœ¨ä¸€å®šæ—¶é—´åç»§ç»­ç»§ç»­å¤„ç†ã€‚

ğŸ¤”[æ€è·¯] å¯¹äºloadingçŠ¶æ€çš„ä¼˜é›…è§£å†³æ–¹æ¡ˆ

ä½ å¯ä»¥è¯•è¯•ä½¿ç”¨useEffecté’©å­å‡½æ•°ï¼Œä¸å±€éƒ¨çš„çŠ¶æ€å˜é‡æ¥è§£å†³è¯¥é—®é¢˜ã€‚å…·ä½“æ€è·¯å¯ä»¥è¿™æ ·å®ç°ï¼š

1. åœ¨ç»„ä»¶é¡¶éƒ¨å®šä¹‰ä¸€ä¸ªuseStateï¼Œç”¨äºæ§åˆ¶loadingçŠ¶æ€ã€‚
2. å°†è¿™ä¸ªuseStateçŠ¶æ€å˜é‡ä½œä¸ºpropä¼ é€’ç»™æ¯ä¸€åˆ—çš„æ“ä½œç»„ä»¶ã€‚
3. åœ¨æ“ä½œç»„ä»¶é‡Œé€šè¿‡çˆ¶ç»„ä»¶ä¼ é€’çš„å˜é‡æ¥æ§åˆ¶loadingçŠ¶æ€ã€‚
4. ä½¿ç”¨useEffecté’©å­å‡½æ•°ï¼Œåœ¨ç»„ä»¶didMountæ—¶è®¾ç½®tableçš„loadingçŠ¶æ€ä¸ºå½“å‰çš„loadingçŠ¶æ€å˜é‡ã€‚
5. åœ¨ç»„ä»¶willUnmountæ—¶ï¼ŒåŒæ­¥å¸è½½loadingçŠ¶æ€å˜é‡ã€‚

é€šè¿‡è¿™ä¸ªæ–¹å¼å¯ä»¥ä½¿å¾—loadingçŠ¶æ€åœ¨å†…éƒ¨æ“ä½œæ•°æ®æ—¶è¢«è‡ªåŠ¨ç®¡ç†ï¼Œè€Œåœ¨æŸ¥è¯¢ã€ç¿»é¡µæ“ä½œä¸­å¯ä»¥é€šè¿‡useStateæ‰‹åŠ¨è°ƒèŠ‚loadingçŠ¶æ€ï¼Œå¹¶é€šè¿‡useEffectè‡ªåŠ¨çš„åŒæ­¥åˆ°Tableä¸­å»ã€‚

å…·ä½“çš„ä»£ç å®ç°å¯ä»¥å‚è€ƒä¸‹é¢çš„ç¤ºä¾‹ï¼š

```jsx
import React, { useState, useEffect } from "react";
import { Table, Popconfirm } from "antd";

const data = [
  { name: "Alice", age: 23 },
  { name: "Bob", age: 24 },
];

const columns = [
  {
    title: "Name",
    dataIndex: "name",
  },
  {
    title: "Age",
    dataIndex: "age",
  },
  {
    title: "Action",
    align: "center",
    render: (text, record, index) => (
      <Action
        index={index}
        setLoading={setLoading}
        onDelete={() => {
          // Simulate a long time operation
          setLoading(true);
          setTimeout(() => {
            setData(data.filter((d, i) => i !== index));
            setLoading(false);
          }, 1500);
        }}
      />
    ),
  },
];

const Action = ({ index, setLoading, onDelete }) => (
  <Popconfirm title="Are you sure to delete?" onConfirm={onDelete}>
    <a onClick={() => setLoading(true)}>Delete</a>
  </Popconfirm>
);

const MyTable = () => {
  const [loading, setLoading] = useState(false);
  const [data, setData] = useState([]);

  useEffect(() => {
    setLoading(loading);
  }, [loading]);

  return <Table loading={loading} dataSource={data} columns={columns} />;
};

export default MyTable;
```

å¸Œæœ›è¿™ä¸ªæ–¹æ¡ˆå¯ä»¥è§£å†³ä½ çš„é—®é¢˜ã€‚

## adi291

æˆ‘ç°åœ¨æ˜¯é‡‡ç”¨å¦‚ä¸‹æ–¹å¼è§£å†³çš„

```tsx
const Demo: React.FC = () => {
  const actionRef = useRef<ActionType>();
  const [loading, setLoading] = useState<boolean>(false);

  const columns: ProColumns<GithubIssueItem>[] = [
    {
      dataIndex: "index",
      valueType: "indexBorder",
      width: 48,
    },
    {
      title: "æ“ä½œ",
      valueType: "option",
      key: "option",
      render: (text, record, _, action) => [
        <Popconfirm
          title="ç¡®å®šåˆ é™¤ï¼Ÿ"
          onConfirm={async () => {
            setLoading(true); // 1
            await new Promise((resolve) => setTimeout(resolve, 2000));
            setLoading(false); // 2
            action?.reload();
          }}
        >
          <a>åˆ é™¤</a>
        </Popconfirm>,
      ],
    },
  ];

  return (
    <ProTable<GithubIssueItem>
      actionRef={actionRef}
      columns={columns}
      loading={loading}
      request={async (params = {}, sort, filter) => {
        setLoading(true); // 3
        // if (!loading) setLoading(true); // 4
        let data;
        try {
          data = await request<{ data: GithubIssueItem[] }>(
            "https://proapi.azurewebsites.net/github/issues",
            { params },
          );
        } catch (reason) {
          // showError...
          data = { success: true, data: [] };
        }
        setLoading(false); // 5
        return data;
      }}
      rowKey="id"
      cardBordered
      search={{ labelWidth: "auto" }}
      pagination={{ pageSize: 5 }}
      headerTitle="é«˜çº§è¡¨æ ¼"
    />
  );
};
```

ç›®å‰è¿™ç§æ–¹å¼å”¯ä¸€çš„é—æ†¾æ˜¯å®é™…ä¸Šæ˜¯ä¸¤æ¬¡çŠ¶æ€çš„å˜æ›´ï¼Œåˆ é™¤çš„æ–¹æ³•æ‰§è¡Œæ—¶ä¸€æ¬¡ï¼Œreloadæ›´æ–°è¡¨çš„æ—¶å€™ä¸€æ¬¡ï¼Œä»ç”¨æˆ·æ„Ÿå—ä¸Šæ¥è¯´å¯èƒ½ä¼šç–‘æƒ‘ä¼šä»€ä¹ˆå‡ºç°ä¸¤æ¬¡åŠ è½½ï¼Œä½†ä»ä»£ç ä¸Šæ¥çœ‹æ˜¯åˆç†çš„ï¼Œæœ¬æ¥å°±æ˜¯ä¸¤å—å•ç‹¬çš„é€»è¾‘ã€‚
å½“åˆå°è¯•å‘ç°æ— æ³•å…³é—­æ˜¯æˆ‘æƒ³å½“ç„¶çš„æƒ³è®©å®ƒåªæœ‰ä¸€æ¬¡åŠ è½½çŠ¶æ€ï¼Œä»£ç æ˜¯å»æ‰ 2ã€3ï¼ŒåŠ ä¸Šäº†4ï¼Œæ‰€ä»¥å®é™…ä¸Šåœ¨åˆ é™¤åæ²¡æœ‰å…³é—­loadingä»è€Œå¯¼è‡´æ ¹æœ¬æ²¡æœ‰è¿›å…¥reloadã€‚

## chenshuai2144

> TAutomatically replying with ChatGPT can be attempted, but it cannot be guaranteed to be completely accurate and may not fully address all issues. Please feel free to reply if you have any further questions or concerns.
> æ­¤å›å¤åŸºäº ChatGPT è‡ªåŠ¨ç”Ÿæˆï¼Œå¯ä»¥å°è¯•ä¸‹æ–¹æ¡ˆï¼Œå®˜æ–¹äººå‘˜ä¼šåœ¨ä¸€å®šæ—¶é—´åç»§ç»­ç»§ç»­å¤„ç†ã€‚

ä½ è¿™ç§æ–¹æ¡ˆå¯¹äºè§£å†³è¡¨æ ¼ä¸­çš„æ“ä½œä¸­çš„loadingæ˜¯æ²¡é—®é¢˜çš„ã€‚ä½†æ˜¯ä½ åœ¨requestä¸­çš„loadingçŠ¶æ€çš„ç®¡ç†ä¸Šæœ‰äº›é—®é¢˜ï¼Œå¯¼è‡´äº†ç¬¬ä¸€æ¬¡åˆ é™¤æ—¶loadingçŠ¶æ€æ˜¯æ²¡è¢«æ›´æ–°çš„ï¼Œå¯èƒ½å½±å“åˆ°ç”¨æˆ·ä½“éªŒã€‚ä¸ºäº†æ›´ç²¾ç»†åœ°ç®¡ç†loadingçŠ¶æ€ï¼Œæˆ‘ä»¬å»ºè®®ä½¿ç”¨ Promise.finallyï¼Œè¿™æ ·å¯ä»¥ä¿è¯æ— è®º Promise çŠ¶æ€æœ€ç»ˆå¦‚ä½•ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥å®ŒæˆçŠ¶æ€ç®¡ç†ã€‚å…·ä½“çš„ä»£ç å¯ä»¥å‚è€ƒä¸‹é¢çš„ç¤ºä¾‹ï¼š

```tsx
const Demo: React.FC = () => {
  const actionRef = useRef<ActionType>();
  const [loading, setLoading] = useState<boolean>(false);

  const columns: ProColumns<GithubIssueItem>[] = [
    {
      dataIndex: "index",
      valueType: "indexBorder",
      width: 48,
    },
    {
      title: "æ“ä½œ",
      valueType: "option",
      key: "option",
      render: (_, record, idx, action) => (
        <>
          <Popconfirm
            title="ç¡®å®šåˆ é™¤ï¼Ÿ"
            onConfirm={() => {
              setLoading(true);
              new Promise((resolve) => setTimeout(resolve, 2000)).finally(
                () => {
                  action?.reload();
                  setLoading(false);
                },
              );
            }}
          >
            <a>åˆ é™¤</a>
          </Popconfirm>
        </>
      ),
    },
  ];

  return (
    <ProTable<GithubIssueItem>
      actionRef={actionRef}
      columns={columns}
      loading={loading}
      request={async (params = {}, sort, filter) => {
        setLoading(true);
        try {
          const data = await request<{ data: GithubIssueItem[] }>(
            "https://proapi.azurewebsites.net/github/issues",
            { params },
          );
          return { data, success: true };
        } catch (reason) {
          // showError...
          return { success: false, data: [] };
        } finally {
          setLoading(false);
        }
      }}
      rowKey="id"
      cardBordered
      search={{ labelWidth: "auto" }}
      pagination={{ pageSize: 5 }}
      headerTitle="é«˜çº§è¡¨æ ¼"
    />
  );
};
```

å…·ä½“æ¥è¯´ï¼Œåœ¨åˆ é™¤å¤„ç†æ–¹æ³•çš„æœ€åï¼Œé€šè¿‡ finally å—ç»Ÿä¸€æ›´æ–° loadingï¼Œè¿™æ ·å³ä½¿ delete æ“ä½œæœ¬èº«å°±å§‹ç»ˆå¤„äº pending çŠ¶æ€ï¼Œç”¨æˆ·ä¹Ÿä¸ä¼šæ„Ÿåˆ°æ¯”è¾ƒè¿·æƒ‘äº†ï¼ŒåŒæ—¶ä»£ç æ›´ç®€æ´æ¸…æ™°ã€‚åœ¨requestä¸­çš„loadingçŠ¶æ€ç®¡ç†ä¸Šï¼Œé€šè¿‡try-catch-finallyçš„æ–¹å¼ï¼Œå°†æ•°æ®è¯·æ±‚çš„é€»è¾‘å’ŒåŠç†loadingçŠ¶æ€çš„é€»è¾‘åˆ†åˆ«æ”¾åœ¨ä¸åŒçš„å—ä¸­ï¼Œæ›´åŠ å®¹æ˜“ç†è§£å’Œç»´æŠ¤ã€‚

## adi291

> > TAutomatically replying with ChatGPT can be attempted, but it cannot be guaranteed to be completely accurate and may not fully address all issues. Please feel free to reply if you have any further questions or concerns.
> > æ­¤å›å¤åŸºäº ChatGPT è‡ªåŠ¨ç”Ÿæˆï¼Œå¯ä»¥å°è¯•ä¸‹æ–¹æ¡ˆï¼Œå®˜æ–¹äººå‘˜ä¼šåœ¨ä¸€å®šæ—¶é—´åç»§ç»­ç»§ç»­å¤„ç†ã€‚
>
> ä½ è¿™ç§æ–¹æ¡ˆå¯¹äºè§£å†³è¡¨æ ¼ä¸­çš„æ“ä½œä¸­çš„loadingæ˜¯æ²¡é—®é¢˜çš„ã€‚ä½†æ˜¯ä½ åœ¨requestä¸­çš„loadingçŠ¶æ€çš„ç®¡ç†ä¸Šæœ‰äº›é—®é¢˜ï¼Œå¯¼è‡´äº†ç¬¬ä¸€æ¬¡åˆ é™¤æ—¶loadingçŠ¶æ€æ˜¯æ²¡è¢«æ›´æ–°çš„ï¼Œå¯èƒ½å½±å“åˆ°ç”¨æˆ·ä½“éªŒã€‚ä¸ºäº†æ›´ç²¾ç»†åœ°ç®¡ç†loadingçŠ¶æ€ï¼Œæˆ‘ä»¬å»ºè®®ä½¿ç”¨ Promise.finallyï¼Œè¿™æ ·å¯ä»¥ä¿è¯æ— è®º Promise çŠ¶æ€æœ€ç»ˆå¦‚ä½•ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥å®ŒæˆçŠ¶æ€ç®¡ç†ã€‚å…·ä½“çš„ä»£ç å¯ä»¥å‚è€ƒä¸‹é¢çš„ç¤ºä¾‹ï¼š
>
> ```tsx
> const Demo: React.FC = () => {
>   const actionRef = useRef<ActionType>();
>   const [loading, setLoading] = useState<boolean>(false);
>
>   const columns: ProColumns<GithubIssueItem>[] = [
>     {
>       dataIndex: "index",
>       valueType: "indexBorder",
>       width: 48,
>     },
>     {
>       title: "æ“ä½œ",
>       valueType: "option",
>       key: "option",
>       render: (_, record, idx, action) => (
>         <>
>           <Popconfirm
>             title="ç¡®å®šåˆ é™¤ï¼Ÿ"
>             onConfirm={() => {
>               setLoading(true);
>               new Promise((resolve) => setTimeout(resolve, 2000)).finally(
>                 () => {
>                   action?.reload();
>                   setLoading(false);
>                 },
>               );
>             }}
>           >
>             <a>åˆ é™¤</a>
>           </Popconfirm>
>         </>
>       ),
>     },
>   ];
>
>   return (
>     <ProTable<GithubIssueItem>
>       actionRef={actionRef}
>       columns={columns}
>       loading={loading}
>       request={async (params = {}, sort, filter) => {
>         setLoading(true);
>         try {
>           const data = await request<{ data: GithubIssueItem[] }>(
>             "https://proapi.azurewebsites.net/github/issues",
>             { params },
>           );
>           return { data, success: true };
>         } catch (reason) {
>           // showError...
>           return { success: false, data: [] };
>         } finally {
>           setLoading(false);
>         }
>       }}
>       rowKey="id"
>       cardBordered
>       search={{ labelWidth: "auto" }}
>       pagination={{ pageSize: 5 }}
>       headerTitle="é«˜çº§è¡¨æ ¼"
>     />
>   );
> };
> ```
>
> å…·ä½“æ¥è¯´ï¼Œåœ¨åˆ é™¤å¤„ç†æ–¹æ³•çš„æœ€åï¼Œé€šè¿‡ finally å—ç»Ÿä¸€æ›´æ–° loadingï¼Œè¿™æ ·å³ä½¿ delete æ“ä½œæœ¬èº«å°±å§‹ç»ˆå¤„äº pending çŠ¶æ€ï¼Œç”¨æˆ·ä¹Ÿä¸ä¼šæ„Ÿåˆ°æ¯”è¾ƒè¿·æƒ‘äº†ï¼ŒåŒæ—¶ä»£ç æ›´ç®€æ´æ¸…æ™°ã€‚åœ¨requestä¸­çš„loadingçŠ¶æ€ç®¡ç†ä¸Šï¼Œé€šè¿‡try-catch-finallyçš„æ–¹å¼ï¼Œå°†æ•°æ®è¯·æ±‚çš„é€»è¾‘å’ŒåŠç†loadingçŠ¶æ€çš„é€»è¾‘åˆ†åˆ«æ”¾åœ¨ä¸åŒçš„å—ä¸­ï¼Œæ›´åŠ å®¹æ˜“ç†è§£å’Œç»´æŠ¤ã€‚

è¿™æ ·ç¡®å®æ›´ä¸¥è°¨äº›ã€‚
é—®ä¸€ä¸‹è¿™æ˜¯GPTå“ªä¸ªç‰ˆæœ¬çš„æ¨¡å‹ï¼Œä¸‹æ¬¡ç›´æ¥é—®GPTå¥½äº†ã€‚

## chenshuai2144

> TAutomatically replying with ChatGPT can be attempted, but it cannot be guaranteed to be completely accurate and may not fully address all issues. Please feel free to reply if you have any further questions or concerns.
> æ­¤å›å¤åŸºäº ChatGPT è‡ªåŠ¨ç”Ÿæˆï¼Œå¯ä»¥å°è¯•ä¸‹æ–¹æ¡ˆï¼Œå®˜æ–¹äººå‘˜ä¼šåœ¨ä¸€å®šæ—¶é—´åç»§ç»­ç»§ç»­å¤„ç†ã€‚

è¿™æ˜¯OpenAIçš„ GPT-3 æ¨¡å‹ã€‚ChatGPT æ˜¯ GPT-3 çš„ä¸€ä¸ªå˜ç§ï¼Œå¯ä»¥ä½¿ç”¨å¯¹è¯å¼æ–¹å¼å›ç­”æé—®ã€‚
