# 🐛[BUG] ProTable - 在 ant-modal 中 check 表头的 filter 后, pagination 的 total 等 props 未同步进行改变

`📦  Need to reproduce`,`AI Reply`

### 🐛 bug 描述

当我在 Modal 中绘制一个 ProTable， 并且为某一列配置了 **filter: true** 时，选择表头的过滤项后 pagination 中的 total 等属性并未同步改变，这与在 Modal 外部绘制的 ProTable 表现并不相同。

### 📷 复现步骤

![ProTableBug](https://user-images.githubusercontent.com/56389128/230541179-47baaec9-4879-4523-a52d-620496bf5d4e.gif)

### 🏞 期望结果

当前可操作的解决方案

### 💻 复现代码

```javascript
import React, { useState, useRef } from 'react';
import request from "umi-request";

import type { ActionType } from "@ant-design/pro-table";
import ProTable from "@ant-design/pro-table";
import { Button, Dropdown, Menu, Modal } from "antd";
import { EllipsisOutlined, PlusOutlined } from "@ant-design/icons";

const App = () => {
    const actionRef = useRef<ActionType>();
    const [visible, setVisible] = useState<boolean>(false);

    const handleOpenModal = () => setVisible(!visible);

    return (
        <>
            <Button onClick={handleOpenModal}>Open Modal</Button>
            {/* @ts-ignore - Property 'children' does not exist on type 'IntrinsicAttributes & ModalProps'. */}
            <Modal width={1500} visible={visible}>
                <ProTable
                    // This props block refer from procomponents.ant.design documentation (anchor 查询表格)
                    // @see https://procomponents.ant.design/components/table?tab=api&current=1&pageSize=5#%E6%9F%A5%E8%AF%A2%E8%A1%A8%E6%A0%BC */}
                    // ......
                />
            </Modal>
        </>
    );
};

export default App;
```

### © 版本信息

"@ant-design/pro-table": "2.66.4"
"antd": "4.19.1",
"react": "^18.2.0",
"react-dom": "^18.2.0",

### 🚑 其他信息

Pagination props 并未改变，如下图：

![image](https://user-images.githubusercontent.com/56389128/230542079-8202ed0d-5c2d-46c4-8d0f-dd6f7e236253.png)

## chenshuai2144

> TAutomatically replying with ChatGPT can be attempted, but it cannot be guaranteed to be completely accurate and may not fully address all issues. Please feel free to reply if you have any further questions or concerns.
> 此回复基于 ChatGPT 自动生成，可以尝试下方案，官方人员会在一定时间后继续继续处理。

你好！感谢你的反馈。经过我在 procomponents.ant.design/searchTable 中的测试，我发现问题出在 filter 的 value 上并未传递到 actionRef 的 current 中，但是也有一些可操作的解决方案：

1. 在 Modal 中为 ProTable 传递一个 callback，将当前 table 的 pagination 信息传递给父组件进行处理。

```javascript
import React, { useState, useRef } from 'react';
import request from "umi-request";

import type { ActionType } from "@ant-design/pro-table";
import ProTable from "@ant-design/pro-table";
import { Button, Dropdown, Menu, Modal } from "antd";
import { EllipsisOutlined, PlusOutlined } from "@ant-design/icons";

const App = () => {
    const actionRef = useRef<ActionType>();
    const [visible, setVisible] = useState<boolean>(false);
    const [total, setTotal] = useState<number>(0);

    const handleOpenModal = () => setVisible(!visible);

    return (
        <>
            <Button onClick={handleOpenModal}>Open Modal</Button>
            {/* @ts-ignore - Property 'children' does not exist on type 'IntrinsicAttributes & ModalProps'. */}
            <Modal width={1500} visible={visible}>
                <ProTable
                    // This props block refer from procomponents.ant.design documentation (anchor 查询表格)
                    // @see https://procomponents.ant.design/components/table?tab=api&current=1&pageSize=5#%E6%9F%A5%E8%AF%A2%E8%A1%A8%E6%A0%BC */}
                    actionRef={(ref) => {
                        actionRef.current = ref;
                        return ref;
                    }}
                    request={(params: any) => { return request(params) } }
                    columns={[{ // .... }]
                    tableExtraRender={(props) => {
                        // 将pagination信息传递给父组件
                        setTotal(props.pagination.total);
                        return null;
                    }}
                />
                <div>Total: {total}</div>
            </Modal>
        </>
    );
};

export default App;
```

但是这个方案在存在复杂逻辑时易出现问题。

2. 同时可以使用 `formRef` ，在父组件获取到的 formRef 当中读取值并重新传递

```javascript
import React, { useState, useRef } from 'react';
import request from "umi-request";

import type { ActionType } from "@ant-design/pro-table";
import ProTable from "@ant-design/pro-table";
import { Button, Dropdown, Menu, Modal } from "antd";
import { EllipsisOutlined, PlusOutlined } from "@ant-design/icons";

const App = () => {
    const actionRef = useRef<ActionType>();
    const formRef = useRef();
    const [visible, setVisible] = useState<boolean>(false);

    const handleOpenModal = () => setVisible(!visible);

    const handleFilterChange = (value: string, dataIndex: string) => {
        const form = formRef.current;
        if (form) {
            const values = { ...form.getFieldsValue };
            values[dataIndex] = value; // 真正的处理逻辑决定于业务需求
            form.setFieldsValue(values);
        }
    }

    return (
        <>
            <Button onClick={handleOpenModal}>Open Modal</Button>
            {/* @ts-ignore - Property 'children' does not exist on type 'IntrinsicAttributes & ModalProps'. */}
            <Modal width={1500} visible={visible}>
                <ProTable
                    // This props block refer from procomponents.ant.design documentation (anchor 查询表格)
                    // @see https://procomponents.ant.design/components/table?tab=api&current=1&pageSize=5#%E6%9F%A5%E8%AF%A2%E8%A1%A8%E6%A0%BC */}
                    actionRef={(ref) => {
                        actionRef.current = ref;
                        return ref;
                    }}
                    request={(params: any) => { return request(params) } }
                    columns={[{ // .... }]
                    searchText="Search"
                    filterDropdownVisible={true}
                    onFilterDropdownVisibleChange={undefined}
                    onFilterChange={handleFilterChange}
                />
            </Modal>
        </>
    );
};

export default App;
```

#### 关于解决方案的讨论

我认为最佳的解决方案应该是在 ProTable 中增加一个 `paginationOnChange` 的 props，并且将其广泛应用在 `pagination` 相关的组件中。这样可以保证在Filter等变化时同时更新分页信息。
