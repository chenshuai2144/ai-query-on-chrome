# ğŸ›[BUG] ProTable - åœ¨ ant-modal ä¸­ check è¡¨å¤´çš„ filter å, pagination çš„ total ç­‰ props æœªåŒæ­¥è¿›è¡Œæ”¹å˜

`ğŸ“¦  Need to reproduce`,`AI Reply`

### ğŸ› bug æè¿°

å½“æˆ‘åœ¨ Modal ä¸­ç»˜åˆ¶ä¸€ä¸ª ProTableï¼Œ å¹¶ä¸”ä¸ºæŸä¸€åˆ—é…ç½®äº† **filter: true** æ—¶ï¼Œé€‰æ‹©è¡¨å¤´çš„è¿‡æ»¤é¡¹å pagination ä¸­çš„ total ç­‰å±æ€§å¹¶æœªåŒæ­¥æ”¹å˜ï¼Œè¿™ä¸åœ¨ Modal å¤–éƒ¨ç»˜åˆ¶çš„ ProTable è¡¨ç°å¹¶ä¸ç›¸åŒã€‚

### ğŸ“· å¤ç°æ­¥éª¤

![ProTableBug](https://user-images.githubusercontent.com/56389128/230541179-47baaec9-4879-4523-a52d-620496bf5d4e.gif)

### ğŸ æœŸæœ›ç»“æœ

å½“å‰å¯æ“ä½œçš„è§£å†³æ–¹æ¡ˆ

### ğŸ’» å¤ç°ä»£ç 

```javascript
import React, { useState, useRef } from 'react';
import request from "umi-request";

import type { ActionType } from "@ant-design/pro-table";
import ProTable from "@ant-design/pro-table";
import { Button, Dropdown, Menu, Modal } from "antd";
import { EllipsisOutlined, PlusOutlined } from "@ant-design/icons";

const App = () => {
    const actionRef = useRef<ActionType>();
    const [visible, setVisible] = useState<boolean>(false);

    const handleOpenModal = () => setVisible(!visible);

    return (
        <>
            <Button onClick={handleOpenModal}>Open Modal</Button>
            {/* @ts-ignore - Property 'children' does not exist on type 'IntrinsicAttributes & ModalProps'. */}
            <Modal width={1500} visible={visible}>
                <ProTable
                    // This props block refer from procomponents.ant.design documentation (anchor æŸ¥è¯¢è¡¨æ ¼)
                    // @see https://procomponents.ant.design/components/table?tab=api&current=1&pageSize=5#%E6%9F%A5%E8%AF%A2%E8%A1%A8%E6%A0%BC */}
                    // ......
                />
            </Modal>
        </>
    );
};

export default App;
```

### Â© ç‰ˆæœ¬ä¿¡æ¯

"@ant-design/pro-table": "2.66.4"
"antd": "4.19.1",
"react": "^18.2.0",
"react-dom": "^18.2.0",

### ğŸš‘ å…¶ä»–ä¿¡æ¯

Pagination props å¹¶æœªæ”¹å˜ï¼Œå¦‚ä¸‹å›¾ï¼š

![image](https://user-images.githubusercontent.com/56389128/230542079-8202ed0d-5c2d-46c4-8d0f-dd6f7e236253.png)

## chenshuai2144

> TAutomatically replying with ChatGPT can be attempted, but it cannot be guaranteed to be completely accurate and may not fully address all issues. Please feel free to reply if you have any further questions or concerns.
> æ­¤å›å¤åŸºäº ChatGPT è‡ªåŠ¨ç”Ÿæˆï¼Œå¯ä»¥å°è¯•ä¸‹æ–¹æ¡ˆï¼Œå®˜æ–¹äººå‘˜ä¼šåœ¨ä¸€å®šæ—¶é—´åç»§ç»­ç»§ç»­å¤„ç†ã€‚

ä½ å¥½ï¼æ„Ÿè°¢ä½ çš„åé¦ˆã€‚ç»è¿‡æˆ‘åœ¨ procomponents.ant.design/searchTable ä¸­çš„æµ‹è¯•ï¼Œæˆ‘å‘ç°é—®é¢˜å‡ºåœ¨ filter çš„ value ä¸Šå¹¶æœªä¼ é€’åˆ° actionRef çš„ current ä¸­ï¼Œä½†æ˜¯ä¹Ÿæœ‰ä¸€äº›å¯æ“ä½œçš„è§£å†³æ–¹æ¡ˆï¼š

1. åœ¨ Modal ä¸­ä¸º ProTable ä¼ é€’ä¸€ä¸ª callbackï¼Œå°†å½“å‰ table çš„ pagination ä¿¡æ¯ä¼ é€’ç»™çˆ¶ç»„ä»¶è¿›è¡Œå¤„ç†ã€‚

```javascript
import React, { useState, useRef } from 'react';
import request from "umi-request";

import type { ActionType } from "@ant-design/pro-table";
import ProTable from "@ant-design/pro-table";
import { Button, Dropdown, Menu, Modal } from "antd";
import { EllipsisOutlined, PlusOutlined } from "@ant-design/icons";

const App = () => {
    const actionRef = useRef<ActionType>();
    const [visible, setVisible] = useState<boolean>(false);
    const [total, setTotal] = useState<number>(0);

    const handleOpenModal = () => setVisible(!visible);

    return (
        <>
            <Button onClick={handleOpenModal}>Open Modal</Button>
            {/* @ts-ignore - Property 'children' does not exist on type 'IntrinsicAttributes & ModalProps'. */}
            <Modal width={1500} visible={visible}>
                <ProTable
                    // This props block refer from procomponents.ant.design documentation (anchor æŸ¥è¯¢è¡¨æ ¼)
                    // @see https://procomponents.ant.design/components/table?tab=api&current=1&pageSize=5#%E6%9F%A5%E8%AF%A2%E8%A1%A8%E6%A0%BC */}
                    actionRef={(ref) => {
                        actionRef.current = ref;
                        return ref;
                    }}
                    request={(params: any) => { return request(params) } }
                    columns={[{ // .... }]
                    tableExtraRender={(props) => {
                        // å°†paginationä¿¡æ¯ä¼ é€’ç»™çˆ¶ç»„ä»¶
                        setTotal(props.pagination.total);
                        return null;
                    }}
                />
                <div>Total: {total}</div>
            </Modal>
        </>
    );
};

export default App;
```

ä½†æ˜¯è¿™ä¸ªæ–¹æ¡ˆåœ¨å­˜åœ¨å¤æ‚é€»è¾‘æ—¶æ˜“å‡ºç°é—®é¢˜ã€‚

2. åŒæ—¶å¯ä»¥ä½¿ç”¨ `formRef` ï¼Œåœ¨çˆ¶ç»„ä»¶è·å–åˆ°çš„ formRef å½“ä¸­è¯»å–å€¼å¹¶é‡æ–°ä¼ é€’

```javascript
import React, { useState, useRef } from 'react';
import request from "umi-request";

import type { ActionType } from "@ant-design/pro-table";
import ProTable from "@ant-design/pro-table";
import { Button, Dropdown, Menu, Modal } from "antd";
import { EllipsisOutlined, PlusOutlined } from "@ant-design/icons";

const App = () => {
    const actionRef = useRef<ActionType>();
    const formRef = useRef();
    const [visible, setVisible] = useState<boolean>(false);

    const handleOpenModal = () => setVisible(!visible);

    const handleFilterChange = (value: string, dataIndex: string) => {
        const form = formRef.current;
        if (form) {
            const values = { ...form.getFieldsValue };
            values[dataIndex] = value; // çœŸæ­£çš„å¤„ç†é€»è¾‘å†³å®šäºä¸šåŠ¡éœ€æ±‚
            form.setFieldsValue(values);
        }
    }

    return (
        <>
            <Button onClick={handleOpenModal}>Open Modal</Button>
            {/* @ts-ignore - Property 'children' does not exist on type 'IntrinsicAttributes & ModalProps'. */}
            <Modal width={1500} visible={visible}>
                <ProTable
                    // This props block refer from procomponents.ant.design documentation (anchor æŸ¥è¯¢è¡¨æ ¼)
                    // @see https://procomponents.ant.design/components/table?tab=api&current=1&pageSize=5#%E6%9F%A5%E8%AF%A2%E8%A1%A8%E6%A0%BC */}
                    actionRef={(ref) => {
                        actionRef.current = ref;
                        return ref;
                    }}
                    request={(params: any) => { return request(params) } }
                    columns={[{ // .... }]
                    searchText="Search"
                    filterDropdownVisible={true}
                    onFilterDropdownVisibleChange={undefined}
                    onFilterChange={handleFilterChange}
                />
            </Modal>
        </>
    );
};

export default App;
```

#### å…³äºè§£å†³æ–¹æ¡ˆçš„è®¨è®º

æˆ‘è®¤ä¸ºæœ€ä½³çš„è§£å†³æ–¹æ¡ˆåº”è¯¥æ˜¯åœ¨ ProTable ä¸­å¢åŠ ä¸€ä¸ª `paginationOnChange` çš„ propsï¼Œå¹¶ä¸”å°†å…¶å¹¿æ³›åº”ç”¨åœ¨ `pagination` ç›¸å…³çš„ç»„ä»¶ä¸­ã€‚è¿™æ ·å¯ä»¥ä¿è¯åœ¨Filterç­‰å˜åŒ–æ—¶åŒæ—¶æ›´æ–°åˆ†é¡µä¿¡æ¯ã€‚
