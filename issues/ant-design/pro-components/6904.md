# ProTableå½“è®¾ç½®preserveSelectedRowKeysä¸ºtrueæ—¶è¯»å–selectedRowså€¼é”™è¯¯ğŸ›[BUG]ğŸ›[BUG]

`AI Reply`

### ğŸ› bug æè¿°

åœ¨ProTableç»„ä»¶ä¸­è®¾ç½®preserveSelectedRowKeysä¸ºtrueï¼Œå¹¶ä¸”è®¾ç½®selectedRowKeysé»˜è®¤é€‰ä¸­å€¼, å¹¶ä¸”è®¾ç½®é»˜è®¤ä¸å¯é€‰ä¸­çš„æ¡ç›®ï¼Œåœ¨onChangeä¸­æ‰“å°selectedRowså€¼æ—¶å‡ºç°undefinedçš„æƒ…å†µã€‚
![image](https://user-images.githubusercontent.com/20655248/230552312-c19a09b6-0f57-4b49-9a7f-a211bec2f578.png)
![image](https://user-images.githubusercontent.com/20655248/230553205-d22f75df-70c0-405d-bae2-4dc3fe79fa57.png)

@ant-design/pro-components":ç‰ˆæœ¬"2.3.58

### Â© ç‰ˆç»„ä»¶ä¸­è®¾ç½®æœ¬ä¿¡æ¯

- ProComponents ç‰ˆæœ¬: [e.g. 4.0.0]
- umi ç‰ˆæœ¬
- æµè§ˆå™¨ç¯å¢ƒ
- å¼€å‘ç¯å¢ƒ [e.g. mac OS]

### ğŸš‘ å…¶ä»–ä¿¡æ¯

<!--
å¦‚æˆªå›¾ç­‰å…¶ä»–ä¿¡æ¯å¯ä»¥è´´åœ¨è¿™é‡Œ
-->

## chenshuai2144

> TAutomatically replying with ChatGPT can be attempted, but it cannot be guaranteed to be completely accurate and may not fully address all issues. Please feel free to reply if you have any further questions or concerns.
> æ­¤å›å¤åŸºäº ChatGPT è‡ªåŠ¨ç”Ÿæˆï¼Œå¯ä»¥å°è¯•ä¸‹æ–¹æ¡ˆï¼Œå®˜æ–¹äººå‘˜ä¼šåœ¨ä¸€å®šæ—¶é—´åç»§ç»­ç»§ç»­å¤„ç†ã€‚

### ğŸŒˆ è§£å†³æ–¹æ¡ˆ

æ ¹æ®ä½ æä¾›çš„æƒ…å†µï¼Œä»æˆªå›¾ä¸Šçœ‹é€‰æ‹©æ¡†ä¸­çš„æ¡ç›®æ˜¯å¯é€‰çš„ï¼Œä½†æ˜¯åœ¨onChangeäº‹ä»¶ä¸­ä¼šå‡ºç°é€‰ä¸­çš„æ¡ç›®ä¸ºundefinedçš„æƒ…å†µã€‚å¯¹äºè¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬éœ€è¦æ³¨æ„ä¸€ä¸‹å‡ ç‚¹ï¼š

1. å¯èƒ½æ˜¯selectedRowKeysæ²¡æœ‰æ­£ç¡®è®¾ç½®

åœ¨ä½ çš„ä»£ç ä¸­ï¼Œä½ æœ‰é€šè¿‡selectedRowKeyså±æ€§å¯¹é€‰ä¸­çš„æ¡ç›®è¿›è¡Œäº†åˆå§‹åŒ–ã€‚ä½†æ˜¯åœ¨onChangeäº‹ä»¶ä¸­ï¼Œå¦‚æœselectedRowKeyså€¼ä¸ºundefinedï¼Œæ˜¾ç„¶é€‰ä¸­çš„æ¡ç›®ä¹Ÿä¼šä¸ºundefinedã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ç¡®è®¤ä¸€ä¸‹selectedRowKeyså±æ€§æœ‰æ²¡æœ‰æ­£ç¡®è®¾ç½®ã€‚å¯ä»¥é€šè¿‡æ‰“å°è¾“å‡ºç¡®è®¤ä¸€ä¸‹ã€‚å¦‚æœselectedRowKeysç¡®å®æ²¡æœ‰æ­£å¸¸è®¾ç½®ï¼Œå¯ä»¥æ ¹æ®éœ€æ±‚è¿›è¡Œä¿®æ”¹ã€‚

2. å¯èƒ½æ˜¯preserveSelectedRowKeysè®¾ç½®ä¸æ­£ç¡®

preserveSelectedRowKeysè®¾ç½®ä¸ºtrueçš„è¯ï¼Œä¼šä¿å­˜è¿™ä¸ªè¡¨æ ¼çš„é€‰ä¸­çŠ¶æ€ã€‚å¦‚æœä½ å¸Œæœ›è®¾ç½®åªèƒ½é€‰ä¸­æŸäº›æ¡ç›®ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®disabledå±æ€§è®©æŸäº›æ¡ç›®ä¸å¯é€‰ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äºpreserveSelectedRowKeysçš„å­˜åœ¨ï¼Œå½“ä½ å…¨éƒ¨çš„æ¡ç›®éƒ½è®¾ç½®äº†disabledæ—¶ï¼ŒonChangeäº‹ä»¶ä¸­æ‰“å°çš„selectedRowså€¼ä¼šä¸ºundefinedã€‚å› æ­¤ï¼Œåˆç†è®¾ç½®disabledå±æ€§ä¼šæœ‰åŠ©äºè§£å†³è¿™ä¸ªé—®é¢˜ã€‚

3. å¯èƒ½æ˜¯selectedRowsäº‹ä»¶æ²¡æœ‰å¤„ç†

åœ¨ProTableç»„ä»¶ä¸­ï¼ŒselectedRowsäº‹ä»¶ä¸€èˆ¬æ˜¯åœ¨onChangeäº‹ä»¶ä¸­è°ƒç”¨çš„ã€‚å¦‚æœä½ æ²¡æœ‰å¯¹selectedRowsäº‹ä»¶è¿›è¡Œå¤„ç†ï¼Œæˆ–è€…å¤„ç†ä¸æ­£ç¡®ï¼Œé‚£ä¹ˆåœ¨onChangeäº‹ä»¶ä¸­æ‰“å°å‡ºæ¥çš„selectedRowså€¼å¾ˆå¯èƒ½ä¸ºundefinedã€‚

å¦‚æœä»¥ä¸Šæ­¥éª¤éƒ½æ²¡æœ‰è§£å†³é—®é¢˜ï¼Œå¯ä»¥å°è¯•æ£€æŸ¥ä¸€ä¸‹å…¶ä»–çš„ä»£ç ã€‚

### ğŸ“– å‚è€ƒæ–‡æ¡£

- [ProTable API æ–‡æ¡£](https://procomponents.ant.design/components/table-cn/)
- [Antd é€‰é¡¹ API æ–‡æ¡£](https://ant.design/components/select-cn/#API)
- [Antd Table API æ–‡æ¡£](https://ant.design/components/table-cn/#API)

  ## chenshuai2144

  å¦‚æœåœ¨ä½¿ç”¨ `ProTable` ç»„ä»¶æ—¶ï¼Œè®¾ç½®äº† `preserveSelectedRowKeys` ä¸º `true`ï¼Œå¹¶ä¸”é€šè¿‡ `selectedRowKeys` å±æ€§è®¾ç½®äº†é»˜è®¤é€‰ä¸­çš„è¡Œï¼Œä½†åœ¨ `onChange` äº‹ä»¶ä¸­æ‰“å° `selectedRows` æ—¶å‡ºç° `undefined` çš„æƒ…å†µï¼Œå¯èƒ½æ˜¯ç”±äºé…ç½®é—®é¢˜å¯¼è‡´çš„ã€‚

ä¸€ç§å¯èƒ½çš„è§£å†³æ–¹æ³•æ˜¯ï¼Œç¡®ä¿ `ProTable` ç»„ä»¶çš„ `rowSelection` å±æ€§ä¸ `selectedRowKeys` å’Œ `onChange` äº‹ä»¶æ­£ç¡®é…åˆä½¿ç”¨ã€‚

ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ä»£ç ï¼Œå±•ç¤ºå¦‚ä½•åœ¨ `ProTable` ä¸­è®¾ç½®é€‰ä¸­è¡Œå’Œå¤„ç† `onChange` äº‹ä»¶ï¼š

```jsx
import React, { useState } from "react";
import { ProTable } from "@ant-design/pro-table";

function MyTable() {
  const [selectedRowKeys, setSelectedRowKeys] = useState([]);

  const handleTableChange = (selectedRowKeys, selectedRows) => {
    setSelectedRowKeys(selectedRowKeys);
    console.log(selectedRows);
    // æ‰§è¡Œå…¶ä»–æ“ä½œ...
  };

  return (
    <ProTable
      rowSelection={{
        selectedRowKeys,
        onChange: handleTableChange,
        preserveSelectedRowKeys: true,
      }}
      // å…¶ä»–ProTableç»„ä»¶çš„é…ç½®é¡¹...
    />
  );
}

export default MyTable;
```

åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ `useState` é’©å­åˆ›å»ºäº† `selectedRowKeys` çŠ¶æ€æ¥å­˜å‚¨é€‰ä¸­è¡Œçš„å€¼ã€‚`handleTableChange` å‡½æ•°ç”¨äºå¤„ç† `onChange` äº‹ä»¶ï¼Œå…¶ä¸­æˆ‘ä»¬æ›´æ–°äº† `selectedRowKeys` çŠ¶æ€ï¼Œå¹¶æ‰“å°äº† `selectedRows` å€¼ã€‚è¯·ç¡®ä¿åœ¨ `selectedRowKeys` æ›´æ–°åå†æ‰“å° `selectedRows`ï¼Œä»¥ä¾¿è·å–æœ€æ–°çš„é€‰ä¸­è¡Œæ•°æ®ã€‚

åœ¨ `ProTable` ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† `rowSelection` å±æ€§æ¥é…ç½®è¡Œé€‰æ‹©åŠŸèƒ½ã€‚é€šè¿‡è®¾ç½® `selectedRowKeys` å±æ€§ä¸º `selectedRowKeys` çŠ¶æ€çš„å€¼ï¼Œä»¥åŠè®¾ç½® `onChange` å±æ€§ä¸º `handleTableChange` å‡½æ•°ï¼Œå®ç°äº†å¯¹é€‰ä¸­è¡Œçš„æ§åˆ¶å’Œæ•°æ®çš„æ¥æ”¶ã€‚

è¯·æ ¹æ®æ‚¨çš„å®é™…éœ€æ±‚å’Œç»„ä»¶é…ç½®è¿›è¡Œç›¸åº”çš„è°ƒæ•´ï¼Œç¡®ä¿å±æ€§çš„æ­£ç¡®è®¾ç½®å’Œäº‹ä»¶å¤„ç†çš„é€»è¾‘ã€‚
