# 🧐[问题] ProTable 金额(valueType: "money")需要在搜索栏渲染成一个范围的问题, 和0不被传值的问题

`AI Reply`

### 🧐 问题描述

表格里的金额是一列，但是搜索栏中需要渲染成类似于 dateRange 的那种，输入一个范围的。看了下[所有的valueType](https://procomponents.ant.design/components/schema#valuetype)貌似不支持类似于digitRange的type？

那我目前的一个workaround就是，1个column用于显示在table，2个column用于显示在search栏

### 💻 示例代码

```
        {
            title: "金额",
            dataIndex: "amount",
            valueType: "money",
            sorter: true,
            hideInSearch: true,
        },
        {
            title: "最小金额",
            dataIndex: "minAmount",
            valueType: "money",
            hideInTable: true,
        },
        {
            title: "最大金额",
            dataIndex: "maxAmount",
            valueType: "money",
            hideInTable: true,
        },
```

我的问题是：

1. 有更好的办法吗？我尝试过不用后面2个虚拟列，直接使用renderFormItem渲染两个`<InputNumber />-<InputNumber />`，但是没有对应的valueType可以用导致这么渲染，点击查询是拿不到值的
2. input的类型是money或者digit的时候，用户在输入框里输入0，是不会被取到值的（我看请求，如果填0或者不填，都不会传这个字段的值）。怎么样才能当输入的是0的时候，也能得到0呢？当然要保留什么都不输入还是什么都不传。

## chenshuai2144

> TAutomatically replying with ChatGPT can be attempted, but it cannot be guaranteed to be completely accurate and may not fully address all issues. Please feel free to reply if you have any further questions or concerns.
> 此回复基于 ChatGPT 自动生成，可以尝试下方案，官方人员会在一定时间后继续继续处理。

### 🌈 解决方案

1. 您可以使用 `ProForm` 带有 `RangePicker[money]` 来解决该问题，实现代码和渲染效果如下。

```tsx
import { ProForm, ProFormDatePicker, ProFormText } from '@ant-design/pro-form';

...

<ProForm onFinish={onFinish}>
  <ProForm.Group>
    <ProFormDatePicker.MoneyRangePicker name="amount" />
    <ProFormText name="otherField" />
  </ProForm.Group>
</ProForm>
```

![image](https://user-images.githubusercontent.com/28954298/125194098-ef3c2d80-e28a-11eb-965b-fa98fbf16b43.png)

2. `ProTable` 中的 `valueType` 可以通过自定义 `renderFormItem` 来实现范围检索，本例中 `valueType` 为 `text`，详见以下代码。

```tsx
const columns = [
  {
    title: '金额',
    dataIndex: 'amount',
    valueType: 'text',
    renderFormItem: (_, { value, onChange }) => (
      <Input.Group compact>
        <InputNumber
          value={value ? value[0] : undefined}
          onChange={(val) => onChange([val, value[1]])}
          style={{ width: '45%' }}
          min={0}
        />
        <Input
          style={{
            width: '10%',
            borderLeft: 0,
            pointerEvents: 'none',
            backgroundColor: '#fff',
          }}
          placeholder="~"
          disabled
        />
        <InputNumber
          value={value ? value[1] : undefined}
          onChange={(val) => onChange([value[0], val])}
          style={{ width: '45%', borderLeft: 0 }}
          min={0}
        />
      </Input.Group>
    ),
    render: (dom, entity) => formatMoney(entity.amount),
  },
  ...
];

<ProTable
  columns={columns}
  request={async () => {
    // ...
  }}
  search={{
    allowClear: true,
  }}
/>;
```

![image](https://user-images.githubusercontent.com/28954298/125194247-ddd90280-e28b-11eb-8ec8-e879a01a29c7.png)

3. 如果您坚持使用 `RangePicker[digit]`，可以对用户输入的数字 `0` 进行拦截，加上 `0.` (坑：0.、0.0、0.00 等都不能识别为 `0`)。
   实现代码如下。

```tsx
import { InputNumber } from 'antd';
import React, { useState } from 'react';

...

const handleInput = (val: string) => {
  if (val === '0') {
    // 如果用户输入的是0，强行加上小数点，变成0.
    setStrValue('0.');
  } else {
    setStrValue(val);
  }
};

<InputNumber
  min={0}
  formatter={(value) =>
    value ? formatMoney(parseFloat(value.toFixed(2)), currencies[0]) : ''
  }
  parser={(inputValue) =>
    parseFloat(inputValue ? inputValue.replace(/¥|,/g, '') : 0)
  }
  maxLength={15}
  style={{ width: '100%' }}
  value={strValue}
  onChange={(val) => setValue(val)}
  onBlur={(e) => handleInput(e.target.value)}
/>
```

### 📚 相关文档

- [ProComponents RangePicker](https://procomponents.ant.design/components/range-picker)
- [ProComponents 自定义 filter](https://procomponents.ant.design/components/table#%E7%AD%9B%E9%80%89-filter)

  ## textnumber085

  这AI是怎么打出`坑`的哈哈哈哈

> (坑：0.、0.0、0.00 等都不能识别为 0)。

## textnumber085

方法二，渲染出2个input是可以的，但是点击查询按纽后，并没有在request中看到有这个参数带着

## chenshuai2144

> TAutomatically replying with ChatGPT can be attempted, but it cannot be guaranteed to be completely accurate and may not fully address all issues. Please feel free to reply if you have any further questions or concerns.
> 此回复基于 ChatGPT 自动生成，可以尝试下方案，官方人员会在一定时间后继续继续处理。

检查一下代码，观察是否已经将查询表单的参数传递给了 ProTable 的 request 中的参数。

一般来说，在 ProTable 中，需要将 search 中的搜索参数传入 querystring 或者是放到表单数据中再发送请求。另外查询参数发生变化时，请求也要跟着变化，是在 childRef 里面执行的，在 ProTable 的 onSearch 事件中需要拿到你的 childRef，然后 forceUpdate 一下。

参考一下该示例代码：

```tsx
import React, { useRef } from "react";
import { Button, Input } from "antd";
import ProTable from "@ant-design/pro-table";

const { Search } = Input;

const columns = [
  {
    title: "id",
    dataIndex: "id",
  },
  {
    title: "title",
    dataIndex: "title",
  },
];

export default () => {
  const childRef = useRef(null);

  return (
    <div>
      <ProTable
        columns={columns}
        request={(params) => {
          console.log(params);
          return Promise.resolve({ data: [], success: true });
        }}
        rowKey="id"
        search={{
          collapsed: false,
          optionRender: ({ searchText, resetText }, { form }) => (
            <>
              <Search
                placeholder="请输入标题"
                value={form.getFieldValue("title")}
                onChange={(event) =>
                  form.setFieldsValue({ title: event.target.value })
                }
                onSearch={() => childRef.current.reload()}
                style={{ width: 200 }}
              />
              <Button onClick={() => console.log(form.getFieldsValue())}>
                搜索
              </Button>
            </>
          ),
        }}
        dateFormatter="string"
        headerTitle="高级表格"
        toolBarRender={() => [
          <Button onClick={() => console.log(childRef.current.getDataSource())}>
            打印表格数据
          </Button>,
        ]}
        tableAlertRender={({ selectedRowKeys }) => (
          <div>
            已选择 <a style={{ fontWeight: 600 }}>{selectedRowKeys.length}</a>{" "}
            项&nbsp;&nbsp;
            <span>
              服务调用次数总计 {""}
              <span style={{ fontWeight: 600 }}>0</span> 次
            </span>
          </div>
        )}
        request={(params) => {
          console.log(params);
          return Promise.resolve({
            data: [
              {
                id: "1",
                title: "这是一条测试数据",
                status: "normal",
                created_at: 1613202087000,
                progress: 0,
              },
              {
                id: "2",
                title: "这是二条测试数据",
                status: "exception",
                created_at: 1613202087000,
                progress: 0,
              },
              {
                id: "3",
                title: "这是三条测试数据",
                status: "active",
                created_at: 1613202087000,
                progress: 0,
              },
            ],
            success: true,
            total: 3,
          });
        }}
        pagination={{
          showQuickJumper: true,
        }}
        actionRef={childRef}
      />
    </div>
  );
};
```

- demo 在表单组件 `Search` 加点击搜索后的查询按钮，将数据传到了 `ProTable`
- 使用 `actionRef` 获取 `childRef.current.getDataSource()`，打印当前表格的数据
- 检查一下 `request` 函数接收到的参数，根据传入的参数返回数据

另外，要注意数据格式和字段名是否和 `params` 对象一致，或者在使用 `API` 时发送 `post` 请求时，参数格式是否正确。

如果已经按照以上方法实现，但还是出现了查询不到数据的情况，请再次检查一下代码，是否有其他影响请求参数的代码逻辑。如果问题还未解决，请贴上你的完整代码，我们将会一起来解决。

## textnumber085

这... AI不太智能的样子

## lili574

试试valueType: 'digitRange'
@textnumber085

## chenshuai2144

楼上正解，用 digitRange 吧，money 没支持 range
