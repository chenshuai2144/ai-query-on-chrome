# ğŸ›[BUG]BetaSchemaFormçš„formRefè·å–çš„ProFormInstanceæ²¡æœ‰proformæ‰©å±•çš„æ–¹æ³• ï¼ŒformRef.currentå¯¹è±¡ä¸­æ²¡æœ‰getFieldsFormatValueæ–¹æ³•

æé—®å‰å…ˆçœ‹çœ‹ï¼š

https://github.com/ryanhanwu/How-To-Ask-Questions-The-Smart-Way/blob/main/README-zh_CN.md

### ğŸ› bug æè¿°

åŸæœ¬ç”¨çš„proForm1.7.xæ— æ­¤é—®é¢˜ï¼Œç”±äºvalueType = group æŠ˜å çŠ¶æ€ä¸‹ç»„ä»¶é”€æ¯è·å–ä¸åˆ°å€¼ï¼Œå‡çº§åˆ°2.10.1æ‰å‡ºç°çš„æ­¤é—®é¢˜

<!--
è¯¦ç»†åœ°æè¿° bugï¼Œè®©å¤§å®¶éƒ½èƒ½ç†è§£
-->

### ğŸ“· å¤ç°æ­¥éª¤

<!--
æ¸…æ™°æè¿°å¤ç°æ­¥éª¤ï¼Œè®©åˆ«äººä¹Ÿèƒ½çœ‹åˆ°é—®é¢˜ï¼Œå¦‚æœå¯èƒ½ï¼Œå°½é‡æä¾›å¯æ‰§è¡Œä»£ç ï¼Œ
å¦‚ï¼šhttps://codesandbox.io/ åœ¨æ­¤å¤„åˆ›å»ºä¸€ä¸ª codesandboxï¼Œæ–¹ä¾¿æˆ‘ä»¬æ›´å¿«çš„æ’æŸ¥å’Œå¤ç°é—®é¢˜
-->

### ğŸ æœŸæœ›ç»“æœ

<!--
æè¿°ä½ åŸæœ¬æœŸæœ›çœ‹åˆ°çš„ç»“æœ
-->

### ğŸ’» å¤ç°ä»£ç 

import { BetaSchemaForm } from '@ant-design/pro-form';
import { Input } from 'antd';
import React, { useRef } from 'react'

const valueEnum = {
all: { text: 'å…¨éƒ¨', status: 'Default' },
open: {
text: 'æœªè§£å†³',
status: 'Error',
},
closed: {
text: 'å·²è§£å†³',
status: 'Success',
disabled: true,
},
processing: {
text: 'è§£å†³ä¸­',
status: 'Processing',
},
};

const columns = [
{
title: "æŠ˜å çˆ¶çº§",
valueType: "group",

        fieldProps: {
            collapsible: true,
        },

        columns: [
            {
                title: 'æ ‡é¢˜',
                dataIndex: 'title',
                initialValue: 'å¿…å¡«',
                colProps: {
                    span: 24

                },
                formItemProps: {
                    rules: [
                        {
                            required: true,
                            message: 'æ­¤é¡¹ä¸ºå¿…å¡«é¡¹',
                        },
                    ],
                },
            },
            {
                title: 'çŠ¶æ€',
                dataIndex: 'state',
                valueType: 'select',
                valueEnum,
                tooltip: 'å½“titleä¸ºdisabledæ—¶çŠ¶æ€æ— æ³•é€‰æ‹©',
                dependencies: ['title'],
                fieldProps: (form) => {
                    if (form.getFieldValue('title') === 'disabled') {
                        return {
                            disabled: true,
                            placeholder: 'disabled',
                        };
                    } else {
                        return {
                            placeholder: 'normal',
                        };
                    }
                },
            },
            {
                title: 'æ ‡ç­¾',
                dataIndex: 'labels',
                tooltip: 'å½“titleä¸ºå¿…å¡«æ—¶æ­¤é¡¹å°†ä¸ºå¿…å¡«',
                dependencies: ['title'],
                formItemProps(form) {
                    if (form.getFieldValue('title') === 'å¿…å¡«') {
                        return {
                            rules: [
                                {
                                    required: true,
                                },
                            ],
                        };
                    } else {
                        return {};
                    }
                },
            },
            {
                valueType: 'dependency',
                name: ['title'],
                columns: ({ title }) => {
                    return title !== 'hidden'
                        ? [
                            {
                                title: 'titleä¸ºhiddenæ—¶éšè—',
                                dataIndex: 'hidden',
                                valueType: 'date',
                                renderFormItem: () => {
                                    return <Input />;
                                },
                            },
                        ]
                        : [];
                },
            }
        ]
    },

    {
        title: 'åˆ›å»ºæ—¶é—´',
        key: 'showTime',
        dataIndex: 'createName',
        valueType: 'date',
    }

];

export default () => {

    const formRef = useRef()
    return <div style={{
        margin: "20px 300px"
    }}>
        <BetaSchemaForm
            formRef={formRef}
            shouldUpdate={false}
            layoutType="Form"
            onFinish={async (values) => {

//æ­¤æ—¶formRef.currentå¯¹è±¡ä¸­æ²¡æœ‰getFieldsFormatValueæ–¹æ³•
console.log(formRef)

            }}
            columns={columns}
        />
    </div>

};

<!--
æä¾›å¯å¤ç°çš„ä»£ç ï¼Œä»“åº“ï¼Œæˆ–çº¿ä¸Šç¤ºä¾‹
-->

### Â© ç‰ˆæœ¬ä¿¡æ¯

"@ant-design/pro-form": "^2.10.1",

- ProComponents ç‰ˆæœ¬: [e.g. 4.0.0]
- umi ç‰ˆæœ¬
- æµè§ˆå™¨ç¯å¢ƒ
- å¼€å‘ç¯å¢ƒ [e.g. mac OS]

### ğŸš‘ å…¶ä»–ä¿¡æ¯

<!--
å¦‚æˆªå›¾ç­‰å…¶ä»–ä¿¡æ¯å¯ä»¥è´´åœ¨è¿™é‡Œ
-->

![image](https://user-images.githubusercontent.com/26292353/231758578-e6fea6b1-cc15-469a-a160-3a7d4d83e361.png)

## ldwonday

BetaSchemaFormçš„formRefæœ‰bug

## ty01

/_
ä¸ºäº†è§£å†³BetaSchemaFormè·å–çš„å®ä¾‹æ²¡æœ‰proformçš„æ‰©å±•ä¿¡æ¯ï¼Œå¿…é¡»æ‰‹åŠ¨æ›´æ–°ä¸‹æ‰èƒ½è·å–åˆ°
_/
const [_count, _setCount] = useState(0)
useEffect(() => {
if (!formRef.current || !formRef.current.getFieldsFormatValue) {
setTimeout(() => {
\_setCount(v => v + 1)
}, 100)
}
}, [_count])

ä¸´æ—¶è§£å†³æ­¤é—®é¢˜ï¼Œç­‰å¾…å®˜æ–¹å›ç­”

## ldwonday

@ty01 è¯•è¯•æŒ‰ç…§æˆ‘æçš„pré‡Œçš„ä»£ç ä¿®æ”¹ä¸‹ä½ node_modulesé‡Œçš„SchemaFormé‡Œçš„ä»£ç ï¼Œç„¶åçœ‹çœ‹æ˜¯å¦è§£å†³äº†ä½ çš„é—®é¢˜
