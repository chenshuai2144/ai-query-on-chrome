# ğŸ›[BUG]StepsForm.StepFormä¸èƒ½æ‹†åˆ†ç»„ä»¶

`form`,`ğŸ–ï¸  featrue`,`AI Reply`

æé—®å‰å…ˆçœ‹çœ‹ï¼š

https://github.com/ryanhanwu/How-To-Ask-Questions-The-Smart-Way/blob/main/README-zh_CN.md

### ğŸ› bug æè¿°

æ¯ä¸€æ­¥éª¤éœ€è¦å¡«å†™çš„èµ„æ–™æ¯”è¾ƒå¤šï¼Œæ”¾åœ¨åŒä¸€ä¸ªæ–‡ä»¶é‡Œä¼šå¯¼è‡´æ–‡ä»¶è¿‡å¤§ï¼Œä¸æ–¹ä¾¿ç»´æŠ¤ï¼Œåœ¨æ‹†åˆ†çš„æ—¶å€™ï¼Œåªæœ‰ç¬¬ä¸€æ­¥å¯ä»¥æäº¤ï¼Œåé¢ä¼šå‡ºç°caught TypeError: Cannot read properties of undefined (reading 'current')çš„é”™è¯¯

### ğŸ“· å¤ç°æ­¥éª¤

`// index.tsx
 <StepsForm>
          <A />
          <B />
        </StepsForm>`
`// A.tsx
<StepsForm.StepForm
        name="a"
        onFinish={async () => {
          return true;
        }}
      >
        <ProFormText name="aa" />
      </StepsForm.StepForm>`
`// B.tsx
<StepsForm.StepForm
        name="b"
        onFinish={async () => {
          return true;
        }}
      >
        <ProFormText name="bb" />
      </StepsForm.StepForm>`

### ğŸ æœŸæœ›ç»“æœ

formå¯ä»¥æäº¤

### Â© ç‰ˆæœ¬ä¿¡æ¯

- ProComponents ç‰ˆæœ¬: 2.4.4
- umi ç‰ˆæœ¬ @umijs/max 4.0.33
- æµè§ˆå™¨ç¯å¢ƒ è°·æ­Œæµè§ˆå™¨
- å¼€å‘ç¯å¢ƒ mac OS

## chenshuai2144

> TAutomatically replying with ChatGPT can be attempted, but it cannot be guaranteed to be completely accurate and may not fully address all issues. Please feel free to reply if you have any further questions or concerns.
> æ­¤å›å¤åŸºäº ChatGPT è‡ªåŠ¨ç”Ÿæˆï¼Œå¯ä»¥å°è¯•ä¸‹æ–¹æ¡ˆï¼Œå®˜æ–¹äººå‘˜ä¼šåœ¨ä¸€å®šæ—¶é—´åç»§ç»­ç»§ç»­å¤„ç†ã€‚

è¿™ä¸ªé—®é¢˜çœ‹èµ·æ¥æ˜¯å› ä¸ºæ‹†åˆ†ç»„ä»¶åæœ‰å¤šä¸ªStepsForm.StepFormï¼Œè€Œå½“ç¬¬äºŒä¸ªStepsForm.StepFormæ¸²æŸ“æ—¶ï¼Œå®ƒçš„refè¿˜æ²¡æœ‰è¢«å­˜å‚¨åˆ°StepsFormç»„ä»¶å†…éƒ¨çš„formRefså±æ€§ä¸­ã€‚

å¯ä»¥å°è¯•åœ¨StepsFormç»„ä»¶å†…éƒ¨æ·»åŠ ä¸€ä¸ªformRefså±æ€§æ¥å­˜å‚¨å­ç»„ä»¶çš„refï¼Œå¹¶åœ¨æ¯ä¸ªStepsForm.StepFormç»„ä»¶ä¸­è°ƒç”¨Propsçš„onFormReadyæ–¹æ³•æ¥å°†refå­˜å‚¨åˆ°StepsFormç»„ä»¶å†…éƒ¨çš„formRefså±æ€§ä¸­ã€‚

å…·ä½“ä»£ç å¦‚ä¸‹ï¼š

```jsx
import React, { Component } from "react";
import { Steps, Button, message } from "antd";
import { StepsForm } from "@ant-design/pro-form";
import ProForm, { ProFormText } from "@ant-design/pro-form";

const { Step } = Steps;

class MyStepForm extends Component {
  formRef = React.createRef();

  handleFormReady = (formValue) => {
    const { name, children } = this.props;
    const { formRefs } = this.props;

    formRefs[name] = this.formRef.current;

    const fn = this.props.onFormReady;

    if (fn) {
      fn({
        [name]: formValue || {},
        children,
        name: this.props.name,
      });
    }
  };

  render() {
    const { children } = this.props;

    return (
      <div ref={this.formRef}>
        <ProForm onFinish={async () => true} onReady={this.handleFormReady}>
          {children}
        </ProForm>
      </div>
    );
  }
}

class MyStepsForm extends Component {
  formRefs = {};

  handleSubmit = async () => {
    const { onFinish } = this.props;

    let values = [];
    let error = false;

    for (let i = 0; i < React.Children.count(this.props.children); i++) {
      const child = React.Children.toArray(this.props.children)[i];

      if (this.formRefs[child.props.name]) {
        const formValue =
          await this.formRefs[child.props.name].validateFields();

        if (!error) {
          values.push(formValue);
        }

        if (!(await this.formRefs[child.props.name].submit())) {
          error = true;
          message.error("é”™è¯¯çº¢æ¡†æç¤º");
        }
      }
    }

    if (!error) {
      onFinish(values);
    }
  };

  render() {
    let currStep = 0;

    return (
      <div>
        <Steps>
          {React.Children.map(this.props.children, (child, i) => {
            currStep++;
            return (
              <Step
                title={`æ­¥éª¤${currStep}`}
                key={`step-${child.props.name}`}
              />
            );
          })}
        </Steps>
        {React.Children.map(this.props.children, (child, i) => {
          return (
            <div key={child.props.name}>
              {React.cloneElement(child, {
                onFormReady: this.handleFormReady,
                formRefs: this.formRefs,
              })}
            </div>
          );
        })}
        <Button type="primary" onClick={this.handleSubmit}>
          æäº¤
        </Button>
      </div>
    );
  }
}

MyStepsForm.StepForm = MyStepForm;

export default MyStepsForm;
```

ä½¿ç”¨ä¸Šè¿°ä»£ç ï¼Œéœ€è¦å°†æ—§çš„StepsFormå’ŒStepsForm.StepFormæ›¿æ¢ä¸ºMyStepsFormå’ŒMyStepsForm.StepFormã€‚

ä½¿ç”¨æ–¹å¼å’Œä¹‹å‰çš„æ–¹æ³•ç›¸åŒï¼Œåªæ˜¯å¤šäº†ä¸€ä¸ªå½¢å‚:

```jsx
<MyStepsForm onFinish={this.handleSubmit}>
  <MyStepsForm.StepForm name="a">
    <ProFormText name="aa" />
  </MyStepsForm.StepForm>
  <MyStepsForm.StepForm name="b">
    <ProFormText name="bb" />
  </MyStepsForm.StepForm>
</MyStepsForm>
```

## 95zz

> > TAutomatically replying with ChatGPT can be attempted, but it cannot be guaranteed to be completely accurate and may not fully address all issues. Please feel free to reply if you have any further questions or concerns.
> > æ­¤å›å¤åŸºäº ChatGPT è‡ªåŠ¨ç”Ÿæˆï¼Œå¯ä»¥å°è¯•ä¸‹æ–¹æ¡ˆï¼Œå®˜æ–¹äººå‘˜ä¼šåœ¨ä¸€å®šæ—¶é—´åç»§ç»­ç»§ç»­å¤„ç†ã€‚
>
> è¿™ä¸ªé—®é¢˜çœ‹èµ·æ¥æ˜¯å› ä¸ºæ‹†åˆ†ç»„ä»¶åæœ‰å¤šä¸ªStepsForm.StepFormï¼Œè€Œå½“ç¬¬äºŒä¸ªStepsForm.StepFormæ¸²æŸ“æ—¶ï¼Œå®ƒçš„refè¿˜æ²¡æœ‰è¢«å­˜å‚¨åˆ°StepsFormç»„ä»¶å†…éƒ¨çš„formRefså±æ€§ä¸­ã€‚
>
> å¯ä»¥å°è¯•åœ¨StepsFormç»„ä»¶å†…éƒ¨æ·»åŠ ä¸€ä¸ªformRefså±æ€§æ¥å­˜å‚¨å­ç»„ä»¶çš„refï¼Œå¹¶åœ¨æ¯ä¸ªStepsForm.StepFormç»„ä»¶ä¸­è°ƒç”¨Propsçš„onFormReadyæ–¹æ³•æ¥å°†refå­˜å‚¨åˆ°StepsFormç»„ä»¶å†…éƒ¨çš„formRefså±æ€§ä¸­ã€‚
>
> å…·ä½“ä»£ç å¦‚ä¸‹ï¼š
>
> ```js
> import React, { Component } from "react";
> import { Steps, Button, message } from "antd";
> import { StepsForm } from "@ant-design/pro-form";
> import ProForm, { ProFormText } from "@ant-design/pro-form";
>
> const { Step } = Steps;
>
> class MyStepForm extends Component {
>   formRef = React.createRef();
>
>   handleFormReady = (formValue) => {
>     const { name, children } = this.props;
>     const { formRefs } = this.props;
>
>     formRefs[name] = this.formRef.current;
>
>     const fn = this.props.onFormReady;
>
>     if (fn) {
>       fn({
>         [name]: formValue || {},
>         children,
>         name: this.props.name,
>       });
>     }
>   };
>
>   render() {
>     const { children } = this.props;
>
>     return (
>       <div ref={this.formRef}>
>         <ProForm onFinish={async () => true} onReady={this.handleFormReady}>
>           {children}
>         </ProForm>
>       </div>
>     );
>   }
> }
>
> class MyStepsForm extends Component {
>   formRefs = {};
>
>   handleSubmit = async () => {
>     const { onFinish } = this.props;
>
>     let values = [];
>     let error = false;
>
>     for (let i = 0; i < React.Children.count(this.props.children); i++) {
>       const child = React.Children.toArray(this.props.children)[i];
>
>       if (this.formRefs[child.props.name]) {
>         const formValue =
>           await this.formRefs[child.props.name].validateFields();
>
>         if (!error) {
>           values.push(formValue);
>         }
>
>         if (!(await this.formRefs[child.props.name].submit())) {
>           error = true;
>           message.error("é”™è¯¯çº¢æ¡†æç¤º");
>         }
>       }
>     }
>
>     if (!error) {
>       onFinish(values);
>     }
>   };
>
>   render() {
>     let currStep = 0;
>
>     return (
>       <div>
>         <Steps>
>           {React.Children.map(this.props.children, (child, i) => {
>             currStep++;
>             return (
>               <Step
>                 title={`æ­¥éª¤${currStep}`}
>                 key={`step-${child.props.name}`}
>               />
>             );
>           })}
>         </Steps>
>         {React.Children.map(this.props.children, (child, i) => {
>           return (
>             <div key={child.props.name}>
>               {React.cloneElement(child, {
>                 onFormReady: this.handleFormReady,
>                 formRefs: this.formRefs,
>               })}
>             </div>
>           );
>         })}
>         <Button type="primary" onClick={this.handleSubmit}>
>           æäº¤
>         </Button>
>       </div>
>     );
>   }
> }
>
> MyStepsForm.StepForm = MyStepForm;
>
> export default MyStepsForm;
> ```
>
> ä½¿ç”¨ä¸Šè¿°ä»£ç ï¼Œéœ€è¦å°†æ—§çš„StepsFormå’ŒStepsForm.StepFormæ›¿æ¢ä¸ºMyStepsFormå’ŒMyStepsForm.StepFormã€‚
>
> ä½¿ç”¨æ–¹å¼å’Œä¹‹å‰çš„æ–¹æ³•ç›¸åŒï¼Œåªæ˜¯å¤šäº†ä¸€ä¸ªå½¢å‚:
>
> ```js
> <MyStepsForm onFinish={this.handleSubmit}>
>   <MyStepsForm.StepForm name="a">
>     <ProFormText name="aa" />
>   </MyStepsForm.StepForm>
>   <MyStepsForm.StepForm name="b">
>     <ProFormText name="bb" />
>   </MyStepsForm.StepForm>
> </MyStepsForm>
> ```

1. é¡µé¢ä¼šå¤šå‡ºæ¥ ã€æäº¤ã€‘ã€é‡ç½®ã€‘ï¼Œè¯·é—®æ˜¯æ€ä¹ˆè§£å†³
2. Step1ä¸Step2å†…å®¹éƒ½æ˜¾ç¤ºåœ¨äº†åŒä¸€é¡µé¢ä¸Šäº†

## wyhooo

+1ã€‚ç°åœ¨ä¸€ä¸ªæ–‡ä»¶å †äº† 500+ è¡Œã€‚ã€‚ã€‚

## ChinaMrAlvin

const formInstance = Form.useFormInstance()ï¼›å¯ä»¥æ‹¿åˆ°formå®ä¾‹
