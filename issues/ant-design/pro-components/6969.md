# ğŸ›[BUG] ProTable ä¸­ ç¼–è¾‘è¡¨æ ¼ çš„ valueEnum æ•°æ®æ¸²æŸ“é—®é¢˜

`AI Reply`

æé—®å‰å…ˆçœ‹çœ‹ï¼š

https://github.com/ryanhanwu/How-To-Ask-Questions-The-Smart-Way/blob/main/README-zh_CN.md

### ğŸ› bug æè¿°

åœ¨ProTableè¡¨æ ¼ä¸­åŸæœ¬æœªç¼–è¾‘â€ç”¨æˆ·è§’è‰²â€œçš„æ•°æ®æ¸²æŸ“ä¸ºâ€ç®¡ç†å‘˜â€œï¼Œç‚¹å‡»ç¼–è¾‘åè¾“å…¥æ¡†çš„æ˜¾ç¤ºåˆå§‹å€¼å´ä¸º1ã€‚å…¶ä¸­â€ç”¨æˆ·è§’è‰²â€åœ¨æ•°æ®ä¼ é€’è¿‡ç¨‹ç”¨æ•°å€¼ç±»å‹çš„0ä¸1æ¥è¡¨ç¤ºã€‚

<!--
è¯¦ç»†åœ°æè¿° bugï¼Œè®©å¤§å®¶éƒ½èƒ½ç†è§£
-->

### ğŸ“· å¤ç°æ­¥éª¤

åœ¨è¡¨æ ¼ä¸­ç”¨ valueEnum æ¥æ¸²æŸ“ æ•°å€¼ç±»å‹ 0 å’Œ 1 è¡¨ç¤º çš„ â€œæ™®é€šç”¨æˆ·â€ å’Œ â€œç®¡ç†å‘˜â€ çš„æ–‡æœ¬ï¼Œç‚¹å‡»ç¼–è¾‘åä¼šå‡ºç°è¾“å…¥æ¡†åˆå§‹å€¼æ¸²æŸ“ä¸æ­£ç¡®ã€‚åœ¨è¿™ä¹‹åï¼Œæˆ‘ç”¨æŠ“åŒ…å·¥å…·å°†ä¸‹é¢çš„JSONæ•°æ®ä¸­userRole: 1 æ‹¦æˆªå¹¶æ›´æ”¹ä¸º userRole: "1", ç‚¹å‡»ç¼–è¾‘åè¾“å…¥æ¡†åˆå§‹å€¼æ­£å¸¸æ¸²æŸ“ã€‚

ä¸‹é¢æ˜¯æˆ‘çš„è¡¨æ ¼é¡µé¢ä»£ç å’Œè¡¨æ ¼æ•°æ®ä¼ é€’çš„JSONæ•°æ®ï¼š

`declare namespace API {
  type CurrentUser = {
    id: string,
    username: string,
    userAccount: string,
    avatarUrl?: string,
    gender: number,
    phone: string,
    email: string,
    userStatus:number,
    userRole: number,
    planetCode: string,
    createTime: Date,
    updateTime: Date,
    }
}`

`import type {ActionType, ProColumns} from '@ant-design/pro-components';
import { ProTable, TableDropdown } from '@ant-design/pro-components';
import { useRef } from 'react';
import {modify, remove, searchUsers} from "@/services/ant-design-pro/api";
import {Image, message} from "antd";
export const waitTimePromise = async (time: number = 100) => {
return new Promise((resolve) => {
setTimeout(() => {
resolve(true);
}, time);
});
};

export const waitTime = async (time: number = 100) => {
await waitTimePromise(time);
};

const columns: ProColumns<API.CurrentUser>[] = [
{
dataIndex: 'index',
valueType: 'indexBorder',
width: 48,
},
{
title: 'ç”¨æˆ·å',
dataIndex: 'username',
copyable: true,
},
{
title: 'ç”¨æˆ·è´¦æˆ·',
dataIndex: 'userAccount',
copyable: true,
},
{
title: 'æ€§åˆ«',
dataIndex: 'gender',
valueEnum: {
0: {text: "ç”·"},
1: {text: "å¥³"}
},
},
{
title: 'æ‰‹æœºå·',
dataIndex: 'phone',
copyable: true,
},
{
title: 'é‚®ç®±',
dataIndex: 'email',
copyable: true,
},
{
title: 'çŠ¶æ€',
dataIndex: 'userStatus',
valueEnum: {
0: {text: "æ­£å¸¸", status: "Success"},
1: {text: "å°å·", status: "Error"}
},
valueType: "text"
},
{
title: 'æ˜Ÿçƒç¼–å·',
dataIndex: 'planetCode',
},
{
disable: true,
filters: true,
onFilter: true,
ellipsis: true,
title: 'ç”¨æˆ·è§’è‰²',
dataIndex: 'userRole',
valueType: "select",
valueEnum: {
0: {text: "æ™®é€šç”¨æˆ·", status: "Default"},
1: {text: "ç®¡ç†å‘˜", status: "Success"}
},
},
{
title: 'åˆ›å»ºæ—¶é—´',
dataIndex: 'createTime',
valueType: "dateTime"
},
{
title: 'æ“ä½œ',
valueType: 'option',
key: 'option',
render: (text, record, \_, action) => [
<a
key="editable"
onClick={() => {
action?.startEditable?.(record.id);
}} >
ç¼–è¾‘
</a>,
<a href={record.url} target="_blank" rel="noopener noreferrer" key="view">
æŸ¥çœ‹
</a>,
<TableDropdown
key="actionGroup"
onSelect={() => action?.reload()}
menus={[
{ key: 'delete', name: 'åˆ é™¤',onClick: async (info) => {
await remove(record.id).then(function (result) {
if (result) {
message.success("åˆ é™¤æˆåŠŸ")
}
})
} },
]}
/>,
],
},
];
export default () => {
const actionRef = useRef<ActionType>();
return (
<ProTable<API.CurrentUser>
columns={columns}
actionRef={actionRef}
cardBordered
request={async (params = {}, sort, filter) => {
console.log(sort, filter);
await waitTime(500);
const userList = await searchUsers()
return {
data: userList
}
}}
editable={{
type: 'multiple',
onSave: async (key,user) => {
await modify(user).then((result) => {

            if (result) {
              message.success("ä¿å­˜æˆåŠŸ")
            }
          })
        },
        onChange: () => {

        }
      }}
      columnsState={{
        persistenceKey: 'pro-table-singe-demos',
        persistenceType: 'localStorage',
        onChange(value) {
          console.log('value: ', value);
        },
      }}
      rowKey="id"
      search={{
        labelWidth: 'auto',
      }}
      options={{
        setting: {
          listsHeight: 400,
        },
      }}
      form={{
        // ç”±äºé…ç½®äº† transformï¼Œæäº¤çš„å‚ä¸ä¸å®šä¹‰çš„ä¸åŒè¿™é‡Œéœ€è¦è½¬åŒ–ä¸€ä¸‹
        syncToUrl: (values, type) => {
          if (type === 'get') {
            return {
              ...values,
              created_at: [values.startTime, values.endTime],
            };
          }
          return values;
        },

      }}
      pagination={{
        pageSize: 5,
        onChange: (page) => console.log(page),
      }}
      dateFormatter="string"
      headerTitle="é«˜çº§è¡¨æ ¼"/>

);
};
`

`{
	"code": 0,
	"data": [{
		"id": 1,
		"username": null,
		"userAccount": "admin",
		"userPassword": null,
		"avatarUrl": "https://yupi.icu/logo.png",
		"gender": 0,
		"phone": "",
		"email": "",
		"userStatus": 0,
		"createTime": "2023-04-23T08:09:53.000+00:00",
		"updateTime": "2023-04-23T11:28:03.000+00:00",
		"isDelete": null,
		"userRole": 1,
		"planetCode": "1"
	}],
	"message": "ok",
	"description": ""
}`

<!--
æ¸…æ™°æè¿°å¤ç°æ­¥éª¤ï¼Œè®©åˆ«äººä¹Ÿèƒ½çœ‹åˆ°é—®é¢˜ï¼Œå¦‚æœå¯èƒ½ï¼Œå°½é‡æä¾›å¯æ‰§è¡Œä»£ç ï¼Œ
å¦‚ï¼šhttps://codesandbox.io/ åœ¨æ­¤å¤„åˆ›å»ºä¸€ä¸ª codesandboxï¼Œæ–¹ä¾¿æˆ‘ä»¬æ›´å¿«çš„æ’æŸ¥å’Œå¤ç°é—®é¢˜
-->

### ğŸ æœŸæœ›ç»“æœ

<!--
æè¿°ä½ åŸæœ¬æœŸæœ›çœ‹åˆ°çš„ç»“æœ
-->

### ğŸ’» å¤ç°ä»£ç 

<!--
æä¾›å¯å¤ç°çš„ä»£ç ï¼Œä»“åº“ï¼Œæˆ–çº¿ä¸Šç¤ºä¾‹
-->

### Â© ç‰ˆæœ¬ä¿¡æ¯

- ProComponents ç‰ˆæœ¬: 1.1.1
- umi ç‰ˆæœ¬ 3.5.0
- æµè§ˆå™¨ç¯å¢ƒ Microsoft Edge
- å¼€å‘ç¯å¢ƒ [e.g. mac OS] windows 11

### ğŸš‘ å…¶ä»–ä¿¡æ¯

<!--
å¦‚æˆªå›¾ç­‰å…¶ä»–ä¿¡æ¯å¯ä»¥è´´åœ¨è¿™é‡Œ
-->

## chenshuai2144

> TAutomatically replying with ChatGPT can be attempted, but it cannot be guaranteed to be completely accurate and may not fully address all issues. Please feel free to reply if you have any further questions or concerns.
> æ­¤å›å¤åŸºäº ChatGPT è‡ªåŠ¨ç”Ÿæˆï¼Œå¯ä»¥å°è¯•ä¸‹æ–¹æ¡ˆï¼Œå®˜æ–¹äººå‘˜ä¼šåœ¨ä¸€å®šæ—¶é—´åç»§ç»­ç»§ç»­å¤„ç†ã€‚

æ ¹æ®æè¿°åˆ†æï¼Œå¯èƒ½æ˜¯ ProTable ä¸­ `valueType` ä¸º `select` çš„ `valueEnum` æ•°æ®æ¸²æŸ“çš„é—®é¢˜ï¼Œå»ºè®®æ£€æŸ¥ä»£ç ä¸­æ˜¯å¦æœ‰ä»¥ä¸‹æƒ…å†µï¼š

1. `valueEnum` ä¸­å°† `value` è½¬ä¸ºæ•°å­—ç±»å‹ï¼Œå¯¼è‡´æ¸²æŸ“æ—¶å‡ºç°é—®é¢˜ï¼›
2. `valueType` ä¸º `select` æ—¶ï¼Œåœ¨ç¼–è¾‘æ—¶åªèƒ½æ¥æ”¶å­—ç¬¦ä¸²ç±»å‹çš„å€¼ï¼Œä½†åŸå§‹æ•°æ®ä¸ºæ•°å­—ç±»å‹ã€‚

é’ˆå¯¹ç¬¬ä¸€ç‚¹é—®é¢˜ï¼Œå¯ä»¥å°è¯•å°† `valueEnum` ä¸­çš„å€¼æ”¹ä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼Œå¦‚å°† `0` æ”¹ä¸º `"0"`ã€‚

é’ˆå¯¹ç¬¬äºŒç‚¹é—®é¢˜ï¼Œå¯ä»¥å°è¯•å¯¹ç¼–è¾‘æ—¶çš„æ•°æ®è¿›è¡Œè½¬å‹ï¼Œå°†æ•°å­—ç±»å‹çš„å€¼è½¬ä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```tsx
{
  title: 'ç”¨æˆ·è§’è‰²',
  dataIndex: 'userRole',
  valueType: 'select',
  editable: true,
  renderFormItem: (item, { type, defaultRender, ...rest }, form) => {
    return (
      <Input
        {...rest}
        value={form.getFieldValue(item.dataIndex)?.toString()}
        onChange={(e) => {
          form.setFieldsValue({ [item.dataIndex]: e.target.value });
        }}
      />
    );
  },
  valueEnum: {
    0: { text: 'æ™®é€šç”¨æˆ·', status: 'Default' },
    1: { text: 'ç®¡ç†å‘˜', status: 'Success' },
  },
},
```

æ­¤å¤–ï¼Œå¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼Œäº†è§£å¦‚ä½•æ­£ç¡®ä½¿ç”¨ `valueType` å’Œ `valueEnum` å±æ€§ï¼š

- `valueType`ï¼šhttps://procomponents.ant.design/components/table#valueformat
- `valueEnum`ï¼šhttps://procomponents.ant.design/components/table#valueenum

  ## yinsel

  > > TAutomatically replying with ChatGPT can be attempted, but it cannot be guaranteed to be completely accurate and may not fully address all issues. Please feel free to reply if you have any further questions or concerns.
  > > æ­¤å›å¤åŸºäº ChatGPT è‡ªåŠ¨ç”Ÿæˆï¼Œå¯ä»¥å°è¯•ä¸‹æ–¹æ¡ˆï¼Œå®˜æ–¹äººå‘˜ä¼šåœ¨ä¸€å®šæ—¶é—´åç»§ç»­ç»§ç»­å¤„ç†ã€‚â†³
  >
  > æ ¹æ®æè¿°åˆ†æï¼Œå¯èƒ½æ˜¯ ProTable ä¸­ `valueType` ä¸º `select` çš„ `valueEnum` æ•°æ®æ¸²æŸ“çš„é—®é¢˜ï¼Œå»ºè®®æ£€æŸ¥ä»£ç ä¸­æ˜¯å¦æœ‰ä»¥ä¸‹æƒ…å†µï¼š
  >
  > 1. `valueEnum` ä¸­å°† `value` è½¬ä¸ºæ•°å­—ç±»å‹ï¼Œå¯¼è‡´æ¸²æŸ“æ—¶å‡ºç°é—®é¢˜ï¼›
  > 2. `valueType` ä¸º `select` æ—¶ï¼Œåœ¨ç¼–è¾‘æ—¶åªèƒ½æ¥æ”¶å­—ç¬¦ä¸²ç±»å‹çš„å€¼ï¼Œä½†åŸå§‹æ•°æ®ä¸ºæ•°å­—ç±»å‹ã€‚
  >
  > é’ˆå¯¹ç¬¬ä¸€ç‚¹é—®é¢˜ï¼Œå¯ä»¥å°è¯•å°† `valueEnum` ä¸­çš„å€¼æ”¹ä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼Œå¦‚å°† `0` æ”¹ä¸º `"0"`ã€‚
  >
  > é’ˆå¯¹ç¬¬äºŒç‚¹é—®é¢˜ï¼Œå¯ä»¥å°è¯•å¯¹ç¼–è¾‘æ—¶çš„æ•°æ®è¿›è¡Œè½¬å‹ï¼Œå°†æ•°å­—ç±»å‹çš„å€¼è½¬ä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š
  >
  > ```tsx
  > {
  >   title: 'ç”¨æˆ·è§’è‰²',
  >   dataIndex: 'userRole',
  >   valueType: 'select',
  >   editable: true,
  >   renderFormItem: (item, { type, defaultRender, ...rest }, form) => {
  >     return (
  >       <Input
  >         {...rest}
  >         value={form.getFieldValue(item.dataIndex)?.toString()}
  >         onChange={(e) => {
  >           form.setFieldsValue({ [item.dataIndex]: e.target.value });
  >         }}
  >       />
  >     );
  >   },
  >   valueEnum: {
  >     0: { text: 'æ™®é€šç”¨æˆ·', status: 'Default' },
  >     1: { text: 'ç®¡ç†å‘˜', status: 'Success' },
  >   },
  > },
  > ```
  >
  > æ­¤å¤–ï¼Œå¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼Œäº†è§£å¦‚ä½•æ­£ç¡®ä½¿ç”¨ `valueType` å’Œ `valueEnum` å±æ€§ï¼š
  >
  > - `valueType`ï¼šhttps://procomponents.ant.design/components/table#valueformat
  > - `valueEnum`ï¼šhttps://procomponents.ant.design/components/table#valueenum

æ„Ÿè°¢å›å¤ã€‚ç»è¿‡æµ‹è¯•ä¸Šè¿°é—®é¢˜ä¸valueTypeçš„ç±»å‹æ— å…³ï¼Œä¾‹å¦‚æˆ‘ä¹‹å‰ç»™å‡ºçš„ä¾‹å­çš„å±•ç¤ºâ€œçŠ¶æ€â€ä¸€åˆ—valueTypeçš„å€¼ä¸ºâ€œtextâ€,ä¾æ—§æ¸²æŸ“ä¸æ­£ç¡®ï¼Œå¹¶ä¸”åªæ˜¯åˆå§‹å€¼æ¸²æŸ“ä¸æ­£ç¡®ï¼Œå½“é¼ æ ‡å°è¯•ç‚¹å‡»valueTypeä¸ºselectçš„è¾“å…¥æ¡†æ—¶ï¼Œå‘ç°ä¸‹æ‹‰å±•ç¤ºçš„æ•°æ®æ¸²æŸ“æ˜¯æ­£ç¡®çš„ã€‚æ¥ç€å°†valueEnumçš„0ä¸1æ”¹ä¸ºâ€™0â€˜ä¸â€™1â€˜ï¼Œé—®é¢˜ä¾æ—§å­˜åœ¨ã€‚

æ¥ç€ç”¨renderFormItem å°è¯•è½¬ä¸ºå­—ç¬¦ä¸²ï¼Œæµ‹è¯•ä¹‹åå‘ç°å…¶ä¸­onChangeæ–¹æ³•æ˜¯åœ¨å°è¯•ä¿®æ”¹è¾“å…¥æ¡†çš„å€¼åæ‰ä¼šè§¦å‘ï¼Œä¹Ÿå°±æ˜¯æ— æ³•å¯¹ç‚¹å‡»ç¼–è¾‘åçš„åˆå§‹å€¼è¿›è¡Œè½¬æ¢å¹¶èµ‹å€¼ã€‚ä¹‹åæˆ‘å†æ¬¡ç”¨è¯·æ±‚æ‹¦æˆªå™¨æ‹¦æˆªresponseï¼Œå°†å…¶ä¸­çš„userRole è¿›è¡Œç±»å‹æ–­è¨€ï¼š

`response.data.userRole = response.data.userRole.toString() `

è½¬æ¢åè¾“å…¥æ¡†åˆå§‹å€¼æ¸²æŸ“æ­£ç¡®,ï¼Œæ‰€ä»¥æˆ‘çš„æ¨æ–­æ˜¯valueEnum ä¸æ”¯æŒç›´æ¥å¯¹æ•°å€¼ç±»å‹ çš„ä¸åŒæ•°æ®çš„æ¸²æŸ“ï¼Œå¦‚æœæŸ¥é˜…å®˜æ–¹æ–‡æ¡£ï¼Œå…¶keyå€¼ç¡®å®æ˜¯å®šä¹‰ä¸º[key: string]ï¼ˆvalueEnumä¸æ”¯æŒnumber?ï¼‰å¯èƒ½æˆ‘æ‰€è¯´çš„å¹¶éä¸€ä¸ªBugï¼Œè€Œæ˜¯ä¸€ä¸ªå»ºè®®ï¼Œå¸Œæœ›valueEnumèƒ½å¤Ÿæ”¯æŒnumberç±»å‹.

## chenshuai2144

object æ˜¯ä¸æ”¯æŒ numberï¼Œå¦‚æœè¦ç”¨ number éœ€è¦ä½¿ç”¨ map è¿™ä¸ªæ•°æ®ç»“æ„

## xyovo

>

OKï¼Œè¿™å¯¹æˆ‘æœ‰ç”¨~ è°¢è°¢
