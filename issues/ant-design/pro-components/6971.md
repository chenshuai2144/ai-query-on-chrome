# 🧐[问题] ProFormSelect使用OptGroup 如何设置key

`AI Reply`

提问前先看看：

https://github.com/ryanhanwu/How-To-Ask-Questions-The-Smart-Way/blob/main/README-zh_CN.md

### 🧐 问题描述

<!--
详细地描述问题，让大家都能理解
-->

使用Select中的OptGroup，在控制台中获取到如下`warning`。

```
Warning: Each child in a list should have a unique "key" prop.

Check the render method of `ForwardRef(SearchSelect2)`. See https://reactjs.org/link/warning-keys for more information.
    at OptGroup2
    at SearchSelect2
```

如何去消除该warning，是个bug吗？options内部没有处理好？

### 💻 示例代码

<!--
如果你有解决方案，在这里清晰地阐述
-->

```tsx
<ProFormSelect
  width="md"
  name="singleProduct"
  label="单品"
  request={async () => {
    const result = await singleProductsRefetch();
    if (result.data?.singleProducts) {
      const options: RequestOptionsType[] = [];
      for (const singleProduct of result.data.singleProducts) {
        const splitTitle = singleProduct.title.split(" ");
        const findProduct = options?.find((x) => x.label === splitTitle[0]);
        if (!findProduct) {
          options.push({
            label: splitTitle[0],
            options: [{ label: singleProduct.title, value: singleProduct._id }],
          });
        }
        findProduct?.options?.push({
          label: singleProduct.title,
          value: singleProduct._id,
        });
      }
      return options;
    }
    return [];
  }}
/>
```

## chenshuai2144

> TAutomatically replying with ChatGPT can be attempted, but it cannot be guaranteed to be completely accurate and may not fully address all issues. Please feel free to reply if you have any further questions or concerns.
> 此回复基于 ChatGPT 自动生成，可以尝试下方案，官方人员会在一定时间后继续继续处理。

### 🌈 解决方案

这个warning是提示你每个list中的孩子应该要有一个唯一的key prop，具体可以参考官方文档：[Lists and Keys](https://reactjs.org/docs/lists-and-keys.html)。

在Antd的`ProFormSelect`中，`request`属性内部最终会将处理完的`options`数组通过`Select`组件渲染，并且渲染`OptGroup`时也可以添加key属性。

```tsx
<ProFormSelect
  width="md"
  name="singleProduct"
  label="单品"
  request={async () => {
    const result = await singleProductsRefetch();
    if (result.data?.singleProducts) {
      const options: RequestOptionsType[] = [];
      for (const singleProduct of result.data.singleProducts) {
        const splitTitle = singleProduct.title.split(" ");
        const findProduct = options?.find((x) => x.label === splitTitle[0]);
        if (!findProduct) {
          options.push({
            label: splitTitle[0],
            options: [
              {
                label: singleProduct.title,
                value: singleProduct._id,
                key: singleProduct._id,
              },
            ], // 添加key
          });
        }
        findProduct?.options?.push({
          label: singleProduct.title,
          value: singleProduct._id,
          key: singleProduct._id,
        }); // 添加key
      }
      return options;
    }
    return [];
  }}
/>
```

添加`key`后，控制台的warning就不会再出现了。

参考文档：

- [Antd官方文档 - Select](https://ant.design/components/select-cn/)
- [React官方文档 - Lists and Keys](https://reactjs.org/docs/lists-and-keys.html)

## chenshuai2144

```
 options.push({
            label: splitTitle[0],
            options: [{ label: singleProduct.title, value: singleProduct._id, key: singleProduct._id }], // 添加key
          })

```

这里要增加key
