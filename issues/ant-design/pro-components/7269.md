# 下拉筛选的ValueEnum如何设置🧐[问题]

`AI Reply`

提问前先看看：

https://github.com/ryanhanwu/How-To-Ask-Questions-The-Smart-Way/blob/main/README-zh_CN.md

### 🧐 问题描述

正在使用`ProTable`，其中`columns`定义的某一项中使用了`renderFormItem`和`render`，我希望能基于`render`中的`key`进行筛选。

<!--
详细地描述问题，让大家都能理解
-->

### 💻 示例代码

以下是我的示例代码

```typescript
// 数据类
type UserItem = {
    ...
    role: {
        name: string;
        color: string;
    }[];
};

const columns: ProColumns<UserItem>[] = [
// 某一个column的定义
{
        disable: true,
        title: '角色',
        dataIndex: 'role',
        // search: false,
        renderFormItem: (_, { defaultRender }) => {
            return defaultRender(_);
        },
        render: (_, record:UserItem) => (
            <Space>
                {record.role.map(({ name, color }) => (
                    <Tag role={name} color={color} key={name}>
                        {name}
                    </Tag>
                ))}
            </Space>
        ),
        filters: true,
        onFilter: true,
        // https://procomponents.ant.design/components/schema#valueenum
        valueType: 'select',
        valueEnum: {
            all:{
                text:"全部"
            },
            admin:{
                text:"admin"
            },
            user:{
                text:"user"
            }
        }
        ),
    },
];

export default () => {
    const actionRef = useRef<ActionType>();
    return (
        <ProTable<UserItem>
            columns={columns}
            actionRef={actionRef}
            cardBordered
            request={async (params = {}, sort, filter) => {
                console.log(sort, filter);
                await waitTime(2000);
                return request<{
                    data: UserItem[];
                }>('/api/v1/manage/queryAllUserList', {
                    params,
                });
            }}
            editable={{
                type: 'multiple',
            }}
            columnsState={{
                persistenceKey: 'pro-table-singe-demos',
                persistenceType: 'localStorage',
                onChange(value) {
                    console.log('value: ', value);
                },
            }}
            rowKey="id"
            search={{
                labelWidth: 'auto',
            }}
            options={{
                setting: {
                    listsHeight: 800,
                },
            }}
            form={{
                // 由于配置了 transform，提交的参与与定义的不同这里需要转化一下
                syncToUrl: (values, type) => {
                    if (type === 'get') {
                        return {
                            ...values,
                            created_at: [values.startTime, values.endTime],
                        };
                    }
                    return values;
                },
            }}
            pagination={{
                pageSize: 10,
                onChange: (page) => console.log(page),
            }}
            dateFormatter="string"
            headerTitle="当前用户"
            toolBarRender={() => [
                <Button
                    key="button"
                    icon={<PlusOutlined />}
                    onClick={() => {
                        actionRef.current?.reload();
                    }}
                    type="primary"
                >
                    添加用户
                </Button>,
            ]}
            onSubmit={(params)=>{
                alert("submit");
                console.log("submit:", params);
            }}
        />
    );
};
```

<!--
如果你有解决方案，在这里清晰地阐述
-->

### 🚑 其他信息

<!--
如截图等其他信息可以贴在这里
-->

## LabBaxMX-0219

我参考的模板: https://procomponents.ant.design/components/table?tab=api&current=1&pageSize=5#packages-table-src-components-table-tab-api-demo-single

我的response部分的用户数据如下：

```json
{
            "id": "0af0316f-4068-495d-82cd-bd0662985d1a",
            "avater": "https://avatars.githubusercontent.com/u/69057311",
            "phone": "+86 148-0914-8200",
            "created_at": "2023-06-24T14:26:46.275Z",
            "updated_at": "2023-06-24T16:19:24.021Z",
            "locked_at": "2023-06-25T01:18:29.496Z",
            "role": [
                {
                    "name": "user",
                    "color": "default"
                }
            ],
            "user": "Ena_Rosenbaum@hotmail.com",
            "state": "locked"
        },
```

问题截图如下

![能够正常获取到模拟数据](https://github.com/ant-design/pro-components/assets/70470574/ce9b570d-1051-49d0-af4e-d41c33ee90a3)

![进行筛选时无法获得对应的数据](https://github.com/ant-design/pro-components/assets/70470574/93edc42d-3ed2-4126-8be3-bc397712cea4)

## chenshuai2144

> TAutomatically replying with ChatGPT can be attempted, but it cannot be guaranteed to be completely accurate and may not fully address all issues. Please feel free to reply if you have any further questions or concerns.
> 此回复基于 ChatGPT 自动生成，可以尝试下方案，官方人员会在一定时间后继续继续处理。

你的问题是希望基于`render`中的`key`进行下拉筛选的ValueEnum设置。根据你提供的信息和代码，我注意到你已经正确设置了`valueEnum`。不过，要使基于`render`中的`key`进行筛选生效，还需要在`onFilter`回调函数中对筛选条件进行处理。

在你的代码中，`onFilter`属性设置为`true`，这使得`ProTable`内部会根据`valueEnum`自动处理筛选逻辑。然而，由于你的`render`方法中使用了一个`Array.map`循环，每个`Tag`组件都有一个唯一的`key`，所以在筛选时需要使用`filter`参数进行匹配。

下面是你需要进行的修改:

1. 在`onFilter`的回调函数中，将`record.role.map(({ name }) => name)`改为`record.role.map(({ name }) => name).includes(filter.toString())`，这会检查`filter`参数是否包含在`name`数组中。

修改后的代码如下：

```typescript
// 数据类
type UserItem = {
    ...
    role: {
        name: string;
        color: string;
    }[];
};

const columns: ProColumns<UserItem>[] = [
// 某一个column的定义
{
    ...
    onFilter: (_, record) => record.role.map(({ name }) => name).includes(_.toString()),
    ...
    valueEnum: {
        all: {
            text: "全部"
        },
        admin: {
            text: "admin"
        },
        user: {
            text: "user"
        }
    },
},
];
```

这样修改后，你应该能够通过下拉筛选基于`render`中的`key`进行筛选。

希望这能解决你的问题！如果还有其他问题，请随时问我。
