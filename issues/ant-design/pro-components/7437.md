# Ant Design Pro ProTable Data Source not auto trigger update🧐[问题]

`table`,`🤷🏼 How to use`

I currently working on Ant Design Pro Protable and completed my code, I found that my ProTable is not auto refresh after I away from the page and back to the page. I recently just upgrade Ant Design Pro version to 5.2 and previous version is 4.0+. I tested the same code in my another application which working fine. Not sure if it is a versioning issue?

Here is my code:

```

import {
    Form,
    Input,
    Popconfirm,
    InputNumber,
    Button,
    Modal,
    Select,
    message
  } from 'antd';
import { useState, useRef } from 'react';
import React, {useEffect} from 'react';
import { PageContainer } from '@ant-design/pro-layout';
import ProTable from '@ant-design/pro-table';
import { ExportOutlined, PlusOutlined} from '@ant-design/icons';
import ExportJsonExcel from 'js-export-excel';
import { connect } from 'umi';
import { GetProductFamily } from '@/services/maintenance';

const { Option } = Select;

const ProductSetup = ({ currentUser }) => {
    const actionRef = useRef();
    const dataSource = useRef({});
    const [form] = Form.useForm();
    const [subform] = Form.useForm();
    const [isAddModalVisible, setIsAddModalVisible] = useState(false);
    const [division, setDivision] = useState("");
    const pfRef = React.useRef();
    const pfDescRef = React.useRef();

    const columns = [

        {
          title: 'Id',
          dataIndex: 'id',
          search: false,
          hideInTable: true,
        },
        {
          title: 'Product',
          dataIndex: 'name',
          search: true,
        },
        {
          title: 'Product Description',
          dataIndex: 'description',
          search: true,
        },
        {
          title: 'Deparment',
          dataIndex: 'department',
          search: true,
        },
        {
            title: 'Action',
            valueType: 'option',
            key: 'option',
            render: (text, record, _, action) =>
             [
                <Popconfirm
                    key="1"
                    title="Delete Product Family"
                    description="Are you sure to delete this product?"
                    onConfirm={()=>confirm(record.id)}
                    onCancel={cancel}
                    okText="Yes"
                    cancelText="No"
                >
                    <Button key="delete" type="danger" >Delete</Button>
                </Popconfirm>,

             ]
         }
      ];

    const showAddModal = () => {
        setIsAddModalVisible(true);
    };

    const reload=()=>window.location.reload();

    const handleAddCancel = () => {
        form.resetFields();
        setDivision('');
        setIsAddModalVisible(false);
    };

    const confirm = async (id) => {
    const settings = {
        method: 'POST',
        headers: {
            Accept: 'application/json',
            'Content-Type': 'application/json',
        }
    };
    const result = await fetch(`/test/api/maintenance/DeletePFSetupItem?id=${id}&loginUser=${encodeURIComponent(currentUser.userid)}`, settings);
    if (result.status === 200)
    {
        message.success("Product Family has been deleted.");
        actionRef.current.reload();
    }
    };
    const cancel = () => {
    };

    const onSelectchange = (value) => {
    setDivision(value);
    };

    const onDataSourceChange = (latest, old) => {
    if (old === undefined) {
        dataSource.current = latest;
    }
    if (latest && old) {
        if (latest.length !== old.length) dataSource.current = latest;
    }
    };

    const onChange = (a, b, c, current) => {
        dataSource.current = current.currentDataSource;
    };

    const createNew = async () => {
        const settings = {
            method: 'POST',
            headers: {
                Accept: 'application/json',
                'Content-Type': 'application/json',
            }
        };
        const result = await fetch(`/test/api/Maintenance/AddProduct?pf=${encodeURIComponent(pfRef.current.input.value)}&pfDesc=${encodeURIComponent(pfDescRef.current.input.value)}&dept=${department}&loginUser=${encodeURIComponent(currentUser.userid)}`, settings);
        if (result.status ===200)
        {
            setIsAddModalVisible(false);
            message.success("New Product has been added!");
            form.resetFields();
            setDivision('');
            actionRef.current.reload();
        }
    };

    const preAddValidation = async () => {
        let errMsg="";
        console.log(currentUser);
        const result = await fetch(`/test/api/Maintenance/PrePFAddValidation?pf=${encodeURIComponent(pfRef.current.input.value)}&dept=${department}`);
        if (result.status === 200){
            const body = await result.json();
            for (let i = 0; i < body.data.length; i++) {
                errMsg = body.data[i].message
            }

            if (errMsg !==""){
                message.error(errMsg);
            }
            else{
                createNew();
            }
        }
      };


    const handleAddOk = () => {
        if(division===""||division===null||division===undefined
          || pfRef.current.input.value ===""||pfRef.current.input.value ===null||pfRef.current.input.value ===undefined
          || pfDescRef.current.input.value ==="" || pfDescRef.current.input.value ===null || pfDescRef.current.input.value ===undefined){
            message.error("All field are required!");
        }
        else{
            preAddValidation();
        }
    };


    return(
        <PageContainer
        ghost
        header={{
          title: 'Product Setup',
          breadcrumb: {},
        }}>
      <ProTable
      actionRef={actionRef}
      columns={columns}
      rowKey="id"
      pagination={{
        pageSize: 10
      }}
      search={{
          layout: 'vertical',
          labelWidth: 120,
        }}
      toolBarRender={() => [
      <Button key="3" type="primary" onClick={showAddModal}>
      <PlusOutlined />
          Add
      </Button>
      ]}
      onDataSourceChange={onDataSourceChange}
      onChange={onChange}
      request={(params,sorter, filter) => GetProduct({ ...params,sorter, filter }, encodeURIComponent(currentUser.userid))}
      />

    <Modal title="Add New" open={isAddModalVisible} onOk={handleAddOk} width={900} destroyOnClose={reload} onCancel={handleAddCancel} style={{ top: '10px' }}>
        <Form form={form} labelCol={{span: 6, }}>
            <Form.Item label="Product Family"
            name="pf"
            rules={[
                      {
                        required: true,
                        message: 'Please input product!',
                      },
                    ]}  >
                <Input  ref={pfRef} placeholder='Please input product'/>
            </Form.Item>
            <Form.Item label="Product Description"
            name="pfDesc"
             rules={[
                {
                  required: true,
                  message: 'Please input description!',
                },
              ]}  >
                <Input  ref={pfDescRef} placeholder='Please input product description'/>
            </Form.Item>
            <Form.Item
                    label="Division"
                    name="division"
                    rules={[
                      {
                        required: true,
                        message: 'Please select division!',
                      },
                    ]}
                  >
                    <Select placeholder="Please select division" onChange={(e)=> onSelectchange(e)}>
                      <Option value="A">A</Option>
                      <Option value="B">B</Option>
                      <Option value="C">C</Option>
                      <Option value="D">D</Option>
                      <Option value="E">E</Option>
                      <Option value="F">F</Option>
                      <Option value="G">G</Option>
                      <Option value="H">H</Option>
                      <Option value="I">I</Option>
                    </Select>
                  </Form.Item>
        </Form>
</Modal>

      </PageContainer>
    );
}

export default connect(({ user }) => ({
    currentUser: user.currentUser,
  }))(ProductSetup);
```

## chenshuai2144

  <html>
<body>
<!--StartFragment-->

| revalidateOnFocus | Automatically re-request when the window is focused | boolean | true |
| ----------------- | --------------------------------------------------- | ------- | ---- |

<!--EndFragment-->
</body>
</html>

you need this api？

## AlexThoh88

> revalidateOnFocus

Hi @chenshuai2144, this is work for me, thanks
