# [Bug] addLocale 无效

<!--
感谢您向我们反馈问题，为了高效的解决问题，我们期望你能提供以下信息：
-->

## What happens?

addLocale(langName, {'test.test':'tttt'}, {antd: langName, momentLocale: langName})

## Mini Showcase Repository(REQUIRED)

## How To Reproduce

<!-- 请提供复现链接/步骤，错误日志以及相关配置 -->

## Context

## 原因

.umi/plugin-locale/localeExport.ts

```ts
    // 如果这是的 name 和当前的locale 相同需要重新设置一下，不然更新不了
    if (locale === getLocale()) {
        event.emit(LANG_CHANGE_EVENT, locale);
    }
};
```

模板如下
https://github.com/umijs/umi/blob/467ca496b03dac351d66c480771580a89c5ab5a6/packages/plugins/libs/locale/localeExports.tpl#L102-L106

这里只是触发事件，但这个事件没有被处理

而其他地方有类似如下的注释
https://github.com/umijs/umi/blob/467ca496b03dac351d66c480771580a89c5ab5a6/packages/plugins/libs/locale/localeExports.tpl#L218-L228

推测，这里是不是忘记手动触发了。。。。

## rozbo

更新，虽然这里看起来好像有问题，但实际上手动修改成这样也不成..容我再研究研究

## rozbo

再更新，可能应该不是这个的问题，其实应该是这个`addLocale`的调用有要求，必须在`i18nProvider`这个hook之前才行（有点反逻辑，放在`i18nProvider`这个hook反而不行，因为插件要先于我们注册，所以插件会先执行）。
最终注册在`accessProvider`就行了。（也不能注册在`dataflowProvider`之前，不然用不了`model`）
