# [Bug] Vite 在 max 中的启动缓慢问题

### 前情提要

在 #10433 中，我们详细的探讨了 vite `4.1` 的启动问题，以 vite + max 模板项目启动为例，包含三个主要方面问题：

1. 一启动 max ，就马上访问页面，会导致终端 vite 报错，启动失败。

2. 在 `mac 2020 (Intel i5)` 电脑上，启动 vite + max 模板项目需要花费 20s 以上预构建时间。

3. 在 `mac 2020 (Intel i5)` 电脑上，启动 vite + max 模板项目需要前后刷新 3 次以上页面，否则 vite 不会启动预构建，构建也不会完成（启动 umi 服务 → 不再阻塞 → 白屏，需要刷新 1 次页面 → 刷新后，请求 vite js 路径，开始预构建 → 白屏，等待请求并发结束后 → 必须再手动刷新 1 次页面 → 等待 vite 预构建结束完 → 再刷新 1 次页面 → 得到结果）。

目前 vite 已经升级到了 `4.2` ，在 Vite PR [#9986](https://github.com/vitejs/vite/issues/9986) 中，已经修复了第 1 个问题（由 https://github.com/umijs/umi/pull/10770 完成），但经检验，仍存在后两个问题。

### 解决方案

暂时没想到解决路径。

欢迎讨论，参与解决。

## fz6m

@xierenyuan 实测 vite v4.3.1 完全解了需要刷新 3 次页面的问题，甚至感觉比 mfsu 都要快，有空可以升级下。

## fz6m

### 最新进展

vite 尝试 [内置自动请求](https://github.com/vitejs/vite/pull/12809) 来更早的预构建，这也许可以进一步解决本 issue 中的慢构建问题。

在未来可以尝试一下这个思路，但要确认本 issue 中第一个问题是否复发（启动服务的第一时间就打开页面访问，看看是否会报错）。
