# [Bug] MFSU æ— æ³•ä¸ wasm ä¸€èµ·ä½¿ç”¨

`type(mfsu)`,`later`

## What happens?

MFSU æ— æ³•ä¸ wasm ä¸€èµ·ä½¿ç”¨

æˆ‘ä»¬éœ€è¦ä¿è¯å››ç»„ç”¨ä¾‹é€šè¿‡ï¼Œå±•å¼€å¦‚ä¸‹ï¼š

#### 1. wasm config + mfsu

æœ‰é…ç½® wasm ï¼Œå¼€å¯ mfsu ï¼Œå¯¼å…¥ wasm ï¼Œå¾—åˆ° wasm çš„ object æ–¹æ³•æ¨¡å—ã€‚

> ğŸ”´ ç°çŠ¶ ï¼šè¿è¡Œå¤±è´¥

#### 2. mfsu

æ²¡é…ç½® wasm ï¼Œå¼€å¯ mfsu ï¼Œå¯¼å…¥ wasm ï¼Œå¾—åˆ° wasm url

> ğŸ”´ ç°çŠ¶ ï¼šè¿è¡Œå¤±è´¥

#### 3. wasm config + `mfsu: false`

é…ç½® wasm ï¼Œä¸å¼€å¯ mfsu ï¼Œå¯¼å…¥ wasm ï¼Œå¾—åˆ° wasm çš„ object æ–¹æ³•æ¨¡å—ã€‚

> ğŸŸ¢ ç°çŠ¶ ï¼šè¿è¡ŒæˆåŠŸ

#### 4. `mfsu: false`

æ²¡é…ç½® wasm ï¼Œå…³é—­ mfsu ï¼Œå¯¼å…¥ wasm ï¼Œå¾—åˆ° wasm url

> ğŸŸ¢ ç°çŠ¶ ï¼šè¿è¡ŒæˆåŠŸ

## Mini Showcase Repository(REQUIRED)

https://github.com/MoeYc/umi-mfsu-bug-when-using-wasm

## How To Reproduce

1. pnpm i
2. pnpm dev

## Context

- **Umi Version**: 4.0.61
- **Node Version**: 18
- **Platform**: macos

## å¬å”¤

è¾›è‹¦æœ‰æ—¶é—´äº†çœ‹ä¸‹ @stormslowly ğŸŒ¹

## xiaohuoni

åŠ é€Ÿâ©åŠ é€Ÿâ© @stormslowly

## stormslowly

- case 1.2 åœ¨ PR åˆå¹¶å‰å»ºè®® `mfsu: { exclude: ['åŒ…å']}` ç»•è¿‡

- case 1 : PR åˆå¹¶åï¼Œå¯ä»¥æ­£å¸¸ä½¿ç”¨

- case 2 å¦‚æœæ˜¯ç”¨ asyncWebAssembly å»ºè®®ç»§ç»­ä½¿ç”¨ exclude çš„æ–¹å¼ , å› ä¸ºé¡¹ç›®è¿™ä¾§ä¸çŸ¥é“ mf å¯¼å‡ºçš„æ˜¯ä¸æ˜¯ä¸€ä¸ª async æ¨¡å—ã€‚

- case 2 å¦‚æœè¦ä½¿ç”¨ syncWebAssembly å¯ä»¥ä½¿ç”¨ mfsu ï¼Œä½†éœ€è¦ä¸º mfsu é…ç½® chainwebpackï¼Œ é¡¹ç›® chainwebpack é…ä¸é… syncWebAssembly éƒ½å¯ä»¥

```ts
  mfsu: {
  chainWebpack(config) {
    config.set('experiments', {
      ...config.get('experiments'),
      syncWebAssembly: true
    })
    const REG = /\.wasm$/
    config.module.rule('asset').exclude.add(REG).end();
  },
```

## stormslowly

@xiaohuoni @fz6m é‡äº‹ä¸å†³ï¼Œä¸è¦å…³ MFSU ï¼Œ é€šè¿‡ MFSU exclude å’Œ shared ä¸¤æ¿æ–§ç»•è¿‡ã€‚

## xiaohuoni

å¥½éš¾ï¼Œæ„Ÿè§‰ mfsu å°± pshu å¤§ä½¬ä¼šç”¨äº†
