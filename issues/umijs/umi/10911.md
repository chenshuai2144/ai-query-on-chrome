# Bug in Umi v4.0.64: `history.block` can prevent page routing from functioning properly.

## What happens?

The callback function of `history.block` will block the router's transition regardless of whether it returns a value or not.

## How to reproduce:

1. Write the following code in a page function:

```javascript
useEffect(() => {
  const unblock = history.block(({ location }) => {
    console.log("Address intercepted", location);
    // Return false
    // Return "hello"
    return true;
  });
  return () => {
    unblock?.();
  };
}, []);
```

2. Click on the left menu, and you will find that the navigation is blocked.

## Context:

- Umi version: 4.0.64
- Node version: 16.17.0
- Platform: Windows 10

## Solution:

- Refer to this document (https://github.com/remix-run/history/blob/main/docs/blocking-transitions.md)
- Use `unblock()` before calling `retry()`.
- Alternatively, prompt the user with a confirmation dialog to leave the page before blocking the route.
- Example code:

```javascript
useEffect(() => {
  const unblock = history.block(({ location, retry }) => {
    // Cancel the listener and call the retry method before blocking the route
    unblock();
    retry();

    // Or use the following approach
    if (!window.confirm("Do you want to leave the current page?")) {
      console.log("No");
    } else {
      unblock();
      retry();
    }
  });
  return () => {
    unblock?.();
  };
}, []);
```
