# [Bug] 从umi3升级到umi4后，package.json中配置type='module', .cjs.js文件无法被正确解析

  <!--
感谢您向我们反馈问题，为了高效的解决问题，我们期望你能提供以下信息：
-->

## What happens?

<!-- A clear and concise description of what the bug is. -->
<!-- 清晰的描述下遇到的问题。-->

## Mini Showcase Repository(REQUIRED)

> Please provide a [minimal reproduction](https://stackoverflow.com/help/minimal-reproducible-example) then upload to your GitHub. 请提供 [最小重现](https://stackoverflow.com/help/minimal-reproducible-example)，并上传到你的 GitHub 仓库

<!-- 为节约大家的时间，无复现步骤的 ISSUE 会被关闭，提供之后再 REOPEN -->
<!-- YOUR_REPOSITORY_URL on github or stackbliz -->

https://github.com/iwalking11/umi4-cjs-bug

## How To Reproduce

**Steps to reproduce the behavior:** 1. 2. 1.引入@aliyun-sls/web-track-browser包 该包的package.json配置如下：
![image](https://user-images.githubusercontent.com/14257970/236765735-9ec9fd22-1850-4629-81b4-f7a01c16fb5a.png)

2.项目中通过esm方式引用该包

import SlsTracker from "@aliyun-sls/web-track-browser";
项目启动后浏览器报错：
![image](https://user-images.githubusercontent.com/14257970/236765778-6bc23c0c-a383-466c-805b-4f0816adfb30.png)

删除该包package.json中的type='module'，项目重新启动后可以正常访问。

**Expected behavior** 1. 2.
原则上，.cjs.js后缀的文件应该按照commonjs的规则解析，但是这里被type='module'的优先级覆盖了，按照esm解析了

<!-- 请提供复现链接/步骤，错误日志以及相关配置 -->

## Context

- **Umi Version**:4.0.67
- **Node Version**:16
- **Platform**:web

  ## fz6m

  给这个库提一个 PR 修复这个问题，或者用 [`pnpm patch`](https://pnpm.io/cli/patch) 一下这个包的代码先用着。
