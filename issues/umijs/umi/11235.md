# [Bug] 通过 `api.modifyDefaultConfig` 修改 `targets` 配置不生效

## What happens?

项目中使用 `api.modifyDefaultConfig` 修改 `targets` 为 `{ chrome: 71 }`，但 `bundler-webpack/src/config/config.ts` `getConfig` 方法中获取的 `userConfig.targets` 为 `{ chrome: 80 }`

排查发现 [`preset-umi`](https://github.com/umijs/umi/blob/27937cdfbcb6e604917cd1b288f726b4c4f4fe3d/packages/preset-umi/src/features/polyfill/polyfill.ts#L71) 中使用 `api.modifyConfig` 修改了 `targets`

两个问题：

1. 为什么 `api.modifyConfig` 优先级更高却比 `api.modifyDefaultConfig` 先调用？（两者调用时机与 v3 相反）
2. `getConfig` 中处理了 `targets` 的默认值，`preset-umi` 还需要 `api.modifyConfig` 修改 `targets` 吗？

## Mini Showcase Repository(REQUIRED)

## How To Reproduce

通过 `api.modifyDefaultConfig` 配置 `targets` 不生效

## Context

- **Umi Version**: 4.0.69
- **Node Version**: ^16
- **Platform**: Windows

  ## fz6m

  1. 调用时机是无所谓的。因为这个 api 从名字上来设定，就是不能有副作用的，仅仅是用来修改配置这件单纯的事，`modifyDefaultConfig` 就是修改默认配置，`modifyConfig` 就是修改用户配置，最后 config 会和 defaultConfig 合并到一起，同时 config 的优先级高，所以是 `modifyDefaultConfig` 先调用还是 `modifyConfig` 都是无所谓的，最终结果是有固定优先级的。

2. 为啥 targets 的配置不放到 defaultConfig 而是 config 时去判断，这是因为合并配置的时候是深度合并的，如果放到 default config 里，用户如果有自己的 targets 配置，合并到一起就造成了用户预期之外的部分，比如：

   ```ts
   merge(
     /* default config */ { targets: { chrome: 100 } },
     /* user config */ { targets: { firefox: 60 } },
   );
   // result: { chrome: 100, firefox: 60 }
   ```

   所以如果你要自己定义 targets ，就用 `modifyConfig` 修改吧。

## Enivia

虽然有解决办法，但只是升级了 umi 的一个小版本就导致使用 modifyDefaultConfig 修改 targets 失效了真是挺坑的。。。这个问题不是刚好 debug 到内部都发现不了。

## xiaohuoni

你升级了什么小版本 @Enivia

## Enivia

@xiaohuoni

umi 4.0.27 -> 4.0.69

## xiaohuoni

@Enivia 你的意思是 27版本，使用 modifyDefaultConfig 修改 targets 是有效的是嘛？

## Enivia

@xiaohuoni 是的
