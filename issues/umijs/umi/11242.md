# [Bug] åœ¨ esmodule ä¸­ import å…¶ä»–åŒ…æ—¶æ— æ³•æ­£ç¡®è§£æ

  <!--
æ„Ÿè°¢æ‚¨å‘æˆ‘ä»¬åé¦ˆé—®é¢˜ï¼Œä¸ºäº†é«˜æ•ˆçš„è§£å†³é—®é¢˜ï¼Œæˆ‘ä»¬æœŸæœ›ä½ èƒ½æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š
-->

## What happens?

**1. åœ¨ node_modules ä¸­æœ‰ä¸€ä¸ª type=module çš„åŒ…ï¼Œå‡è®¾ä¸º '@scope/a'ï¼Œåœ¨ app.ts æŒ‰å¦‚ä¸‹æ–¹å¼å¼•å…¥ï¼š**

app.ts

```typescript
import A from "@scope/a";
```

**2. è€Œåœ¨ '@scope/a' ä¸­çš„ esmodule è„šæœ¬ä¸­é€šè¿‡ import è¯­å¥å¼•å…¥äº†åŒ… `m`ï¼š**

@scope/a/dist/index.es.js

```javascript
//...
import M from 'm';
const L = M.create({//...})
//...
```

**3. æ­¤æ—¶å¼•å…¥åæŠ¥é”™ï¼ŒM ä¸Šæ²¡æœ‰ create æ–¹æ³•ï¼š**

æŠ¥é”™ï¼š
![CleanShot 2023-06-06 at 21 23 40@2x](https://github.com/umijs/umi/assets/17818522/4112ac16-82e2-44f0-bb8d-4d38b0289576)

**4. æ‰“å° M åå‘ç°å¼•å…¥çš„å†…å®¹ä¸ºï¼š**

<img width="322" alt="CleanShot 2023-06-06 at 21 24 15@2x" src="https://github.com/umijs/umi/assets/17818522/582c08f5-a08e-4c7d-87b3-ee2903d56169">

**5. ä½†æ˜¯å¦‚æœç›´æ¥åœ¨ app.ts ä¸­å¼•å…¥ 'm' åº“ï¼Œæˆ–è€…æ˜¯å°† '@scope/a' ä¸­çš„ index.es.js ç›´æ¥æ”¾åˆ° src ä¸­å¼•å…¥ï¼Œéƒ½èƒ½å¤Ÿå¾—åˆ°æ­£å¸¸çš„é»˜è®¤å¯¼å‡ºï¼›**

è¯·é—®è¯¥é—®é¢˜å¯ä»¥é€šè¿‡ä»€ä¹ˆæ ·çš„é…ç½®è§£å†³å—ï¼Ÿ

## Mini Showcase Repository(REQUIRED)

æŠ±æ­‰ï¼Œå†…éƒ¨é¡¹ç›®çŸ­æœŸå†…ä¸å¤ªå¥½æä¾›å¤ç°åº“ï¼Œå¦‚æœé€šè¿‡ä¸Šé¢ä¿¡æ¯ä¸å¥½æ¨æ–­é—®é¢˜æ‰€åœ¨æˆ‘å†æƒ³åŠæ³•åˆ›å»ºä¸€ä¸ªç±»ä¼¼é¡¹ç›®å§ğŸ™ğŸ»

## How To Reproduce

**Steps to reproduce the behavior:** 1. 2.

**Expected behavior** 1. 2.

'@scope/a' ä¸­çš„ `import M from 'm'` è¯­å¥å¯ä»¥æ­£å¸¸å¼•å…¥å…¶é»˜è®¤å¯¼å‡º

## Context

- **Umi Version**: 4.0.47
- **Node Version**: 16.4.2
- **Platform**: macOS 11.4

  ## fz6m

  ä½ éœ€è¦è‡ªå·±å¤„ç†å¥½ es äº’æ“ä½œçš„é—®é¢˜ï¼ˆæŒ‡ä»€ä¹ˆæ—¶å€™å– default ä»€ä¹ˆæ—¶å€™å–æœ¬èº«ï¼‰ï¼Œä½ éœ€è¦ç”¨ tsc æˆ–è€… father è¿™æ ·çš„æ‰“åŒ…å™¨æ‰“åŒ…ä½ çš„ `@scope/a` è¿™ä¸ªåŒ…ï¼Œç”Ÿæˆçš„ä»£ç é‡Œä¼šè‡ªåŠ¨æ·»åŠ èƒ¶æ°´ä»£ç ç”¨äºè§£å†³ es äº’æ“ä½œé—®é¢˜ï¼Œè¿™æ ·ä½ æ— éœ€å…³å¿ƒä»–æ˜¯ä¸æ˜¯ esmodule æ‰“åŒ…è€Œæˆçš„ï¼Œä¹Ÿå°±æ˜¯æ— éœ€å…³å¿ƒå¯¼å‡ºåœ¨ä¸åœ¨ default ä¸Šçš„é—®é¢˜ã€‚

umi ä¸ä¼šå¤„ç† node_modules é‡Œé¢çš„ä»£ç çš„ es äº’æ“ä½œé—®é¢˜ï¼Œè¿™éœ€è¦åŒ…å¼€å‘è€…è‡ªå·±å°±è§£å†³ã€‚

## shockw4ver

> ä½ éœ€è¦è‡ªå·±å¤„ç†å¥½ es äº’æ“ä½œçš„é—®é¢˜ï¼ˆæŒ‡ä»€ä¹ˆæ—¶å€™å– default ä»€ä¹ˆæ—¶å€™å–æœ¬èº«ï¼‰ï¼Œä½ éœ€è¦ç”¨ tsc æˆ–è€… father è¿™æ ·çš„æ‰“åŒ…å™¨æ‰“åŒ…ä½ çš„ `@scope/a` è¿™ä¸ªåŒ…ï¼Œç”Ÿæˆçš„ä»£ç é‡Œä¼šè‡ªåŠ¨æ·»åŠ èƒ¶æ°´ä»£ç ç”¨äºè§£å†³ es äº’æ“ä½œé—®é¢˜ï¼Œè¿™æ ·ä½ æ— éœ€å…³å¿ƒä»–æ˜¯ä¸æ˜¯ esmodule æ‰“åŒ…è€Œæˆçš„ï¼Œä¹Ÿå°±æ˜¯æ— éœ€å…³å¿ƒå¯¼å‡ºåœ¨ä¸åœ¨ default ä¸Šçš„é—®é¢˜ã€‚
>
> umi ä¸ä¼šå¤„ç† node_modules é‡Œé¢çš„ä»£ç çš„ es äº’æ“ä½œé—®é¢˜ï¼Œè¿™éœ€è¦åŒ…å¼€å‘è€…è‡ªå·±å°±è§£å†³ã€‚

ä½†æ˜¯å¦‚æœæŠŠæ–‡ä»¶å¤åˆ¶åˆ° src ç›®å½•ä¸‹ç›´æ¥å¼•ç”¨ï¼Œç¼–è¯‘å°±ç¬¦åˆé¢„æœŸäº†ï¼Œæœ‰åŠæ³•è®© node_modules é‡Œçš„åŒ…è¢«è§†ä¸ºæ™®é€šæ–‡ä»¶å¼•å…¥å—

## fz6m

ä½ æ˜¯è¿™ä¸ªåŒ…çš„ä½œè€…çš„è¯ï¼Œä½ è¦åœ¨è¿™ä¸ªåŒ…æ„å»ºä¸Šå°±è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¸ç„¶ä»»ä½•äººéƒ½æ˜¯æ²¡æ³•ç”¨ä½ è¿™ä¸ªåŒ…çš„ã€‚

å¯ä»¥å°è¯•ç”¨ [`extraBabelIncludes`](https://umijs.org/docs/api/config#extrababelincludes) è¿™ä¸ªé€‰é¡¹é…ä¸Šä½ çš„åŒ…åçœ‹çœ‹æœ‰æ•ˆæ²¡ï¼Œæˆ‘æ²¡è¯•è¿‡ã€‚

## shockw4ver

> ä½ æ˜¯è¿™ä¸ªåŒ…çš„ä½œè€…çš„è¯ï¼Œä½ è¦åœ¨è¿™ä¸ªåŒ…æ„å»ºä¸Šå°±è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¸ç„¶ä»»ä½•äººéƒ½æ˜¯æ²¡æ³•ç”¨ä½ è¿™ä¸ªåŒ…çš„ã€‚
>
> å¯ä»¥å°è¯•ç”¨ [`extraBabelIncludes`](https://umijs.org/docs/api/config#extrababelincludes) è¿™ä¸ªé€‰é¡¹é…ä¸Šä½ çš„åŒ…åçœ‹çœ‹æœ‰æ•ˆæ²¡ï¼Œæˆ‘æ²¡è¯•è¿‡ã€‚

æœ‰å°è¯•è¿‡ extraBabelIncludesï¼Œä½†è¿˜æ˜¯ä¼šæœ‰ç›¸åŒé—®é¢˜ï¼›
è¿™ä¸ªåŒ…åœ¨å…¶ä»– webpack ç³»ä¸‹çš„é¡¹ç›®æ˜¯ ok çš„ï¼Œç°åœ¨æ˜¯æƒ³ä½¿ç”¨ umi é‡æ„æ•´ä¸ªé¡¹ç›®ï¼Œç„¶åé‡åˆ°äº†è¿™ä¸ªé—®é¢˜ï¼›

å¦å¤–è¿˜å‘ç°ä¸€ç§æ–¹å¼ä¹Ÿèƒ½è·‘é€šï¼š

1. å°†è¿™ä¸ªåŒ…çš„ type ä» module æ”¹ä¸º commonjsï¼›
2. åŒæ—¶é€šè¿‡ alias å°†å®ƒå®šä½åˆ° cjs æ ¼å¼çš„æ–‡ä»¶ä¸Šï¼ˆåŒ…åŒæ—¶äº§å‡ºäº† cjs å’Œ es ä¸¤ç§æ ¼å¼ï¼Œé€šè¿‡ package.json çš„ exports å®šå‘ï¼‰ï¼›

ç¬¬ä¸€æ­¥è¿˜ä¸èƒ½ç¼ºå°‘ï¼Œå¦åˆ™ä¼šæŠ¥ `export 'default' (imported as 'A') was not found in '@scope/a' (module has no exports)`ï¼Œæ‰€ä»¥åƒæ˜¯ç¼–è¯‘ç³»ç»Ÿå¯¹ type=module çš„åŒ…æœ‰å¦å¤–å¤„ç†ï¼Ÿ

## fz6m

éœ€è¦ç»™ä¸€ä¸ªæœ€å°å¤ç°æ‰èƒ½æ’æŸ¥é—®é¢˜ã€‚
