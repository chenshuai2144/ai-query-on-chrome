# [Bug] An error occurs when using @@/plugin-request in getInitialState.

`Need Reproduce`

<!--
感谢您向我们反馈问题，为了高效的解决问题，我们期望你能提供以下信息：
-->

## What happens?

<!-- A clear and concise description of what the bug is. -->
<!-- 清晰的描述下遇到的问题。-->

An error occurs when using @@/plugin-request in getInitialState.

> Unhandled Rejection (TypeError): Cannot read properties of undefined (reading 'UseRequestProvider')

## Mini Showcase Repository(REQUIRED)

> Please provide a [minimal reproduction](https://stackoverflow.com/help/minimal-reproducible-example) then upload to your GitHub. 请提供 [最小重现](https://stackoverflow.com/help/minimal-reproducible-example)，并上传到你的 GitHub 仓库

<!-- 为节约大家的时间，无复现步骤的 ISSUE 会被关闭，提供之后再 REOPEN -->
<!-- YOUR_REPOSITORY_URL on github or stackbliz -->

https://github.com/see/next/line
https://codesandbox.io/p/sandbox/silent-fire-wd6kxm

## How To Reproduce

**Steps to reproduce the behavior:** 1. 2.

**Expected behavior** 1. 2.

<!-- 请提供复现链接/步骤，错误日志以及相关配置 -->

```shell
npx create-umi@latest demo
# Ant Design Pro
# npm
# taobao

cd demo

echo 'import { request } from '@@/plugin-request'
export async function getInitialState() {
  const data = await request('https://api.github.com')
  return { data }
}
' > ./src/app.ts

npm run dev
```

## Context

- **Umi Version**: 4.x
- **Node Version**: 18.x
- **Platform**: Macos 13.x

## fz6m

所有的方法需要从 `@umijs/max` 里导入：

```ts
import { request } from "@umijs/max";
```

上面给的 github repo url 404 找不到，如还有问题，给一个能打开的 repo 链接。

## 662

> 所有的方法需要从 `@umijs/max` 里导入：
>
> ```ts
> import { request } from "@umijs/max";
> ```
>
> 上面给的 github repo url 404 找不到，如还有问题，给一个能打开的 repo 链接。

Github 的链接是用来骗 bot 的。
下一行的 codesandbox 可以直接看到结果

![image](https://github.com/umijs/umi/assets/13599186/820ad39d-94aa-4651-8736-14d5ab8676d4)

## 662

@umijs/max 中的 request 确实可用，仅插件二次封装之后的会出问题

之所以要用 @@/plugin-request 而非 @umijs/max 导出的 request，是因为 https://umijs.org/docs/max/request#request 文档中提到，使用 plugin-request 可以获得额外的能力

## 662

没注意 @umijs/max 中的 request 就是来自 .umi 目录

关了。
