# umi^4.0.53中theme 引入ts文件对象无法热更新

`Need Reproduce`

## What happens?

直接在config文件更新 theme，可以热更新，但是引入变量后，在变量里面修改，无法热更新，
设置mfsu:false，也无效
![image](https://github.com/umijs/umi/assets/42568595/338bdef5-48d4-45dc-8def-be242499fc48)

## Mini Showcase Repository(REQUIRED)

## How To Reproduce

1.在theme.ts文件内修改主题色，后
npm run start 无效果
![image](https://github.com/umijs/umi/assets/42568595/9086abbb-59dc-46ef-b56c-0b55d7583ae2)

2、在config中直接修改，主题色改变（只要config中有更改，就能触发热更新）

## Context

- **Umi Version**:4.0.53
- **Node Version**:16.0.0
- **Platform**:macOS

## fz6m

仅 `config.ts` 的更改会被自动检测重启 umi 进程，其他导入的文件不支持。

## lixiaoshun

重新run start还会保留上次的编译结果，即使删除.umi文件夹

## fz6m

如有问题，需要给一个最小复现。

## fz6m

是 `@primary-color` ，可 [参考文档](https://umijs.org/docs/api/config#theme) 。

## lixiaoshun

使用@primary-color还是不可以，第一次是生效的，在theme.ts文件中，除了第一次，后面修改主题色，npm run start不会更新，但是build又没有问题

## fz6m

我看了下，有两个需要注意的：

第一个是 `config/theme.ts` 不是配置主文件，所以它的更改不会让 umi 缓存失效，所以应该在 `config/config.ts` 里配置 `theme` ：

```ts
// config/config.ts

// ...
  theme: {
    "@primary-color": "#a2e91e",
    // 有无 `@` 前缀均可
    // "primary-color": "#a2e91e",
  }
// ...
```

第二个是 less 缓存需要人为手动保存一次 `src/global.less` 文件后才会更新，也就是说每次改了 `theme` 配置后自动重启项目，要打开 `global.less` 按 `cmd/ctrl + s` 保存一下触发 less 重新编译才可以让新主题生效。

以上缓存问题都是仅在开发时才有的，构建是没问题的，自己开发时注意下吧。

注：

1. 可以通过手动添加 `config/theme.ts` 到缓存失效检测列表的方式来支持外置 `theme` 配置文件，但不推荐：

   ```ts
   // config/config.ts

     chainWebpack: (config: any, { env }) => {
       if (env === 'development') {
         const cache = config.get('cache')
         config.set(
           'cache',
           {
             ...cache,
             buildDependencies: {
               config: [
                 ...cache.buildDependencies.config,
                 join(__dirname, './theme.ts')
               ]
             }
           }
         )
       }
     },
   ```

2. **我在本地调试构建的时候，第一次不小心自动上传了你的 oss ，自己清理下 oss 目录文件吧，同时把这个仓库删了更改下 token 防止 key 被滥用。** @lixiaoshun

3. 手动配置 cacheGroup 是没用的，在 umi 4 中如需分包，可以配置内置的分包策略 [`codeSplitting`](https://umijs.org/docs/api/config#codesplitting) ，另可参考 [代码拆分指南](https://umijs.org/blog/code-splitting) 。
