# [Bug] openapi集成失败，报api.addMiddewares is not a function错误

我设置的openapi
import { join } from 'path';

const openApiConfig = {
requestLibPath: "import { request } from 'umi'",
// 或者使用在线的版本
// schemaPath: "https://gw.alipayobjects.com/os/antfincdn/M%24jrzTTYJN/oneapi.json",
schemaPath: join(\_\_dirname, 'openApi.json'),
mock: false,
}

export default openApiConfig

运行 yarn max openapi后，报错
fatal - TypeError: api.addMiddewares is not a function
at \_default (/Users/chenfeng/Desktop/code/umi/node_modules/@umijs/plugin-openapi/lib/index.js:118:7)
at Service.initPlugin (/Users/chenfeng/Desktop/code/umi/node_modules/@umijs/core/dist/service/service.js:463:40)
at Service.run (/Users/chenfeng/Desktop/code/umi/node_modules/@umijs/core/dist/service/service.js:259:18)
at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
at async Service.run2 (/Users/chenfeng/Desktop/code/umi/node_modules/umi/dist/service/service.js:65:12)
at async run (/Users/chenfeng/Desktop/code/umi/node_modules/umi/dist/cli/cli.js:57:7)
fatal - A complete log of this run can be found in:
fatal - /Users/chenfeng/Desktop/code/umi/node_modules/.cache/logger/umi.log
fatal - Consider reporting a GitHub issue on https://github.com/umijs/umi/issues
error Command failed with exit code 1.

## fz6m

umi 4 的 openapi 插件在 [这个仓库](https://github.com/umijs/umi-presets-pro/tree/master/packages/max-plugin-openapi) ，以前 `@umijs/plugin-xxx` 的插件均不适用于 umi 4 ，你可以用 umi-presets-pro 这个预设，包含了 [很多](https://github.com/umijs/umi-presets-pro/blob/master/packages/umi-preset-pro/src/index.ts) 实用的功能。

## zyk2891

那怎么通过scripts启动啊？原来plugin-xxx启动命令是umi oepnapi,现在又没有max openapi。

## zyk2891

我看antd-pro里面脚手架的openapi启动命令是max openapi,那为什么我在自己项目里手动安装@umijs/max-plugin-openapi和@umijs/max,没办法用max openapi启动
