# How to use PWA on umi 3.0

`type(documentation)`

Hello,
wanna to know how to use pwa in 3.0

I tried but it seems that this option was removed.

Thank you

## sherry007

å› ä¸ºé¡¹ç›®ä¸­éœ€è¦ç”¨ PWA å’Œ service workerï¼Œç ”ç©¶äº†ä¸€å¤©ï¼Œæœ€ç»ˆæ‰“é€šï¼Œä»¥ä¸‹æ˜¯æˆ‘çš„é…ç½®ï¼š

1. `umirc.js` é…ç½®ï¼šéœ€è¦å®‰è£…æ’ä»¶ `workbox-webpack-plugin`

```javascript
// umirc.js
const { InjectManifest } = require('workbox-webpack-plugin');
export default {
  ...
  copy: [`/pwa/${manifestName}`],  // è¿™ä¸ªéœ€è¦æä¾› pwa éœ€è¦çš„ .webmanifest æ–‡ä»¶ï¼Œç„¶åŽæ‰‹åŠ¨å°†å…¶æ‹·è´åˆ°æž„å»ºä¹‹åŽçš„ç›®å½•ï¼ˆdistï¼‰ä¸‹
  links: [{ rel: 'manifest', href: `/console/${manifestName}` }], // æ‰‹åŠ¨æ’å…¥ .webmanifest æ–‡ä»¶çš„ link
  chainWebpack(memo) {
    // workbox é…ç½®
    memo.plugin('workbox').use(InjectManifest, [
      {
        swSrc: './pwa/service-worker.js',
        swDest: 'sw.js',
        exclude: [/\.map$/, /favicon\.ico$/, /^manifest.*\.js?$/],
      },
    ]);
  },
  ...
}
```

2. åˆ›å»ºæ–‡ä»¶ `register-service-worker.js`, æ–‡ä»¶å†…å®¹æ˜¯æ³¨å†Œ service workerï¼Œéœ€è¦å…ˆå®‰è£…æ’ä»¶ `register-service-worker` å“ˆï¼š

```javascript
// register-service-worker.js
import { register } from "register-service-worker";

function dispathServiceWorkerEvent(eventName) {
  const event = document.createEvent("Event");
  event.initEvent(eventName, true, true);
  window.dispatchEvent(event);
}

if (process.env.NODE_ENV === "production") {
  register(`/console/sw.js`, {
    // è¿™ä¸ªè·¯å¾„æ˜¯æ ¹æ®ä½ æœ€ç»ˆç”Ÿæˆçš„ service worker çš„æ–‡ä»¶è·¯å¾„æ¥ç¡®å®š
    updated() {
      dispathServiceWorkerEvent("sw.updated");
    },

    offline() {
      dispathServiceWorkerEvent("sw.offline");
    },
  });
}
```

3. å°† `register-service-worker.js` æ–‡ä»¶å¼•å…¥åˆ°ä½ çš„ app è¿è¡Œå…¥å£ï¼Œæˆ‘çš„è¯æ˜¯åœ¨ global.js ä¸­ å¼•å…¥äº†è¿™ä¸ªæ–‡ä»¶ï¼Œåæ­£å°±æ˜¯åœ¨è¿è¡Œåº”ç”¨å‰å…ˆè¿è¡Œè¿™ä¸ªè„šæœ¬å¯¹ service worker è¿›è¡Œæ³¨å†Œ

```javascript
// global.js
...
import './register-service-worker';
...
```

4. è¿™ä¸ªéªŒè¯çš„è¯ï¼Œå…¶å®žæœ¬åœ°ä¸å¤ªå¥½éªŒè¯ï¼Œæˆ‘ä»¬é¡¹ç›®çš„è¯ï¼Œæ˜¯æŠŠé¡¹ç›®æ”¾åˆ° docker é‡Œè¿è¡Œï¼Œç„¶åŽæš´éœ²ç«¯å£è¿›åŽ»ï¼Œæ˜¯å¯ä»¥çœ‹åˆ° sw.js å’Œ .webmanifest æ–‡ä»¶ï¼›ç„¶åŽåœ¨å¹³æ¿è¿è¡Œçš„æ—¶å€™å¯ä»¥ç”Ÿæˆæ¡Œé¢åº”ç”¨
   ![image](https://user-images.githubusercontent.com/5960194/89148723-34bb0c00-d58d-11ea-9ea6-82d382721694.png)
   ![image](https://user-images.githubusercontent.com/5960194/89148794-5e743300-d58d-11ea-9060-1c6676ddbe0b.png)

æœ€åŽï¼Œå¸Œæœ›èƒ½å¤Ÿå¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œå¦‚æžœæœ‰é—®é¢˜ï¼Œå¯ä»¥è”ç³»æˆ‘

## Jerry-yx

æ±‚å¤§ç¥žèµæ•™ï¼ï¼ï¼ï¼ï¼ï¼
![image](https://user-images.githubusercontent.com/34082804/91928409-8a124680-ed0e-11ea-9836-78cdb2a6bfd5.png)
ç”¨è¿™ç§æ–¹æ³•é…ç½®ä¹‹åŽï¼Œservice worker æ¿€æ´»æˆåŠŸäº†ï¼Œä½†æ˜¯æŠŠç½‘æ–­å¼€æˆ–è€…æ›´æ–°swæ–‡ä»¶ä¹‹åŽéƒ½ä¸è§¦å‘æ³¨å†Œçš„äº‹ä»¶æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿåˆ·æ–°æ‰ä¼šè§¦å‘swæ›´æ–°äº‹ä»¶ï¼Œè€Œä¸”æŠ¥é”™äº†ï¼Œä¸æ¸…æ¥šæ˜¯ä¸ºä»€ä¹ˆï¼Ÿ
![image](https://user-images.githubusercontent.com/34082804/91928436-99918f80-ed0e-11ea-9b05-68031cb5613c.png)
![image](https://user-images.githubusercontent.com/34082804/91928726-5b48a000-ed0f-11ea-8d51-71944e1771c8.png)

## sherry007

> æ±‚å¤§ç¥žèµæ•™ï¼ï¼ï¼ï¼ï¼ï¼
> ![image](https://user-images.githubusercontent.com/34082804/91928409-8a124680-ed0e-11ea-9836-78cdb2a6bfd5.png)
> ç”¨è¿™ç§æ–¹æ³•é…ç½®ä¹‹åŽï¼Œservice worker æ¿€æ´»æˆåŠŸäº†ï¼Œä½†æ˜¯æŠŠç½‘æ–­å¼€æˆ–è€…æ›´æ–°swæ–‡ä»¶ä¹‹åŽéƒ½ä¸è§¦å‘æ³¨å†Œçš„äº‹ä»¶æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿåˆ·æ–°æ‰ä¼šè§¦å‘swæ›´æ–°äº‹ä»¶ï¼Œè€Œä¸”æŠ¥é”™äº†ï¼Œä¸æ¸…æ¥šæ˜¯ä¸ºä»€ä¹ˆï¼Ÿ
> ![image](https://user-images.githubusercontent.com/34082804/91928436-99918f80-ed0e-11ea-9b05-68031cb5613c.png) > ![image](https://user-images.githubusercontent.com/34082804/91928726-5b48a000-ed0f-11ea-8d51-71944e1771c8.png)

å«å¤§ç¥žè¨€é‡äº†ðŸ¤£ï¼Œè¿™ä¸ªæˆ‘æŸ¥äº†ä¸€ä¸‹ï¼Œé¦–å…ˆç½‘ç»œæ–­å¼€æ˜¯ä¸æ˜¯æœ¬æ¥å°±ä¸ä¼šè§¦å‘æ³¨å†Œäº‹ä»¶å‘¢ï¼Œæ›´æ–°swæ–‡ä»¶çš„è¯åº”è¯¥æ˜¯ä¼šè§¦å‘æ›´æ–°äº‹ä»¶çš„ï¼Œä½†æ˜¯ä½ è¿™ä¸ªswæ–‡ä»¶æ˜¯ä¸æ˜¯æž„å»ºä¹‹åŽçš„å‘€ï¼Œä½ åœ¨å“ªé‡Œæ”¹äº†è¿™ä¸ªæ–‡ä»¶å‘¢ï¼Ÿæˆ‘æŽ¨èä½ çœ‹ä¸€ä¸‹[è¿™ç¯‡æ–‡ç« ](https://developers.google.com/web/fundamentals/primers/service-workers#update-a-service-worker)å“¦
æˆ‘å½“æ—¶é…ç½®ä¹Ÿåªæ˜¯ç¨å¾®ç†è§£äº›ç±»åž‹ä¸º `InjectManifest` çš„ï¼Œè¿™ç§æˆ‘å¯èƒ½ä¸å¤ªäº†è§£æ€•ç»™ä½ è¯´é”™äº†ï¼Œä¸å¥½æ„æ€å‘€~

## Jerry-yx

è°¢è°¢ï¼ï¼ï¼
æœ¬æ¥æ˜¯æƒ³å®žçŽ°buildä»£ç ç”Ÿæˆæ–°ç‰ˆæœ¬çš„sw.jsæ–‡ä»¶ä¹‹åŽï¼Œæµè§ˆå™¨ä¸åˆ·æ–°åœ¨å½“å‰é¡µå°±èƒ½æ„ŸçŸ¥åˆ°sw.jsæ–‡ä»¶çš„æ›´æ–°ï¼Œç«‹é©¬æ³¨å†Œï¼Œä½†æ˜¯åŽæ¥æŸ¥èµ„æ–™å‘çŽ°ï¼Œå¹¶æ²¡æœ‰è¿™æ ·çš„åŠŸèƒ½ï¼Œä¹‹æ¶èƒ½åˆ·æ–°ä¹‹åŽæ‰ä¼šé‡æ–°æ³¨å†Œã€‚

## sherry007

> è°¢è°¢ï¼ï¼ï¼
> æœ¬æ¥æ˜¯æƒ³å®žçŽ°buildä»£ç ç”Ÿæˆæ–°ç‰ˆæœ¬çš„sw.jsæ–‡ä»¶ä¹‹åŽï¼Œæµè§ˆå™¨ä¸åˆ·æ–°åœ¨å½“å‰é¡µå°±èƒ½æ„ŸçŸ¥åˆ°sw.jsæ–‡ä»¶çš„æ›´æ–°ï¼Œç«‹é©¬æ³¨å†Œï¼Œä½†æ˜¯åŽæ¥æŸ¥èµ„æ–™å‘çŽ°ï¼Œå¹¶æ²¡æœ‰è¿™æ ·çš„åŠŸèƒ½ï¼Œä¹‹æ¶èƒ½åˆ·æ–°ä¹‹åŽæ‰ä¼šé‡æ–°æ³¨å†Œã€‚

å—¯å—¯ï¼ä¸å®¢æ°”å“¦~

## jimStyle88

@sherry007 å¤§ç¥žä½ å¥½ï¼Œæˆ‘åœ¨umi2.x å¼€å¯äº†Pwa é…ç½®ï¼Œåœ¨å®žé™…åœºæ™¯ä¸­å‘å…ˆï¼Œæ¯æ¬¡å‘å¸ƒæ–°ç‰ˆæœ¬ä¹‹åŽï¼Œæ€»æœ‰å‡ ä¸ªç”¨æ³•è¿”å›žæ— æ³•æ‹‰å–åˆ°æœ€æ–°çš„jsæ–‡ä»¶å¯¼è‡´ç™½å±ï¼ŒæŽ§åˆ¶å°æŠ¥é”™ï¼ˆjs è·¯å¾„ 404ï¼‰ï¼Œç›®å‰è¿˜æžä¸æ‡‚ä¸ºä½•æ²¡æœ‰è§¦å‘updateã€‚ è¯·å¤§ç¥žæ”¯æ‹›ï¼Œæ€Žä¹ˆå¹³æ»‘ç”¨æˆ·æ— æ„ŸçŸ¥çš„å…³é—­PWA ï¼Œè¾¾åˆ°æ¯æ¬¡å‘å¸ƒï¼Œä¸ä¼šæœ‰èŽ·å–ä¸åˆ°æœ€æ–°æ–‡ä»¶çš„é—®é¢˜å‡ºçŽ°ã€‚
ç›®å‰çš„ä»£ç å¦‚ä¸‹ï¼š
![image](https://user-images.githubusercontent.com/20588608/97127303-394e2580-1774-11eb-981b-2c54b551fe73.png)
æœ›å›žå¤

## sorrycc

It's inactive above 3 months, feel free to reopen if still have problems.

## Aloento

@sherry007 å¤§ä½¬ï¼Œæˆ‘åœ¨ç”¨Ant Proæž„å»ºçš„æ—¶å€™é‡åˆ°äº†è¿™ä¸ªé”™è¯¯
`Can't find self.__WB_MANIFEST in your SW source.`
è¯·é—®å¦‚ä½•è§£å†³ï¼Ÿ

## rianonehub

> @sherry007 å¤§ä½¬ï¼Œæˆ‘åœ¨ç”¨Ant Proæž„å»ºçš„æ—¶å€™é‡åˆ°äº†è¿™ä¸ªé”™è¯¯ `Can't find self.__WB_MANIFEST in your SW source.` è¯·é—®å¦‚ä½•è§£å†³ï¼Ÿ

@Aloento
add this line on `service-worker.js` fix for me
`workbox.precaching.precacheAndRoute(self.__WB_MANIFEST || []);`

## W-yang-hhhhh

@sherry007 ä½ çš„é‚£ä¸ª.webmanifestæ–‡ä»¶ æ€Žä¹ˆç”Ÿæˆçš„ï¼Œè¿˜æœ‰æ–‡ä»¶çš„ç›®å½•æ–¹ä¾¿çœ‹ä¸€ä¸‹ä¹ˆ

## conioX

any example or plugin to use umi pwa?

## sherry007

> @sherry007 ä½ çš„é‚£ä¸ª.webmanifestæ–‡ä»¶ æ€Žä¹ˆç”Ÿæˆçš„ï¼Œè¿˜æœ‰æ–‡ä»¶çš„ç›®å½•æ–¹ä¾¿çœ‹ä¸€ä¸‹ä¹ˆ

è¿™ä¸ªæœ‰æ¨¡æ¿æ–‡ä»¶ï¼Œå¯ä»¥çœ‹ mdn è¿™ç¯‡ https://developer.mozilla.org/zh-CN/docs/Web/Manifest ï¼›è¿™ä¸ªæ–‡ä»¶è¢«æˆ‘æ”¾åˆ°äº† root ç›®å½•ä¸‹çš„ pwa æ–‡ä»¶å¤¹ä¸‹çš„
![image](https://user-images.githubusercontent.com/5960194/154025702-d2855601-adb4-42a1-a28a-97595c8df048.png)

## sambhav2612

any updates on this? can't get the manifest link with the service worker. @sherry007

## sherry007

>

Hi, I want to know if you have created the manifest file and config the "links" in `umirc` as I said @sambhav2612
