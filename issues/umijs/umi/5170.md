# externals只能是string或object?

`type(bug)`

[https://webpack.js.org/configuration/externals/](https://webpack.js.org/configuration/externals/)
umi的externals不是这种语法配置?

```
externals: [
   {
      react: 'react',
   },
  (context: string, request: string, callback: any) => {
      ...
  }
  ...
]
```

只能接受string或object?

```
Validate config "externals" failed, "value" must be one of [object, string]
ValidationError: "value" must be one of [object, string]

```

看了下ts定义长这样, (() => any)应该怎么用,尝试了下启动会一致卡在0%

```
export interface IConfigFromPlugins {
  ...
  externals?: {} | string | (() => any);
 ...
}
```

- **Umi 版本**：3.2.14
- **Node 版本**：v14.4.0
- **操作系统**：

## xiaohuoni

支持的，以下配置可以正常编译。

```ts
externals: [
  {
    // String
    react: "window.React",
    "react-dom": "window.ReactDOM",
    // Object
  },
  // Function
  function (context, request, callback) {
    callback();
  },
];
scripts: [
  "https://gw.alipayobjects.com/os/lib/react/16.13.1/umd/react.production.min.js",
  "https://gw.alipayobjects.com/os/lib/react-dom/16.13.1/umd/react-dom.production.min.js",
];
```

## chenxiaolei

@xiaohuoni 不对呀, 编译不过, 是我错过了什么吗

1.  yarn create @umijs/umi-app
2.  yarn install
3.  修改 .umirc.ts 中的externals

```
import { defineConfig } from 'umi';

export default defineConfig({
  nodeModulesTransform: {
    type: 'none',
  },
  routes: [
    { path: '/', component: '@/pages/index' },
  ],
  externals : [
    {
      // String
      react: 'window.React',
      'react-dom': 'window.ReactDOM',
      // Object
    },
    // Function
    function (context, request, callback) {
      callback();
    },
  ],
   scripts : [
    'https://gw.alipayobjects.com/os/lib/react/16.13.1/umd/react.production.min.js',
    'https://gw.alipayobjects.com/os/lib/react-dom/16.13.1/umd/react-dom.production.min.js',
  ]
});
```

4. yarn start

```
yarn run v1.22.4
$ umi dev
Validate config "externals" failed, "value" must be one of [object, string]
ValidationError: "value" must be one of [object, string]
✨  Done in 2.52s.
```

## xiaohuoni

确实，不行。我是通过插件里面测试的。我再看看。

## xiaohuoni

@chenxiaolei 修复了。你着急使用的话，可以手动修改
node_modules/@umijs/preset-built-in/lib/plugins/features/externals.js

```ts
var _default = (api) => {
  api.describe({
    key: "externals",
    config: {
      schema(joi) {
        // https://webpack.js.org/configuration/externals/#externals
        return joi.alternatives(
          joi.string(),
          joi.object(),
          joi.function(),
          joi
            .array()
            .items(
              joi.alternatives(joi.object(), joi.string(), joi.function()),
            ),
        );
      },
    },
  });
};
```

## chenxiaolei

@xiaohuoni ok,那我把问题关了

## xiaohuoni

合并了再关

## xiaohuoni

sorrycc ：不合了吧，不必追求全量 webpack，太灵活反而会给之后的辅助工具带来困难。

## jiaowochunge

为什么不合呢？很困扰的。太灵活算什么理由

## QiangTian1993

所以这个问题解决没
