# Location å’Œ useLocationçš„query ç¼ºå°‘ ts å£°æ˜ç±»å‹

`type(bug)`

<!--
æ„Ÿè°¢æ‚¨å‘æˆ‘ä»¬åé¦ˆé—®é¢˜ï¼Œä¸ºäº†é«˜æ•ˆçš„è§£å†³é—®é¢˜ï¼Œæˆ‘ä»¬æœŸæœ›ä½ èƒ½æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š
-->

å¦‚å›¾
![image](https://user-images.githubusercontent.com/7939085/91000837-ade1d800-e5fc-11ea-8bcd-fba5269231d5.png)

![image](https://user-images.githubusercontent.com/7939085/91000844-b0dcc880-e5fc-11ea-97b4-df0cf454bdf9.png)

## What happens?

<!-- æ¸…æ™°çš„æè¿°ä¸‹é‡åˆ°çš„é—®é¢˜ã€‚-->

## æœ€å°å¯å¤ç°ä»“åº“

> è¯·ä½¿ç”¨ `yarn create @umijs/umi-app` åˆ›å»ºï¼Œå¹¶ä¸Šä¼ åˆ°ä½ çš„ GitHub ä»“åº“

<!-- ä¸ºèŠ‚çº¦å¤§å®¶çš„æ—¶é—´ï¼Œæ— å¤ç°æ­¥éª¤çš„ ISSUE ä¼šè¢«å…³é—­ï¼Œæä¾›ä¹‹åå† REOPEN -->
<!-- https://github.com/YOUR_REPOSITORY_URL -->

## å¤ç°æ­¥éª¤ï¼Œé”™è¯¯æ—¥å¿—ä»¥åŠç›¸å…³é…ç½®

<!-- è¯·æä¾›å¤ç°æ­¥éª¤ï¼Œé”™è¯¯æ—¥å¿—ä»¥åŠç›¸å…³é…ç½® -->
<!-- å¯ä»¥å°è¯•ä¸è¦é”ç‰ˆæœ¬ï¼Œé‡æ–°å®‰è£…ä¾èµ–è¯•è¯•å…ˆ -->

## ç›¸å…³ç¯å¢ƒä¿¡æ¯

- **Umi ç‰ˆæœ¬**ï¼š
- **Node ç‰ˆæœ¬**ï¼š
- **æ“ä½œç³»ç»Ÿ**ï¼š

## xiaohuoni

çœ‹äº†ä¸€ä¸‹ä»£ç ï¼Œåº”è¯¥æ˜¯å·²ç»ä¿®å¤äº†ã€‚https://github.com/umijs/umi/commit/94f47a9039889244a95119056751d5bd1422d37c
ä½ å¯ä»¥æ›´æ–°ä¸€ä¸‹ä½ çš„umiç‰ˆæœ¬

## xiexingen

![image](https://user-images.githubusercontent.com/7939085/93552802-12961580-f9a4-11ea-866e-d74d9c742919.png)
å¥‡æ€ªäº†
"@umijs/preset-react": "^1.6.6",
"umi": "^3.2.20"

## xiaohuoni

@xiexingen ç»™ä¸ªä¾‹å­çœ‹ä¸‹

## leftstick

@xiaohuoni @xiexingen ä¹‹å‰é‚£ä¸ªä¿®å¤åªå¯¹ page component çš„ props é‡Œçš„location æœ‰æ•ˆã€‚

ç›´æ¥ç”¨ `useLocation` ï¼Œæˆ–è€… `history.location` å¾—åˆ°çš„å¯¹è±¡ï¼Œä»ç„¶æ²¡æœ‰ `query` å®šä¹‰ã€‚

ä¹‹å‰æˆ‘å°è±¡ @sorrycc ä¼¼ä¹æè¿‡è¿™ä¸ªåœ°æ–¹æœ‰æ½œåœ¨é—®é¢˜ï¼Œæ‰€ä»¥ä¸€ç›´æ²¡ä¿®å¤ã€‚ä¸ç¡®å®šé‚£ä¸ªç–‘é—®ç°åœ¨æ˜¯å¦ä¾æ—§å­˜åœ¨ã€‚ä½†`query` å®šä¹‰åº”è¯¥ç¡®å®è¿˜æ²¡æœ‰åŠ 

## xiaohuoni

https://github.com/umijs/umi/issues/4268#issuecomment-616908652

## alvin0216

```ts
const location = useLocation();
location.query; // ç±»å‹â€œLocationâ€ä¸Šä¸å­˜åœ¨å±æ€§â€œqueryâ€ã€‚
```

å®é™…ä¸Šæ˜¯æœ‰çš„ ï¼Œä½†æ˜¯ç±»å‹å£°æ˜å°±æ²¡æœ‰ï¼Œè¯·é—®å„ä½å¦‚ä½•è§£å†³çš„ ^3.3.2
@xiexingen

## xiexingen

> ```ts
> const location = useLocation();
> location.query; // ç±»å‹â€œLocationâ€ä¸Šä¸å­˜åœ¨å±æ€§â€œqueryâ€ã€‚
> ```
>
> å®é™…ä¸Šæ˜¯æœ‰çš„ ï¼Œä½†æ˜¯ç±»å‹å£°æ˜å°±æ²¡æœ‰ï¼Œè¯·é—®å„ä½å¦‚ä½•è§£å†³çš„ ^3.3.2
> @xiexingen

å®˜æ–¹æš‚æ—¶è¿˜æ²¡å¤„ç†ï¼Œæ”¹åŠ¨æ¯”è¾ƒå¤§ï¼›æˆ‘ç›®å‰æ˜¯ç”¨location['query']è¿™ç§å½¢å¼æ¥æš‚æ—¶è§£å†³çš„

## alvin0216

> > ```ts
> > const location = useLocation();
> > location.query; // ç±»å‹â€œLocationâ€ä¸Šä¸å­˜åœ¨å±æ€§â€œqueryâ€ã€‚
> > ```
> >
> > å®é™…ä¸Šæ˜¯æœ‰çš„ ï¼Œä½†æ˜¯ç±»å‹å£°æ˜å°±æ²¡æœ‰ï¼Œè¯·é—®å„ä½å¦‚ä½•è§£å†³çš„ ^3.3.2
> > @xiexingen
>
> å®˜æ–¹æš‚æ—¶è¿˜æ²¡å¤„ç†ï¼Œæ”¹åŠ¨æ¯”è¾ƒå¤§ï¼›æˆ‘ç›®å‰æ˜¯ç”¨location['query']è¿™ç§å½¢å¼æ¥æš‚æ—¶è§£å†³çš„

è°¢å›ï¼Œæˆ‘æ˜¯é€šè¿‡ [react-router query-paramters](https://reactrouter.com/web/example/query-parameters) å»è§£å†³çš„

ä»£ç ï¼š

```ts
export default function useSearchParams(): URLSearchParams {
  return new URLSearchParams(useLocation().search);
}
```

## sorrycc

It's inactive above 3 months, feel free to reopen if still have problems.

## mastercbhw

This problem still exists

## LiuJinYang9527

è¯¥é—®é¢˜ä»ç„¶å­˜åœ¨

## lhzbxx

è¿™ä¸ªé—®é¢˜æ²¡æœ‰è®¡åˆ’è§£å†³å—ï¼Ÿ

## nilzhao

æˆ‘æ˜¯é‡æ–°å®šä¹‰äº†ä¸€æ¬¡

- use-real-location.ts

```ts
import * as H from "history";
import { parse, ParsedQuery } from "query-string";
import { useLocation } from "umi";

const useRealLocation = <Q extends ParsedQuery<string>>() => {
  const location = useLocation<undefined>() as H.Location<undefined> & {
    query: Q;
  };
  const query = location.query || parse(location.search);

  return { ...location, query };
};

export default useRealLocation;
```

## lhzbxx

> æˆ‘æ˜¯é‡æ–°å®šä¹‰äº†ä¸€æ¬¡
>
> - use-real-location.ts
>
> ```ts
> import * as H from "history";
> import { parse, ParsedQuery } from "query-string";
> import { useLocation } from "umi";
>
> const useRealLocation = <Q extends ParsedQuery<string>>() => {
>   const location = useLocation<undefined>() as H.Location<undefined> & {
>     query: Q;
>   };
>   const query = location.query || parse(location.search);
>
>   return { ...location, query };
> };
>
> export default useRealLocation;
> ```

æˆ‘ç›®å‰æ˜¯ç›´æ¥ç”¨äº† [@ahooksjs/use-url-state](https://www.npmjs.com/package/@ahooksjs/use-url-state)ã€‚

## hengkx

@sorrycc @xiaohuoni é—®é¢˜ä¾ç„¶ æ²¡æœ‰è§£å†³

## LeleCao

@sorrycc @xiaohuoni è¯¥é—®é¢˜ä¾ç„¶å­˜åœ¨ï¼Œä½ ä»¬å®¶åº”ç”¨æ²¡æœ‰è·¯ç”±å—ã€‚ // @ts_nocheck

## littlee

ğŸ‘€ é—®é¢˜ä¾ç„¶ æ²¡æœ‰è§£å†³

## bruceeewong

è¯•è¯•è‡ªå®šä¹‰hook + any å¤§æ³•ğŸ¤ª

```ts
import { useLocation } from "umi";
export default function useQuery(): Record<string, string> {
  const location: any = useLocation();
  return location.query;
}
```

## fengjiahao

same problem for my project

## cl1107

> è¯•è¯•è‡ªå®šä¹‰hook + any å¤§æ³•ğŸ¤ª
>
> ```ts
> import { useLocation } from "umi";
> export default function useQuery(): Record<string, string> {
>   const location: any = useLocation();
>   return location.query;
> }
> ```

```typescript
import { useLocation } from "umi";
import type { Location } from "umi";

export const useLocationQuery = <T extends Record<string, string>>() => {
  const location = useLocation() as Location & { query: T };
  return location.query;
};
```

## linxianxi

+1ã€‚å¥½åƒæ˜¯ @types/history çš„é—®é¢˜ï¼Ÿ

## cloudy-boyuan

> +1ã€‚å¥½åƒæ˜¯ @types/history çš„é—®é¢˜ï¼Ÿ

æ‰‹åŠ¨æ·»åŠ å£°æ˜

```typescript
import { Location } from "history";

declare module "History" {
  interface Location {
    query: Record<string, string>;
  }
}
```

## linxianxi

> > +1ã€‚å¥½åƒæ˜¯ @types/history çš„é—®é¢˜ï¼Ÿ
>
> æ‰‹åŠ¨æ·»åŠ å£°æ˜
>
> ```ts
> import { Location } from "history";
>
> declare module "History" {
>   interface Location {
>     query: Record<string, string>;
>   }
> }
> ```

æ²¡ç”¨

## Liu-Ya

```ts
import type { Location } from "history";
const location = useLocation() as Location & { query: { from?: string } };
```

@linxianxi

## zchhaenngg

import type { Location } from 'history';

export default withRouter(({ history, location, match }) => {
const newlocation = location as Location & { query: { tag?: string } };
const { tag } = newlocation.query;

## bobbychan

```js
  import type { Location } from 'umi';
  const location: Location = useLocation();
```

## Pszz

> ```js
>   import type { Location } from 'umi';
>   const location: Location = useLocation();
> ```

and

```ts
import type { Location } from "umi";
const { query } = history.location as Location;
```

## HuangZurong

    const location = useLocation();
    const query = (location as any).query;


