# Location 和 useLocation的query 缺少 ts 声明类型

`type(bug)`

<!--
感谢您向我们反馈问题，为了高效的解决问题，我们期望你能提供以下信息：
-->

如图
![image](https://user-images.githubusercontent.com/7939085/91000837-ade1d800-e5fc-11ea-8bcd-fba5269231d5.png)

![image](https://user-images.githubusercontent.com/7939085/91000844-b0dcc880-e5fc-11ea-97b4-df0cf454bdf9.png)

## What happens?

<!-- 清晰的描述下遇到的问题。-->

## 最小可复现仓库

> 请使用 `yarn create @umijs/umi-app` 创建，并上传到你的 GitHub 仓库

<!-- 为节约大家的时间，无复现步骤的 ISSUE 会被关闭，提供之后再 REOPEN -->
<!-- https://github.com/YOUR_REPOSITORY_URL -->

## 复现步骤，错误日志以及相关配置

<!-- 请提供复现步骤，错误日志以及相关配置 -->
<!-- 可以尝试不要锁版本，重新安装依赖试试先 -->

## 相关环境信息

- **Umi 版本**：
- **Node 版本**：
- **操作系统**：

## xiaohuoni

看了一下代码，应该是已经修复了。https://github.com/umijs/umi/commit/94f47a9039889244a95119056751d5bd1422d37c
你可以更新一下你的umi版本

## xiexingen

![image](https://user-images.githubusercontent.com/7939085/93552802-12961580-f9a4-11ea-866e-d74d9c742919.png)
奇怪了
"@umijs/preset-react": "^1.6.6",
"umi": "^3.2.20"

## xiaohuoni

@xiexingen 给个例子看下

## leftstick

@xiaohuoni @xiexingen 之前那个修复只对 page component 的 props 里的location 有效。

直接用 `useLocation` ，或者 `history.location` 得到的对象，仍然没有 `query` 定义。

之前我印象 @sorrycc 似乎提过这个地方有潜在问题，所以一直没修复。不确定那个疑问现在是否依旧存在。但`query` 定义应该确实还没有加

## xiaohuoni

https://github.com/umijs/umi/issues/4268#issuecomment-616908652

## alvin0216

```ts
const location = useLocation();
location.query; // 类型“Location”上不存在属性“query”。
```

实际上是有的 ，但是类型声明就没有，请问各位如何解决的 ^3.3.2
@xiexingen

## xiexingen

> ```ts
> const location = useLocation();
> location.query; // 类型“Location”上不存在属性“query”。
> ```
>
> 实际上是有的 ，但是类型声明就没有，请问各位如何解决的 ^3.3.2
> @xiexingen

官方暂时还没处理，改动比较大；我目前是用location['query']这种形式来暂时解决的

## alvin0216

> > ```ts
> > const location = useLocation();
> > location.query; // 类型“Location”上不存在属性“query”。
> > ```
> >
> > 实际上是有的 ，但是类型声明就没有，请问各位如何解决的 ^3.3.2
> > @xiexingen
>
> 官方暂时还没处理，改动比较大；我目前是用location['query']这种形式来暂时解决的

谢回，我是通过 [react-router query-paramters](https://reactrouter.com/web/example/query-parameters) 去解决的

代码：

```ts
export default function useSearchParams(): URLSearchParams {
  return new URLSearchParams(useLocation().search);
}
```

## sorrycc

It's inactive above 3 months, feel free to reopen if still have problems.

## mastercbhw

This problem still exists

## LiuJinYang9527

该问题仍然存在

## lhzbxx

这个问题没有计划解决吗？

## nilzhao

我是重新定义了一次

- use-real-location.ts

```ts
import * as H from "history";
import { parse, ParsedQuery } from "query-string";
import { useLocation } from "umi";

const useRealLocation = <Q extends ParsedQuery<string>>() => {
  const location = useLocation<undefined>() as H.Location<undefined> & {
    query: Q;
  };
  const query = location.query || parse(location.search);

  return { ...location, query };
};

export default useRealLocation;
```

## lhzbxx

> 我是重新定义了一次
>
> - use-real-location.ts
>
> ```ts
> import * as H from "history";
> import { parse, ParsedQuery } from "query-string";
> import { useLocation } from "umi";
>
> const useRealLocation = <Q extends ParsedQuery<string>>() => {
>   const location = useLocation<undefined>() as H.Location<undefined> & {
>     query: Q;
>   };
>   const query = location.query || parse(location.search);
>
>   return { ...location, query };
> };
>
> export default useRealLocation;
> ```

我目前是直接用了 [@ahooksjs/use-url-state](https://www.npmjs.com/package/@ahooksjs/use-url-state)。

## hengkx

@sorrycc @xiaohuoni 问题依然 没有解决

## LeleCao

@sorrycc @xiaohuoni 该问题依然存在，你们家应用没有路由吗。 // @ts_nocheck

## littlee

👀 问题依然 没有解决

## bruceeewong

试试自定义hook + any 大法🤪

```ts
import { useLocation } from "umi";
export default function useQuery(): Record<string, string> {
  const location: any = useLocation();
  return location.query;
}
```

## fengjiahao

same problem for my project

## cl1107

> 试试自定义hook + any 大法🤪
>
> ```ts
> import { useLocation } from "umi";
> export default function useQuery(): Record<string, string> {
>   const location: any = useLocation();
>   return location.query;
> }
> ```

```typescript
import { useLocation } from "umi";
import type { Location } from "umi";

export const useLocationQuery = <T extends Record<string, string>>() => {
  const location = useLocation() as Location & { query: T };
  return location.query;
};
```

## linxianxi

+1。好像是 @types/history 的问题？

## cloudy-boyuan

> +1。好像是 @types/history 的问题？

手动添加声明

```typescript
import { Location } from "history";

declare module "History" {
  interface Location {
    query: Record<string, string>;
  }
}
```

## linxianxi

> > +1。好像是 @types/history 的问题？
>
> 手动添加声明
>
> ```ts
> import { Location } from "history";
>
> declare module "History" {
>   interface Location {
>     query: Record<string, string>;
>   }
> }
> ```

没用

## Liu-Ya

```ts
import type { Location } from "history";
const location = useLocation() as Location & { query: { from?: string } };
```

@linxianxi

## zchhaenngg

import type { Location } from 'history';

export default withRouter(({ history, location, match }) => {
const newlocation = location as Location & { query: { tag?: string } };
const { tag } = newlocation.query;

## bobbychan

```js
  import type { Location } from 'umi';
  const location: Location = useLocation();
```

## Pszz

> ```js
>   import type { Location } from 'umi';
>   const location: Location = useLocation();
> ```

and

```ts
import type { Location } from "umi";
const { query } = history.location as Location;
```

## HuangZurong

    const location = useLocation();
    const query = (location as any).query;


