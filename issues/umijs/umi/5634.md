# 每次保存热更新后，内存一直向上涨，直到最后内存溢出

`type(bug)`,`type(ssr)`

## What happens?

每次保存热更新后，内存一直向上涨，直到最后内存溢出
![微信截图_20201107222902](https://user-images.githubusercontent.com/47233643/98443785-aab0af80-2148-11eb-977d-065bd7586497.png)

## 相关环境信息

- **Umi 版本**：
  3.2.24
- **Node 版本**：
  14.15
- **操作系统**：
  win10

## ycjcl868

SSR？

## ibandeng

> SSR？

对，是我配置有问题吗？

## shangdev

我的情况是：

1. 未开SSR
2. 1c2g服务器上开调试模式，每次保存文件CPU和内存均大幅增加（达到90%以上），如果保存太多频繁，直接导致服务器卡死。

## ycjcl868

这个我来排查下

## iamwjj

@ycjcl868 还没排查出来吗？这开发体验也太难受了，时不时要重新启动。

## robinv8

> @ycjcl868 还没排查出来吗？这开发体验也太难受了，时不时要重新启动。

暂时可以在启动命令配置 NODE_OPTIONS=--max_old_space_size=8192 来增加 node 配额

## williamnie

这块应该是require的问题导致内存上涨，在开发阶段虽然每次都会清理require进来的umi.server.js，但是貌似内存并没有真正的释放，所以会导致内存泄露，貌似暂时没啥好办法 @ycjcl868

## williamnie

@ibandeng 提供一个复现吧，你是参照example里的例子，还是自己搭建的呢？我这边复现不了，给我个最小复现吧，

## ycjcl868

可能是 require('./umi.server')，这个会占用不少内存

## williamnie

> 可能是 require('./umi.server')，这个会占用不少内存

是的，我怀疑是这里，我实际测试感觉还行，会定期的释放，可能是页面太少了，如果项目太大的话，有可能会造成这个问题，还发现一个问题，现在egg的例子貌似不会热更新了，是不是没指定port造成的？

## ace0109

出现一样的问题，不是SSR。node版本14.16是直接dev启动直接就内存溢出了。换到12.22.1，能够撑一段时间。

## LemonTree-shine

反正是保存多次整个电脑都卡，让我说场景我说不出来，该看的文档都看了，说的配置都加上了，就是卡，项目大了，打包也卡，热更新更是卡的离谱，完全没有开发体验！

## httol

有结果吗，开发时内存暴涨。node占用2G

## dctxf

为毛关了？

## flwzz

内存占用9个g啊

## williamnie

> 内存占用9个g啊

哪个版本啊，现在还会占用这么高么？是只有开发环境这样，还是生产环境也这样？

## hyzx86

同样的项目 antd pro 5.20 不同的电脑就出现这种内存溢出的问题
都是32G内存，另一台电脑跑到1G 就挂了。。说内存溢出

## hyzx86

重新捣鼓了下 nvm ..好了

## airzhanglin

大佬，最后怎么解决这个问题？能够用--max_old_space_size=4096方式解决？

## hyzx86

> 大佬，最后怎么解决这个问题？能够用--max_old_space_size=4096方式解决？

换node版本

## airzhanglin

> > 大佬，最后怎么解决这个问题？能够用--max_old_space_size=4096方式解决？
>
> 换node版本

换到多少版本可以解决？

## hyzx86

不记得了，16 ？
我用的 umi4
