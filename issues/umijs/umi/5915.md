# [Feature Request] 动态修改base路径

`type(enhancement)`

## Background

一个项目中包含不同业务的数据，url中通过加上business来区分业务，页面跳转时需要加上business，能否在运行时改变base，跳转时只需要关心非business路径即可。

## Proposal

支持动态修改base路径

## sorrycc

不支持动态修改 base 路径，也没有计划，这个需求比较奇怪。

## wefiy

不奇怪啊，应用的上下文有时候部署的时候不是固定的

## smilehht

可以通过设置window.routerBase = 'xxx'来动态改变base路由

## justable

@sorrycc qiankun的子应用就需要运行时判断 base 路径：`<BrowserRouter basename={window.__POWERED_BY_QIANKUN__ ? '/app-react' : '/'}>`，umi 把这部分配置收敛了，没法操作。。

## LOWINC

> @sorrycc qiankun的子应用就需要运行时判断 base 路径：`<BrowserRouter basename={window.__POWERED_BY_QIANKUN__ ? '/app-react' : '/'}>`，umi 把这部分配置收敛了，没法操作。。

我也遇到这个问题了。。。。 umi项目 作为子应用应该怎么配置base？

## windyzoe

reopen?qiankun没法用直接凉凉了

## transtone

> 可以通过设置window.routerBase = 'xxx'来动态改变base路由
> https://github.com/umijs/umi/blob/master/packages/preset-built-in/src/plugins/generateFiles/core/history.tpl#L4

这个方法需要启用 `runtimehistory` https://umijs.org/zh-CN/config#runtimehistory

```js
export default defineConfig({
  runtimeHistory: {},
  ...其他配置...
})
```

可以把 `public-path.js` 文件改写一下：

```js
if (window.__POWERED_BY_QIANKUN__) {
  // eslint-disable-next-line no-undef
  __webpack_public_path__ = window.__INJECTED_PUBLIC_PATH_BY_QIANKUN__;
} else {
  window.routerBase = "/非乾坤路由-base-xxx/";
}
```

## wsz7777

强烈reopen

## wsz7777

@sorrycc 动态改base是迁移成本最低的方式了

## zhanghsoft

最后咋解决的 在用微前端也遇到了

## smilehht

> 最后咋解决的 在用微前端也遇到了

window.routerBase = 'xxx'来动态改变base路由

## poapoc

我是在qiankun的子应用里面用到了，用的框架是umi
1 配置开启runtimeHistory

```
export default defineConfig({
  runtimeHistory: {},
})
```

2 在app.tsx里面设置basename

```
import { setLocale, setCreateHistoryOptions } from 'umi';
setCreateHistoryOptions({
    basename: pathPrefix,//你要设置的前缀
});
```

## awishDay

父子应用都是umi 父应用配置了base之后 子应用的路由就访问不到了

## HeeBooo

> runtimeHistory

解决了，谢谢

## gaofei019

> 我是在qiankun的子应用里面用到了，用的框架是umi 1 配置开启runtimeHistory
>
> ```
> export default defineConfig({
>   runtimeHistory: {},
> })
> ```
>
> 2 在app.tsx里面设置basename
>
> ```
> import { setLocale, setCreateHistoryOptions } from 'umi';
> setCreateHistoryOptions({
>     basename: pathPrefix,//你要设置的前缀
> });
> ```

用的第几版本的umi

## cuijiudai

> 父子应用都是umi 父应用配置了base之后 子应用的路由就访问不到了

我也遇到了

## ziqiya

umi4 不支持修改 basename，子应用只能修改config里的base和publicPath，再改nginx配置

## balabll

> umi4 不支持修改 basename，子应用只能修改config里的base和publicPath，再改nginx配置

@ziqiya 请问Nginx部分是如何配置的

## Jiyr0119

>

解决了么 真的秀 升级个版本 升的微前端不好用了 动态修改base 这么平常的一个需求

## twinkle77

同，动态修改 base 路径真的是个必要需求

## warjiang

> feat: support dynamically modify the base path #9811

umi也太拉了，准备弃疗了

## twinkle77

@warjiang

```typescript
export const qiankun = {
  async mount(props) {
    // 微前端依赖
    if (window.__POWERED_BY_QIANKUN__ && props) {
      props.base = "/cl";
    }
  },
};
```

通过这种方式改子应用的 base 可以

## HJM515

> @warjiang
>
> ```ts
> export const qiankun = {
>   async mount(props) {
>     // 微前端依赖
>     if (window.__POWERED_BY_QIANKUN__ && props) {
>       props.base = "/cl";
>     }
>   },
> };
> ```
>
> 通过这种方式改子应用的 base 可以

试了一下，真的可以，厉害！
