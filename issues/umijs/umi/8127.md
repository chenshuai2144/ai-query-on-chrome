# [Bug] react18.1下，msfu(关闭mfsu也有问题)路由下一个页面，加载js报错，但刷新页面后正常。

<!--
⚠️ ⚠️ ⚠️ 注意：讨论和提问请到讨论区（https://github.com/umijs/umi/discussions），否则会被直接关掉。 ⚠️ ⚠️ ⚠️
-->
<!--
感谢您向我们反馈问题，为了高效的解决问题，我们期望你能提供以下信息：
-->

## What happens?

1、umi 3.5.24 react ,react-dom 18.1.0版本，使用msfu，路由下一个页面报错。
[@umijs/runtime] load component failed ChunkLoadError: Loading chunk **\*\*\*** failed.
(error: **\*\*\*****index.js)
at Object.**webpack_require**.f.j (jsonp chunk loading:27:1)
at ensure chunk:6:1
at Array.reduce (<anonymous>)
at Function.**webpack_require\_\_.e (ensure chunk:5:1)
at Function.fn.e (hot module replacement:81:1)
at loader (routes.ts:64:1)
at LoadableSubscription.load [as _loadFn] (mf-dep_vendors-node_modules_umi_node_modules_umijs_runtime_dist_index_esm_js.af99fab3.async.js:287:17)
at LoadableSubscription.retry (mf-dep_vendors-node_modules_umi_node_modules_umijs_runtime_dist_index_esm_js.af99fab3.async.js:477:24)
at new LoadableSubscription (mf-dep_vendors-node_modules_umi_node_modules_umijs_runtime_dist_index_esm_js.af99fab3.async.js:462:10)
at init (mf-dep_vendors-node_modules_umi_node_modules_umijs_runtime_dist_index_esm_js.af99fab3.async.js:367:17)
at LoadableComponent (mf-dep_vendors-node_modules_umi_node_modules_umijs_runtime_dist_index_esm_js.af99fab3.async.js:408:5)
at renderWithHooks (mf-dep_vendors-node_modules_react-dom_index_js.8775df10.async.js:16824:18)
at updateForwardRef (mf-dep_vendors-node_modules_react-dom_index_js.8775df10.async.js:20667:20)
at beginWork (mf-dep_vendors-node_modules_react-dom_index_js.8775df10.async.js:23109:16)
at beginWork$1 (mf-dep_vendors-node_modules_react-dom_index_js.8775df10.async.js:28025:14)
at performUnitOfWork (mf-dep_vendors-node_modules_react-dom_index_js.8775df10.async.js:27157:12)
at workLoopSync (mf-dep_vendors-node_modules_react-dom_index_js.8775df10.async.js:27066:5)
at renderRootSync (mf-dep_vendors-node_modules_react-dom_index_js.8775df10.async.js:27034:7)
at performConcurrentWorkOnRoot (mf-dep_vendors-node_modules_react-dom_index_js.8775df10.async.js:26338:74)
at workLoop (mf-dep_vendors-node_modules_react-dom_index_js.8775df10.async.js:269:38)
at flushWork (mf-dep_vendors-node_modules_react-dom_index_js.8775df10.async.js:243:18)
at performWorkUntilDeadline (mf-dep_vendors-node_modules_react-dom_index_js.8775df10.async.js:527:25)
at queue.<computed> (mf-dep_vendors-node_modules_core-js_index_js.f8014813.async.js:5867:53)
at run (mf-dep_vendors-node_modules_core-js_index_js.f8014813.async.js:5840:5)
at listener (mf-dep_vendors-node_modules_core-js_index_js.f8014813.async.js:5851:3)

2、umi 3.5.24 react ,react-dom 18.1.0版本，不使用msfu，路由下一个页面报错。
css loading:8 Uncaught ReferenceError: chunkId is not defined
at HTMLLinkElement.linkTag.onerror (css loading:8:1)
linkTag.onerror @ css loading:8
error（异步）
createStylesheet @ css loading:6
（匿名） @ css loading:39
loadStylesheet @ css loading:35
**webpack_require**.f.miniCss @ css loading:51
（匿名） @ ensure chunk:6
**webpack_require**.e @ ensure chunk:5
fn.e @ hot module replacement:81
loader @ routes.ts:64
load @ index.esm.js:231
retry @ index.esm.js:421
LoadableSubscription @ index.esm.js:406
init @ index.esm.js:311
LoadableComponent @ index.esm.js:352
renderWithHooks @ react-dom.development.js:16175
updateForwardRef @ react-dom.development.js:20023
beginWork @ react-dom.development.js:22465
beginWork$1 @ react-dom.development.js:27381
performUnitOfWork @ react-dom.development.js:26513
workLoopSync @ react-dom.development.js:26422
renderRootSync @ react-dom.development.js:26390
performConcurrentWorkOnRoot @ react-dom.development.js:25694
workLoop @ scheduler.development.js:266
flushWork @ scheduler.development.js:239
performWorkUntilDeadline @ scheduler.development.js:533
queue.<computed> @ task.js:52
run @ task.js:25
listener @ task.js:36
postMessage（异步）
post @ task.js:41
setImmediate @ task.js:54
schedulePerformWorkUntilDeadline @ scheduler.development.js:564
requestHostCallback @ scheduler.development.js:588
unstable_scheduleCallback @ scheduler.development.js:441
scheduleCallback$1 @ react-dom.development.js:27491
ensureRootIsScheduled @ react-dom.development.js:25639
scheduleUpdateOnFiber @ react-dom.development.js:25428
dispatchReducerAction @ react-dom.development.js:17316
checkForUpdates @ useSelector.js:74
handleChangeWrapper @ Subscription.js:95
（匿名） @ Subscription.js:23
batchedUpdates$1 @ react-dom.development.js:26096
notify @ Subscription.js:19
notifyNestedSubs @ Subscription.js:90
handleChangeWrapper @ Subscription.js:95
dispatch @ redux.js:297
（匿名） @ middleware.js:66
（匿名） @ index.esm.js:787
（匿名） @ middleware.js:22
（匿名） @ index.esm.js:819
（匿名） @ global.ts:322
（匿名） @ index.esm.js:268
setTimeout（异步）
（匿名） @ index.esm.js:267
listener @ history.js:159
（匿名） @ history.js:177
notifyListeners @ history.js:176
setState @ history.js:292
（匿名） @ history.js:373
confirmTransitionTo @ history.js:149
push @ history.js:354
roomListClick @ index.tsx:24
callCallback @ react-dom.development.js:4161
invokeGuardedCallbackDev @ react-dom.development.js:4210
invokeGuardedCallback @ react-dom.development.js:4274
invokeGuardedCallbackAndCatchFirstError @ react-dom.development.js:4288
executeDispatch @ react-dom.development.js:9038
processDispatchQueueItemsInOrder @ react-dom.development.js:9070
processDispatchQueue @ react-dom.development.js:9083
dispatchEventsForPlugins @ react-dom.development.js:9094
（匿名） @ react-dom.development.js:9285
batchedUpdates$1 @ react-dom.development.js:26096
batchedUpdates @ react-dom.development.js:3988
dispatchEventForPluginEventSystem @ react-dom.development.js:9284
dispatchEventWithEnableCapturePhaseSelectiveHydrationWithoutDiscreteEventReplay @ react-dom.development.js:6462
dispatchEvent @ react-dom.development.js:6454
dispatchDiscreteEvent @ react-dom.development.js:6427
devScripts.js:6523 [@umijs/runtime] load component failed ChunkLoadError: Loading chunk p**room-list**index failed.
(error: **\*\*\*****index.js)
at Object.**webpack_require**.f.j (jsonp chunk loading:27:1)
at ensure chunk:6:1
at Array.reduce (<anonymous>)
at Function.**webpack_require\_\_.e (ensure chunk:5:1)
at Function.fn.e (hot module replacement:81:1)
at loader (routes.ts:64:46)
at LoadableSubscription.load [as _loadFn] (index.esm.js:231:17)
at LoadableSubscription.retry (index.esm.js:421:24)
at new LoadableSubscription (index.esm.js:406:10)
at init (index.esm.js:311:17)
at LoadableComponent (index.esm.js:352:5)
at renderWithHooks (react-dom.development.js:16175:1)
at updateForwardRef (react-dom.development.js:20023:1)
at beginWork (react-dom.development.js:22465:1)
at beginWork$1 (react-dom.development.js:27381:1)
at performUnitOfWork (react-dom.development.js:26513:1)
at workLoopSync (react-dom.development.js:26422:1)
at renderRootSync (react-dom.development.js:26390:1)
at performConcurrentWorkOnRoot (react-dom.development.js:25694:1)
at workLoop (scheduler.development.js:266:34)
at flushWork (scheduler.development.js:239:14)
at performWorkUntilDeadline (scheduler.development.js:533:21)
at queue.<computed> (task.js:52:1)
at run (task.js:25:1)
at listener (task.js:36:1)

<!-- A clear and concise description of what the bug is. -->
<!-- 清晰的描述下遇到的问题。-->

## Mini Showcase Repository(REQUIRED)

> Please provide a repository using `yarn create @umijs/umi-app` then upload to your GitHub 请提供一个可复现的仓库，使用 `yarn create @umijs/umi-app` 创建，并上传到你的 GitHub 仓库

<!-- 为节约大家的时间，无复现步骤的 ISSUE 会被关闭，提供之后再 REOPEN -->
<!-- https://github.com/YOUR_REPOSITORY_URL -->

## How To Reproduce

**Steps to reproduce the behavior:** 1. 2.

**Expected behavior** 1. 2.

<!-- 请提供复现链接/步骤，错误日志以及相关配置 -->

umi 3.5.23升级3.5.24
react react-dom 17.0.2升级18.1.0
开发环境开启msfu或关闭msfu都存在问题！
现状：路由跳转下一个页面，加载js报错，但刷新页面后正常。后面又路由跳转下一个页面，加载js报错。
希望：不报错，跳转路由页面，正常显示。

## Context

- **Umi Version**:3.5.24
- **Node Version**:14.19.3
- **Platform**:mac os 12.3.1

## cat-walk

咋就关了？ 也没个结果啊

## zhupp034

我也遇到同样的问题

## liangskyli

用react18的话，升级到umi4吧

------------------ 原始邮件 ------------------
发件人: zhupengpeng **_@_**.**_&gt;
发送时间: 2023年8月17日 14:04
收件人: umijs/umi _**@**_._**&gt;
抄送: liangsky **_@_**.**_&gt;, Author _**@**_._**&gt;
主题: Re: [umijs/umi] [Bug] react18.1下，msfu(关闭mfsu也有问题)路由下一个页面，加载js报错，但刷新页面后正常。 (Issue #8127)

我也遇到同样的问题

—
Reply to this email directly, view it on GitHub, or unsubscribe.
You are receiving this because you authored the thread.Message ID: **_@_**.\*\*\*&gt;

## ywzou

我这边使用Webscoket通讯后，也遇到同样的问题，没有Webscoket消息都正常
