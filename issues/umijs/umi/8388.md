# [Bug] umi4打包后index.html中js缺失

在配置中使用了`chainWebpack`，如下：

```javascript
chainWebpack(config: any) {
    const isDev = process.env.NODE_ENV === 'development';
    const hash = !isDev ? '.[contenthash:8]' : '';

    config.output.filename(`static/js/[name]${hash}.js`);
    config.output.chunkFilename(`static/js/[name]${hash}.chunk.js`);

    config.plugin('extract-css').use(MiniCssExtractPlugin).tap((args: any) => [
      {
        ...args[0],
        chunkFilename: `static/css/[name]${hash}.chunk.css`,
        filename: `static/[name]${hash}.css`,
      },
    ]);
  },
```

在打包后发现`index.html`中未注入就是，经查看发现在`https://github.com/umijs/umi/blob/master/packages/preset-umi/src/commands/dev/getAssetsMap.ts`中这个`UMI_ASSETS_REG`里面的正则取的是以`umi`开头的，而我的资源路径是`static/js/umi.135d6641.js`，所以匹配不到，希望官方可以修复一下这个问题

我的项目`umi`版本是`4.0.5`

ps：在`umi3`系列中是可以正常运行的，望4.x系列中继续支持，谢谢！

## sorrycc

不建议修改产物目录结构；如需修改，需自行排查问题并提 PR 解决。

## qianxiaofendou

> 不建议修改产物目录结构；如需修改，需自行排查问题并提 PR 解决。

因为我们这边会有权限管控 只有static目录下的文件权限拦截会放过 因此我们这里面的所有项目的静态资源文件都是在static目录下的，index.html文件除外，所有希望可以修改上面的正则匹配规则，支持修改构建产物目录，我们的项目现已降级到umi3了，希望umi4早日支持！

@sorrycc

## cx91

@qianxiaofendou
可以试着在plugin.ts 文件中自己写逻辑去添加js引用

import type { IApi } from "umi";
const packageName = require('./package.json').name;

export default (api: IApi) => {
$("body").append([
        `<script src="${packageName}-umi.js"></script>`
]);
return $;
});
};

## Liu-0114

我现在也用umi4修改打包配置遇到了相同的问题，

```js
chainWebpack(config) {
    // 修改js，js chunk文件输出目录
    config.output
      .filename(assetDir + '/js/[name].js')
      .chunkFilename(assetDir + '/js/[name].js')
    config.plugin("extract-css").use(require('mini-css-extract-plugin')).tap(() => [
      {
        filename: `${assetDir}/css/[name].css`,
        chunkFilename: `${assetDir}/css/[name].chunk.css`,
        ignoreOrder: true,
      },
    ]);
  },
```

打包成功，但是项目运行后，不请求js资源，
请问这个问题有解决吗？谢谢！

## fz6m

请不要自行定义 umi 4 产物的位置，由于内部存在一些固定写死为 `umi.js` 的产物约定，自行改变目录会产生问题引发线上事故，请不要这么做。
