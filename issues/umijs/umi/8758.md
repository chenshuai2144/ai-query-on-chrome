# [Bug] Umi4使用脚本生成测试文件后，运行测试报错`Invalid config keys: antd`

<!--
⚠️ ⚠️ ⚠️ 注意：讨论和提问请到讨论区（https://github.com/umijs/umi/discussions），否则会被直接关掉。 ⚠️ ⚠️ ⚠️
-->
<!--
感谢您向我们反馈问题，为了高效的解决问题，我们期望你能提供以下信息：
-->

## Umi4单元测试报错

<!-- A clear and concise description of what the bug is. -->
<!-- 清晰的描述下遇到的问题。-->

## Mini Showcase Repository(REQUIRED)

https://github.com/hackers267/test_error.git

<!-- 为节约大家的时间，无复现步骤的 ISSUE 会被关闭，提供之后再 REOPEN -->
<!-- https://github.com/YOUR_REPOSITORY_URL -->

## How To Reproduce

下载仓库，然后执行下面的命令即可复现。

```
pnpm install
pnpm test
```

<!-- 请提供复现链接/步骤，错误日志以及相关配置 -->

报错：

```
Error: Jest: Failed to parse the TypeScript config file jest.config.ts
  AssertionError [ERR_ASSERTION]: Invalid config keys: antd, access, model, initialState, request, layout
    at readConfigFileAndSetRootDir (node_modules/jest/node_modules/jest-config/build/readConfigFileAndSetRootDir.js:136:13)
    at processTicksAndRejections (internal/process/task_queues.js:95:5)
    at async readConfig (node_modules/jest/node_modules/jest-config/build/index.js:233:18)
    at async readConfigs (node_modules/jest/node_modules/jest-config/build/index.js:420:26)
    at async runCLI (node_modules/@jest/core/build/cli/index.js:132:59)
    at async Object.run (node_modules/jest/node_modules/jest-cli/build/cli/index.js:155:37)
 ELIFECYCLE  Test failed. See above for more details.
```

## Context

- **Umi Version**: umi@4.0.9
- **Node Version**: v14.19.3
- **Platform**: Linux

一个临时的解决方案是可以在使用测试的时候自定义环境变量：`UMI_PRESETS=<rootDir>/node_modules/@umijs/max/dist/preset.js`;

是不是可以在UMI为添加`test`命令，因为在使用UMI命令的时候，可以自动设置`UMI_PRESETS`环境变量。

## Echo-minn

我执行`npm start`也报同样的错

## ihavecoke

使用 @umijs/plugins 在 config.ts 中配置 {antd:{}}

## fz6m

将 `jest.config.ts` 中的导入换为 max ：

```diff
// jest.config.ts

-import { ... } from 'umi/test'
+import { ... } from '@umijs/max/test'
```

## hackers267

> 将 `jest.config.ts` 中的导入换为 max ：
>
> ```diff
> // jest.config.ts
>
> -import { ... } from 'umi/test'
> +import { ... } from '@umijs/max/test'
> ```

这个可以解决问题。希望可以在自动生成`jest.config.ts`的时候，自动使用这个方案。

## fz6m

你使用的是什么生成的？max 的生成器是：

```bash
  pnpm max g jest
```

## hackers267

>

使用的是umi生成器：

```
pnpm umi g jest
```

居然也可以使用，但生成的是错误的代码片段。

## zhangxinyong12

解决了吗？我也遇到了同样的问题。我没看懂，应该怎么解决。help

## ScauBosco

>

这个可以
